import{R as Pu,r as Ie}from"./react-router-DnJdZ7Pr.js";import{c as q1,u as _s,a as Bc,s as Py,b as ig}from"./r3f-fiber-ECY7sA7Z.js";import{g as ei,D as ng,h as $n,P as sg,O as rg,Q as Xr,M as jr,j as W1,k as Za,C as Qi,E as Z1,l as eb,m as tb,n as bd,o as Ny,p as Gy,q as ul,F as Ac,r as jn,s as ib,t as nb,u as sb,I as rb,v as Hy,w as Ky,x as ab,y as ob,z as cl,G as lb,H as Vy,J as ub,K as cb,X as fb,Y as eo,Z as hb,_ as xd,$ as db,a0 as gb,a1 as mb,a2 as Ph,a3 as pb,a4 as $y,a5 as za,a6 as Ab,a7 as Yy,a8 as vb,a9 as Mc,aa as yb,ab as Eb,ac as Tb,ad as Sb,ae as Nh,af as ag,ag as bb,ah as xb,ai as Cb,aj as Rb,ak as zy,al as Lb,am as Cd,an as cA,ao as fA,ap as hA,aq as Db,ar as _b,as as og,at as jy,au as Ib,av as Bb,aw as Mb,ax as Jy,ay as Ob,az as Fb,aA as kb,aB as lg,aC as wb,aD as Ub,aE as Pb,aF as Nb,aG as Gb,aH as Hb,aI as Kb}from"./three-QB82UnXe.js";import{r as Vb,a as $b,g as Yb}from"./react-Bzgz95E1.js";var Gh={exports:{}},qo={},Hh={exports:{}},Kh={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dA;function zb(){return dA||(dA=1,(function(l){function e(k,K){var Q=k.length;k.push(K);e:for(;0<Q;){var j=Q-1>>>1,J=k[j];if(0<n(J,K))k[j]=K,k[Q]=J,Q=j;else break e}}function t(k){return k.length===0?null:k[0]}function i(k){if(k.length===0)return null;var K=k[0],Q=k.pop();if(Q!==K){k[0]=Q;e:for(var j=0,J=k.length,U=J>>>1;j<U;){var N=2*(j+1)-1,V=k[N],q=N+1,X=k[q];if(0>n(V,Q))q<J&&0>n(X,V)?(k[j]=X,k[q]=Q,j=q):(k[j]=V,k[N]=Q,j=N);else if(q<J&&0>n(X,Q))k[j]=X,k[q]=Q,j=q;else break e}}return K}function n(k,K){var Q=k.sortIndex-K.sortIndex;return Q!==0?Q:k.id-K.id}if(l.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;l.unstable_now=function(){return r.now()}}else{var o=Date,u=o.now();l.unstable_now=function(){return o.now()-u}}var f=[],h=[],d=1,m=null,p=3,v=!1,y=!1,T=!1,S=!1,b=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,L=typeof setImmediate<"u"?setImmediate:null;function D(k){for(var K=t(h);K!==null;){if(K.callback===null)i(h);else if(K.startTime<=k)i(h),K.sortIndex=K.expirationTime,e(f,K);else break;K=t(h)}}function _(k){if(T=!1,D(k),!y)if(t(f)!==null)y=!0,w||(w=!0,P());else{var K=t(h);K!==null&&Z(_,K.startTime-k)}}var w=!1,I=-1,O=5,F=-1;function M(){return S?!0:!(l.unstable_now()-F<O)}function H(){if(S=!1,w){var k=l.unstable_now();F=k;var K=!0;try{e:{y=!1,T&&(T=!1,C(I),I=-1),v=!0;var Q=p;try{t:{for(D(k),m=t(f);m!==null&&!(m.expirationTime>k&&M());){var j=m.callback;if(typeof j=="function"){m.callback=null,p=m.priorityLevel;var J=j(m.expirationTime<=k);if(k=l.unstable_now(),typeof J=="function"){m.callback=J,D(k),K=!0;break t}m===t(f)&&i(f),D(k)}else i(f);m=t(f)}if(m!==null)K=!0;else{var U=t(h);U!==null&&Z(_,U.startTime-k),K=!1}}break e}finally{m=null,p=Q,v=!1}K=void 0}}finally{K?P():w=!1}}}var P;if(typeof L=="function")P=function(){L(H)};else if(typeof MessageChannel<"u"){var z=new MessageChannel,Y=z.port2;z.port1.onmessage=H,P=function(){Y.postMessage(null)}}else P=function(){b(H,0)};function Z(k,K){I=b(function(){k(l.unstable_now())},K)}l.unstable_IdlePriority=5,l.unstable_ImmediatePriority=1,l.unstable_LowPriority=4,l.unstable_NormalPriority=3,l.unstable_Profiling=null,l.unstable_UserBlockingPriority=2,l.unstable_cancelCallback=function(k){k.callback=null},l.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<k?Math.floor(1e3/k):5},l.unstable_getCurrentPriorityLevel=function(){return p},l.unstable_next=function(k){switch(p){case 1:case 2:case 3:var K=3;break;default:K=p}var Q=p;p=K;try{return k()}finally{p=Q}},l.unstable_requestPaint=function(){S=!0},l.unstable_runWithPriority=function(k,K){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var Q=p;p=k;try{return K()}finally{p=Q}},l.unstable_scheduleCallback=function(k,K,Q){var j=l.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?j+Q:j):Q=j,k){case 1:var J=-1;break;case 2:J=250;break;case 5:J=1073741823;break;case 4:J=1e4;break;default:J=5e3}return J=Q+J,k={id:d++,callback:K,priorityLevel:k,startTime:Q,expirationTime:J,sortIndex:-1},Q>j?(k.sortIndex=Q,e(h,k),t(f)===null&&k===t(h)&&(T?(C(I),I=-1):T=!0,Z(_,Q-j))):(k.sortIndex=J,e(f,k),y||v||(y=!0,w||(w=!0,P()))),k},l.unstable_shouldYield=M,l.unstable_wrapCallback=function(k){var K=p;return function(){var Q=p;p=K;try{return k.apply(this,arguments)}finally{p=Q}}}})(Kh)),Kh}var gA;function jb(){return gA||(gA=1,Hh.exports=zb()),Hh.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mA;function Jb(){if(mA)return qo;mA=1;var l=jb(),e=Vb(),t=$b();function i(s){var a="https://react.dev/errors/"+s;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)a+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+s+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function r(s){var a=s,c=s;if(s.alternate)for(;a.return;)a=a.return;else{s=a;do a=s,(a.flags&4098)!==0&&(c=a.return),s=a.return;while(s)}return a.tag===3?c:null}function o(s){if(s.tag===13){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function u(s){if(s.tag===31){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function f(s){if(r(s)!==s)throw Error(i(188))}function h(s){var a=s.alternate;if(!a){if(a=r(s),a===null)throw Error(i(188));return a!==s?null:s}for(var c=s,g=a;;){var A=c.return;if(A===null)break;var E=A.alternate;if(E===null){if(g=A.return,g!==null){c=g;continue}break}if(A.child===E.child){for(E=A.child;E;){if(E===c)return f(A),s;if(E===g)return f(A),a;E=E.sibling}throw Error(i(188))}if(c.return!==g.return)c=A,g=E;else{for(var x=!1,B=A.child;B;){if(B===c){x=!0,c=A,g=E;break}if(B===g){x=!0,g=A,c=E;break}B=B.sibling}if(!x){for(B=E.child;B;){if(B===c){x=!0,c=E,g=A;break}if(B===g){x=!0,g=E,c=A;break}B=B.sibling}if(!x)throw Error(i(189))}}if(c.alternate!==g)throw Error(i(190))}if(c.tag!==3)throw Error(i(188));return c.stateNode.current===c?s:a}function d(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s;for(s=s.child;s!==null;){if(a=d(s),a!==null)return a;s=s.sibling}return null}var m=Object.assign,p=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),C=Symbol.for("react.consumer"),L=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),w=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),O=Symbol.for("react.lazy"),F=Symbol.for("react.activity"),M=Symbol.for("react.memo_cache_sentinel"),H=Symbol.iterator;function P(s){return s===null||typeof s!="object"?null:(s=H&&s[H]||s["@@iterator"],typeof s=="function"?s:null)}var z=Symbol.for("react.client.reference");function Y(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===z?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case T:return"Fragment";case b:return"Profiler";case S:return"StrictMode";case _:return"Suspense";case w:return"SuspenseList";case F:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case y:return"Portal";case L:return s.displayName||"Context";case C:return(s._context.displayName||"Context")+".Consumer";case D:var a=s.render;return s=s.displayName,s||(s=a.displayName||a.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case I:return a=s.displayName||null,a!==null?a:Y(s.type)||"Memo";case O:a=s._payload,s=s._init;try{return Y(s(a))}catch{}}return null}var Z=Array.isArray,k=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q={pending:!1,data:null,method:null,action:null},j=[],J=-1;function U(s){return{current:s}}function N(s){0>J||(s.current=j[J],j[J]=null,J--)}function V(s,a){J++,j[J]=s.current,s.current=a}var q=U(null),X=U(null),re=U(null),oe=U(null);function le(s,a){switch(V(re,a),V(X,s),V(q,null),a.nodeType){case 9:case 11:s=(s=a.documentElement)&&(s=s.namespaceURI)?Op(s):0;break;default:if(s=a.tagName,a=a.namespaceURI)a=Op(a),s=Fp(a,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}N(q),V(q,s)}function ve(){N(q),N(X),N(re)}function ye(s){s.memoizedState!==null&&V(oe,s);var a=q.current,c=Fp(a,s.type);a!==c&&(V(X,s),V(q,c))}function fe(s){X.current===s&&(N(q),N(X)),oe.current===s&&(N(oe),jo._currentValue=Q)}var me,Pe;function Be(s){if(me===void 0)try{throw Error()}catch(c){var a=c.stack.trim().match(/\n( *(at )?)/);me=a&&a[1]||"",Pe=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+me+s+Pe}var Ce=!1;function Ae(s,a){if(!s||Ce)return"";Ce=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var g={DetermineComponentFrameRoot:function(){try{if(a){var ge=function(){throw Error()};if(Object.defineProperty(ge.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ge,[])}catch(ae){var se=ae}Reflect.construct(s,[],ge)}else{try{ge.call()}catch(ae){se=ae}s.call(ge.prototype)}}else{try{throw Error()}catch(ae){se=ae}(ge=s())&&typeof ge.catch=="function"&&ge.catch(function(){})}}catch(ae){if(ae&&se&&typeof ae.stack=="string")return[ae.stack,se.stack]}return[null,null]}};g.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var A=Object.getOwnPropertyDescriptor(g.DetermineComponentFrameRoot,"name");A&&A.configurable&&Object.defineProperty(g.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var E=g.DetermineComponentFrameRoot(),x=E[0],B=E[1];if(x&&B){var G=x.split(`
`),ne=B.split(`
`);for(A=g=0;g<G.length&&!G[g].includes("DetermineComponentFrameRoot");)g++;for(;A<ne.length&&!ne[A].includes("DetermineComponentFrameRoot");)A++;if(g===G.length||A===ne.length)for(g=G.length-1,A=ne.length-1;1<=g&&0<=A&&G[g]!==ne[A];)A--;for(;1<=g&&0<=A;g--,A--)if(G[g]!==ne[A]){if(g!==1||A!==1)do if(g--,A--,0>A||G[g]!==ne[A]){var ue=`
`+G[g].replace(" at new "," at ");return s.displayName&&ue.includes("<anonymous>")&&(ue=ue.replace("<anonymous>",s.displayName)),ue}while(1<=g&&0<=A);break}}}finally{Ce=!1,Error.prepareStackTrace=c}return(c=s?s.displayName||s.name:"")?Be(c):""}function Ee(s,a){switch(s.tag){case 26:case 27:case 5:return Be(s.type);case 16:return Be("Lazy");case 13:return s.child!==a&&a!==null?Be("Suspense Fallback"):Be("Suspense");case 19:return Be("SuspenseList");case 0:case 15:return Ae(s.type,!1);case 11:return Ae(s.type.render,!1);case 1:return Ae(s.type,!0);case 31:return Be("Activity");default:return""}}function pe(s){try{var a="",c=null;do a+=Ee(s,c),c=s,s=s.return;while(s);return a}catch(g){return`
Error generating stack: `+g.message+`
`+g.stack}}var Re=Object.prototype.hasOwnProperty,Te=l.unstable_scheduleCallback,de=l.unstable_cancelCallback,He=l.unstable_shouldYield,Le=l.unstable_requestPaint,Se=l.unstable_now,be=l.unstable_getCurrentPriorityLevel,qe=l.unstable_ImmediatePriority,De=l.unstable_UserBlockingPriority,Oe=l.unstable_NormalPriority,Ne=l.unstable_LowPriority,Ye=l.unstable_IdlePriority,ct=l.log,Bt=l.unstable_setDisableYieldValue,Xe=null,Ke=null;function we(s){if(typeof ct=="function"&&Bt(s),Ke&&typeof Ke.setStrictMode=="function")try{Ke.setStrictMode(Xe,s)}catch{}}var rt=Math.clz32?Math.clz32:yt,Dt=Math.log,Ai=Math.LN2;function yt(s){return s>>>=0,s===0?32:31-(Dt(s)/Ai|0)|0}var Ve=256,ft=262144,wi=4194304;function at(s){var a=s&42;if(a!==0)return a;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function We(s,a,c){var g=s.pendingLanes;if(g===0)return 0;var A=0,E=s.suspendedLanes,x=s.pingedLanes;s=s.warmLanes;var B=g&134217727;return B!==0?(g=B&~E,g!==0?A=at(g):(x&=B,x!==0?A=at(x):c||(c=B&~s,c!==0&&(A=at(c))))):(B=g&~E,B!==0?A=at(B):x!==0?A=at(x):c||(c=g&~s,c!==0&&(A=at(c)))),A===0?0:a!==0&&a!==A&&(a&E)===0&&(E=A&-A,c=a&-a,E>=c||E===32&&(c&4194048)!==0)?a:A}function _t(s,a){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&a)===0}function It(s,a){switch(s){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Je(){var s=wi;return wi<<=1,(wi&62914560)===0&&(wi=4194304),s}function Et(s){for(var a=[],c=0;31>c;c++)a.push(s);return a}function zt(s,a){s.pendingLanes|=a,a!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function ai(s,a,c,g,A,E){var x=s.pendingLanes;s.pendingLanes=c,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=c,s.entangledLanes&=c,s.errorRecoveryDisabledLanes&=c,s.shellSuspendCounter=0;var B=s.entanglements,G=s.expirationTimes,ne=s.hiddenUpdates;for(c=x&~c;0<c;){var ue=31-rt(c),ge=1<<ue;B[ue]=0,G[ue]=-1;var se=ne[ue];if(se!==null)for(ne[ue]=null,ue=0;ue<se.length;ue++){var ae=se[ue];ae!==null&&(ae.lane&=-536870913)}c&=~ge}g!==0&&Kt(s,g,0),E!==0&&A===0&&s.tag!==0&&(s.suspendedLanes|=E&~(x&~a))}function Kt(s,a,c){s.pendingLanes|=a,s.suspendedLanes&=~a;var g=31-rt(a);s.entangledLanes|=a,s.entanglements[g]=s.entanglements[g]|1073741824|c&261930}function Ri(s,a){var c=s.entangledLanes|=a;for(s=s.entanglements;c;){var g=31-rt(c),A=1<<g;A&a|s[g]&a&&(s[g]|=a),c&=~A}}function mn(s,a){var c=a&-a;return c=(c&42)!==0?1:Ui(c),(c&(s.suspendedLanes|a))!==0?0:c}function Ui(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function qi(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function Rn(){var s=K.p;return s!==0?s:(s=window.event,s===void 0?32:nA(s.type))}function Wi(s,a){var c=K.p;try{return K.p=s,a()}finally{K.p=c}}var kt=Math.random().toString(36).slice(2),Mt="__reactFiber$"+kt,fi="__reactProps$"+kt,Ln="__reactContainer$"+kt,ro="__reactEvents$"+kt,Ll="__reactListeners$"+kt,Qr="__reactHandles$"+kt,qr="__reactResources$"+kt,hr="__reactMarker$"+kt;function Wr(s){delete s[Mt],delete s[fi],delete s[ro],delete s[Ll],delete s[Qr]}function pn(s){var a=s[Mt];if(a)return a;for(var c=s.parentNode;c;){if(a=c[Ln]||c[Mt]){if(c=a.alternate,a.child!==null||c!==null&&c.child!==null)for(s=Hp(s);s!==null;){if(c=s[Mt])return c;s=Hp(s)}return a}s=c,c=s.parentNode}return null}function Dn(s){if(s=s[Mt]||s[Ln]){var a=s.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return s}return null}function Jn(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s.stateNode;throw Error(i(33))}function Fe(s){var a=s[qr];return a||(a=s[qr]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function wt(s){s[hr]=!0}var Dl=new Set,Xn={};function Zi(s,a){Qn(s,a),Qn(s+"Capture",a)}function Qn(s,a){for(Xn[s]=a,s=0;s<a.length;s++)Dl.add(a[s])}var ao=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),dr={},gr={};function _l(s){return Re.call(gr,s)?!0:Re.call(dr,s)?!1:ao.test(s)?gr[s]=!0:(dr[s]=!0,!1)}function qn(s,a,c){if(_l(a))if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":s.removeAttribute(a);return;case"boolean":var g=a.toLowerCase().slice(0,5);if(g!=="data-"&&g!=="aria-"){s.removeAttribute(a);return}}s.setAttribute(a,""+c)}}function mr(s,a,c){if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(a);return}s.setAttribute(a,""+c)}}function Pi(s,a,c,g){if(g===null)s.removeAttribute(c);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttributeNS(a,c,""+g)}}function Ti(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Ms(s){var a=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function oo(s,a,c){var g=Object.getOwnPropertyDescriptor(s.constructor.prototype,a);if(!s.hasOwnProperty(a)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var A=g.get,E=g.set;return Object.defineProperty(s,a,{configurable:!0,get:function(){return A.call(this)},set:function(x){c=""+x,E.call(this,x)}}),Object.defineProperty(s,a,{enumerable:g.enumerable}),{getValue:function(){return c},setValue:function(x){c=""+x},stopTracking:function(){s._valueTracker=null,delete s[a]}}}}function _n(s){if(!s._valueTracker){var a=Ms(s)?"checked":"value";s._valueTracker=oo(s,a,""+s[a])}}function Zr(s){if(!s)return!1;var a=s._valueTracker;if(!a)return!0;var c=a.getValue(),g="";return s&&(g=Ms(s)?s.checked?"true":"false":s.value),s=g,s!==c?(a.setValue(s),!0):!1}function Os(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var lo=/[\n"\\]/g;function Gt(s){return s.replace(lo,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function uo(s,a,c,g,A,E,x,B){s.name="",x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"?s.type=x:s.removeAttribute("type"),a!=null?x==="number"?(a===0&&s.value===""||s.value!=a)&&(s.value=""+Ti(a)):s.value!==""+Ti(a)&&(s.value=""+Ti(a)):x!=="submit"&&x!=="reset"||s.removeAttribute("value"),a!=null?Wn(s,x,Ti(a)):c!=null?Wn(s,x,Ti(c)):g!=null&&s.removeAttribute("value"),A==null&&E!=null&&(s.defaultChecked=!!E),A!=null&&(s.checked=A&&typeof A!="function"&&typeof A!="symbol"),B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"?s.name=""+Ti(B):s.removeAttribute("name")}function pr(s,a,c,g,A,E,x,B){if(E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"&&(s.type=E),a!=null||c!=null){if(!(E!=="submit"&&E!=="reset"||a!=null)){_n(s);return}c=c!=null?""+Ti(c):"",a=a!=null?""+Ti(a):c,B||a===s.value||(s.value=a),s.defaultValue=a}g=g??A,g=typeof g!="function"&&typeof g!="symbol"&&!!g,s.checked=B?s.checked:!!g,s.defaultChecked=!!g,x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(s.name=x),_n(s)}function Wn(s,a,c){a==="number"&&Os(s.ownerDocument)===s||s.defaultValue===""+c||(s.defaultValue=""+c)}function Zn(s,a,c,g){if(s=s.options,a){a={};for(var A=0;A<c.length;A++)a["$"+c[A]]=!0;for(c=0;c<s.length;c++)A=a.hasOwnProperty("$"+s[c].value),s[c].selected!==A&&(s[c].selected=A),A&&g&&(s[c].defaultSelected=!0)}else{for(c=""+Ti(c),a=null,A=0;A<s.length;A++){if(s[A].value===c){s[A].selected=!0,g&&(s[A].defaultSelected=!0);return}a!==null||s[A].disabled||(a=s[A])}a!==null&&(a.selected=!0)}}function Ar(s,a,c){if(a!=null&&(a=""+Ti(a),a!==s.value&&(s.value=a),c==null)){s.defaultValue!==a&&(s.defaultValue=a);return}s.defaultValue=c!=null?""+Ti(c):""}function vr(s,a,c,g){if(a==null){if(g!=null){if(c!=null)throw Error(i(92));if(Z(g)){if(1<g.length)throw Error(i(93));g=g[0]}c=g}c==null&&(c=""),a=c}c=Ti(a),s.defaultValue=c,g=s.textContent,g===c&&g!==""&&g!==null&&(s.value=g),_n(s)}function In(s,a){if(a){var c=s.firstChild;if(c&&c===s.lastChild&&c.nodeType===3){c.nodeValue=a;return}}s.textContent=a}var Il=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function co(s,a,c){var g=a.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?g?s.setProperty(a,""):a==="float"?s.cssFloat="":s[a]="":g?s.setProperty(a,c):typeof c!="number"||c===0||Il.has(a)?a==="float"?s.cssFloat=c:s[a]=(""+c).trim():s[a]=c+"px"}function ea(s,a,c){if(a!=null&&typeof a!="object")throw Error(i(62));if(s=s.style,c!=null){for(var g in c)!c.hasOwnProperty(g)||a!=null&&a.hasOwnProperty(g)||(g.indexOf("--")===0?s.setProperty(g,""):g==="float"?s.cssFloat="":s[g]="");for(var A in a)g=a[A],a.hasOwnProperty(A)&&c[A]!==g&&co(s,A,g)}else for(var E in a)a.hasOwnProperty(E)&&co(s,E,a[E])}function es(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Bl=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ta=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function An(s){return ta.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function vi(){}var ts=null;function ia(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var en=null,Bn=null;function na(s){var a=Dn(s);if(a&&(s=a.stateNode)){var c=s[fi]||null;e:switch(s=a.stateNode,a.type){case"input":if(uo(s,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),a=c.name,c.type==="radio"&&a!=null){for(c=s;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+Gt(""+a)+'"][type="radio"]'),a=0;a<c.length;a++){var g=c[a];if(g!==s&&g.form===s.form){var A=g[fi]||null;if(!A)throw Error(i(90));uo(g,A.value,A.defaultValue,A.defaultValue,A.checked,A.defaultChecked,A.type,A.name)}}for(a=0;a<c.length;a++)g=c[a],g.form===s.form&&Zr(g)}break e;case"textarea":Ar(s,c.value,c.defaultValue);break e;case"select":a=c.value,a!=null&&Zn(s,!!c.multiple,a,!1)}}}var sa=!1;function yr(s,a,c){if(sa)return s(a,c);sa=!0;try{var g=s(a);return g}finally{if(sa=!1,(en!==null||Bn!==null)&&(pu(),en&&(a=en,s=Bn,Bn=en=null,na(a),s)))for(a=0;a<s.length;a++)na(s[a])}}function is(s,a){var c=s.stateNode;if(c===null)return null;var g=c[fi]||null;if(g===null)return null;c=g[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(s=s.type,g=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!g;break e;default:s=!1}if(s)return null;if(c&&typeof c!="function")throw Error(i(231,a,typeof c));return c}var tn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Si=!1;if(tn)try{var ns={};Object.defineProperty(ns,"passive",{get:function(){Si=!0}}),window.addEventListener("test",ns,ns),window.removeEventListener("test",ns,ns)}catch{Si=!1}var vn=null,ra=null,Fs=null;function fo(){if(Fs)return Fs;var s,a=ra,c=a.length,g,A="value"in vn?vn.value:vn.textContent,E=A.length;for(s=0;s<c&&a[s]===A[s];s++);var x=c-s;for(g=1;g<=x&&a[c-g]===A[E-g];g++);return Fs=A.slice(s,1<g?1-g:void 0)}function Er(s){var a=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&a===13&&(s=13)):s=a,s===10&&(s=13),32<=s||s===13?s:0}function Mn(){return!0}function ks(){return!1}function Ht(s){function a(c,g,A,E,x){this._reactName=c,this._targetInst=A,this.type=g,this.nativeEvent=E,this.target=x,this.currentTarget=null;for(var B in s)s.hasOwnProperty(B)&&(c=s[B],this[B]=c?c(E):E[B]);return this.isDefaultPrevented=(E.defaultPrevented!=null?E.defaultPrevented:E.returnValue===!1)?Mn:ks,this.isPropagationStopped=ks,this}return m(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Mn)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Mn)},persist:function(){},isPersistent:Mn}),a}var On={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ws=Ht(On),ss=m({},On,{view:0,detail:0}),Tr=Ht(ss),aa,rs,as,oi=m({},ss,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Kc,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==as&&(as&&s.type==="mousemove"?(aa=s.screenX-as.screenX,rs=s.screenY-as.screenY):rs=aa=0,as=s),aa)},movementY:function(s){return"movementY"in s?s.movementY:rs}}),Ml=Ht(oi),oa=m({},oi,{dataTransfer:0}),la=Ht(oa),Ol=m({},ss,{relatedTarget:0}),ho=Ht(Ol),yi=m({},On,{animationName:0,elapsedTime:0,pseudoElement:0}),Ni=Ht(yi),Ei=m({},On,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Fn=Ht(Ei),Fl=m({},On,{data:0}),Ug=Ht(Fl),sS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},rS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},aS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function oS(s){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(s):(s=aS[s])?!!a[s]:!1}function Kc(){return oS}var lS=m({},ss,{key:function(s){if(s.key){var a=sS[s.key]||s.key;if(a!=="Unidentified")return a}return s.type==="keypress"?(s=Er(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?rS[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Kc,charCode:function(s){return s.type==="keypress"?Er(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Er(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),uS=Ht(lS),cS=m({},oi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Pg=Ht(cS),fS=m({},ss,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Kc}),hS=Ht(fS),dS=m({},On,{propertyName:0,elapsedTime:0,pseudoElement:0}),gS=Ht(dS),mS=m({},oi,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),pS=Ht(mS),AS=m({},On,{newState:0,oldState:0}),vS=Ht(AS),yS=[9,13,27,32],Vc=tn&&"CompositionEvent"in window,go=null;tn&&"documentMode"in document&&(go=document.documentMode);var ES=tn&&"TextEvent"in window&&!go,Ng=tn&&(!Vc||go&&8<go&&11>=go),Gg=" ",Hg=!1;function Kg(s,a){switch(s){case"keyup":return yS.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vg(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var ua=!1;function TS(s,a){switch(s){case"compositionend":return Vg(a);case"keypress":return a.which!==32?null:(Hg=!0,Gg);case"textInput":return s=a.data,s===Gg&&Hg?null:s;default:return null}}function SS(s,a){if(ua)return s==="compositionend"||!Vc&&Kg(s,a)?(s=fo(),Fs=ra=vn=null,ua=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Ng&&a.locale!=="ko"?null:a.data;default:return null}}var bS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $g(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a==="input"?!!bS[s.type]:a==="textarea"}function Yg(s,a,c,g){en?Bn?Bn.push(g):Bn=[g]:en=g,a=bu(a,"onChange"),0<a.length&&(c=new ws("onChange","change",null,c,g),s.push({event:c,listeners:a}))}var mo=null,po=null;function xS(s){Lp(s,0)}function kl(s){var a=Jn(s);if(Zr(a))return s}function zg(s,a){if(s==="change")return a}var jg=!1;if(tn){var $c;if(tn){var Yc="oninput"in document;if(!Yc){var Jg=document.createElement("div");Jg.setAttribute("oninput","return;"),Yc=typeof Jg.oninput=="function"}$c=Yc}else $c=!1;jg=$c&&(!document.documentMode||9<document.documentMode)}function Xg(){mo&&(mo.detachEvent("onpropertychange",Qg),po=mo=null)}function Qg(s){if(s.propertyName==="value"&&kl(po)){var a=[];Yg(a,po,s,ia(s)),yr(xS,a)}}function CS(s,a,c){s==="focusin"?(Xg(),mo=a,po=c,mo.attachEvent("onpropertychange",Qg)):s==="focusout"&&Xg()}function RS(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return kl(po)}function LS(s,a){if(s==="click")return kl(a)}function DS(s,a){if(s==="input"||s==="change")return kl(a)}function _S(s,a){return s===a&&(s!==0||1/s===1/a)||s!==s&&a!==a}var Gi=typeof Object.is=="function"?Object.is:_S;function Ao(s,a){if(Gi(s,a))return!0;if(typeof s!="object"||s===null||typeof a!="object"||a===null)return!1;var c=Object.keys(s),g=Object.keys(a);if(c.length!==g.length)return!1;for(g=0;g<c.length;g++){var A=c[g];if(!Re.call(a,A)||!Gi(s[A],a[A]))return!1}return!0}function qg(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Wg(s,a){var c=qg(s);s=0;for(var g;c;){if(c.nodeType===3){if(g=s+c.textContent.length,s<=a&&g>=a)return{node:c,offset:a-s};s=g}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=qg(c)}}function Zg(s,a){return s&&a?s===a?!0:s&&s.nodeType===3?!1:a&&a.nodeType===3?Zg(s,a.parentNode):"contains"in s?s.contains(a):s.compareDocumentPosition?!!(s.compareDocumentPosition(a)&16):!1:!1}function em(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var a=Os(s.document);a instanceof s.HTMLIFrameElement;){try{var c=typeof a.contentWindow.location.href=="string"}catch{c=!1}if(c)s=a.contentWindow;else break;a=Os(s.document)}return a}function zc(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a&&(a==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||a==="textarea"||s.contentEditable==="true")}var IS=tn&&"documentMode"in document&&11>=document.documentMode,ca=null,jc=null,vo=null,Jc=!1;function tm(s,a,c){var g=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Jc||ca==null||ca!==Os(g)||(g=ca,"selectionStart"in g&&zc(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),vo&&Ao(vo,g)||(vo=g,g=bu(jc,"onSelect"),0<g.length&&(a=new ws("onSelect","select",null,a,c),s.push({event:a,listeners:g}),a.target=ca)))}function Sr(s,a){var c={};return c[s.toLowerCase()]=a.toLowerCase(),c["Webkit"+s]="webkit"+a,c["Moz"+s]="moz"+a,c}var fa={animationend:Sr("Animation","AnimationEnd"),animationiteration:Sr("Animation","AnimationIteration"),animationstart:Sr("Animation","AnimationStart"),transitionrun:Sr("Transition","TransitionRun"),transitionstart:Sr("Transition","TransitionStart"),transitioncancel:Sr("Transition","TransitionCancel"),transitionend:Sr("Transition","TransitionEnd")},Xc={},im={};tn&&(im=document.createElement("div").style,"AnimationEvent"in window||(delete fa.animationend.animation,delete fa.animationiteration.animation,delete fa.animationstart.animation),"TransitionEvent"in window||delete fa.transitionend.transition);function br(s){if(Xc[s])return Xc[s];if(!fa[s])return s;var a=fa[s],c;for(c in a)if(a.hasOwnProperty(c)&&c in im)return Xc[s]=a[c];return s}var nm=br("animationend"),sm=br("animationiteration"),rm=br("animationstart"),BS=br("transitionrun"),MS=br("transitionstart"),OS=br("transitioncancel"),am=br("transitionend"),om=new Map,Qc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Qc.push("scrollEnd");function yn(s,a){om.set(s,a),Zi(a,[s])}var wl=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},nn=[],ha=0,qc=0;function Ul(){for(var s=ha,a=qc=ha=0;a<s;){var c=nn[a];nn[a++]=null;var g=nn[a];nn[a++]=null;var A=nn[a];nn[a++]=null;var E=nn[a];if(nn[a++]=null,g!==null&&A!==null){var x=g.pending;x===null?A.next=A:(A.next=x.next,x.next=A),g.pending=A}E!==0&&lm(c,A,E)}}function Pl(s,a,c,g){nn[ha++]=s,nn[ha++]=a,nn[ha++]=c,nn[ha++]=g,qc|=g,s.lanes|=g,s=s.alternate,s!==null&&(s.lanes|=g)}function Wc(s,a,c,g){return Pl(s,a,c,g),Nl(s)}function xr(s,a){return Pl(s,null,null,a),Nl(s)}function lm(s,a,c){s.lanes|=c;var g=s.alternate;g!==null&&(g.lanes|=c);for(var A=!1,E=s.return;E!==null;)E.childLanes|=c,g=E.alternate,g!==null&&(g.childLanes|=c),E.tag===22&&(s=E.stateNode,s===null||s._visibility&1||(A=!0)),s=E,E=E.return;return s.tag===3?(E=s.stateNode,A&&a!==null&&(A=31-rt(c),s=E.hiddenUpdates,g=s[A],g===null?s[A]=[a]:g.push(a),a.lane=c|536870912),E):null}function Nl(s){if(50<Go)throw Go=0,lh=null,Error(i(185));for(var a=s.return;a!==null;)s=a,a=s.return;return s.tag===3?s.stateNode:null}var da={};function FS(s,a,c,g){this.tag=s,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Hi(s,a,c,g){return new FS(s,a,c,g)}function Zc(s){return s=s.prototype,!(!s||!s.isReactComponent)}function os(s,a){var c=s.alternate;return c===null?(c=Hi(s.tag,a,s.key,s.mode),c.elementType=s.elementType,c.type=s.type,c.stateNode=s.stateNode,c.alternate=s,s.alternate=c):(c.pendingProps=a,c.type=s.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=s.flags&65011712,c.childLanes=s.childLanes,c.lanes=s.lanes,c.child=s.child,c.memoizedProps=s.memoizedProps,c.memoizedState=s.memoizedState,c.updateQueue=s.updateQueue,a=s.dependencies,c.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},c.sibling=s.sibling,c.index=s.index,c.ref=s.ref,c.refCleanup=s.refCleanup,c}function um(s,a){s.flags&=65011714;var c=s.alternate;return c===null?(s.childLanes=0,s.lanes=a,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,a=c.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),s}function Gl(s,a,c,g,A,E){var x=0;if(g=s,typeof s=="function")Zc(s)&&(x=1);else if(typeof s=="string")x=N1(s,c,q.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case F:return s=Hi(31,c,a,A),s.elementType=F,s.lanes=E,s;case T:return Cr(c.children,A,E,a);case S:x=8,A|=24;break;case b:return s=Hi(12,c,a,A|2),s.elementType=b,s.lanes=E,s;case _:return s=Hi(13,c,a,A),s.elementType=_,s.lanes=E,s;case w:return s=Hi(19,c,a,A),s.elementType=w,s.lanes=E,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case L:x=10;break e;case C:x=9;break e;case D:x=11;break e;case I:x=14;break e;case O:x=16,g=null;break e}x=29,c=Error(i(130,s===null?"null":typeof s,"")),g=null}return a=Hi(x,c,a,A),a.elementType=s,a.type=g,a.lanes=E,a}function Cr(s,a,c,g){return s=Hi(7,s,g,a),s.lanes=c,s}function ef(s,a,c){return s=Hi(6,s,null,a),s.lanes=c,s}function cm(s){var a=Hi(18,null,null,0);return a.stateNode=s,a}function tf(s,a,c){return a=Hi(4,s.children!==null?s.children:[],s.key,a),a.lanes=c,a.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},a}var fm=new WeakMap;function sn(s,a){if(typeof s=="object"&&s!==null){var c=fm.get(s);return c!==void 0?c:(a={value:s,source:a,stack:pe(a)},fm.set(s,a),a)}return{value:s,source:a,stack:pe(a)}}var ga=[],ma=0,Hl=null,yo=0,rn=[],an=0,Us=null,kn=1,wn="";function ls(s,a){ga[ma++]=yo,ga[ma++]=Hl,Hl=s,yo=a}function hm(s,a,c){rn[an++]=kn,rn[an++]=wn,rn[an++]=Us,Us=s;var g=kn;s=wn;var A=32-rt(g)-1;g&=~(1<<A),c+=1;var E=32-rt(a)+A;if(30<E){var x=A-A%5;E=(g&(1<<x)-1).toString(32),g>>=x,A-=x,kn=1<<32-rt(a)+A|c<<A|g,wn=E+s}else kn=1<<E|c<<A|g,wn=s}function nf(s){s.return!==null&&(ls(s,1),hm(s,1,0))}function sf(s){for(;s===Hl;)Hl=ga[--ma],ga[ma]=null,yo=ga[--ma],ga[ma]=null;for(;s===Us;)Us=rn[--an],rn[an]=null,wn=rn[--an],rn[an]=null,kn=rn[--an],rn[an]=null}function dm(s,a){rn[an++]=kn,rn[an++]=wn,rn[an++]=Us,kn=a.id,wn=a.overflow,Us=s}var hi=null,Ot=null,ut=!1,Ps=null,on=!1,rf=Error(i(519));function Ns(s){var a=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Eo(sn(a,s)),rf}function gm(s){var a=s.stateNode,c=s.type,g=s.memoizedProps;switch(a[Mt]=s,a[fi]=g,c){case"dialog":nt("cancel",a),nt("close",a);break;case"iframe":case"object":case"embed":nt("load",a);break;case"video":case"audio":for(c=0;c<Ko.length;c++)nt(Ko[c],a);break;case"source":nt("error",a);break;case"img":case"image":case"link":nt("error",a),nt("load",a);break;case"details":nt("toggle",a);break;case"input":nt("invalid",a),pr(a,g.value,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name,!0);break;case"select":nt("invalid",a);break;case"textarea":nt("invalid",a),vr(a,g.value,g.defaultValue,g.children)}c=g.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||a.textContent===""+c||g.suppressHydrationWarning===!0||Bp(a.textContent,c)?(g.popover!=null&&(nt("beforetoggle",a),nt("toggle",a)),g.onScroll!=null&&nt("scroll",a),g.onScrollEnd!=null&&nt("scrollend",a),g.onClick!=null&&(a.onclick=vi),a=!0):a=!1,a||Ns(s,!0)}function mm(s){for(hi=s.return;hi;)switch(hi.tag){case 5:case 31:case 13:on=!1;return;case 27:case 3:on=!0;return;default:hi=hi.return}}function pa(s){if(s!==hi)return!1;if(!ut)return mm(s),ut=!0,!1;var a=s.tag,c;if((c=a!==3&&a!==27)&&((c=a===5)&&(c=s.type,c=!(c!=="form"&&c!=="button")||bh(s.type,s.memoizedProps)),c=!c),c&&Ot&&Ns(s),mm(s),a===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(317));Ot=Gp(s)}else if(a===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(317));Ot=Gp(s)}else a===27?(a=Ot,Zs(s.type)?(s=Dh,Dh=null,Ot=s):Ot=a):Ot=hi?un(s.stateNode.nextSibling):null;return!0}function Rr(){Ot=hi=null,ut=!1}function af(){var s=Ps;return s!==null&&(Ii===null?Ii=s:Ii.push.apply(Ii,s),Ps=null),s}function Eo(s){Ps===null?Ps=[s]:Ps.push(s)}var of=U(null),Lr=null,us=null;function Gs(s,a,c){V(of,a._currentValue),a._currentValue=c}function cs(s){s._currentValue=of.current,N(of)}function lf(s,a,c){for(;s!==null;){var g=s.alternate;if((s.childLanes&a)!==a?(s.childLanes|=a,g!==null&&(g.childLanes|=a)):g!==null&&(g.childLanes&a)!==a&&(g.childLanes|=a),s===c)break;s=s.return}}function uf(s,a,c,g){var A=s.child;for(A!==null&&(A.return=s);A!==null;){var E=A.dependencies;if(E!==null){var x=A.child;E=E.firstContext;e:for(;E!==null;){var B=E;E=A;for(var G=0;G<a.length;G++)if(B.context===a[G]){E.lanes|=c,B=E.alternate,B!==null&&(B.lanes|=c),lf(E.return,c,s),g||(x=null);break e}E=B.next}}else if(A.tag===18){if(x=A.return,x===null)throw Error(i(341));x.lanes|=c,E=x.alternate,E!==null&&(E.lanes|=c),lf(x,c,s),x=null}else x=A.child;if(x!==null)x.return=A;else for(x=A;x!==null;){if(x===s){x=null;break}if(A=x.sibling,A!==null){A.return=x.return,x=A;break}x=x.return}A=x}}function Aa(s,a,c,g){s=null;for(var A=a,E=!1;A!==null;){if(!E){if((A.flags&524288)!==0)E=!0;else if((A.flags&262144)!==0)break}if(A.tag===10){var x=A.alternate;if(x===null)throw Error(i(387));if(x=x.memoizedProps,x!==null){var B=A.type;Gi(A.pendingProps.value,x.value)||(s!==null?s.push(B):s=[B])}}else if(A===oe.current){if(x=A.alternate,x===null)throw Error(i(387));x.memoizedState.memoizedState!==A.memoizedState.memoizedState&&(s!==null?s.push(jo):s=[jo])}A=A.return}s!==null&&uf(a,s,c,g),a.flags|=262144}function Kl(s){for(s=s.firstContext;s!==null;){if(!Gi(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function Dr(s){Lr=s,us=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function di(s){return pm(Lr,s)}function Vl(s,a){return Lr===null&&Dr(s),pm(s,a)}function pm(s,a){var c=a._currentValue;if(a={context:a,memoizedValue:c,next:null},us===null){if(s===null)throw Error(i(308));us=a,s.dependencies={lanes:0,firstContext:a},s.flags|=524288}else us=us.next=a;return c}var kS=typeof AbortController<"u"?AbortController:function(){var s=[],a=this.signal={aborted:!1,addEventListener:function(c,g){s.push(g)}};this.abort=function(){a.aborted=!0,s.forEach(function(c){return c()})}},wS=l.unstable_scheduleCallback,US=l.unstable_NormalPriority,Xt={$$typeof:L,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function cf(){return{controller:new kS,data:new Map,refCount:0}}function To(s){s.refCount--,s.refCount===0&&wS(US,function(){s.controller.abort()})}var So=null,ff=0,va=0,ya=null;function PS(s,a){if(So===null){var c=So=[];ff=0,va=gh(),ya={status:"pending",value:void 0,then:function(g){c.push(g)}}}return ff++,a.then(Am,Am),a}function Am(){if(--ff===0&&So!==null){ya!==null&&(ya.status="fulfilled");var s=So;So=null,va=0,ya=null;for(var a=0;a<s.length;a++)(0,s[a])()}}function NS(s,a){var c=[],g={status:"pending",value:null,reason:null,then:function(A){c.push(A)}};return s.then(function(){g.status="fulfilled",g.value=a;for(var A=0;A<c.length;A++)(0,c[A])(a)},function(A){for(g.status="rejected",g.reason=A,A=0;A<c.length;A++)(0,c[A])(void 0)}),g}var vm=k.S;k.S=function(s,a){tp=Se(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&PS(s,a),vm!==null&&vm(s,a)};var _r=U(null);function hf(){var s=_r.current;return s!==null?s:Ct.pooledCache}function $l(s,a){a===null?V(_r,_r.current):V(_r,a.pool)}function ym(){var s=hf();return s===null?null:{parent:Xt._currentValue,pool:s}}var Ea=Error(i(460)),df=Error(i(474)),Yl=Error(i(542)),zl={then:function(){}};function Em(s){return s=s.status,s==="fulfilled"||s==="rejected"}function Tm(s,a,c){switch(c=s[c],c===void 0?s.push(a):c!==a&&(a.then(vi,vi),a=c),a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,bm(s),s;default:if(typeof a.status=="string")a.then(vi,vi);else{if(s=Ct,s!==null&&100<s.shellSuspendCounter)throw Error(i(482));s=a,s.status="pending",s.then(function(g){if(a.status==="pending"){var A=a;A.status="fulfilled",A.value=g}},function(g){if(a.status==="pending"){var A=a;A.status="rejected",A.reason=g}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,bm(s),s}throw Br=a,Ea}}function Ir(s){try{var a=s._init;return a(s._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(Br=c,Ea):c}}var Br=null;function Sm(){if(Br===null)throw Error(i(459));var s=Br;return Br=null,s}function bm(s){if(s===Ea||s===Yl)throw Error(i(483))}var Ta=null,bo=0;function jl(s){var a=bo;return bo+=1,Ta===null&&(Ta=[]),Tm(Ta,s,a)}function xo(s,a){a=a.props.ref,s.ref=a!==void 0?a:null}function Jl(s,a){throw a.$$typeof===p?Error(i(525)):(s=Object.prototype.toString.call(a),Error(i(31,s==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":s)))}function xm(s){function a(W,$){if(s){var ie=W.deletions;ie===null?(W.deletions=[$],W.flags|=16):ie.push($)}}function c(W,$){if(!s)return null;for(;$!==null;)a(W,$),$=$.sibling;return null}function g(W){for(var $=new Map;W!==null;)W.key!==null?$.set(W.key,W):$.set(W.index,W),W=W.sibling;return $}function A(W,$){return W=os(W,$),W.index=0,W.sibling=null,W}function E(W,$,ie){return W.index=ie,s?(ie=W.alternate,ie!==null?(ie=ie.index,ie<$?(W.flags|=67108866,$):ie):(W.flags|=67108866,$)):(W.flags|=1048576,$)}function x(W){return s&&W.alternate===null&&(W.flags|=67108866),W}function B(W,$,ie,he){return $===null||$.tag!==6?($=ef(ie,W.mode,he),$.return=W,$):($=A($,ie),$.return=W,$)}function G(W,$,ie,he){var Ge=ie.type;return Ge===T?ue(W,$,ie.props.children,he,ie.key):$!==null&&($.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===O&&Ir(Ge)===$.type)?($=A($,ie.props),xo($,ie),$.return=W,$):($=Gl(ie.type,ie.key,ie.props,null,W.mode,he),xo($,ie),$.return=W,$)}function ne(W,$,ie,he){return $===null||$.tag!==4||$.stateNode.containerInfo!==ie.containerInfo||$.stateNode.implementation!==ie.implementation?($=tf(ie,W.mode,he),$.return=W,$):($=A($,ie.children||[]),$.return=W,$)}function ue(W,$,ie,he,Ge){return $===null||$.tag!==7?($=Cr(ie,W.mode,he,Ge),$.return=W,$):($=A($,ie),$.return=W,$)}function ge(W,$,ie){if(typeof $=="string"&&$!==""||typeof $=="number"||typeof $=="bigint")return $=ef(""+$,W.mode,ie),$.return=W,$;if(typeof $=="object"&&$!==null){switch($.$$typeof){case v:return ie=Gl($.type,$.key,$.props,null,W.mode,ie),xo(ie,$),ie.return=W,ie;case y:return $=tf($,W.mode,ie),$.return=W,$;case O:return $=Ir($),ge(W,$,ie)}if(Z($)||P($))return $=Cr($,W.mode,ie,null),$.return=W,$;if(typeof $.then=="function")return ge(W,jl($),ie);if($.$$typeof===L)return ge(W,Vl(W,$),ie);Jl(W,$)}return null}function se(W,$,ie,he){var Ge=$!==null?$.key:null;if(typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint")return Ge!==null?null:B(W,$,""+ie,he);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case v:return ie.key===Ge?G(W,$,ie,he):null;case y:return ie.key===Ge?ne(W,$,ie,he):null;case O:return ie=Ir(ie),se(W,$,ie,he)}if(Z(ie)||P(ie))return Ge!==null?null:ue(W,$,ie,he,null);if(typeof ie.then=="function")return se(W,$,jl(ie),he);if(ie.$$typeof===L)return se(W,$,Vl(W,ie),he);Jl(W,ie)}return null}function ae(W,$,ie,he,Ge){if(typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint")return W=W.get(ie)||null,B($,W,""+he,Ge);if(typeof he=="object"&&he!==null){switch(he.$$typeof){case v:return W=W.get(he.key===null?ie:he.key)||null,G($,W,he,Ge);case y:return W=W.get(he.key===null?ie:he.key)||null,ne($,W,he,Ge);case O:return he=Ir(he),ae(W,$,ie,he,Ge)}if(Z(he)||P(he))return W=W.get(ie)||null,ue($,W,he,Ge,null);if(typeof he.then=="function")return ae(W,$,ie,jl(he),Ge);if(he.$$typeof===L)return ae(W,$,ie,Vl($,he),Ge);Jl($,he)}return null}function Me(W,$,ie,he){for(var Ge=null,ht=null,Ue=$,Ze=$=0,lt=null;Ue!==null&&Ze<ie.length;Ze++){Ue.index>Ze?(lt=Ue,Ue=null):lt=Ue.sibling;var dt=se(W,Ue,ie[Ze],he);if(dt===null){Ue===null&&(Ue=lt);break}s&&Ue&&dt.alternate===null&&a(W,Ue),$=E(dt,$,Ze),ht===null?Ge=dt:ht.sibling=dt,ht=dt,Ue=lt}if(Ze===ie.length)return c(W,Ue),ut&&ls(W,Ze),Ge;if(Ue===null){for(;Ze<ie.length;Ze++)Ue=ge(W,ie[Ze],he),Ue!==null&&($=E(Ue,$,Ze),ht===null?Ge=Ue:ht.sibling=Ue,ht=Ue);return ut&&ls(W,Ze),Ge}for(Ue=g(Ue);Ze<ie.length;Ze++)lt=ae(Ue,W,Ze,ie[Ze],he),lt!==null&&(s&&lt.alternate!==null&&Ue.delete(lt.key===null?Ze:lt.key),$=E(lt,$,Ze),ht===null?Ge=lt:ht.sibling=lt,ht=lt);return s&&Ue.forEach(function(sr){return a(W,sr)}),ut&&ls(W,Ze),Ge}function $e(W,$,ie,he){if(ie==null)throw Error(i(151));for(var Ge=null,ht=null,Ue=$,Ze=$=0,lt=null,dt=ie.next();Ue!==null&&!dt.done;Ze++,dt=ie.next()){Ue.index>Ze?(lt=Ue,Ue=null):lt=Ue.sibling;var sr=se(W,Ue,dt.value,he);if(sr===null){Ue===null&&(Ue=lt);break}s&&Ue&&sr.alternate===null&&a(W,Ue),$=E(sr,$,Ze),ht===null?Ge=sr:ht.sibling=sr,ht=sr,Ue=lt}if(dt.done)return c(W,Ue),ut&&ls(W,Ze),Ge;if(Ue===null){for(;!dt.done;Ze++,dt=ie.next())dt=ge(W,dt.value,he),dt!==null&&($=E(dt,$,Ze),ht===null?Ge=dt:ht.sibling=dt,ht=dt);return ut&&ls(W,Ze),Ge}for(Ue=g(Ue);!dt.done;Ze++,dt=ie.next())dt=ae(Ue,W,Ze,dt.value,he),dt!==null&&(s&&dt.alternate!==null&&Ue.delete(dt.key===null?Ze:dt.key),$=E(dt,$,Ze),ht===null?Ge=dt:ht.sibling=dt,ht=dt);return s&&Ue.forEach(function(Q1){return a(W,Q1)}),ut&&ls(W,Ze),Ge}function bt(W,$,ie,he){if(typeof ie=="object"&&ie!==null&&ie.type===T&&ie.key===null&&(ie=ie.props.children),typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case v:e:{for(var Ge=ie.key;$!==null;){if($.key===Ge){if(Ge=ie.type,Ge===T){if($.tag===7){c(W,$.sibling),he=A($,ie.props.children),he.return=W,W=he;break e}}else if($.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===O&&Ir(Ge)===$.type){c(W,$.sibling),he=A($,ie.props),xo(he,ie),he.return=W,W=he;break e}c(W,$);break}else a(W,$);$=$.sibling}ie.type===T?(he=Cr(ie.props.children,W.mode,he,ie.key),he.return=W,W=he):(he=Gl(ie.type,ie.key,ie.props,null,W.mode,he),xo(he,ie),he.return=W,W=he)}return x(W);case y:e:{for(Ge=ie.key;$!==null;){if($.key===Ge)if($.tag===4&&$.stateNode.containerInfo===ie.containerInfo&&$.stateNode.implementation===ie.implementation){c(W,$.sibling),he=A($,ie.children||[]),he.return=W,W=he;break e}else{c(W,$);break}else a(W,$);$=$.sibling}he=tf(ie,W.mode,he),he.return=W,W=he}return x(W);case O:return ie=Ir(ie),bt(W,$,ie,he)}if(Z(ie))return Me(W,$,ie,he);if(P(ie)){if(Ge=P(ie),typeof Ge!="function")throw Error(i(150));return ie=Ge.call(ie),$e(W,$,ie,he)}if(typeof ie.then=="function")return bt(W,$,jl(ie),he);if(ie.$$typeof===L)return bt(W,$,Vl(W,ie),he);Jl(W,ie)}return typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint"?(ie=""+ie,$!==null&&$.tag===6?(c(W,$.sibling),he=A($,ie),he.return=W,W=he):(c(W,$),he=ef(ie,W.mode,he),he.return=W,W=he),x(W)):c(W,$)}return function(W,$,ie,he){try{bo=0;var Ge=bt(W,$,ie,he);return Ta=null,Ge}catch(Ue){if(Ue===Ea||Ue===Yl)throw Ue;var ht=Hi(29,Ue,null,W.mode);return ht.lanes=he,ht.return=W,ht}finally{}}}var Mr=xm(!0),Cm=xm(!1),Hs=!1;function gf(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function mf(s,a){s=s.updateQueue,a.updateQueue===s&&(a.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Ks(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Vs(s,a,c){var g=s.updateQueue;if(g===null)return null;if(g=g.shared,(gt&2)!==0){var A=g.pending;return A===null?a.next=a:(a.next=A.next,A.next=a),g.pending=a,a=Nl(s),lm(s,null,c),a}return Pl(s,g,a,c),Nl(s)}function Co(s,a,c){if(a=a.updateQueue,a!==null&&(a=a.shared,(c&4194048)!==0)){var g=a.lanes;g&=s.pendingLanes,c|=g,a.lanes=c,Ri(s,c)}}function pf(s,a){var c=s.updateQueue,g=s.alternate;if(g!==null&&(g=g.updateQueue,c===g)){var A=null,E=null;if(c=c.firstBaseUpdate,c!==null){do{var x={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};E===null?A=E=x:E=E.next=x,c=c.next}while(c!==null);E===null?A=E=a:E=E.next=a}else A=E=a;c={baseState:g.baseState,firstBaseUpdate:A,lastBaseUpdate:E,shared:g.shared,callbacks:g.callbacks},s.updateQueue=c;return}s=c.lastBaseUpdate,s===null?c.firstBaseUpdate=a:s.next=a,c.lastBaseUpdate=a}var Af=!1;function Ro(){if(Af){var s=ya;if(s!==null)throw s}}function Lo(s,a,c,g){Af=!1;var A=s.updateQueue;Hs=!1;var E=A.firstBaseUpdate,x=A.lastBaseUpdate,B=A.shared.pending;if(B!==null){A.shared.pending=null;var G=B,ne=G.next;G.next=null,x===null?E=ne:x.next=ne,x=G;var ue=s.alternate;ue!==null&&(ue=ue.updateQueue,B=ue.lastBaseUpdate,B!==x&&(B===null?ue.firstBaseUpdate=ne:B.next=ne,ue.lastBaseUpdate=G))}if(E!==null){var ge=A.baseState;x=0,ue=ne=G=null,B=E;do{var se=B.lane&-536870913,ae=se!==B.lane;if(ae?(ot&se)===se:(g&se)===se){se!==0&&se===va&&(Af=!0),ue!==null&&(ue=ue.next={lane:0,tag:B.tag,payload:B.payload,callback:null,next:null});e:{var Me=s,$e=B;se=a;var bt=c;switch($e.tag){case 1:if(Me=$e.payload,typeof Me=="function"){ge=Me.call(bt,ge,se);break e}ge=Me;break e;case 3:Me.flags=Me.flags&-65537|128;case 0:if(Me=$e.payload,se=typeof Me=="function"?Me.call(bt,ge,se):Me,se==null)break e;ge=m({},ge,se);break e;case 2:Hs=!0}}se=B.callback,se!==null&&(s.flags|=64,ae&&(s.flags|=8192),ae=A.callbacks,ae===null?A.callbacks=[se]:ae.push(se))}else ae={lane:se,tag:B.tag,payload:B.payload,callback:B.callback,next:null},ue===null?(ne=ue=ae,G=ge):ue=ue.next=ae,x|=se;if(B=B.next,B===null){if(B=A.shared.pending,B===null)break;ae=B,B=ae.next,ae.next=null,A.lastBaseUpdate=ae,A.shared.pending=null}}while(!0);ue===null&&(G=ge),A.baseState=G,A.firstBaseUpdate=ne,A.lastBaseUpdate=ue,E===null&&(A.shared.lanes=0),Js|=x,s.lanes=x,s.memoizedState=ge}}function Rm(s,a){if(typeof s!="function")throw Error(i(191,s));s.call(a)}function Lm(s,a){var c=s.callbacks;if(c!==null)for(s.callbacks=null,s=0;s<c.length;s++)Rm(c[s],a)}var Sa=U(null),Xl=U(0);function Dm(s,a){s=ys,V(Xl,s),V(Sa,a),ys=s|a.baseLanes}function vf(){V(Xl,ys),V(Sa,Sa.current)}function yf(){ys=Xl.current,N(Sa),N(Xl)}var Ki=U(null),ln=null;function $s(s){var a=s.alternate;V(jt,jt.current&1),V(Ki,s),ln===null&&(a===null||Sa.current!==null||a.memoizedState!==null)&&(ln=s)}function Ef(s){V(jt,jt.current),V(Ki,s),ln===null&&(ln=s)}function _m(s){s.tag===22?(V(jt,jt.current),V(Ki,s),ln===null&&(ln=s)):Ys()}function Ys(){V(jt,jt.current),V(Ki,Ki.current)}function Vi(s){N(Ki),ln===s&&(ln=null),N(jt)}var jt=U(0);function Ql(s){for(var a=s;a!==null;){if(a.tag===13){var c=a.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||Rh(c)||Lh(c)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var fs=0,Qe=null,Tt=null,Qt=null,ql=!1,ba=!1,Or=!1,Wl=0,Do=0,xa=null,GS=0;function Vt(){throw Error(i(321))}function Tf(s,a){if(a===null)return!1;for(var c=0;c<a.length&&c<s.length;c++)if(!Gi(s[c],a[c]))return!1;return!0}function Sf(s,a,c,g,A,E){return fs=E,Qe=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,k.H=s===null||s.memoizedState===null?h0:Uf,Or=!1,E=c(g,A),Or=!1,ba&&(E=Bm(a,c,g,A)),Im(s),E}function Im(s){k.H=Bo;var a=Tt!==null&&Tt.next!==null;if(fs=0,Qt=Tt=Qe=null,ql=!1,Do=0,xa=null,a)throw Error(i(300));s===null||qt||(s=s.dependencies,s!==null&&Kl(s)&&(qt=!0))}function Bm(s,a,c,g){Qe=s;var A=0;do{if(ba&&(xa=null),Do=0,ba=!1,25<=A)throw Error(i(301));if(A+=1,Qt=Tt=null,s.updateQueue!=null){var E=s.updateQueue;E.lastEffect=null,E.events=null,E.stores=null,E.memoCache!=null&&(E.memoCache.index=0)}k.H=d0,E=a(c,g)}while(ba);return E}function HS(){var s=k.H,a=s.useState()[0];return a=typeof a.then=="function"?_o(a):a,s=s.useState()[0],(Tt!==null?Tt.memoizedState:null)!==s&&(Qe.flags|=1024),a}function bf(){var s=Wl!==0;return Wl=0,s}function xf(s,a,c){a.updateQueue=s.updateQueue,a.flags&=-2053,s.lanes&=~c}function Cf(s){if(ql){for(s=s.memoizedState;s!==null;){var a=s.queue;a!==null&&(a.pending=null),s=s.next}ql=!1}fs=0,Qt=Tt=Qe=null,ba=!1,Do=Wl=0,xa=null}function bi(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qt===null?Qe.memoizedState=Qt=s:Qt=Qt.next=s,Qt}function Jt(){if(Tt===null){var s=Qe.alternate;s=s!==null?s.memoizedState:null}else s=Tt.next;var a=Qt===null?Qe.memoizedState:Qt.next;if(a!==null)Qt=a,Tt=s;else{if(s===null)throw Qe.alternate===null?Error(i(467)):Error(i(310));Tt=s,s={memoizedState:Tt.memoizedState,baseState:Tt.baseState,baseQueue:Tt.baseQueue,queue:Tt.queue,next:null},Qt===null?Qe.memoizedState=Qt=s:Qt=Qt.next=s}return Qt}function Zl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function _o(s){var a=Do;return Do+=1,xa===null&&(xa=[]),s=Tm(xa,s,a),a=Qe,(Qt===null?a.memoizedState:Qt.next)===null&&(a=a.alternate,k.H=a===null||a.memoizedState===null?h0:Uf),s}function eu(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return _o(s);if(s.$$typeof===L)return di(s)}throw Error(i(438,String(s)))}function Rf(s){var a=null,c=Qe.updateQueue;if(c!==null&&(a=c.memoCache),a==null){var g=Qe.alternate;g!==null&&(g=g.updateQueue,g!==null&&(g=g.memoCache,g!=null&&(a={data:g.data.map(function(A){return A.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),c===null&&(c=Zl(),Qe.updateQueue=c),c.memoCache=a,c=a.data[a.index],c===void 0)for(c=a.data[a.index]=Array(s),g=0;g<s;g++)c[g]=M;return a.index++,c}function hs(s,a){return typeof a=="function"?a(s):a}function tu(s){var a=Jt();return Lf(a,Tt,s)}function Lf(s,a,c){var g=s.queue;if(g===null)throw Error(i(311));g.lastRenderedReducer=c;var A=s.baseQueue,E=g.pending;if(E!==null){if(A!==null){var x=A.next;A.next=E.next,E.next=x}a.baseQueue=A=E,g.pending=null}if(E=s.baseState,A===null)s.memoizedState=E;else{a=A.next;var B=x=null,G=null,ne=a,ue=!1;do{var ge=ne.lane&-536870913;if(ge!==ne.lane?(ot&ge)===ge:(fs&ge)===ge){var se=ne.revertLane;if(se===0)G!==null&&(G=G.next={lane:0,revertLane:0,gesture:null,action:ne.action,hasEagerState:ne.hasEagerState,eagerState:ne.eagerState,next:null}),ge===va&&(ue=!0);else if((fs&se)===se){ne=ne.next,se===va&&(ue=!0);continue}else ge={lane:0,revertLane:ne.revertLane,gesture:null,action:ne.action,hasEagerState:ne.hasEagerState,eagerState:ne.eagerState,next:null},G===null?(B=G=ge,x=E):G=G.next=ge,Qe.lanes|=se,Js|=se;ge=ne.action,Or&&c(E,ge),E=ne.hasEagerState?ne.eagerState:c(E,ge)}else se={lane:ge,revertLane:ne.revertLane,gesture:ne.gesture,action:ne.action,hasEagerState:ne.hasEagerState,eagerState:ne.eagerState,next:null},G===null?(B=G=se,x=E):G=G.next=se,Qe.lanes|=ge,Js|=ge;ne=ne.next}while(ne!==null&&ne!==a);if(G===null?x=E:G.next=B,!Gi(E,s.memoizedState)&&(qt=!0,ue&&(c=ya,c!==null)))throw c;s.memoizedState=E,s.baseState=x,s.baseQueue=G,g.lastRenderedState=E}return A===null&&(g.lanes=0),[s.memoizedState,g.dispatch]}function Df(s){var a=Jt(),c=a.queue;if(c===null)throw Error(i(311));c.lastRenderedReducer=s;var g=c.dispatch,A=c.pending,E=a.memoizedState;if(A!==null){c.pending=null;var x=A=A.next;do E=s(E,x.action),x=x.next;while(x!==A);Gi(E,a.memoizedState)||(qt=!0),a.memoizedState=E,a.baseQueue===null&&(a.baseState=E),c.lastRenderedState=E}return[E,g]}function Mm(s,a,c){var g=Qe,A=Jt(),E=ut;if(E){if(c===void 0)throw Error(i(407));c=c()}else c=a();var x=!Gi((Tt||A).memoizedState,c);if(x&&(A.memoizedState=c,qt=!0),A=A.queue,Bf(km.bind(null,g,A,s),[s]),A.getSnapshot!==a||x||Qt!==null&&Qt.memoizedState.tag&1){if(g.flags|=2048,Ca(9,{destroy:void 0},Fm.bind(null,g,A,c,a),null),Ct===null)throw Error(i(349));E||(fs&127)!==0||Om(g,a,c)}return c}function Om(s,a,c){s.flags|=16384,s={getSnapshot:a,value:c},a=Qe.updateQueue,a===null?(a=Zl(),Qe.updateQueue=a,a.stores=[s]):(c=a.stores,c===null?a.stores=[s]:c.push(s))}function Fm(s,a,c,g){a.value=c,a.getSnapshot=g,wm(a)&&Um(s)}function km(s,a,c){return c(function(){wm(a)&&Um(s)})}function wm(s){var a=s.getSnapshot;s=s.value;try{var c=a();return!Gi(s,c)}catch{return!0}}function Um(s){var a=xr(s,2);a!==null&&Bi(a,s,2)}function _f(s){var a=bi();if(typeof s=="function"){var c=s;if(s=c(),Or){we(!0);try{c()}finally{we(!1)}}}return a.memoizedState=a.baseState=s,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:hs,lastRenderedState:s},a}function Pm(s,a,c,g){return s.baseState=c,Lf(s,Tt,typeof g=="function"?g:hs)}function KS(s,a,c,g,A){if(su(s))throw Error(i(485));if(s=a.action,s!==null){var E={payload:A,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(x){E.listeners.push(x)}};k.T!==null?c(!0):E.isTransition=!1,g(E),c=a.pending,c===null?(E.next=a.pending=E,Nm(a,E)):(E.next=c.next,a.pending=c.next=E)}}function Nm(s,a){var c=a.action,g=a.payload,A=s.state;if(a.isTransition){var E=k.T,x={};k.T=x;try{var B=c(A,g),G=k.S;G!==null&&G(x,B),Gm(s,a,B)}catch(ne){If(s,a,ne)}finally{E!==null&&x.types!==null&&(E.types=x.types),k.T=E}}else try{E=c(A,g),Gm(s,a,E)}catch(ne){If(s,a,ne)}}function Gm(s,a,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(g){Hm(s,a,g)},function(g){return If(s,a,g)}):Hm(s,a,c)}function Hm(s,a,c){a.status="fulfilled",a.value=c,Km(a),s.state=c,a=s.pending,a!==null&&(c=a.next,c===a?s.pending=null:(c=c.next,a.next=c,Nm(s,c)))}function If(s,a,c){var g=s.pending;if(s.pending=null,g!==null){g=g.next;do a.status="rejected",a.reason=c,Km(a),a=a.next;while(a!==g)}s.action=null}function Km(s){s=s.listeners;for(var a=0;a<s.length;a++)(0,s[a])()}function Vm(s,a){return a}function $m(s,a){if(ut){var c=Ct.formState;if(c!==null){e:{var g=Qe;if(ut){if(Ot){t:{for(var A=Ot,E=on;A.nodeType!==8;){if(!E){A=null;break t}if(A=un(A.nextSibling),A===null){A=null;break t}}E=A.data,A=E==="F!"||E==="F"?A:null}if(A){Ot=un(A.nextSibling),g=A.data==="F!";break e}}Ns(g)}g=!1}g&&(a=c[0])}}return c=bi(),c.memoizedState=c.baseState=a,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vm,lastRenderedState:a},c.queue=g,c=u0.bind(null,Qe,g),g.dispatch=c,g=_f(!1),E=wf.bind(null,Qe,!1,g.queue),g=bi(),A={state:a,dispatch:null,action:s,pending:null},g.queue=A,c=KS.bind(null,Qe,A,E,c),A.dispatch=c,g.memoizedState=s,[a,c,!1]}function Ym(s){var a=Jt();return zm(a,Tt,s)}function zm(s,a,c){if(a=Lf(s,a,Vm)[0],s=tu(hs)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var g=_o(a)}catch(x){throw x===Ea?Yl:x}else g=a;a=Jt();var A=a.queue,E=A.dispatch;return c!==a.memoizedState&&(Qe.flags|=2048,Ca(9,{destroy:void 0},VS.bind(null,A,c),null)),[g,E,s]}function VS(s,a){s.action=a}function jm(s){var a=Jt(),c=Tt;if(c!==null)return zm(a,c,s);Jt(),a=a.memoizedState,c=Jt();var g=c.queue.dispatch;return c.memoizedState=s,[a,g,!1]}function Ca(s,a,c,g){return s={tag:s,create:c,deps:g,inst:a,next:null},a=Qe.updateQueue,a===null&&(a=Zl(),Qe.updateQueue=a),c=a.lastEffect,c===null?a.lastEffect=s.next=s:(g=c.next,c.next=s,s.next=g,a.lastEffect=s),s}function Jm(){return Jt().memoizedState}function iu(s,a,c,g){var A=bi();Qe.flags|=s,A.memoizedState=Ca(1|a,{destroy:void 0},c,g===void 0?null:g)}function nu(s,a,c,g){var A=Jt();g=g===void 0?null:g;var E=A.memoizedState.inst;Tt!==null&&g!==null&&Tf(g,Tt.memoizedState.deps)?A.memoizedState=Ca(a,E,c,g):(Qe.flags|=s,A.memoizedState=Ca(1|a,E,c,g))}function Xm(s,a){iu(8390656,8,s,a)}function Bf(s,a){nu(2048,8,s,a)}function $S(s){Qe.flags|=4;var a=Qe.updateQueue;if(a===null)a=Zl(),Qe.updateQueue=a,a.events=[s];else{var c=a.events;c===null?a.events=[s]:c.push(s)}}function Qm(s){var a=Jt().memoizedState;return $S({ref:a,nextImpl:s}),function(){if((gt&2)!==0)throw Error(i(440));return a.impl.apply(void 0,arguments)}}function qm(s,a){return nu(4,2,s,a)}function Wm(s,a){return nu(4,4,s,a)}function Zm(s,a){if(typeof a=="function"){s=s();var c=a(s);return function(){typeof c=="function"?c():a(null)}}if(a!=null)return s=s(),a.current=s,function(){a.current=null}}function e0(s,a,c){c=c!=null?c.concat([s]):null,nu(4,4,Zm.bind(null,a,s),c)}function Mf(){}function t0(s,a){var c=Jt();a=a===void 0?null:a;var g=c.memoizedState;return a!==null&&Tf(a,g[1])?g[0]:(c.memoizedState=[s,a],s)}function i0(s,a){var c=Jt();a=a===void 0?null:a;var g=c.memoizedState;if(a!==null&&Tf(a,g[1]))return g[0];if(g=s(),Or){we(!0);try{s()}finally{we(!1)}}return c.memoizedState=[g,a],g}function Of(s,a,c){return c===void 0||(fs&1073741824)!==0&&(ot&261930)===0?s.memoizedState=a:(s.memoizedState=c,s=np(),Qe.lanes|=s,Js|=s,c)}function n0(s,a,c,g){return Gi(c,a)?c:Sa.current!==null?(s=Of(s,c,g),Gi(s,a)||(qt=!0),s):(fs&42)===0||(fs&1073741824)!==0&&(ot&261930)===0?(qt=!0,s.memoizedState=c):(s=np(),Qe.lanes|=s,Js|=s,a)}function s0(s,a,c,g,A){var E=K.p;K.p=E!==0&&8>E?E:8;var x=k.T,B={};k.T=B,wf(s,!1,a,c);try{var G=A(),ne=k.S;if(ne!==null&&ne(B,G),G!==null&&typeof G=="object"&&typeof G.then=="function"){var ue=NS(G,g);Io(s,a,ue,zi(s))}else Io(s,a,g,zi(s))}catch(ge){Io(s,a,{then:function(){},status:"rejected",reason:ge},zi())}finally{K.p=E,x!==null&&B.types!==null&&(x.types=B.types),k.T=x}}function YS(){}function Ff(s,a,c,g){if(s.tag!==5)throw Error(i(476));var A=r0(s).queue;s0(s,A,a,Q,c===null?YS:function(){return a0(s),c(g)})}function r0(s){var a=s.memoizedState;if(a!==null)return a;a={memoizedState:Q,baseState:Q,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:hs,lastRenderedState:Q},next:null};var c={};return a.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:hs,lastRenderedState:c},next:null},s.memoizedState=a,s=s.alternate,s!==null&&(s.memoizedState=a),a}function a0(s){var a=r0(s);a.next===null&&(a=s.alternate.memoizedState),Io(s,a.next.queue,{},zi())}function kf(){return di(jo)}function o0(){return Jt().memoizedState}function l0(){return Jt().memoizedState}function zS(s){for(var a=s.return;a!==null;){switch(a.tag){case 24:case 3:var c=zi();s=Ks(c);var g=Vs(a,s,c);g!==null&&(Bi(g,a,c),Co(g,a,c)),a={cache:cf()},s.payload=a;return}a=a.return}}function jS(s,a,c){var g=zi();c={lane:g,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},su(s)?c0(a,c):(c=Wc(s,a,c,g),c!==null&&(Bi(c,s,g),f0(c,a,g)))}function u0(s,a,c){var g=zi();Io(s,a,c,g)}function Io(s,a,c,g){var A={lane:g,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(su(s))c0(a,A);else{var E=s.alternate;if(s.lanes===0&&(E===null||E.lanes===0)&&(E=a.lastRenderedReducer,E!==null))try{var x=a.lastRenderedState,B=E(x,c);if(A.hasEagerState=!0,A.eagerState=B,Gi(B,x))return Pl(s,a,A,0),Ct===null&&Ul(),!1}catch{}finally{}if(c=Wc(s,a,A,g),c!==null)return Bi(c,s,g),f0(c,a,g),!0}return!1}function wf(s,a,c,g){if(g={lane:2,revertLane:gh(),gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null},su(s)){if(a)throw Error(i(479))}else a=Wc(s,c,g,2),a!==null&&Bi(a,s,2)}function su(s){var a=s.alternate;return s===Qe||a!==null&&a===Qe}function c0(s,a){ba=ql=!0;var c=s.pending;c===null?a.next=a:(a.next=c.next,c.next=a),s.pending=a}function f0(s,a,c){if((c&4194048)!==0){var g=a.lanes;g&=s.pendingLanes,c|=g,a.lanes=c,Ri(s,c)}}var Bo={readContext:di,use:eu,useCallback:Vt,useContext:Vt,useEffect:Vt,useImperativeHandle:Vt,useLayoutEffect:Vt,useInsertionEffect:Vt,useMemo:Vt,useReducer:Vt,useRef:Vt,useState:Vt,useDebugValue:Vt,useDeferredValue:Vt,useTransition:Vt,useSyncExternalStore:Vt,useId:Vt,useHostTransitionStatus:Vt,useFormState:Vt,useActionState:Vt,useOptimistic:Vt,useMemoCache:Vt,useCacheRefresh:Vt};Bo.useEffectEvent=Vt;var h0={readContext:di,use:eu,useCallback:function(s,a){return bi().memoizedState=[s,a===void 0?null:a],s},useContext:di,useEffect:Xm,useImperativeHandle:function(s,a,c){c=c!=null?c.concat([s]):null,iu(4194308,4,Zm.bind(null,a,s),c)},useLayoutEffect:function(s,a){return iu(4194308,4,s,a)},useInsertionEffect:function(s,a){iu(4,2,s,a)},useMemo:function(s,a){var c=bi();a=a===void 0?null:a;var g=s();if(Or){we(!0);try{s()}finally{we(!1)}}return c.memoizedState=[g,a],g},useReducer:function(s,a,c){var g=bi();if(c!==void 0){var A=c(a);if(Or){we(!0);try{c(a)}finally{we(!1)}}}else A=a;return g.memoizedState=g.baseState=A,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:A},g.queue=s,s=s.dispatch=jS.bind(null,Qe,s),[g.memoizedState,s]},useRef:function(s){var a=bi();return s={current:s},a.memoizedState=s},useState:function(s){s=_f(s);var a=s.queue,c=u0.bind(null,Qe,a);return a.dispatch=c,[s.memoizedState,c]},useDebugValue:Mf,useDeferredValue:function(s,a){var c=bi();return Of(c,s,a)},useTransition:function(){var s=_f(!1);return s=s0.bind(null,Qe,s.queue,!0,!1),bi().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,a,c){var g=Qe,A=bi();if(ut){if(c===void 0)throw Error(i(407));c=c()}else{if(c=a(),Ct===null)throw Error(i(349));(ot&127)!==0||Om(g,a,c)}A.memoizedState=c;var E={value:c,getSnapshot:a};return A.queue=E,Xm(km.bind(null,g,E,s),[s]),g.flags|=2048,Ca(9,{destroy:void 0},Fm.bind(null,g,E,c,a),null),c},useId:function(){var s=bi(),a=Ct.identifierPrefix;if(ut){var c=wn,g=kn;c=(g&~(1<<32-rt(g)-1)).toString(32)+c,a="_"+a+"R_"+c,c=Wl++,0<c&&(a+="H"+c.toString(32)),a+="_"}else c=GS++,a="_"+a+"r_"+c.toString(32)+"_";return s.memoizedState=a},useHostTransitionStatus:kf,useFormState:$m,useActionState:$m,useOptimistic:function(s){var a=bi();a.memoizedState=a.baseState=s;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=c,a=wf.bind(null,Qe,!0,c),c.dispatch=a,[s,a]},useMemoCache:Rf,useCacheRefresh:function(){return bi().memoizedState=zS.bind(null,Qe)},useEffectEvent:function(s){var a=bi(),c={impl:s};return a.memoizedState=c,function(){if((gt&2)!==0)throw Error(i(440));return c.impl.apply(void 0,arguments)}}},Uf={readContext:di,use:eu,useCallback:t0,useContext:di,useEffect:Bf,useImperativeHandle:e0,useInsertionEffect:qm,useLayoutEffect:Wm,useMemo:i0,useReducer:tu,useRef:Jm,useState:function(){return tu(hs)},useDebugValue:Mf,useDeferredValue:function(s,a){var c=Jt();return n0(c,Tt.memoizedState,s,a)},useTransition:function(){var s=tu(hs)[0],a=Jt().memoizedState;return[typeof s=="boolean"?s:_o(s),a]},useSyncExternalStore:Mm,useId:o0,useHostTransitionStatus:kf,useFormState:Ym,useActionState:Ym,useOptimistic:function(s,a){var c=Jt();return Pm(c,Tt,s,a)},useMemoCache:Rf,useCacheRefresh:l0};Uf.useEffectEvent=Qm;var d0={readContext:di,use:eu,useCallback:t0,useContext:di,useEffect:Bf,useImperativeHandle:e0,useInsertionEffect:qm,useLayoutEffect:Wm,useMemo:i0,useReducer:Df,useRef:Jm,useState:function(){return Df(hs)},useDebugValue:Mf,useDeferredValue:function(s,a){var c=Jt();return Tt===null?Of(c,s,a):n0(c,Tt.memoizedState,s,a)},useTransition:function(){var s=Df(hs)[0],a=Jt().memoizedState;return[typeof s=="boolean"?s:_o(s),a]},useSyncExternalStore:Mm,useId:o0,useHostTransitionStatus:kf,useFormState:jm,useActionState:jm,useOptimistic:function(s,a){var c=Jt();return Tt!==null?Pm(c,Tt,s,a):(c.baseState=s,[s,c.queue.dispatch])},useMemoCache:Rf,useCacheRefresh:l0};d0.useEffectEvent=Qm;function Pf(s,a,c,g){a=s.memoizedState,c=c(g,a),c=c==null?a:m({},a,c),s.memoizedState=c,s.lanes===0&&(s.updateQueue.baseState=c)}var Nf={enqueueSetState:function(s,a,c){s=s._reactInternals;var g=zi(),A=Ks(g);A.payload=a,c!=null&&(A.callback=c),a=Vs(s,A,g),a!==null&&(Bi(a,s,g),Co(a,s,g))},enqueueReplaceState:function(s,a,c){s=s._reactInternals;var g=zi(),A=Ks(g);A.tag=1,A.payload=a,c!=null&&(A.callback=c),a=Vs(s,A,g),a!==null&&(Bi(a,s,g),Co(a,s,g))},enqueueForceUpdate:function(s,a){s=s._reactInternals;var c=zi(),g=Ks(c);g.tag=2,a!=null&&(g.callback=a),a=Vs(s,g,c),a!==null&&(Bi(a,s,c),Co(a,s,c))}};function g0(s,a,c,g,A,E,x){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(g,E,x):a.prototype&&a.prototype.isPureReactComponent?!Ao(c,g)||!Ao(A,E):!0}function m0(s,a,c,g){s=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(c,g),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(c,g),a.state!==s&&Nf.enqueueReplaceState(a,a.state,null)}function Fr(s,a){var c=a;if("ref"in a){c={};for(var g in a)g!=="ref"&&(c[g]=a[g])}if(s=s.defaultProps){c===a&&(c=m({},c));for(var A in s)c[A]===void 0&&(c[A]=s[A])}return c}function p0(s){wl(s)}function A0(s){console.error(s)}function v0(s){wl(s)}function ru(s,a){try{var c=s.onUncaughtError;c(a.value,{componentStack:a.stack})}catch(g){setTimeout(function(){throw g})}}function y0(s,a,c){try{var g=s.onCaughtError;g(c.value,{componentStack:c.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(A){setTimeout(function(){throw A})}}function Gf(s,a,c){return c=Ks(c),c.tag=3,c.payload={element:null},c.callback=function(){ru(s,a)},c}function E0(s){return s=Ks(s),s.tag=3,s}function T0(s,a,c,g){var A=c.type.getDerivedStateFromError;if(typeof A=="function"){var E=g.value;s.payload=function(){return A(E)},s.callback=function(){y0(a,c,g)}}var x=c.stateNode;x!==null&&typeof x.componentDidCatch=="function"&&(s.callback=function(){y0(a,c,g),typeof A!="function"&&(Xs===null?Xs=new Set([this]):Xs.add(this));var B=g.stack;this.componentDidCatch(g.value,{componentStack:B!==null?B:""})})}function JS(s,a,c,g,A){if(c.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){if(a=c.alternate,a!==null&&Aa(a,c,A,!0),c=Ki.current,c!==null){switch(c.tag){case 31:case 13:return ln===null?Au():c.alternate===null&&$t===0&&($t=3),c.flags&=-257,c.flags|=65536,c.lanes=A,g===zl?c.flags|=16384:(a=c.updateQueue,a===null?c.updateQueue=new Set([g]):a.add(g),fh(s,g,A)),!1;case 22:return c.flags|=65536,g===zl?c.flags|=16384:(a=c.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([g])},c.updateQueue=a):(c=a.retryQueue,c===null?a.retryQueue=new Set([g]):c.add(g)),fh(s,g,A)),!1}throw Error(i(435,c.tag))}return fh(s,g,A),Au(),!1}if(ut)return a=Ki.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=A,g!==rf&&(s=Error(i(422),{cause:g}),Eo(sn(s,c)))):(g!==rf&&(a=Error(i(423),{cause:g}),Eo(sn(a,c))),s=s.current.alternate,s.flags|=65536,A&=-A,s.lanes|=A,g=sn(g,c),A=Gf(s.stateNode,g,A),pf(s,A),$t!==4&&($t=2)),!1;var E=Error(i(520),{cause:g});if(E=sn(E,c),No===null?No=[E]:No.push(E),$t!==4&&($t=2),a===null)return!0;g=sn(g,c),c=a;do{switch(c.tag){case 3:return c.flags|=65536,s=A&-A,c.lanes|=s,s=Gf(c.stateNode,g,s),pf(c,s),!1;case 1:if(a=c.type,E=c.stateNode,(c.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(Xs===null||!Xs.has(E))))return c.flags|=65536,A&=-A,c.lanes|=A,A=E0(A),T0(A,s,c,g),pf(c,A),!1}c=c.return}while(c!==null);return!1}var Hf=Error(i(461)),qt=!1;function gi(s,a,c,g){a.child=s===null?Cm(a,null,c,g):Mr(a,s.child,c,g)}function S0(s,a,c,g,A){c=c.render;var E=a.ref;if("ref"in g){var x={};for(var B in g)B!=="ref"&&(x[B]=g[B])}else x=g;return Dr(a),g=Sf(s,a,c,x,E,A),B=bf(),s!==null&&!qt?(xf(s,a,A),ds(s,a,A)):(ut&&B&&nf(a),a.flags|=1,gi(s,a,g,A),a.child)}function b0(s,a,c,g,A){if(s===null){var E=c.type;return typeof E=="function"&&!Zc(E)&&E.defaultProps===void 0&&c.compare===null?(a.tag=15,a.type=E,x0(s,a,E,g,A)):(s=Gl(c.type,null,g,a,a.mode,A),s.ref=a.ref,s.return=a,a.child=s)}if(E=s.child,!Xf(s,A)){var x=E.memoizedProps;if(c=c.compare,c=c!==null?c:Ao,c(x,g)&&s.ref===a.ref)return ds(s,a,A)}return a.flags|=1,s=os(E,g),s.ref=a.ref,s.return=a,a.child=s}function x0(s,a,c,g,A){if(s!==null){var E=s.memoizedProps;if(Ao(E,g)&&s.ref===a.ref)if(qt=!1,a.pendingProps=g=E,Xf(s,A))(s.flags&131072)!==0&&(qt=!0);else return a.lanes=s.lanes,ds(s,a,A)}return Kf(s,a,c,g,A)}function C0(s,a,c,g){var A=g.children,E=s!==null?s.memoizedState:null;if(s===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),g.mode==="hidden"){if((a.flags&128)!==0){if(E=E!==null?E.baseLanes|c:c,s!==null){for(g=a.child=s.child,A=0;g!==null;)A=A|g.lanes|g.childLanes,g=g.sibling;g=A&~E}else g=0,a.child=null;return R0(s,a,E,c,g)}if((c&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},s!==null&&$l(a,E!==null?E.cachePool:null),E!==null?Dm(a,E):vf(),_m(a);else return g=a.lanes=536870912,R0(s,a,E!==null?E.baseLanes|c:c,c,g)}else E!==null?($l(a,E.cachePool),Dm(a,E),Ys(),a.memoizedState=null):(s!==null&&$l(a,null),vf(),Ys());return gi(s,a,A,c),a.child}function Mo(s,a){return s!==null&&s.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function R0(s,a,c,g,A){var E=hf();return E=E===null?null:{parent:Xt._currentValue,pool:E},a.memoizedState={baseLanes:c,cachePool:E},s!==null&&$l(a,null),vf(),_m(a),s!==null&&Aa(s,a,g,!0),a.childLanes=A,null}function au(s,a){return a=lu({mode:a.mode,children:a.children},s.mode),a.ref=s.ref,s.child=a,a.return=s,a}function L0(s,a,c){return Mr(a,s.child,null,c),s=au(a,a.pendingProps),s.flags|=2,Vi(a),a.memoizedState=null,s}function XS(s,a,c){var g=a.pendingProps,A=(a.flags&128)!==0;if(a.flags&=-129,s===null){if(ut){if(g.mode==="hidden")return s=au(a,g),a.lanes=536870912,Mo(null,s);if(Ef(a),(s=Ot)?(s=Np(s,on),s=s!==null&&s.data==="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Us!==null?{id:kn,overflow:wn}:null,retryLane:536870912,hydrationErrors:null},c=cm(s),c.return=a,a.child=c,hi=a,Ot=null)):s=null,s===null)throw Ns(a);return a.lanes=536870912,null}return au(a,g)}var E=s.memoizedState;if(E!==null){var x=E.dehydrated;if(Ef(a),A)if(a.flags&256)a.flags&=-257,a=L0(s,a,c);else if(a.memoizedState!==null)a.child=s.child,a.flags|=128,a=null;else throw Error(i(558));else if(qt||Aa(s,a,c,!1),A=(c&s.childLanes)!==0,qt||A){if(g=Ct,g!==null&&(x=mn(g,c),x!==0&&x!==E.retryLane))throw E.retryLane=x,xr(s,x),Bi(g,s,x),Hf;Au(),a=L0(s,a,c)}else s=E.treeContext,Ot=un(x.nextSibling),hi=a,ut=!0,Ps=null,on=!1,s!==null&&dm(a,s),a=au(a,g),a.flags|=4096;return a}return s=os(s.child,{mode:g.mode,children:g.children}),s.ref=a.ref,a.child=s,s.return=a,s}function ou(s,a){var c=a.ref;if(c===null)s!==null&&s.ref!==null&&(a.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(i(284));(s===null||s.ref!==c)&&(a.flags|=4194816)}}function Kf(s,a,c,g,A){return Dr(a),c=Sf(s,a,c,g,void 0,A),g=bf(),s!==null&&!qt?(xf(s,a,A),ds(s,a,A)):(ut&&g&&nf(a),a.flags|=1,gi(s,a,c,A),a.child)}function D0(s,a,c,g,A,E){return Dr(a),a.updateQueue=null,c=Bm(a,g,c,A),Im(s),g=bf(),s!==null&&!qt?(xf(s,a,E),ds(s,a,E)):(ut&&g&&nf(a),a.flags|=1,gi(s,a,c,E),a.child)}function _0(s,a,c,g,A){if(Dr(a),a.stateNode===null){var E=da,x=c.contextType;typeof x=="object"&&x!==null&&(E=di(x)),E=new c(g,E),a.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,E.updater=Nf,a.stateNode=E,E._reactInternals=a,E=a.stateNode,E.props=g,E.state=a.memoizedState,E.refs={},gf(a),x=c.contextType,E.context=typeof x=="object"&&x!==null?di(x):da,E.state=a.memoizedState,x=c.getDerivedStateFromProps,typeof x=="function"&&(Pf(a,c,x,g),E.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(x=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),x!==E.state&&Nf.enqueueReplaceState(E,E.state,null),Lo(a,g,E,A),Ro(),E.state=a.memoizedState),typeof E.componentDidMount=="function"&&(a.flags|=4194308),g=!0}else if(s===null){E=a.stateNode;var B=a.memoizedProps,G=Fr(c,B);E.props=G;var ne=E.context,ue=c.contextType;x=da,typeof ue=="object"&&ue!==null&&(x=di(ue));var ge=c.getDerivedStateFromProps;ue=typeof ge=="function"||typeof E.getSnapshotBeforeUpdate=="function",B=a.pendingProps!==B,ue||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(B||ne!==x)&&m0(a,E,g,x),Hs=!1;var se=a.memoizedState;E.state=se,Lo(a,g,E,A),Ro(),ne=a.memoizedState,B||se!==ne||Hs?(typeof ge=="function"&&(Pf(a,c,ge,g),ne=a.memoizedState),(G=Hs||g0(a,c,G,g,se,ne,x))?(ue||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount()),typeof E.componentDidMount=="function"&&(a.flags|=4194308)):(typeof E.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=g,a.memoizedState=ne),E.props=g,E.state=ne,E.context=x,g=G):(typeof E.componentDidMount=="function"&&(a.flags|=4194308),g=!1)}else{E=a.stateNode,mf(s,a),x=a.memoizedProps,ue=Fr(c,x),E.props=ue,ge=a.pendingProps,se=E.context,ne=c.contextType,G=da,typeof ne=="object"&&ne!==null&&(G=di(ne)),B=c.getDerivedStateFromProps,(ne=typeof B=="function"||typeof E.getSnapshotBeforeUpdate=="function")||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(x!==ge||se!==G)&&m0(a,E,g,G),Hs=!1,se=a.memoizedState,E.state=se,Lo(a,g,E,A),Ro();var ae=a.memoizedState;x!==ge||se!==ae||Hs||s!==null&&s.dependencies!==null&&Kl(s.dependencies)?(typeof B=="function"&&(Pf(a,c,B,g),ae=a.memoizedState),(ue=Hs||g0(a,c,ue,g,se,ae,G)||s!==null&&s.dependencies!==null&&Kl(s.dependencies))?(ne||typeof E.UNSAFE_componentWillUpdate!="function"&&typeof E.componentWillUpdate!="function"||(typeof E.componentWillUpdate=="function"&&E.componentWillUpdate(g,ae,G),typeof E.UNSAFE_componentWillUpdate=="function"&&E.UNSAFE_componentWillUpdate(g,ae,G)),typeof E.componentDidUpdate=="function"&&(a.flags|=4),typeof E.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof E.componentDidUpdate!="function"||x===s.memoizedProps&&se===s.memoizedState||(a.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||x===s.memoizedProps&&se===s.memoizedState||(a.flags|=1024),a.memoizedProps=g,a.memoizedState=ae),E.props=g,E.state=ae,E.context=G,g=ue):(typeof E.componentDidUpdate!="function"||x===s.memoizedProps&&se===s.memoizedState||(a.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||x===s.memoizedProps&&se===s.memoizedState||(a.flags|=1024),g=!1)}return E=g,ou(s,a),g=(a.flags&128)!==0,E||g?(E=a.stateNode,c=g&&typeof c.getDerivedStateFromError!="function"?null:E.render(),a.flags|=1,s!==null&&g?(a.child=Mr(a,s.child,null,A),a.child=Mr(a,null,c,A)):gi(s,a,c,A),a.memoizedState=E.state,s=a.child):s=ds(s,a,A),s}function I0(s,a,c,g){return Rr(),a.flags|=256,gi(s,a,c,g),a.child}var Vf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function $f(s){return{baseLanes:s,cachePool:ym()}}function Yf(s,a,c){return s=s!==null?s.childLanes&~c:0,a&&(s|=Yi),s}function B0(s,a,c){var g=a.pendingProps,A=!1,E=(a.flags&128)!==0,x;if((x=E)||(x=s!==null&&s.memoizedState===null?!1:(jt.current&2)!==0),x&&(A=!0,a.flags&=-129),x=(a.flags&32)!==0,a.flags&=-33,s===null){if(ut){if(A?$s(a):Ys(),(s=Ot)?(s=Np(s,on),s=s!==null&&s.data!=="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Us!==null?{id:kn,overflow:wn}:null,retryLane:536870912,hydrationErrors:null},c=cm(s),c.return=a,a.child=c,hi=a,Ot=null)):s=null,s===null)throw Ns(a);return Lh(s)?a.lanes=32:a.lanes=536870912,null}var B=g.children;return g=g.fallback,A?(Ys(),A=a.mode,B=lu({mode:"hidden",children:B},A),g=Cr(g,A,c,null),B.return=a,g.return=a,B.sibling=g,a.child=B,g=a.child,g.memoizedState=$f(c),g.childLanes=Yf(s,x,c),a.memoizedState=Vf,Mo(null,g)):($s(a),zf(a,B))}var G=s.memoizedState;if(G!==null&&(B=G.dehydrated,B!==null)){if(E)a.flags&256?($s(a),a.flags&=-257,a=jf(s,a,c)):a.memoizedState!==null?(Ys(),a.child=s.child,a.flags|=128,a=null):(Ys(),B=g.fallback,A=a.mode,g=lu({mode:"visible",children:g.children},A),B=Cr(B,A,c,null),B.flags|=2,g.return=a,B.return=a,g.sibling=B,a.child=g,Mr(a,s.child,null,c),g=a.child,g.memoizedState=$f(c),g.childLanes=Yf(s,x,c),a.memoizedState=Vf,a=Mo(null,g));else if($s(a),Lh(B)){if(x=B.nextSibling&&B.nextSibling.dataset,x)var ne=x.dgst;x=ne,g=Error(i(419)),g.stack="",g.digest=x,Eo({value:g,source:null,stack:null}),a=jf(s,a,c)}else if(qt||Aa(s,a,c,!1),x=(c&s.childLanes)!==0,qt||x){if(x=Ct,x!==null&&(g=mn(x,c),g!==0&&g!==G.retryLane))throw G.retryLane=g,xr(s,g),Bi(x,s,g),Hf;Rh(B)||Au(),a=jf(s,a,c)}else Rh(B)?(a.flags|=192,a.child=s.child,a=null):(s=G.treeContext,Ot=un(B.nextSibling),hi=a,ut=!0,Ps=null,on=!1,s!==null&&dm(a,s),a=zf(a,g.children),a.flags|=4096);return a}return A?(Ys(),B=g.fallback,A=a.mode,G=s.child,ne=G.sibling,g=os(G,{mode:"hidden",children:g.children}),g.subtreeFlags=G.subtreeFlags&65011712,ne!==null?B=os(ne,B):(B=Cr(B,A,c,null),B.flags|=2),B.return=a,g.return=a,g.sibling=B,a.child=g,Mo(null,g),g=a.child,B=s.child.memoizedState,B===null?B=$f(c):(A=B.cachePool,A!==null?(G=Xt._currentValue,A=A.parent!==G?{parent:G,pool:G}:A):A=ym(),B={baseLanes:B.baseLanes|c,cachePool:A}),g.memoizedState=B,g.childLanes=Yf(s,x,c),a.memoizedState=Vf,Mo(s.child,g)):($s(a),c=s.child,s=c.sibling,c=os(c,{mode:"visible",children:g.children}),c.return=a,c.sibling=null,s!==null&&(x=a.deletions,x===null?(a.deletions=[s],a.flags|=16):x.push(s)),a.child=c,a.memoizedState=null,c)}function zf(s,a){return a=lu({mode:"visible",children:a},s.mode),a.return=s,s.child=a}function lu(s,a){return s=Hi(22,s,null,a),s.lanes=0,s}function jf(s,a,c){return Mr(a,s.child,null,c),s=zf(a,a.pendingProps.children),s.flags|=2,a.memoizedState=null,s}function M0(s,a,c){s.lanes|=a;var g=s.alternate;g!==null&&(g.lanes|=a),lf(s.return,a,c)}function Jf(s,a,c,g,A,E){var x=s.memoizedState;x===null?s.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:g,tail:c,tailMode:A,treeForkCount:E}:(x.isBackwards=a,x.rendering=null,x.renderingStartTime=0,x.last=g,x.tail=c,x.tailMode=A,x.treeForkCount=E)}function O0(s,a,c){var g=a.pendingProps,A=g.revealOrder,E=g.tail;g=g.children;var x=jt.current,B=(x&2)!==0;if(B?(x=x&1|2,a.flags|=128):x&=1,V(jt,x),gi(s,a,g,c),g=ut?yo:0,!B&&s!==null&&(s.flags&128)!==0)e:for(s=a.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&M0(s,c,a);else if(s.tag===19)M0(s,c,a);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break e;for(;s.sibling===null;){if(s.return===null||s.return===a)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(A){case"forwards":for(c=a.child,A=null;c!==null;)s=c.alternate,s!==null&&Ql(s)===null&&(A=c),c=c.sibling;c=A,c===null?(A=a.child,a.child=null):(A=c.sibling,c.sibling=null),Jf(a,!1,A,c,E,g);break;case"backwards":case"unstable_legacy-backwards":for(c=null,A=a.child,a.child=null;A!==null;){if(s=A.alternate,s!==null&&Ql(s)===null){a.child=A;break}s=A.sibling,A.sibling=c,c=A,A=s}Jf(a,!0,c,null,E,g);break;case"together":Jf(a,!1,null,null,void 0,g);break;default:a.memoizedState=null}return a.child}function ds(s,a,c){if(s!==null&&(a.dependencies=s.dependencies),Js|=a.lanes,(c&a.childLanes)===0)if(s!==null){if(Aa(s,a,c,!1),(c&a.childLanes)===0)return null}else return null;if(s!==null&&a.child!==s.child)throw Error(i(153));if(a.child!==null){for(s=a.child,c=os(s,s.pendingProps),a.child=c,c.return=a;s.sibling!==null;)s=s.sibling,c=c.sibling=os(s,s.pendingProps),c.return=a;c.sibling=null}return a.child}function Xf(s,a){return(s.lanes&a)!==0?!0:(s=s.dependencies,!!(s!==null&&Kl(s)))}function QS(s,a,c){switch(a.tag){case 3:le(a,a.stateNode.containerInfo),Gs(a,Xt,s.memoizedState.cache),Rr();break;case 27:case 5:ye(a);break;case 4:le(a,a.stateNode.containerInfo);break;case 10:Gs(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,Ef(a),null;break;case 13:var g=a.memoizedState;if(g!==null)return g.dehydrated!==null?($s(a),a.flags|=128,null):(c&a.child.childLanes)!==0?B0(s,a,c):($s(a),s=ds(s,a,c),s!==null?s.sibling:null);$s(a);break;case 19:var A=(s.flags&128)!==0;if(g=(c&a.childLanes)!==0,g||(Aa(s,a,c,!1),g=(c&a.childLanes)!==0),A){if(g)return O0(s,a,c);a.flags|=128}if(A=a.memoizedState,A!==null&&(A.rendering=null,A.tail=null,A.lastEffect=null),V(jt,jt.current),g)break;return null;case 22:return a.lanes=0,C0(s,a,c,a.pendingProps);case 24:Gs(a,Xt,s.memoizedState.cache)}return ds(s,a,c)}function F0(s,a,c){if(s!==null)if(s.memoizedProps!==a.pendingProps)qt=!0;else{if(!Xf(s,c)&&(a.flags&128)===0)return qt=!1,QS(s,a,c);qt=(s.flags&131072)!==0}else qt=!1,ut&&(a.flags&1048576)!==0&&hm(a,yo,a.index);switch(a.lanes=0,a.tag){case 16:e:{var g=a.pendingProps;if(s=Ir(a.elementType),a.type=s,typeof s=="function")Zc(s)?(g=Fr(s,g),a.tag=1,a=_0(null,a,s,g,c)):(a.tag=0,a=Kf(null,a,s,g,c));else{if(s!=null){var A=s.$$typeof;if(A===D){a.tag=11,a=S0(null,a,s,g,c);break e}else if(A===I){a.tag=14,a=b0(null,a,s,g,c);break e}}throw a=Y(s)||s,Error(i(306,a,""))}}return a;case 0:return Kf(s,a,a.type,a.pendingProps,c);case 1:return g=a.type,A=Fr(g,a.pendingProps),_0(s,a,g,A,c);case 3:e:{if(le(a,a.stateNode.containerInfo),s===null)throw Error(i(387));g=a.pendingProps;var E=a.memoizedState;A=E.element,mf(s,a),Lo(a,g,null,c);var x=a.memoizedState;if(g=x.cache,Gs(a,Xt,g),g!==E.cache&&uf(a,[Xt],c,!0),Ro(),g=x.element,E.isDehydrated)if(E={element:g,isDehydrated:!1,cache:x.cache},a.updateQueue.baseState=E,a.memoizedState=E,a.flags&256){a=I0(s,a,g,c);break e}else if(g!==A){A=sn(Error(i(424)),a),Eo(A),a=I0(s,a,g,c);break e}else{switch(s=a.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(Ot=un(s.firstChild),hi=a,ut=!0,Ps=null,on=!0,c=Cm(a,null,g,c),a.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(Rr(),g===A){a=ds(s,a,c);break e}gi(s,a,g,c)}a=a.child}return a;case 26:return ou(s,a),s===null?(c=Yp(a.type,null,a.pendingProps,null))?a.memoizedState=c:ut||(c=a.type,s=a.pendingProps,g=xu(re.current).createElement(c),g[Mt]=a,g[fi]=s,mi(g,c,s),wt(g),a.stateNode=g):a.memoizedState=Yp(a.type,s.memoizedProps,a.pendingProps,s.memoizedState),null;case 27:return ye(a),s===null&&ut&&(g=a.stateNode=Kp(a.type,a.pendingProps,re.current),hi=a,on=!0,A=Ot,Zs(a.type)?(Dh=A,Ot=un(g.firstChild)):Ot=A),gi(s,a,a.pendingProps.children,c),ou(s,a),s===null&&(a.flags|=4194304),a.child;case 5:return s===null&&ut&&((A=g=Ot)&&(g=R1(g,a.type,a.pendingProps,on),g!==null?(a.stateNode=g,hi=a,Ot=un(g.firstChild),on=!1,A=!0):A=!1),A||Ns(a)),ye(a),A=a.type,E=a.pendingProps,x=s!==null?s.memoizedProps:null,g=E.children,bh(A,E)?g=null:x!==null&&bh(A,x)&&(a.flags|=32),a.memoizedState!==null&&(A=Sf(s,a,HS,null,null,c),jo._currentValue=A),ou(s,a),gi(s,a,g,c),a.child;case 6:return s===null&&ut&&((s=c=Ot)&&(c=L1(c,a.pendingProps,on),c!==null?(a.stateNode=c,hi=a,Ot=null,s=!0):s=!1),s||Ns(a)),null;case 13:return B0(s,a,c);case 4:return le(a,a.stateNode.containerInfo),g=a.pendingProps,s===null?a.child=Mr(a,null,g,c):gi(s,a,g,c),a.child;case 11:return S0(s,a,a.type,a.pendingProps,c);case 7:return gi(s,a,a.pendingProps,c),a.child;case 8:return gi(s,a,a.pendingProps.children,c),a.child;case 12:return gi(s,a,a.pendingProps.children,c),a.child;case 10:return g=a.pendingProps,Gs(a,a.type,g.value),gi(s,a,g.children,c),a.child;case 9:return A=a.type._context,g=a.pendingProps.children,Dr(a),A=di(A),g=g(A),a.flags|=1,gi(s,a,g,c),a.child;case 14:return b0(s,a,a.type,a.pendingProps,c);case 15:return x0(s,a,a.type,a.pendingProps,c);case 19:return O0(s,a,c);case 31:return XS(s,a,c);case 22:return C0(s,a,c,a.pendingProps);case 24:return Dr(a),g=di(Xt),s===null?(A=hf(),A===null&&(A=Ct,E=cf(),A.pooledCache=E,E.refCount++,E!==null&&(A.pooledCacheLanes|=c),A=E),a.memoizedState={parent:g,cache:A},gf(a),Gs(a,Xt,A)):((s.lanes&c)!==0&&(mf(s,a),Lo(a,null,null,c),Ro()),A=s.memoizedState,E=a.memoizedState,A.parent!==g?(A={parent:g,cache:g},a.memoizedState=A,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=A),Gs(a,Xt,g)):(g=E.cache,Gs(a,Xt,g),g!==A.cache&&uf(a,[Xt],c,!0))),gi(s,a,a.pendingProps.children,c),a.child;case 29:throw a.pendingProps}throw Error(i(156,a.tag))}function gs(s){s.flags|=4}function Qf(s,a,c,g,A){if((a=(s.mode&32)!==0)&&(a=!1),a){if(s.flags|=16777216,(A&335544128)===A)if(s.stateNode.complete)s.flags|=8192;else if(op())s.flags|=8192;else throw Br=zl,df}else s.flags&=-16777217}function k0(s,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!Qp(a))if(op())s.flags|=8192;else throw Br=zl,df}function uu(s,a){a!==null&&(s.flags|=4),s.flags&16384&&(a=s.tag!==22?Je():536870912,s.lanes|=a,_a|=a)}function Oo(s,a){if(!ut)switch(s.tailMode){case"hidden":a=s.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?s.tail=null:c.sibling=null;break;case"collapsed":c=s.tail;for(var g=null;c!==null;)c.alternate!==null&&(g=c),c=c.sibling;g===null?a||s.tail===null?s.tail=null:s.tail.sibling=null:g.sibling=null}}function Ft(s){var a=s.alternate!==null&&s.alternate.child===s.child,c=0,g=0;if(a)for(var A=s.child;A!==null;)c|=A.lanes|A.childLanes,g|=A.subtreeFlags&65011712,g|=A.flags&65011712,A.return=s,A=A.sibling;else for(A=s.child;A!==null;)c|=A.lanes|A.childLanes,g|=A.subtreeFlags,g|=A.flags,A.return=s,A=A.sibling;return s.subtreeFlags|=g,s.childLanes=c,a}function qS(s,a,c){var g=a.pendingProps;switch(sf(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ft(a),null;case 1:return Ft(a),null;case 3:return c=a.stateNode,g=null,s!==null&&(g=s.memoizedState.cache),a.memoizedState.cache!==g&&(a.flags|=2048),cs(Xt),ve(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(s===null||s.child===null)&&(pa(a)?gs(a):s===null||s.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,af())),Ft(a),null;case 26:var A=a.type,E=a.memoizedState;return s===null?(gs(a),E!==null?(Ft(a),k0(a,E)):(Ft(a),Qf(a,A,null,g,c))):E?E!==s.memoizedState?(gs(a),Ft(a),k0(a,E)):(Ft(a),a.flags&=-16777217):(s=s.memoizedProps,s!==g&&gs(a),Ft(a),Qf(a,A,s,g,c)),null;case 27:if(fe(a),c=re.current,A=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==g&&gs(a);else{if(!g){if(a.stateNode===null)throw Error(i(166));return Ft(a),null}s=q.current,pa(a)?gm(a):(s=Kp(A,g,c),a.stateNode=s,gs(a))}return Ft(a),null;case 5:if(fe(a),A=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==g&&gs(a);else{if(!g){if(a.stateNode===null)throw Error(i(166));return Ft(a),null}if(E=q.current,pa(a))gm(a);else{var x=xu(re.current);switch(E){case 1:E=x.createElementNS("http://www.w3.org/2000/svg",A);break;case 2:E=x.createElementNS("http://www.w3.org/1998/Math/MathML",A);break;default:switch(A){case"svg":E=x.createElementNS("http://www.w3.org/2000/svg",A);break;case"math":E=x.createElementNS("http://www.w3.org/1998/Math/MathML",A);break;case"script":E=x.createElement("div"),E.innerHTML="<script><\/script>",E=E.removeChild(E.firstChild);break;case"select":E=typeof g.is=="string"?x.createElement("select",{is:g.is}):x.createElement("select"),g.multiple?E.multiple=!0:g.size&&(E.size=g.size);break;default:E=typeof g.is=="string"?x.createElement(A,{is:g.is}):x.createElement(A)}}E[Mt]=a,E[fi]=g;e:for(x=a.child;x!==null;){if(x.tag===5||x.tag===6)E.appendChild(x.stateNode);else if(x.tag!==4&&x.tag!==27&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===a)break e;for(;x.sibling===null;){if(x.return===null||x.return===a)break e;x=x.return}x.sibling.return=x.return,x=x.sibling}a.stateNode=E;e:switch(mi(E,A,g),A){case"button":case"input":case"select":case"textarea":g=!!g.autoFocus;break e;case"img":g=!0;break e;default:g=!1}g&&gs(a)}}return Ft(a),Qf(a,a.type,s===null?null:s.memoizedProps,a.pendingProps,c),null;case 6:if(s&&a.stateNode!=null)s.memoizedProps!==g&&gs(a);else{if(typeof g!="string"&&a.stateNode===null)throw Error(i(166));if(s=re.current,pa(a)){if(s=a.stateNode,c=a.memoizedProps,g=null,A=hi,A!==null)switch(A.tag){case 27:case 5:g=A.memoizedProps}s[Mt]=a,s=!!(s.nodeValue===c||g!==null&&g.suppressHydrationWarning===!0||Bp(s.nodeValue,c)),s||Ns(a,!0)}else s=xu(s).createTextNode(g),s[Mt]=a,a.stateNode=s}return Ft(a),null;case 31:if(c=a.memoizedState,s===null||s.memoizedState!==null){if(g=pa(a),c!==null){if(s===null){if(!g)throw Error(i(318));if(s=a.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(557));s[Mt]=a}else Rr(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Ft(a),s=!1}else c=af(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=c),s=!0;if(!s)return a.flags&256?(Vi(a),a):(Vi(a),null);if((a.flags&128)!==0)throw Error(i(558))}return Ft(a),null;case 13:if(g=a.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(A=pa(a),g!==null&&g.dehydrated!==null){if(s===null){if(!A)throw Error(i(318));if(A=a.memoizedState,A=A!==null?A.dehydrated:null,!A)throw Error(i(317));A[Mt]=a}else Rr(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Ft(a),A=!1}else A=af(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=A),A=!0;if(!A)return a.flags&256?(Vi(a),a):(Vi(a),null)}return Vi(a),(a.flags&128)!==0?(a.lanes=c,a):(c=g!==null,s=s!==null&&s.memoizedState!==null,c&&(g=a.child,A=null,g.alternate!==null&&g.alternate.memoizedState!==null&&g.alternate.memoizedState.cachePool!==null&&(A=g.alternate.memoizedState.cachePool.pool),E=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(E=g.memoizedState.cachePool.pool),E!==A&&(g.flags|=2048)),c!==s&&c&&(a.child.flags|=8192),uu(a,a.updateQueue),Ft(a),null);case 4:return ve(),s===null&&vh(a.stateNode.containerInfo),Ft(a),null;case 10:return cs(a.type),Ft(a),null;case 19:if(N(jt),g=a.memoizedState,g===null)return Ft(a),null;if(A=(a.flags&128)!==0,E=g.rendering,E===null)if(A)Oo(g,!1);else{if($t!==0||s!==null&&(s.flags&128)!==0)for(s=a.child;s!==null;){if(E=Ql(s),E!==null){for(a.flags|=128,Oo(g,!1),s=E.updateQueue,a.updateQueue=s,uu(a,s),a.subtreeFlags=0,s=c,c=a.child;c!==null;)um(c,s),c=c.sibling;return V(jt,jt.current&1|2),ut&&ls(a,g.treeForkCount),a.child}s=s.sibling}g.tail!==null&&Se()>gu&&(a.flags|=128,A=!0,Oo(g,!1),a.lanes=4194304)}else{if(!A)if(s=Ql(E),s!==null){if(a.flags|=128,A=!0,s=s.updateQueue,a.updateQueue=s,uu(a,s),Oo(g,!0),g.tail===null&&g.tailMode==="hidden"&&!E.alternate&&!ut)return Ft(a),null}else 2*Se()-g.renderingStartTime>gu&&c!==536870912&&(a.flags|=128,A=!0,Oo(g,!1),a.lanes=4194304);g.isBackwards?(E.sibling=a.child,a.child=E):(s=g.last,s!==null?s.sibling=E:a.child=E,g.last=E)}return g.tail!==null?(s=g.tail,g.rendering=s,g.tail=s.sibling,g.renderingStartTime=Se(),s.sibling=null,c=jt.current,V(jt,A?c&1|2:c&1),ut&&ls(a,g.treeForkCount),s):(Ft(a),null);case 22:case 23:return Vi(a),yf(),g=a.memoizedState!==null,s!==null?s.memoizedState!==null!==g&&(a.flags|=8192):g&&(a.flags|=8192),g?(c&536870912)!==0&&(a.flags&128)===0&&(Ft(a),a.subtreeFlags&6&&(a.flags|=8192)):Ft(a),c=a.updateQueue,c!==null&&uu(a,c.retryQueue),c=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),g=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(g=a.memoizedState.cachePool.pool),g!==c&&(a.flags|=2048),s!==null&&N(_r),null;case 24:return c=null,s!==null&&(c=s.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),cs(Xt),Ft(a),null;case 25:return null;case 30:return null}throw Error(i(156,a.tag))}function WS(s,a){switch(sf(a),a.tag){case 1:return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 3:return cs(Xt),ve(),s=a.flags,(s&65536)!==0&&(s&128)===0?(a.flags=s&-65537|128,a):null;case 26:case 27:case 5:return fe(a),null;case 31:if(a.memoizedState!==null){if(Vi(a),a.alternate===null)throw Error(i(340));Rr()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 13:if(Vi(a),s=a.memoizedState,s!==null&&s.dehydrated!==null){if(a.alternate===null)throw Error(i(340));Rr()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 19:return N(jt),null;case 4:return ve(),null;case 10:return cs(a.type),null;case 22:case 23:return Vi(a),yf(),s!==null&&N(_r),s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 24:return cs(Xt),null;case 25:return null;default:return null}}function w0(s,a){switch(sf(a),a.tag){case 3:cs(Xt),ve();break;case 26:case 27:case 5:fe(a);break;case 4:ve();break;case 31:a.memoizedState!==null&&Vi(a);break;case 13:Vi(a);break;case 19:N(jt);break;case 10:cs(a.type);break;case 22:case 23:Vi(a),yf(),s!==null&&N(_r);break;case 24:cs(Xt)}}function Fo(s,a){try{var c=a.updateQueue,g=c!==null?c.lastEffect:null;if(g!==null){var A=g.next;c=A;do{if((c.tag&s)===s){g=void 0;var E=c.create,x=c.inst;g=E(),x.destroy=g}c=c.next}while(c!==A)}}catch(B){pt(a,a.return,B)}}function zs(s,a,c){try{var g=a.updateQueue,A=g!==null?g.lastEffect:null;if(A!==null){var E=A.next;g=E;do{if((g.tag&s)===s){var x=g.inst,B=x.destroy;if(B!==void 0){x.destroy=void 0,A=a;var G=c,ne=B;try{ne()}catch(ue){pt(A,G,ue)}}}g=g.next}while(g!==E)}}catch(ue){pt(a,a.return,ue)}}function U0(s){var a=s.updateQueue;if(a!==null){var c=s.stateNode;try{Lm(a,c)}catch(g){pt(s,s.return,g)}}}function P0(s,a,c){c.props=Fr(s.type,s.memoizedProps),c.state=s.memoizedState;try{c.componentWillUnmount()}catch(g){pt(s,a,g)}}function ko(s,a){try{var c=s.ref;if(c!==null){switch(s.tag){case 26:case 27:case 5:var g=s.stateNode;break;case 30:g=s.stateNode;break;default:g=s.stateNode}typeof c=="function"?s.refCleanup=c(g):c.current=g}}catch(A){pt(s,a,A)}}function Un(s,a){var c=s.ref,g=s.refCleanup;if(c!==null)if(typeof g=="function")try{g()}catch(A){pt(s,a,A)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(A){pt(s,a,A)}else c.current=null}function N0(s){var a=s.type,c=s.memoizedProps,g=s.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":c.autoFocus&&g.focus();break e;case"img":c.src?g.src=c.src:c.srcSet&&(g.srcset=c.srcSet)}}catch(A){pt(s,s.return,A)}}function qf(s,a,c){try{var g=s.stateNode;E1(g,s.type,c,a),g[fi]=a}catch(A){pt(s,s.return,A)}}function G0(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&Zs(s.type)||s.tag===4}function Wf(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||G0(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&Zs(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Zf(s,a,c){var g=s.tag;if(g===5||g===6)s=s.stateNode,a?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(s,a):(a=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,a.appendChild(s),c=c._reactRootContainer,c!=null||a.onclick!==null||(a.onclick=vi));else if(g!==4&&(g===27&&Zs(s.type)&&(c=s.stateNode,a=null),s=s.child,s!==null))for(Zf(s,a,c),s=s.sibling;s!==null;)Zf(s,a,c),s=s.sibling}function cu(s,a,c){var g=s.tag;if(g===5||g===6)s=s.stateNode,a?c.insertBefore(s,a):c.appendChild(s);else if(g!==4&&(g===27&&Zs(s.type)&&(c=s.stateNode),s=s.child,s!==null))for(cu(s,a,c),s=s.sibling;s!==null;)cu(s,a,c),s=s.sibling}function H0(s){var a=s.stateNode,c=s.memoizedProps;try{for(var g=s.type,A=a.attributes;A.length;)a.removeAttributeNode(A[0]);mi(a,g,c),a[Mt]=s,a[fi]=c}catch(E){pt(s,s.return,E)}}var ms=!1,Wt=!1,eh=!1,K0=typeof WeakSet=="function"?WeakSet:Set,li=null;function ZS(s,a){if(s=s.containerInfo,Th=Bu,s=em(s),zc(s)){if("selectionStart"in s)var c={start:s.selectionStart,end:s.selectionEnd};else e:{c=(c=s.ownerDocument)&&c.defaultView||window;var g=c.getSelection&&c.getSelection();if(g&&g.rangeCount!==0){c=g.anchorNode;var A=g.anchorOffset,E=g.focusNode;g=g.focusOffset;try{c.nodeType,E.nodeType}catch{c=null;break e}var x=0,B=-1,G=-1,ne=0,ue=0,ge=s,se=null;t:for(;;){for(var ae;ge!==c||A!==0&&ge.nodeType!==3||(B=x+A),ge!==E||g!==0&&ge.nodeType!==3||(G=x+g),ge.nodeType===3&&(x+=ge.nodeValue.length),(ae=ge.firstChild)!==null;)se=ge,ge=ae;for(;;){if(ge===s)break t;if(se===c&&++ne===A&&(B=x),se===E&&++ue===g&&(G=x),(ae=ge.nextSibling)!==null)break;ge=se,se=ge.parentNode}ge=ae}c=B===-1||G===-1?null:{start:B,end:G}}else c=null}c=c||{start:0,end:0}}else c=null;for(Sh={focusedElem:s,selectionRange:c},Bu=!1,li=a;li!==null;)if(a=li,s=a.child,(a.subtreeFlags&1028)!==0&&s!==null)s.return=a,li=s;else for(;li!==null;){switch(a=li,E=a.alternate,s=a.flags,a.tag){case 0:if((s&4)!==0&&(s=a.updateQueue,s=s!==null?s.events:null,s!==null))for(c=0;c<s.length;c++)A=s[c],A.ref.impl=A.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&E!==null){s=void 0,c=a,A=E.memoizedProps,E=E.memoizedState,g=c.stateNode;try{var Me=Fr(c.type,A);s=g.getSnapshotBeforeUpdate(Me,E),g.__reactInternalSnapshotBeforeUpdate=s}catch($e){pt(c,c.return,$e)}}break;case 3:if((s&1024)!==0){if(s=a.stateNode.containerInfo,c=s.nodeType,c===9)Ch(s);else if(c===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":Ch(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(i(163))}if(s=a.sibling,s!==null){s.return=a.return,li=s;break}li=a.return}}function V0(s,a,c){var g=c.flags;switch(c.tag){case 0:case 11:case 15:As(s,c),g&4&&Fo(5,c);break;case 1:if(As(s,c),g&4)if(s=c.stateNode,a===null)try{s.componentDidMount()}catch(x){pt(c,c.return,x)}else{var A=Fr(c.type,a.memoizedProps);a=a.memoizedState;try{s.componentDidUpdate(A,a,s.__reactInternalSnapshotBeforeUpdate)}catch(x){pt(c,c.return,x)}}g&64&&U0(c),g&512&&ko(c,c.return);break;case 3:if(As(s,c),g&64&&(s=c.updateQueue,s!==null)){if(a=null,c.child!==null)switch(c.child.tag){case 27:case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}try{Lm(s,a)}catch(x){pt(c,c.return,x)}}break;case 27:a===null&&g&4&&H0(c);case 26:case 5:As(s,c),a===null&&g&4&&N0(c),g&512&&ko(c,c.return);break;case 12:As(s,c);break;case 31:As(s,c),g&4&&z0(s,c);break;case 13:As(s,c),g&4&&j0(s,c),g&64&&(s=c.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(c=l1.bind(null,c),D1(s,c))));break;case 22:if(g=c.memoizedState!==null||ms,!g){a=a!==null&&a.memoizedState!==null||Wt,A=ms;var E=Wt;ms=g,(Wt=a)&&!E?vs(s,c,(c.subtreeFlags&8772)!==0):As(s,c),ms=A,Wt=E}break;case 30:break;default:As(s,c)}}function $0(s){var a=s.alternate;a!==null&&(s.alternate=null,$0(a)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(a=s.stateNode,a!==null&&Wr(a)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Ut=null,Li=!1;function ps(s,a,c){for(c=c.child;c!==null;)Y0(s,a,c),c=c.sibling}function Y0(s,a,c){if(Ke&&typeof Ke.onCommitFiberUnmount=="function")try{Ke.onCommitFiberUnmount(Xe,c)}catch{}switch(c.tag){case 26:Wt||Un(c,a),ps(s,a,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:Wt||Un(c,a);var g=Ut,A=Li;Zs(c.type)&&(Ut=c.stateNode,Li=!1),ps(s,a,c),$o(c.stateNode),Ut=g,Li=A;break;case 5:Wt||Un(c,a);case 6:if(g=Ut,A=Li,Ut=null,ps(s,a,c),Ut=g,Li=A,Ut!==null)if(Li)try{(Ut.nodeType===9?Ut.body:Ut.nodeName==="HTML"?Ut.ownerDocument.body:Ut).removeChild(c.stateNode)}catch(E){pt(c,a,E)}else try{Ut.removeChild(c.stateNode)}catch(E){pt(c,a,E)}break;case 18:Ut!==null&&(Li?(s=Ut,Up(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,c.stateNode),Ua(s)):Up(Ut,c.stateNode));break;case 4:g=Ut,A=Li,Ut=c.stateNode.containerInfo,Li=!0,ps(s,a,c),Ut=g,Li=A;break;case 0:case 11:case 14:case 15:zs(2,c,a),Wt||zs(4,c,a),ps(s,a,c);break;case 1:Wt||(Un(c,a),g=c.stateNode,typeof g.componentWillUnmount=="function"&&P0(c,a,g)),ps(s,a,c);break;case 21:ps(s,a,c);break;case 22:Wt=(g=Wt)||c.memoizedState!==null,ps(s,a,c),Wt=g;break;default:ps(s,a,c)}}function z0(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{Ua(s)}catch(c){pt(a,a.return,c)}}}function j0(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Ua(s)}catch(c){pt(a,a.return,c)}}function e1(s){switch(s.tag){case 31:case 13:case 19:var a=s.stateNode;return a===null&&(a=s.stateNode=new K0),a;case 22:return s=s.stateNode,a=s._retryCache,a===null&&(a=s._retryCache=new K0),a;default:throw Error(i(435,s.tag))}}function fu(s,a){var c=e1(s);a.forEach(function(g){if(!c.has(g)){c.add(g);var A=u1.bind(null,s,g);g.then(A,A)}})}function Di(s,a){var c=a.deletions;if(c!==null)for(var g=0;g<c.length;g++){var A=c[g],E=s,x=a,B=x;e:for(;B!==null;){switch(B.tag){case 27:if(Zs(B.type)){Ut=B.stateNode,Li=!1;break e}break;case 5:Ut=B.stateNode,Li=!1;break e;case 3:case 4:Ut=B.stateNode.containerInfo,Li=!0;break e}B=B.return}if(Ut===null)throw Error(i(160));Y0(E,x,A),Ut=null,Li=!1,E=A.alternate,E!==null&&(E.return=null),A.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)J0(a,s),a=a.sibling}var En=null;function J0(s,a){var c=s.alternate,g=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:Di(a,s),_i(s),g&4&&(zs(3,s,s.return),Fo(3,s),zs(5,s,s.return));break;case 1:Di(a,s),_i(s),g&512&&(Wt||c===null||Un(c,c.return)),g&64&&ms&&(s=s.updateQueue,s!==null&&(g=s.callbacks,g!==null&&(c=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=c===null?g:c.concat(g))));break;case 26:var A=En;if(Di(a,s),_i(s),g&512&&(Wt||c===null||Un(c,c.return)),g&4){var E=c!==null?c.memoizedState:null;if(g=s.memoizedState,c===null)if(g===null)if(s.stateNode===null){e:{g=s.type,c=s.memoizedProps,A=A.ownerDocument||A;t:switch(g){case"title":E=A.getElementsByTagName("title")[0],(!E||E[hr]||E[Mt]||E.namespaceURI==="http://www.w3.org/2000/svg"||E.hasAttribute("itemprop"))&&(E=A.createElement(g),A.head.insertBefore(E,A.querySelector("head > title"))),mi(E,g,c),E[Mt]=s,wt(E),g=E;break e;case"link":var x=Jp("link","href",A).get(g+(c.href||""));if(x){for(var B=0;B<x.length;B++)if(E=x[B],E.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&E.getAttribute("rel")===(c.rel==null?null:c.rel)&&E.getAttribute("title")===(c.title==null?null:c.title)&&E.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){x.splice(B,1);break t}}E=A.createElement(g),mi(E,g,c),A.head.appendChild(E);break;case"meta":if(x=Jp("meta","content",A).get(g+(c.content||""))){for(B=0;B<x.length;B++)if(E=x[B],E.getAttribute("content")===(c.content==null?null:""+c.content)&&E.getAttribute("name")===(c.name==null?null:c.name)&&E.getAttribute("property")===(c.property==null?null:c.property)&&E.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&E.getAttribute("charset")===(c.charSet==null?null:c.charSet)){x.splice(B,1);break t}}E=A.createElement(g),mi(E,g,c),A.head.appendChild(E);break;default:throw Error(i(468,g))}E[Mt]=s,wt(E),g=E}s.stateNode=g}else Xp(A,s.type,s.stateNode);else s.stateNode=jp(A,g,s.memoizedProps);else E!==g?(E===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):E.count--,g===null?Xp(A,s.type,s.stateNode):jp(A,g,s.memoizedProps)):g===null&&s.stateNode!==null&&qf(s,s.memoizedProps,c.memoizedProps)}break;case 27:Di(a,s),_i(s),g&512&&(Wt||c===null||Un(c,c.return)),c!==null&&g&4&&qf(s,s.memoizedProps,c.memoizedProps);break;case 5:if(Di(a,s),_i(s),g&512&&(Wt||c===null||Un(c,c.return)),s.flags&32){A=s.stateNode;try{In(A,"")}catch(Me){pt(s,s.return,Me)}}g&4&&s.stateNode!=null&&(A=s.memoizedProps,qf(s,A,c!==null?c.memoizedProps:A)),g&1024&&(eh=!0);break;case 6:if(Di(a,s),_i(s),g&4){if(s.stateNode===null)throw Error(i(162));g=s.memoizedProps,c=s.stateNode;try{c.nodeValue=g}catch(Me){pt(s,s.return,Me)}}break;case 3:if(Lu=null,A=En,En=Cu(a.containerInfo),Di(a,s),En=A,_i(s),g&4&&c!==null&&c.memoizedState.isDehydrated)try{Ua(a.containerInfo)}catch(Me){pt(s,s.return,Me)}eh&&(eh=!1,X0(s));break;case 4:g=En,En=Cu(s.stateNode.containerInfo),Di(a,s),_i(s),En=g;break;case 12:Di(a,s),_i(s);break;case 31:Di(a,s),_i(s),g&4&&(g=s.updateQueue,g!==null&&(s.updateQueue=null,fu(s,g)));break;case 13:Di(a,s),_i(s),s.child.flags&8192&&s.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(du=Se()),g&4&&(g=s.updateQueue,g!==null&&(s.updateQueue=null,fu(s,g)));break;case 22:A=s.memoizedState!==null;var G=c!==null&&c.memoizedState!==null,ne=ms,ue=Wt;if(ms=ne||A,Wt=ue||G,Di(a,s),Wt=ue,ms=ne,_i(s),g&8192)e:for(a=s.stateNode,a._visibility=A?a._visibility&-2:a._visibility|1,A&&(c===null||G||ms||Wt||kr(s)),c=null,a=s;;){if(a.tag===5||a.tag===26){if(c===null){G=c=a;try{if(E=G.stateNode,A)x=E.style,typeof x.setProperty=="function"?x.setProperty("display","none","important"):x.display="none";else{B=G.stateNode;var ge=G.memoizedProps.style,se=ge!=null&&ge.hasOwnProperty("display")?ge.display:null;B.style.display=se==null||typeof se=="boolean"?"":(""+se).trim()}}catch(Me){pt(G,G.return,Me)}}}else if(a.tag===6){if(c===null){G=a;try{G.stateNode.nodeValue=A?"":G.memoizedProps}catch(Me){pt(G,G.return,Me)}}}else if(a.tag===18){if(c===null){G=a;try{var ae=G.stateNode;A?Pp(ae,!0):Pp(G.stateNode,!1)}catch(Me){pt(G,G.return,Me)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===s)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break e;for(;a.sibling===null;){if(a.return===null||a.return===s)break e;c===a&&(c=null),a=a.return}c===a&&(c=null),a.sibling.return=a.return,a=a.sibling}g&4&&(g=s.updateQueue,g!==null&&(c=g.retryQueue,c!==null&&(g.retryQueue=null,fu(s,c))));break;case 19:Di(a,s),_i(s),g&4&&(g=s.updateQueue,g!==null&&(s.updateQueue=null,fu(s,g)));break;case 30:break;case 21:break;default:Di(a,s),_i(s)}}function _i(s){var a=s.flags;if(a&2){try{for(var c,g=s.return;g!==null;){if(G0(g)){c=g;break}g=g.return}if(c==null)throw Error(i(160));switch(c.tag){case 27:var A=c.stateNode,E=Wf(s);cu(s,E,A);break;case 5:var x=c.stateNode;c.flags&32&&(In(x,""),c.flags&=-33);var B=Wf(s);cu(s,B,x);break;case 3:case 4:var G=c.stateNode.containerInfo,ne=Wf(s);Zf(s,ne,G);break;default:throw Error(i(161))}}catch(ue){pt(s,s.return,ue)}s.flags&=-3}a&4096&&(s.flags&=-4097)}function X0(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var a=s;X0(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),s=s.sibling}}function As(s,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)V0(s,a.alternate,a),a=a.sibling}function kr(s){for(s=s.child;s!==null;){var a=s;switch(a.tag){case 0:case 11:case 14:case 15:zs(4,a,a.return),kr(a);break;case 1:Un(a,a.return);var c=a.stateNode;typeof c.componentWillUnmount=="function"&&P0(a,a.return,c),kr(a);break;case 27:$o(a.stateNode);case 26:case 5:Un(a,a.return),kr(a);break;case 22:a.memoizedState===null&&kr(a);break;case 30:kr(a);break;default:kr(a)}s=s.sibling}}function vs(s,a,c){for(c=c&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var g=a.alternate,A=s,E=a,x=E.flags;switch(E.tag){case 0:case 11:case 15:vs(A,E,c),Fo(4,E);break;case 1:if(vs(A,E,c),g=E,A=g.stateNode,typeof A.componentDidMount=="function")try{A.componentDidMount()}catch(ne){pt(g,g.return,ne)}if(g=E,A=g.updateQueue,A!==null){var B=g.stateNode;try{var G=A.shared.hiddenCallbacks;if(G!==null)for(A.shared.hiddenCallbacks=null,A=0;A<G.length;A++)Rm(G[A],B)}catch(ne){pt(g,g.return,ne)}}c&&x&64&&U0(E),ko(E,E.return);break;case 27:H0(E);case 26:case 5:vs(A,E,c),c&&g===null&&x&4&&N0(E),ko(E,E.return);break;case 12:vs(A,E,c);break;case 31:vs(A,E,c),c&&x&4&&z0(A,E);break;case 13:vs(A,E,c),c&&x&4&&j0(A,E);break;case 22:E.memoizedState===null&&vs(A,E,c),ko(E,E.return);break;case 30:break;default:vs(A,E,c)}a=a.sibling}}function th(s,a){var c=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),s=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(s=a.memoizedState.cachePool.pool),s!==c&&(s!=null&&s.refCount++,c!=null&&To(c))}function ih(s,a){s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&To(s))}function Tn(s,a,c,g){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Q0(s,a,c,g),a=a.sibling}function Q0(s,a,c,g){var A=a.flags;switch(a.tag){case 0:case 11:case 15:Tn(s,a,c,g),A&2048&&Fo(9,a);break;case 1:Tn(s,a,c,g);break;case 3:Tn(s,a,c,g),A&2048&&(s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&To(s)));break;case 12:if(A&2048){Tn(s,a,c,g),s=a.stateNode;try{var E=a.memoizedProps,x=E.id,B=E.onPostCommit;typeof B=="function"&&B(x,a.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(G){pt(a,a.return,G)}}else Tn(s,a,c,g);break;case 31:Tn(s,a,c,g);break;case 13:Tn(s,a,c,g);break;case 23:break;case 22:E=a.stateNode,x=a.alternate,a.memoizedState!==null?E._visibility&2?Tn(s,a,c,g):wo(s,a):E._visibility&2?Tn(s,a,c,g):(E._visibility|=2,Ra(s,a,c,g,(a.subtreeFlags&10256)!==0||!1)),A&2048&&th(x,a);break;case 24:Tn(s,a,c,g),A&2048&&ih(a.alternate,a);break;default:Tn(s,a,c,g)}}function Ra(s,a,c,g,A){for(A=A&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var E=s,x=a,B=c,G=g,ne=x.flags;switch(x.tag){case 0:case 11:case 15:Ra(E,x,B,G,A),Fo(8,x);break;case 23:break;case 22:var ue=x.stateNode;x.memoizedState!==null?ue._visibility&2?Ra(E,x,B,G,A):wo(E,x):(ue._visibility|=2,Ra(E,x,B,G,A)),A&&ne&2048&&th(x.alternate,x);break;case 24:Ra(E,x,B,G,A),A&&ne&2048&&ih(x.alternate,x);break;default:Ra(E,x,B,G,A)}a=a.sibling}}function wo(s,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var c=s,g=a,A=g.flags;switch(g.tag){case 22:wo(c,g),A&2048&&th(g.alternate,g);break;case 24:wo(c,g),A&2048&&ih(g.alternate,g);break;default:wo(c,g)}a=a.sibling}}var Uo=8192;function La(s,a,c){if(s.subtreeFlags&Uo)for(s=s.child;s!==null;)q0(s,a,c),s=s.sibling}function q0(s,a,c){switch(s.tag){case 26:La(s,a,c),s.flags&Uo&&s.memoizedState!==null&&G1(c,En,s.memoizedState,s.memoizedProps);break;case 5:La(s,a,c);break;case 3:case 4:var g=En;En=Cu(s.stateNode.containerInfo),La(s,a,c),En=g;break;case 22:s.memoizedState===null&&(g=s.alternate,g!==null&&g.memoizedState!==null?(g=Uo,Uo=16777216,La(s,a,c),Uo=g):La(s,a,c));break;default:La(s,a,c)}}function W0(s){var a=s.alternate;if(a!==null&&(s=a.child,s!==null)){a.child=null;do a=s.sibling,s.sibling=null,s=a;while(s!==null)}}function Po(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var g=a[c];li=g,ep(g,s)}W0(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Z0(s),s=s.sibling}function Z0(s){switch(s.tag){case 0:case 11:case 15:Po(s),s.flags&2048&&zs(9,s,s.return);break;case 3:Po(s);break;case 12:Po(s);break;case 22:var a=s.stateNode;s.memoizedState!==null&&a._visibility&2&&(s.return===null||s.return.tag!==13)?(a._visibility&=-3,hu(s)):Po(s);break;default:Po(s)}}function hu(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var g=a[c];li=g,ep(g,s)}W0(s)}for(s=s.child;s!==null;){switch(a=s,a.tag){case 0:case 11:case 15:zs(8,a,a.return),hu(a);break;case 22:c=a.stateNode,c._visibility&2&&(c._visibility&=-3,hu(a));break;default:hu(a)}s=s.sibling}}function ep(s,a){for(;li!==null;){var c=li;switch(c.tag){case 0:case 11:case 15:zs(8,c,a);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var g=c.memoizedState.cachePool.pool;g!=null&&g.refCount++}break;case 24:To(c.memoizedState.cache)}if(g=c.child,g!==null)g.return=c,li=g;else e:for(c=s;li!==null;){g=li;var A=g.sibling,E=g.return;if($0(g),g===c){li=null;break e}if(A!==null){A.return=E,li=A;break e}li=E}}}var t1={getCacheForType:function(s){var a=di(Xt),c=a.data.get(s);return c===void 0&&(c=s(),a.data.set(s,c)),c},cacheSignal:function(){return di(Xt).controller.signal}},i1=typeof WeakMap=="function"?WeakMap:Map,gt=0,Ct=null,it=null,ot=0,mt=0,$i=null,js=!1,Da=!1,nh=!1,ys=0,$t=0,Js=0,wr=0,sh=0,Yi=0,_a=0,No=null,Ii=null,rh=!1,du=0,tp=0,gu=1/0,mu=null,Xs=null,ti=0,Qs=null,Ia=null,Es=0,ah=0,oh=null,ip=null,Go=0,lh=null;function zi(){return(gt&2)!==0&&ot!==0?ot&-ot:k.T!==null?gh():Rn()}function np(){if(Yi===0)if((ot&536870912)===0||ut){var s=ft;ft<<=1,(ft&3932160)===0&&(ft=262144),Yi=s}else Yi=536870912;return s=Ki.current,s!==null&&(s.flags|=32),Yi}function Bi(s,a,c){(s===Ct&&(mt===2||mt===9)||s.cancelPendingCommit!==null)&&(Ba(s,0),qs(s,ot,Yi,!1)),zt(s,c),((gt&2)===0||s!==Ct)&&(s===Ct&&((gt&2)===0&&(wr|=c),$t===4&&qs(s,ot,Yi,!1)),Pn(s))}function sp(s,a,c){if((gt&6)!==0)throw Error(i(327));var g=!c&&(a&127)===0&&(a&s.expiredLanes)===0||_t(s,a),A=g?r1(s,a):ch(s,a,!0),E=g;do{if(A===0){Da&&!g&&qs(s,a,0,!1);break}else{if(c=s.current.alternate,E&&!n1(c)){A=ch(s,a,!1),E=!1;continue}if(A===2){if(E=a,s.errorRecoveryDisabledLanes&E)var x=0;else x=s.pendingLanes&-536870913,x=x!==0?x:x&536870912?536870912:0;if(x!==0){a=x;e:{var B=s;A=No;var G=B.current.memoizedState.isDehydrated;if(G&&(Ba(B,x).flags|=256),x=ch(B,x,!1),x!==2){if(nh&&!G){B.errorRecoveryDisabledLanes|=E,wr|=E,A=4;break e}E=Ii,Ii=A,E!==null&&(Ii===null?Ii=E:Ii.push.apply(Ii,E))}A=x}if(E=!1,A!==2)continue}}if(A===1){Ba(s,0),qs(s,a,0,!0);break}e:{switch(g=s,E=A,E){case 0:case 1:throw Error(i(345));case 4:if((a&4194048)!==a)break;case 6:qs(g,a,Yi,!js);break e;case 2:Ii=null;break;case 3:case 5:break;default:throw Error(i(329))}if((a&62914560)===a&&(A=du+300-Se(),10<A)){if(qs(g,a,Yi,!js),We(g,0,!0)!==0)break e;Es=a,g.timeoutHandle=kp(rp.bind(null,g,c,Ii,mu,rh,a,Yi,wr,_a,js,E,"Throttled",-0,0),A);break e}rp(g,c,Ii,mu,rh,a,Yi,wr,_a,js,E,null,-0,0)}}break}while(!0);Pn(s)}function rp(s,a,c,g,A,E,x,B,G,ne,ue,ge,se,ae){if(s.timeoutHandle=-1,ge=a.subtreeFlags,ge&8192||(ge&16785408)===16785408){ge={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:vi},q0(a,E,ge);var Me=(E&62914560)===E?du-Se():(E&4194048)===E?tp-Se():0;if(Me=H1(ge,Me),Me!==null){Es=E,s.cancelPendingCommit=Me(dp.bind(null,s,a,E,c,g,A,x,B,G,ue,ge,null,se,ae)),qs(s,E,x,!ne);return}}dp(s,a,E,c,g,A,x,B,G)}function n1(s){for(var a=s;;){var c=a.tag;if((c===0||c===11||c===15)&&a.flags&16384&&(c=a.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var g=0;g<c.length;g++){var A=c[g],E=A.getSnapshot;A=A.value;try{if(!Gi(E(),A))return!1}catch{return!1}}if(c=a.child,a.subtreeFlags&16384&&c!==null)c.return=a,a=c;else{if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function qs(s,a,c,g){a&=~sh,a&=~wr,s.suspendedLanes|=a,s.pingedLanes&=~a,g&&(s.warmLanes|=a),g=s.expirationTimes;for(var A=a;0<A;){var E=31-rt(A),x=1<<E;g[E]=-1,A&=~x}c!==0&&Kt(s,c,a)}function pu(){return(gt&6)===0?(Ho(0),!1):!0}function uh(){if(it!==null){if(mt===0)var s=it.return;else s=it,us=Lr=null,Cf(s),Ta=null,bo=0,s=it;for(;s!==null;)w0(s.alternate,s),s=s.return;it=null}}function Ba(s,a){var c=s.timeoutHandle;c!==-1&&(s.timeoutHandle=-1,b1(c)),c=s.cancelPendingCommit,c!==null&&(s.cancelPendingCommit=null,c()),Es=0,uh(),Ct=s,it=c=os(s.current,null),ot=a,mt=0,$i=null,js=!1,Da=_t(s,a),nh=!1,_a=Yi=sh=wr=Js=$t=0,Ii=No=null,rh=!1,(a&8)!==0&&(a|=a&32);var g=s.entangledLanes;if(g!==0)for(s=s.entanglements,g&=a;0<g;){var A=31-rt(g),E=1<<A;a|=s[A],g&=~E}return ys=a,Ul(),c}function ap(s,a){Qe=null,k.H=Bo,a===Ea||a===Yl?(a=Sm(),mt=3):a===df?(a=Sm(),mt=4):mt=a===Hf?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,$i=a,it===null&&($t=1,ru(s,sn(a,s.current)))}function op(){var s=Ki.current;return s===null?!0:(ot&4194048)===ot?ln===null:(ot&62914560)===ot||(ot&536870912)!==0?s===ln:!1}function lp(){var s=k.H;return k.H=Bo,s===null?Bo:s}function up(){var s=k.A;return k.A=t1,s}function Au(){$t=4,js||(ot&4194048)!==ot&&Ki.current!==null||(Da=!0),(Js&134217727)===0&&(wr&134217727)===0||Ct===null||qs(Ct,ot,Yi,!1)}function ch(s,a,c){var g=gt;gt|=2;var A=lp(),E=up();(Ct!==s||ot!==a)&&(mu=null,Ba(s,a)),a=!1;var x=$t;e:do try{if(mt!==0&&it!==null){var B=it,G=$i;switch(mt){case 8:uh(),x=6;break e;case 3:case 2:case 9:case 6:Ki.current===null&&(a=!0);var ne=mt;if(mt=0,$i=null,Ma(s,B,G,ne),c&&Da){x=0;break e}break;default:ne=mt,mt=0,$i=null,Ma(s,B,G,ne)}}s1(),x=$t;break}catch(ue){ap(s,ue)}while(!0);return a&&s.shellSuspendCounter++,us=Lr=null,gt=g,k.H=A,k.A=E,it===null&&(Ct=null,ot=0,Ul()),x}function s1(){for(;it!==null;)cp(it)}function r1(s,a){var c=gt;gt|=2;var g=lp(),A=up();Ct!==s||ot!==a?(mu=null,gu=Se()+500,Ba(s,a)):Da=_t(s,a);e:do try{if(mt!==0&&it!==null){a=it;var E=$i;t:switch(mt){case 1:mt=0,$i=null,Ma(s,a,E,1);break;case 2:case 9:if(Em(E)){mt=0,$i=null,fp(a);break}a=function(){mt!==2&&mt!==9||Ct!==s||(mt=7),Pn(s)},E.then(a,a);break e;case 3:mt=7;break e;case 4:mt=5;break e;case 7:Em(E)?(mt=0,$i=null,fp(a)):(mt=0,$i=null,Ma(s,a,E,7));break;case 5:var x=null;switch(it.tag){case 26:x=it.memoizedState;case 5:case 27:var B=it;if(x?Qp(x):B.stateNode.complete){mt=0,$i=null;var G=B.sibling;if(G!==null)it=G;else{var ne=B.return;ne!==null?(it=ne,vu(ne)):it=null}break t}}mt=0,$i=null,Ma(s,a,E,5);break;case 6:mt=0,$i=null,Ma(s,a,E,6);break;case 8:uh(),$t=6;break e;default:throw Error(i(462))}}a1();break}catch(ue){ap(s,ue)}while(!0);return us=Lr=null,k.H=g,k.A=A,gt=c,it!==null?0:(Ct=null,ot=0,Ul(),$t)}function a1(){for(;it!==null&&!He();)cp(it)}function cp(s){var a=F0(s.alternate,s,ys);s.memoizedProps=s.pendingProps,a===null?vu(s):it=a}function fp(s){var a=s,c=a.alternate;switch(a.tag){case 15:case 0:a=D0(c,a,a.pendingProps,a.type,void 0,ot);break;case 11:a=D0(c,a,a.pendingProps,a.type.render,a.ref,ot);break;case 5:Cf(a);default:w0(c,a),a=it=um(a,ys),a=F0(c,a,ys)}s.memoizedProps=s.pendingProps,a===null?vu(s):it=a}function Ma(s,a,c,g){us=Lr=null,Cf(a),Ta=null,bo=0;var A=a.return;try{if(JS(s,A,a,c,ot)){$t=1,ru(s,sn(c,s.current)),it=null;return}}catch(E){if(A!==null)throw it=A,E;$t=1,ru(s,sn(c,s.current)),it=null;return}a.flags&32768?(ut||g===1?s=!0:Da||(ot&536870912)!==0?s=!1:(js=s=!0,(g===2||g===9||g===3||g===6)&&(g=Ki.current,g!==null&&g.tag===13&&(g.flags|=16384))),hp(a,s)):vu(a)}function vu(s){var a=s;do{if((a.flags&32768)!==0){hp(a,js);return}s=a.return;var c=qS(a.alternate,a,ys);if(c!==null){it=c;return}if(a=a.sibling,a!==null){it=a;return}it=a=s}while(a!==null);$t===0&&($t=5)}function hp(s,a){do{var c=WS(s.alternate,s);if(c!==null){c.flags&=32767,it=c;return}if(c=s.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!a&&(s=s.sibling,s!==null)){it=s;return}it=s=c}while(s!==null);$t=6,it=null}function dp(s,a,c,g,A,E,x,B,G){s.cancelPendingCommit=null;do yu();while(ti!==0);if((gt&6)!==0)throw Error(i(327));if(a!==null){if(a===s.current)throw Error(i(177));if(E=a.lanes|a.childLanes,E|=qc,ai(s,c,E,x,B,G),s===Ct&&(it=Ct=null,ot=0),Ia=a,Qs=s,Es=c,ah=E,oh=A,ip=g,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,c1(Oe,function(){return vp(),null})):(s.callbackNode=null,s.callbackPriority=0),g=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||g){g=k.T,k.T=null,A=K.p,K.p=2,x=gt,gt|=4;try{ZS(s,a,c)}finally{gt=x,K.p=A,k.T=g}}ti=1,gp(),mp(),pp()}}function gp(){if(ti===1){ti=0;var s=Qs,a=Ia,c=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||c){c=k.T,k.T=null;var g=K.p;K.p=2;var A=gt;gt|=4;try{J0(a,s);var E=Sh,x=em(s.containerInfo),B=E.focusedElem,G=E.selectionRange;if(x!==B&&B&&B.ownerDocument&&Zg(B.ownerDocument.documentElement,B)){if(G!==null&&zc(B)){var ne=G.start,ue=G.end;if(ue===void 0&&(ue=ne),"selectionStart"in B)B.selectionStart=ne,B.selectionEnd=Math.min(ue,B.value.length);else{var ge=B.ownerDocument||document,se=ge&&ge.defaultView||window;if(se.getSelection){var ae=se.getSelection(),Me=B.textContent.length,$e=Math.min(G.start,Me),bt=G.end===void 0?$e:Math.min(G.end,Me);!ae.extend&&$e>bt&&(x=bt,bt=$e,$e=x);var W=Wg(B,$e),$=Wg(B,bt);if(W&&$&&(ae.rangeCount!==1||ae.anchorNode!==W.node||ae.anchorOffset!==W.offset||ae.focusNode!==$.node||ae.focusOffset!==$.offset)){var ie=ge.createRange();ie.setStart(W.node,W.offset),ae.removeAllRanges(),$e>bt?(ae.addRange(ie),ae.extend($.node,$.offset)):(ie.setEnd($.node,$.offset),ae.addRange(ie))}}}}for(ge=[],ae=B;ae=ae.parentNode;)ae.nodeType===1&&ge.push({element:ae,left:ae.scrollLeft,top:ae.scrollTop});for(typeof B.focus=="function"&&B.focus(),B=0;B<ge.length;B++){var he=ge[B];he.element.scrollLeft=he.left,he.element.scrollTop=he.top}}Bu=!!Th,Sh=Th=null}finally{gt=A,K.p=g,k.T=c}}s.current=a,ti=2}}function mp(){if(ti===2){ti=0;var s=Qs,a=Ia,c=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||c){c=k.T,k.T=null;var g=K.p;K.p=2;var A=gt;gt|=4;try{V0(s,a.alternate,a)}finally{gt=A,K.p=g,k.T=c}}ti=3}}function pp(){if(ti===4||ti===3){ti=0,Le();var s=Qs,a=Ia,c=Es,g=ip;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?ti=5:(ti=0,Ia=Qs=null,Ap(s,s.pendingLanes));var A=s.pendingLanes;if(A===0&&(Xs=null),qi(c),a=a.stateNode,Ke&&typeof Ke.onCommitFiberRoot=="function")try{Ke.onCommitFiberRoot(Xe,a,void 0,(a.current.flags&128)===128)}catch{}if(g!==null){a=k.T,A=K.p,K.p=2,k.T=null;try{for(var E=s.onRecoverableError,x=0;x<g.length;x++){var B=g[x];E(B.value,{componentStack:B.stack})}}finally{k.T=a,K.p=A}}(Es&3)!==0&&yu(),Pn(s),A=s.pendingLanes,(c&261930)!==0&&(A&42)!==0?s===lh?Go++:(Go=0,lh=s):Go=0,Ho(0)}}function Ap(s,a){(s.pooledCacheLanes&=a)===0&&(a=s.pooledCache,a!=null&&(s.pooledCache=null,To(a)))}function yu(){return gp(),mp(),pp(),vp()}function vp(){if(ti!==5)return!1;var s=Qs,a=ah;ah=0;var c=qi(Es),g=k.T,A=K.p;try{K.p=32>c?32:c,k.T=null,c=oh,oh=null;var E=Qs,x=Es;if(ti=0,Ia=Qs=null,Es=0,(gt&6)!==0)throw Error(i(331));var B=gt;if(gt|=4,Z0(E.current),Q0(E,E.current,x,c),gt=B,Ho(0,!1),Ke&&typeof Ke.onPostCommitFiberRoot=="function")try{Ke.onPostCommitFiberRoot(Xe,E)}catch{}return!0}finally{K.p=A,k.T=g,Ap(s,a)}}function yp(s,a,c){a=sn(c,a),a=Gf(s.stateNode,a,2),s=Vs(s,a,2),s!==null&&(zt(s,2),Pn(s))}function pt(s,a,c){if(s.tag===3)yp(s,s,c);else for(;a!==null;){if(a.tag===3){yp(a,s,c);break}else if(a.tag===1){var g=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(Xs===null||!Xs.has(g))){s=sn(c,s),c=E0(2),g=Vs(a,c,2),g!==null&&(T0(c,g,a,s),zt(g,2),Pn(g));break}}a=a.return}}function fh(s,a,c){var g=s.pingCache;if(g===null){g=s.pingCache=new i1;var A=new Set;g.set(a,A)}else A=g.get(a),A===void 0&&(A=new Set,g.set(a,A));A.has(c)||(nh=!0,A.add(c),s=o1.bind(null,s,a,c),a.then(s,s))}function o1(s,a,c){var g=s.pingCache;g!==null&&g.delete(a),s.pingedLanes|=s.suspendedLanes&c,s.warmLanes&=~c,Ct===s&&(ot&c)===c&&($t===4||$t===3&&(ot&62914560)===ot&&300>Se()-du?(gt&2)===0&&Ba(s,0):sh|=c,_a===ot&&(_a=0)),Pn(s)}function Ep(s,a){a===0&&(a=Je()),s=xr(s,a),s!==null&&(zt(s,a),Pn(s))}function l1(s){var a=s.memoizedState,c=0;a!==null&&(c=a.retryLane),Ep(s,c)}function u1(s,a){var c=0;switch(s.tag){case 31:case 13:var g=s.stateNode,A=s.memoizedState;A!==null&&(c=A.retryLane);break;case 19:g=s.stateNode;break;case 22:g=s.stateNode._retryCache;break;default:throw Error(i(314))}g!==null&&g.delete(a),Ep(s,c)}function c1(s,a){return Te(s,a)}var Eu=null,Oa=null,hh=!1,Tu=!1,dh=!1,Ws=0;function Pn(s){s!==Oa&&s.next===null&&(Oa===null?Eu=Oa=s:Oa=Oa.next=s),Tu=!0,hh||(hh=!0,h1())}function Ho(s,a){if(!dh&&Tu){dh=!0;do for(var c=!1,g=Eu;g!==null;){if(s!==0){var A=g.pendingLanes;if(A===0)var E=0;else{var x=g.suspendedLanes,B=g.pingedLanes;E=(1<<31-rt(42|s)+1)-1,E&=A&~(x&~B),E=E&201326741?E&201326741|1:E?E|2:0}E!==0&&(c=!0,xp(g,E))}else E=ot,E=We(g,g===Ct?E:0,g.cancelPendingCommit!==null||g.timeoutHandle!==-1),(E&3)===0||_t(g,E)||(c=!0,xp(g,E));g=g.next}while(c);dh=!1}}function f1(){Tp()}function Tp(){Tu=hh=!1;var s=0;Ws!==0&&S1()&&(s=Ws);for(var a=Se(),c=null,g=Eu;g!==null;){var A=g.next,E=Sp(g,a);E===0?(g.next=null,c===null?Eu=A:c.next=A,A===null&&(Oa=c)):(c=g,(s!==0||(E&3)!==0)&&(Tu=!0)),g=A}ti!==0&&ti!==5||Ho(s),Ws!==0&&(Ws=0)}function Sp(s,a){for(var c=s.suspendedLanes,g=s.pingedLanes,A=s.expirationTimes,E=s.pendingLanes&-62914561;0<E;){var x=31-rt(E),B=1<<x,G=A[x];G===-1?((B&c)===0||(B&g)!==0)&&(A[x]=It(B,a)):G<=a&&(s.expiredLanes|=B),E&=~B}if(a=Ct,c=ot,c=We(s,s===a?c:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),g=s.callbackNode,c===0||s===a&&(mt===2||mt===9)||s.cancelPendingCommit!==null)return g!==null&&g!==null&&de(g),s.callbackNode=null,s.callbackPriority=0;if((c&3)===0||_t(s,c)){if(a=c&-c,a===s.callbackPriority)return a;switch(g!==null&&de(g),qi(c)){case 2:case 8:c=De;break;case 32:c=Oe;break;case 268435456:c=Ye;break;default:c=Oe}return g=bp.bind(null,s),c=Te(c,g),s.callbackPriority=a,s.callbackNode=c,a}return g!==null&&g!==null&&de(g),s.callbackPriority=2,s.callbackNode=null,2}function bp(s,a){if(ti!==0&&ti!==5)return s.callbackNode=null,s.callbackPriority=0,null;var c=s.callbackNode;if(yu()&&s.callbackNode!==c)return null;var g=ot;return g=We(s,s===Ct?g:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),g===0?null:(sp(s,g,a),Sp(s,Se()),s.callbackNode!=null&&s.callbackNode===c?bp.bind(null,s):null)}function xp(s,a){if(yu())return null;sp(s,a,!0)}function h1(){x1(function(){(gt&6)!==0?Te(qe,f1):Tp()})}function gh(){if(Ws===0){var s=va;s===0&&(s=Ve,Ve<<=1,(Ve&261888)===0&&(Ve=256)),Ws=s}return Ws}function Cp(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:An(""+s)}function Rp(s,a){var c=a.ownerDocument.createElement("input");return c.name=a.name,c.value=a.value,s.id&&c.setAttribute("form",s.id),a.parentNode.insertBefore(c,a),s=new FormData(s),c.parentNode.removeChild(c),s}function d1(s,a,c,g,A){if(a==="submit"&&c&&c.stateNode===A){var E=Cp((A[fi]||null).action),x=g.submitter;x&&(a=(a=x[fi]||null)?Cp(a.formAction):x.getAttribute("formAction"),a!==null&&(E=a,x=null));var B=new ws("action","action",null,g,A);s.push({event:B,listeners:[{instance:null,listener:function(){if(g.defaultPrevented){if(Ws!==0){var G=x?Rp(A,x):new FormData(A);Ff(c,{pending:!0,data:G,method:A.method,action:E},null,G)}}else typeof E=="function"&&(B.preventDefault(),G=x?Rp(A,x):new FormData(A),Ff(c,{pending:!0,data:G,method:A.method,action:E},E,G))},currentTarget:A}]})}}for(var mh=0;mh<Qc.length;mh++){var ph=Qc[mh],g1=ph.toLowerCase(),m1=ph[0].toUpperCase()+ph.slice(1);yn(g1,"on"+m1)}yn(nm,"onAnimationEnd"),yn(sm,"onAnimationIteration"),yn(rm,"onAnimationStart"),yn("dblclick","onDoubleClick"),yn("focusin","onFocus"),yn("focusout","onBlur"),yn(BS,"onTransitionRun"),yn(MS,"onTransitionStart"),yn(OS,"onTransitionCancel"),yn(am,"onTransitionEnd"),Qn("onMouseEnter",["mouseout","mouseover"]),Qn("onMouseLeave",["mouseout","mouseover"]),Qn("onPointerEnter",["pointerout","pointerover"]),Qn("onPointerLeave",["pointerout","pointerover"]),Zi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Zi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Zi("onBeforeInput",["compositionend","keypress","textInput","paste"]),Zi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Zi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Zi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ko="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),p1=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ko));function Lp(s,a){a=(a&4)!==0;for(var c=0;c<s.length;c++){var g=s[c],A=g.event;g=g.listeners;e:{var E=void 0;if(a)for(var x=g.length-1;0<=x;x--){var B=g[x],G=B.instance,ne=B.currentTarget;if(B=B.listener,G!==E&&A.isPropagationStopped())break e;E=B,A.currentTarget=ne;try{E(A)}catch(ue){wl(ue)}A.currentTarget=null,E=G}else for(x=0;x<g.length;x++){if(B=g[x],G=B.instance,ne=B.currentTarget,B=B.listener,G!==E&&A.isPropagationStopped())break e;E=B,A.currentTarget=ne;try{E(A)}catch(ue){wl(ue)}A.currentTarget=null,E=G}}}}function nt(s,a){var c=a[ro];c===void 0&&(c=a[ro]=new Set);var g=s+"__bubble";c.has(g)||(Dp(a,s,2,!1),c.add(g))}function Ah(s,a,c){var g=0;a&&(g|=4),Dp(c,s,g,a)}var Su="_reactListening"+Math.random().toString(36).slice(2);function vh(s){if(!s[Su]){s[Su]=!0,Dl.forEach(function(c){c!=="selectionchange"&&(p1.has(c)||Ah(c,!1,s),Ah(c,!0,s))});var a=s.nodeType===9?s:s.ownerDocument;a===null||a[Su]||(a[Su]=!0,Ah("selectionchange",!1,a))}}function Dp(s,a,c,g){switch(nA(a)){case 2:var A=$1;break;case 8:A=Y1;break;default:A=Oh}c=A.bind(null,a,c,s),A=void 0,!Si||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(A=!0),g?A!==void 0?s.addEventListener(a,c,{capture:!0,passive:A}):s.addEventListener(a,c,!0):A!==void 0?s.addEventListener(a,c,{passive:A}):s.addEventListener(a,c,!1)}function yh(s,a,c,g,A){var E=g;if((a&1)===0&&(a&2)===0&&g!==null)e:for(;;){if(g===null)return;var x=g.tag;if(x===3||x===4){var B=g.stateNode.containerInfo;if(B===A)break;if(x===4)for(x=g.return;x!==null;){var G=x.tag;if((G===3||G===4)&&x.stateNode.containerInfo===A)return;x=x.return}for(;B!==null;){if(x=pn(B),x===null)return;if(G=x.tag,G===5||G===6||G===26||G===27){g=E=x;continue e}B=B.parentNode}}g=g.return}yr(function(){var ne=E,ue=ia(c),ge=[];e:{var se=om.get(s);if(se!==void 0){var ae=ws,Me=s;switch(s){case"keypress":if(Er(c)===0)break e;case"keydown":case"keyup":ae=uS;break;case"focusin":Me="focus",ae=ho;break;case"focusout":Me="blur",ae=ho;break;case"beforeblur":case"afterblur":ae=ho;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ae=Ml;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ae=la;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ae=hS;break;case nm:case sm:case rm:ae=Ni;break;case am:ae=gS;break;case"scroll":case"scrollend":ae=Tr;break;case"wheel":ae=pS;break;case"copy":case"cut":case"paste":ae=Fn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ae=Pg;break;case"toggle":case"beforetoggle":ae=vS}var $e=(a&4)!==0,bt=!$e&&(s==="scroll"||s==="scrollend"),W=$e?se!==null?se+"Capture":null:se;$e=[];for(var $=ne,ie;$!==null;){var he=$;if(ie=he.stateNode,he=he.tag,he!==5&&he!==26&&he!==27||ie===null||W===null||(he=is($,W),he!=null&&$e.push(Vo($,he,ie))),bt)break;$=$.return}0<$e.length&&(se=new ae(se,Me,null,c,ue),ge.push({event:se,listeners:$e}))}}if((a&7)===0){e:{if(se=s==="mouseover"||s==="pointerover",ae=s==="mouseout"||s==="pointerout",se&&c!==ts&&(Me=c.relatedTarget||c.fromElement)&&(pn(Me)||Me[Ln]))break e;if((ae||se)&&(se=ue.window===ue?ue:(se=ue.ownerDocument)?se.defaultView||se.parentWindow:window,ae?(Me=c.relatedTarget||c.toElement,ae=ne,Me=Me?pn(Me):null,Me!==null&&(bt=r(Me),$e=Me.tag,Me!==bt||$e!==5&&$e!==27&&$e!==6)&&(Me=null)):(ae=null,Me=ne),ae!==Me)){if($e=Ml,he="onMouseLeave",W="onMouseEnter",$="mouse",(s==="pointerout"||s==="pointerover")&&($e=Pg,he="onPointerLeave",W="onPointerEnter",$="pointer"),bt=ae==null?se:Jn(ae),ie=Me==null?se:Jn(Me),se=new $e(he,$+"leave",ae,c,ue),se.target=bt,se.relatedTarget=ie,he=null,pn(ue)===ne&&($e=new $e(W,$+"enter",Me,c,ue),$e.target=ie,$e.relatedTarget=bt,he=$e),bt=he,ae&&Me)t:{for($e=A1,W=ae,$=Me,ie=0,he=W;he;he=$e(he))ie++;he=0;for(var Ge=$;Ge;Ge=$e(Ge))he++;for(;0<ie-he;)W=$e(W),ie--;for(;0<he-ie;)$=$e($),he--;for(;ie--;){if(W===$||$!==null&&W===$.alternate){$e=W;break t}W=$e(W),$=$e($)}$e=null}else $e=null;ae!==null&&_p(ge,se,ae,$e,!1),Me!==null&&bt!==null&&_p(ge,bt,Me,$e,!0)}}e:{if(se=ne?Jn(ne):window,ae=se.nodeName&&se.nodeName.toLowerCase(),ae==="select"||ae==="input"&&se.type==="file")var ht=zg;else if($g(se))if(jg)ht=DS;else{ht=RS;var Ue=CS}else ae=se.nodeName,!ae||ae.toLowerCase()!=="input"||se.type!=="checkbox"&&se.type!=="radio"?ne&&es(ne.elementType)&&(ht=zg):ht=LS;if(ht&&(ht=ht(s,ne))){Yg(ge,ht,c,ue);break e}Ue&&Ue(s,se,ne),s==="focusout"&&ne&&se.type==="number"&&ne.memoizedProps.value!=null&&Wn(se,"number",se.value)}switch(Ue=ne?Jn(ne):window,s){case"focusin":($g(Ue)||Ue.contentEditable==="true")&&(ca=Ue,jc=ne,vo=null);break;case"focusout":vo=jc=ca=null;break;case"mousedown":Jc=!0;break;case"contextmenu":case"mouseup":case"dragend":Jc=!1,tm(ge,c,ue);break;case"selectionchange":if(IS)break;case"keydown":case"keyup":tm(ge,c,ue)}var Ze;if(Vc)e:{switch(s){case"compositionstart":var lt="onCompositionStart";break e;case"compositionend":lt="onCompositionEnd";break e;case"compositionupdate":lt="onCompositionUpdate";break e}lt=void 0}else ua?Kg(s,c)&&(lt="onCompositionEnd"):s==="keydown"&&c.keyCode===229&&(lt="onCompositionStart");lt&&(Ng&&c.locale!=="ko"&&(ua||lt!=="onCompositionStart"?lt==="onCompositionEnd"&&ua&&(Ze=fo()):(vn=ue,ra="value"in vn?vn.value:vn.textContent,ua=!0)),Ue=bu(ne,lt),0<Ue.length&&(lt=new Ug(lt,s,null,c,ue),ge.push({event:lt,listeners:Ue}),Ze?lt.data=Ze:(Ze=Vg(c),Ze!==null&&(lt.data=Ze)))),(Ze=ES?TS(s,c):SS(s,c))&&(lt=bu(ne,"onBeforeInput"),0<lt.length&&(Ue=new Ug("onBeforeInput","beforeinput",null,c,ue),ge.push({event:Ue,listeners:lt}),Ue.data=Ze)),d1(ge,s,ne,c,ue)}Lp(ge,a)})}function Vo(s,a,c){return{instance:s,listener:a,currentTarget:c}}function bu(s,a){for(var c=a+"Capture",g=[];s!==null;){var A=s,E=A.stateNode;if(A=A.tag,A!==5&&A!==26&&A!==27||E===null||(A=is(s,c),A!=null&&g.unshift(Vo(s,A,E)),A=is(s,a),A!=null&&g.push(Vo(s,A,E))),s.tag===3)return g;s=s.return}return[]}function A1(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function _p(s,a,c,g,A){for(var E=a._reactName,x=[];c!==null&&c!==g;){var B=c,G=B.alternate,ne=B.stateNode;if(B=B.tag,G!==null&&G===g)break;B!==5&&B!==26&&B!==27||ne===null||(G=ne,A?(ne=is(c,E),ne!=null&&x.unshift(Vo(c,ne,G))):A||(ne=is(c,E),ne!=null&&x.push(Vo(c,ne,G)))),c=c.return}x.length!==0&&s.push({event:a,listeners:x})}var v1=/\r\n?/g,y1=/\u0000|\uFFFD/g;function Ip(s){return(typeof s=="string"?s:""+s).replace(v1,`
`).replace(y1,"")}function Bp(s,a){return a=Ip(a),Ip(s)===a}function St(s,a,c,g,A,E){switch(c){case"children":typeof g=="string"?a==="body"||a==="textarea"&&g===""||In(s,g):(typeof g=="number"||typeof g=="bigint")&&a!=="body"&&In(s,""+g);break;case"className":mr(s,"class",g);break;case"tabIndex":mr(s,"tabindex",g);break;case"dir":case"role":case"viewBox":case"width":case"height":mr(s,c,g);break;case"style":ea(s,g,E);break;case"data":if(a!=="object"){mr(s,"data",g);break}case"src":case"href":if(g===""&&(a!=="a"||c!=="href")){s.removeAttribute(c);break}if(g==null||typeof g=="function"||typeof g=="symbol"||typeof g=="boolean"){s.removeAttribute(c);break}g=An(""+g),s.setAttribute(c,g);break;case"action":case"formAction":if(typeof g=="function"){s.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof E=="function"&&(c==="formAction"?(a!=="input"&&St(s,a,"name",A.name,A,null),St(s,a,"formEncType",A.formEncType,A,null),St(s,a,"formMethod",A.formMethod,A,null),St(s,a,"formTarget",A.formTarget,A,null)):(St(s,a,"encType",A.encType,A,null),St(s,a,"method",A.method,A,null),St(s,a,"target",A.target,A,null)));if(g==null||typeof g=="symbol"||typeof g=="boolean"){s.removeAttribute(c);break}g=An(""+g),s.setAttribute(c,g);break;case"onClick":g!=null&&(s.onclick=vi);break;case"onScroll":g!=null&&nt("scroll",s);break;case"onScrollEnd":g!=null&&nt("scrollend",s);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(i(61));if(c=g.__html,c!=null){if(A.children!=null)throw Error(i(60));s.innerHTML=c}}break;case"multiple":s.multiple=g&&typeof g!="function"&&typeof g!="symbol";break;case"muted":s.muted=g&&typeof g!="function"&&typeof g!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(g==null||typeof g=="function"||typeof g=="boolean"||typeof g=="symbol"){s.removeAttribute("xlink:href");break}c=An(""+g),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":g!=null&&typeof g!="function"&&typeof g!="symbol"?s.setAttribute(c,""+g):s.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":g&&typeof g!="function"&&typeof g!="symbol"?s.setAttribute(c,""):s.removeAttribute(c);break;case"capture":case"download":g===!0?s.setAttribute(c,""):g!==!1&&g!=null&&typeof g!="function"&&typeof g!="symbol"?s.setAttribute(c,g):s.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":g!=null&&typeof g!="function"&&typeof g!="symbol"&&!isNaN(g)&&1<=g?s.setAttribute(c,g):s.removeAttribute(c);break;case"rowSpan":case"start":g==null||typeof g=="function"||typeof g=="symbol"||isNaN(g)?s.removeAttribute(c):s.setAttribute(c,g);break;case"popover":nt("beforetoggle",s),nt("toggle",s),qn(s,"popover",g);break;case"xlinkActuate":Pi(s,"http://www.w3.org/1999/xlink","xlink:actuate",g);break;case"xlinkArcrole":Pi(s,"http://www.w3.org/1999/xlink","xlink:arcrole",g);break;case"xlinkRole":Pi(s,"http://www.w3.org/1999/xlink","xlink:role",g);break;case"xlinkShow":Pi(s,"http://www.w3.org/1999/xlink","xlink:show",g);break;case"xlinkTitle":Pi(s,"http://www.w3.org/1999/xlink","xlink:title",g);break;case"xlinkType":Pi(s,"http://www.w3.org/1999/xlink","xlink:type",g);break;case"xmlBase":Pi(s,"http://www.w3.org/XML/1998/namespace","xml:base",g);break;case"xmlLang":Pi(s,"http://www.w3.org/XML/1998/namespace","xml:lang",g);break;case"xmlSpace":Pi(s,"http://www.w3.org/XML/1998/namespace","xml:space",g);break;case"is":qn(s,"is",g);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=Bl.get(c)||c,qn(s,c,g))}}function Eh(s,a,c,g,A,E){switch(c){case"style":ea(s,g,E);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(i(61));if(c=g.__html,c!=null){if(A.children!=null)throw Error(i(60));s.innerHTML=c}}break;case"children":typeof g=="string"?In(s,g):(typeof g=="number"||typeof g=="bigint")&&In(s,""+g);break;case"onScroll":g!=null&&nt("scroll",s);break;case"onScrollEnd":g!=null&&nt("scrollend",s);break;case"onClick":g!=null&&(s.onclick=vi);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Xn.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(A=c.endsWith("Capture"),a=c.slice(2,A?c.length-7:void 0),E=s[fi]||null,E=E!=null?E[c]:null,typeof E=="function"&&s.removeEventListener(a,E,A),typeof g=="function")){typeof E!="function"&&E!==null&&(c in s?s[c]=null:s.hasAttribute(c)&&s.removeAttribute(c)),s.addEventListener(a,g,A);break e}c in s?s[c]=g:g===!0?s.setAttribute(c,""):qn(s,c,g)}}}function mi(s,a,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":nt("error",s),nt("load",s);var g=!1,A=!1,E;for(E in c)if(c.hasOwnProperty(E)){var x=c[E];if(x!=null)switch(E){case"src":g=!0;break;case"srcSet":A=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:St(s,a,E,x,c,null)}}A&&St(s,a,"srcSet",c.srcSet,c,null),g&&St(s,a,"src",c.src,c,null);return;case"input":nt("invalid",s);var B=E=x=A=null,G=null,ne=null;for(g in c)if(c.hasOwnProperty(g)){var ue=c[g];if(ue!=null)switch(g){case"name":A=ue;break;case"type":x=ue;break;case"checked":G=ue;break;case"defaultChecked":ne=ue;break;case"value":E=ue;break;case"defaultValue":B=ue;break;case"children":case"dangerouslySetInnerHTML":if(ue!=null)throw Error(i(137,a));break;default:St(s,a,g,ue,c,null)}}pr(s,E,B,G,ne,x,A,!1);return;case"select":nt("invalid",s),g=x=E=null;for(A in c)if(c.hasOwnProperty(A)&&(B=c[A],B!=null))switch(A){case"value":E=B;break;case"defaultValue":x=B;break;case"multiple":g=B;default:St(s,a,A,B,c,null)}a=E,c=x,s.multiple=!!g,a!=null?Zn(s,!!g,a,!1):c!=null&&Zn(s,!!g,c,!0);return;case"textarea":nt("invalid",s),E=A=g=null;for(x in c)if(c.hasOwnProperty(x)&&(B=c[x],B!=null))switch(x){case"value":g=B;break;case"defaultValue":A=B;break;case"children":E=B;break;case"dangerouslySetInnerHTML":if(B!=null)throw Error(i(91));break;default:St(s,a,x,B,c,null)}vr(s,g,A,E);return;case"option":for(G in c)if(c.hasOwnProperty(G)&&(g=c[G],g!=null))switch(G){case"selected":s.selected=g&&typeof g!="function"&&typeof g!="symbol";break;default:St(s,a,G,g,c,null)}return;case"dialog":nt("beforetoggle",s),nt("toggle",s),nt("cancel",s),nt("close",s);break;case"iframe":case"object":nt("load",s);break;case"video":case"audio":for(g=0;g<Ko.length;g++)nt(Ko[g],s);break;case"image":nt("error",s),nt("load",s);break;case"details":nt("toggle",s);break;case"embed":case"source":case"link":nt("error",s),nt("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ne in c)if(c.hasOwnProperty(ne)&&(g=c[ne],g!=null))switch(ne){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:St(s,a,ne,g,c,null)}return;default:if(es(a)){for(ue in c)c.hasOwnProperty(ue)&&(g=c[ue],g!==void 0&&Eh(s,a,ue,g,c,void 0));return}}for(B in c)c.hasOwnProperty(B)&&(g=c[B],g!=null&&St(s,a,B,g,c,null))}function E1(s,a,c,g){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var A=null,E=null,x=null,B=null,G=null,ne=null,ue=null;for(ae in c){var ge=c[ae];if(c.hasOwnProperty(ae)&&ge!=null)switch(ae){case"checked":break;case"value":break;case"defaultValue":G=ge;default:g.hasOwnProperty(ae)||St(s,a,ae,null,g,ge)}}for(var se in g){var ae=g[se];if(ge=c[se],g.hasOwnProperty(se)&&(ae!=null||ge!=null))switch(se){case"type":E=ae;break;case"name":A=ae;break;case"checked":ne=ae;break;case"defaultChecked":ue=ae;break;case"value":x=ae;break;case"defaultValue":B=ae;break;case"children":case"dangerouslySetInnerHTML":if(ae!=null)throw Error(i(137,a));break;default:ae!==ge&&St(s,a,se,ae,g,ge)}}uo(s,x,B,G,ne,ue,E,A);return;case"select":ae=x=B=se=null;for(E in c)if(G=c[E],c.hasOwnProperty(E)&&G!=null)switch(E){case"value":break;case"multiple":ae=G;default:g.hasOwnProperty(E)||St(s,a,E,null,g,G)}for(A in g)if(E=g[A],G=c[A],g.hasOwnProperty(A)&&(E!=null||G!=null))switch(A){case"value":se=E;break;case"defaultValue":B=E;break;case"multiple":x=E;default:E!==G&&St(s,a,A,E,g,G)}a=B,c=x,g=ae,se!=null?Zn(s,!!c,se,!1):!!g!=!!c&&(a!=null?Zn(s,!!c,a,!0):Zn(s,!!c,c?[]:"",!1));return;case"textarea":ae=se=null;for(B in c)if(A=c[B],c.hasOwnProperty(B)&&A!=null&&!g.hasOwnProperty(B))switch(B){case"value":break;case"children":break;default:St(s,a,B,null,g,A)}for(x in g)if(A=g[x],E=c[x],g.hasOwnProperty(x)&&(A!=null||E!=null))switch(x){case"value":se=A;break;case"defaultValue":ae=A;break;case"children":break;case"dangerouslySetInnerHTML":if(A!=null)throw Error(i(91));break;default:A!==E&&St(s,a,x,A,g,E)}Ar(s,se,ae);return;case"option":for(var Me in c)if(se=c[Me],c.hasOwnProperty(Me)&&se!=null&&!g.hasOwnProperty(Me))switch(Me){case"selected":s.selected=!1;break;default:St(s,a,Me,null,g,se)}for(G in g)if(se=g[G],ae=c[G],g.hasOwnProperty(G)&&se!==ae&&(se!=null||ae!=null))switch(G){case"selected":s.selected=se&&typeof se!="function"&&typeof se!="symbol";break;default:St(s,a,G,se,g,ae)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var $e in c)se=c[$e],c.hasOwnProperty($e)&&se!=null&&!g.hasOwnProperty($e)&&St(s,a,$e,null,g,se);for(ne in g)if(se=g[ne],ae=c[ne],g.hasOwnProperty(ne)&&se!==ae&&(se!=null||ae!=null))switch(ne){case"children":case"dangerouslySetInnerHTML":if(se!=null)throw Error(i(137,a));break;default:St(s,a,ne,se,g,ae)}return;default:if(es(a)){for(var bt in c)se=c[bt],c.hasOwnProperty(bt)&&se!==void 0&&!g.hasOwnProperty(bt)&&Eh(s,a,bt,void 0,g,se);for(ue in g)se=g[ue],ae=c[ue],!g.hasOwnProperty(ue)||se===ae||se===void 0&&ae===void 0||Eh(s,a,ue,se,g,ae);return}}for(var W in c)se=c[W],c.hasOwnProperty(W)&&se!=null&&!g.hasOwnProperty(W)&&St(s,a,W,null,g,se);for(ge in g)se=g[ge],ae=c[ge],!g.hasOwnProperty(ge)||se===ae||se==null&&ae==null||St(s,a,ge,se,g,ae)}function Mp(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function T1(){if(typeof performance.getEntriesByType=="function"){for(var s=0,a=0,c=performance.getEntriesByType("resource"),g=0;g<c.length;g++){var A=c[g],E=A.transferSize,x=A.initiatorType,B=A.duration;if(E&&B&&Mp(x)){for(x=0,B=A.responseEnd,g+=1;g<c.length;g++){var G=c[g],ne=G.startTime;if(ne>B)break;var ue=G.transferSize,ge=G.initiatorType;ue&&Mp(ge)&&(G=G.responseEnd,x+=ue*(G<B?1:(B-ne)/(G-ne)))}if(--g,a+=8*(E+x)/(A.duration/1e3),s++,10<s)break}}if(0<s)return a/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var Th=null,Sh=null;function xu(s){return s.nodeType===9?s:s.ownerDocument}function Op(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Fp(s,a){if(s===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&a==="foreignObject"?0:s}function bh(s,a){return s==="textarea"||s==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var xh=null;function S1(){var s=window.event;return s&&s.type==="popstate"?s===xh?!1:(xh=s,!0):(xh=null,!1)}var kp=typeof setTimeout=="function"?setTimeout:void 0,b1=typeof clearTimeout=="function"?clearTimeout:void 0,wp=typeof Promise=="function"?Promise:void 0,x1=typeof queueMicrotask=="function"?queueMicrotask:typeof wp<"u"?function(s){return wp.resolve(null).then(s).catch(C1)}:kp;function C1(s){setTimeout(function(){throw s})}function Zs(s){return s==="head"}function Up(s,a){var c=a,g=0;do{var A=c.nextSibling;if(s.removeChild(c),A&&A.nodeType===8)if(c=A.data,c==="/$"||c==="/&"){if(g===0){s.removeChild(A),Ua(a);return}g--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")g++;else if(c==="html")$o(s.ownerDocument.documentElement);else if(c==="head"){c=s.ownerDocument.head,$o(c);for(var E=c.firstChild;E;){var x=E.nextSibling,B=E.nodeName;E[hr]||B==="SCRIPT"||B==="STYLE"||B==="LINK"&&E.rel.toLowerCase()==="stylesheet"||c.removeChild(E),E=x}}else c==="body"&&$o(s.ownerDocument.body);c=A}while(c);Ua(a)}function Pp(s,a){var c=s;s=0;do{var g=c.nextSibling;if(c.nodeType===1?a?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(a?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),g&&g.nodeType===8)if(c=g.data,c==="/$"){if(s===0)break;s--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||s++;c=g}while(c)}function Ch(s){var a=s.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var c=a;switch(a=a.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":Ch(c),Wr(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}s.removeChild(c)}}function R1(s,a,c,g){for(;s.nodeType===1;){var A=c;if(s.nodeName.toLowerCase()!==a.toLowerCase()){if(!g&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(g){if(!s[hr])switch(a){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(E=s.getAttribute("rel"),E==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(E!==A.rel||s.getAttribute("href")!==(A.href==null||A.href===""?null:A.href)||s.getAttribute("crossorigin")!==(A.crossOrigin==null?null:A.crossOrigin)||s.getAttribute("title")!==(A.title==null?null:A.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(E=s.getAttribute("src"),(E!==(A.src==null?null:A.src)||s.getAttribute("type")!==(A.type==null?null:A.type)||s.getAttribute("crossorigin")!==(A.crossOrigin==null?null:A.crossOrigin))&&E&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(a==="input"&&s.type==="hidden"){var E=A.name==null?null:""+A.name;if(A.type==="hidden"&&s.getAttribute("name")===E)return s}else return s;if(s=un(s.nextSibling),s===null)break}return null}function L1(s,a,c){if(a==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!c||(s=un(s.nextSibling),s===null))return null;return s}function Np(s,a){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!a||(s=un(s.nextSibling),s===null))return null;return s}function Rh(s){return s.data==="$?"||s.data==="$~"}function Lh(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function D1(s,a){var c=s.ownerDocument;if(s.data==="$~")s._reactRetry=a;else if(s.data!=="$?"||c.readyState!=="loading")a();else{var g=function(){a(),c.removeEventListener("DOMContentLoaded",g)};c.addEventListener("DOMContentLoaded",g),s._reactRetry=g}}function un(s){for(;s!=null;s=s.nextSibling){var a=s.nodeType;if(a===1||a===3)break;if(a===8){if(a=s.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return s}var Dh=null;function Gp(s){s=s.nextSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="/$"||c==="/&"){if(a===0)return un(s.nextSibling);a--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||a++}s=s.nextSibling}return null}function Hp(s){s=s.previousSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(a===0)return s;a--}else c!=="/$"&&c!=="/&"||a++}s=s.previousSibling}return null}function Kp(s,a,c){switch(a=xu(c),s){case"html":if(s=a.documentElement,!s)throw Error(i(452));return s;case"head":if(s=a.head,!s)throw Error(i(453));return s;case"body":if(s=a.body,!s)throw Error(i(454));return s;default:throw Error(i(451))}}function $o(s){for(var a=s.attributes;a.length;)s.removeAttributeNode(a[0]);Wr(s)}var cn=new Map,Vp=new Set;function Cu(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var Ts=K.d;K.d={f:_1,r:I1,D:B1,C:M1,L:O1,m:F1,X:w1,S:k1,M:U1};function _1(){var s=Ts.f(),a=pu();return s||a}function I1(s){var a=Dn(s);a!==null&&a.tag===5&&a.type==="form"?a0(a):Ts.r(s)}var Fa=typeof document>"u"?null:document;function $p(s,a,c){var g=Fa;if(g&&typeof a=="string"&&a){var A=Gt(a);A='link[rel="'+s+'"][href="'+A+'"]',typeof c=="string"&&(A+='[crossorigin="'+c+'"]'),Vp.has(A)||(Vp.add(A),s={rel:s,crossOrigin:c,href:a},g.querySelector(A)===null&&(a=g.createElement("link"),mi(a,"link",s),wt(a),g.head.appendChild(a)))}}function B1(s){Ts.D(s),$p("dns-prefetch",s,null)}function M1(s,a){Ts.C(s,a),$p("preconnect",s,a)}function O1(s,a,c){Ts.L(s,a,c);var g=Fa;if(g&&s&&a){var A='link[rel="preload"][as="'+Gt(a)+'"]';a==="image"&&c&&c.imageSrcSet?(A+='[imagesrcset="'+Gt(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(A+='[imagesizes="'+Gt(c.imageSizes)+'"]')):A+='[href="'+Gt(s)+'"]';var E=A;switch(a){case"style":E=ka(s);break;case"script":E=wa(s)}cn.has(E)||(s=m({rel:"preload",href:a==="image"&&c&&c.imageSrcSet?void 0:s,as:a},c),cn.set(E,s),g.querySelector(A)!==null||a==="style"&&g.querySelector(Yo(E))||a==="script"&&g.querySelector(zo(E))||(a=g.createElement("link"),mi(a,"link",s),wt(a),g.head.appendChild(a)))}}function F1(s,a){Ts.m(s,a);var c=Fa;if(c&&s){var g=a&&typeof a.as=="string"?a.as:"script",A='link[rel="modulepreload"][as="'+Gt(g)+'"][href="'+Gt(s)+'"]',E=A;switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":E=wa(s)}if(!cn.has(E)&&(s=m({rel:"modulepreload",href:s},a),cn.set(E,s),c.querySelector(A)===null)){switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(zo(E)))return}g=c.createElement("link"),mi(g,"link",s),wt(g),c.head.appendChild(g)}}}function k1(s,a,c){Ts.S(s,a,c);var g=Fa;if(g&&s){var A=Fe(g).hoistableStyles,E=ka(s);a=a||"default";var x=A.get(E);if(!x){var B={loading:0,preload:null};if(x=g.querySelector(Yo(E)))B.loading=5;else{s=m({rel:"stylesheet",href:s,"data-precedence":a},c),(c=cn.get(E))&&_h(s,c);var G=x=g.createElement("link");wt(G),mi(G,"link",s),G._p=new Promise(function(ne,ue){G.onload=ne,G.onerror=ue}),G.addEventListener("load",function(){B.loading|=1}),G.addEventListener("error",function(){B.loading|=2}),B.loading|=4,Ru(x,a,g)}x={type:"stylesheet",instance:x,count:1,state:B},A.set(E,x)}}}function w1(s,a){Ts.X(s,a);var c=Fa;if(c&&s){var g=Fe(c).hoistableScripts,A=wa(s),E=g.get(A);E||(E=c.querySelector(zo(A)),E||(s=m({src:s,async:!0},a),(a=cn.get(A))&&Ih(s,a),E=c.createElement("script"),wt(E),mi(E,"link",s),c.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},g.set(A,E))}}function U1(s,a){Ts.M(s,a);var c=Fa;if(c&&s){var g=Fe(c).hoistableScripts,A=wa(s),E=g.get(A);E||(E=c.querySelector(zo(A)),E||(s=m({src:s,async:!0,type:"module"},a),(a=cn.get(A))&&Ih(s,a),E=c.createElement("script"),wt(E),mi(E,"link",s),c.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},g.set(A,E))}}function Yp(s,a,c,g){var A=(A=re.current)?Cu(A):null;if(!A)throw Error(i(446));switch(s){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(a=ka(c.href),c=Fe(A).hoistableStyles,g=c.get(a),g||(g={type:"style",instance:null,count:0,state:null},c.set(a,g)),g):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){s=ka(c.href);var E=Fe(A).hoistableStyles,x=E.get(s);if(x||(A=A.ownerDocument||A,x={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},E.set(s,x),(E=A.querySelector(Yo(s)))&&!E._p&&(x.instance=E,x.state.loading=5),cn.has(s)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},cn.set(s,c),E||P1(A,s,c,x.state))),a&&g===null)throw Error(i(528,""));return x}if(a&&g!==null)throw Error(i(529,""));return null;case"script":return a=c.async,c=c.src,typeof c=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=wa(c),c=Fe(A).hoistableScripts,g=c.get(a),g||(g={type:"script",instance:null,count:0,state:null},c.set(a,g)),g):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,s))}}function ka(s){return'href="'+Gt(s)+'"'}function Yo(s){return'link[rel="stylesheet"]['+s+"]"}function zp(s){return m({},s,{"data-precedence":s.precedence,precedence:null})}function P1(s,a,c,g){s.querySelector('link[rel="preload"][as="style"]['+a+"]")?g.loading=1:(a=s.createElement("link"),g.preload=a,a.addEventListener("load",function(){return g.loading|=1}),a.addEventListener("error",function(){return g.loading|=2}),mi(a,"link",c),wt(a),s.head.appendChild(a))}function wa(s){return'[src="'+Gt(s)+'"]'}function zo(s){return"script[async]"+s}function jp(s,a,c){if(a.count++,a.instance===null)switch(a.type){case"style":var g=s.querySelector('style[data-href~="'+Gt(c.href)+'"]');if(g)return a.instance=g,wt(g),g;var A=m({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return g=(s.ownerDocument||s).createElement("style"),wt(g),mi(g,"style",A),Ru(g,c.precedence,s),a.instance=g;case"stylesheet":A=ka(c.href);var E=s.querySelector(Yo(A));if(E)return a.state.loading|=4,a.instance=E,wt(E),E;g=zp(c),(A=cn.get(A))&&_h(g,A),E=(s.ownerDocument||s).createElement("link"),wt(E);var x=E;return x._p=new Promise(function(B,G){x.onload=B,x.onerror=G}),mi(E,"link",g),a.state.loading|=4,Ru(E,c.precedence,s),a.instance=E;case"script":return E=wa(c.src),(A=s.querySelector(zo(E)))?(a.instance=A,wt(A),A):(g=c,(A=cn.get(E))&&(g=m({},c),Ih(g,A)),s=s.ownerDocument||s,A=s.createElement("script"),wt(A),mi(A,"link",g),s.head.appendChild(A),a.instance=A);case"void":return null;default:throw Error(i(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(g=a.instance,a.state.loading|=4,Ru(g,c.precedence,s));return a.instance}function Ru(s,a,c){for(var g=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),A=g.length?g[g.length-1]:null,E=A,x=0;x<g.length;x++){var B=g[x];if(B.dataset.precedence===a)E=B;else if(E!==A)break}E?E.parentNode.insertBefore(s,E.nextSibling):(a=c.nodeType===9?c.head:c,a.insertBefore(s,a.firstChild))}function _h(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.title==null&&(s.title=a.title)}function Ih(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.integrity==null&&(s.integrity=a.integrity)}var Lu=null;function Jp(s,a,c){if(Lu===null){var g=new Map,A=Lu=new Map;A.set(c,g)}else A=Lu,g=A.get(c),g||(g=new Map,A.set(c,g));if(g.has(s))return g;for(g.set(s,null),c=c.getElementsByTagName(s),A=0;A<c.length;A++){var E=c[A];if(!(E[hr]||E[Mt]||s==="link"&&E.getAttribute("rel")==="stylesheet")&&E.namespaceURI!=="http://www.w3.org/2000/svg"){var x=E.getAttribute(a)||"";x=s+x;var B=g.get(x);B?B.push(E):g.set(x,[E])}}return g}function Xp(s,a,c){s=s.ownerDocument||s,s.head.insertBefore(c,a==="title"?s.querySelector("head > title"):null)}function N1(s,a,c){if(c===1||a.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return s=a.disabled,typeof a.precedence=="string"&&s==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function Qp(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function G1(s,a,c,g){if(c.type==="stylesheet"&&(typeof g.media!="string"||matchMedia(g.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var A=ka(g.href),E=a.querySelector(Yo(A));if(E){a=E._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(s.count++,s=Du.bind(s),a.then(s,s)),c.state.loading|=4,c.instance=E,wt(E);return}E=a.ownerDocument||a,g=zp(g),(A=cn.get(A))&&_h(g,A),E=E.createElement("link"),wt(E);var x=E;x._p=new Promise(function(B,G){x.onload=B,x.onerror=G}),mi(E,"link",g),c.instance=E}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(s.count++,c=Du.bind(s),a.addEventListener("load",c),a.addEventListener("error",c))}}var Bh=0;function H1(s,a){return s.stylesheets&&s.count===0&&Iu(s,s.stylesheets),0<s.count||0<s.imgCount?function(c){var g=setTimeout(function(){if(s.stylesheets&&Iu(s,s.stylesheets),s.unsuspend){var E=s.unsuspend;s.unsuspend=null,E()}},6e4+a);0<s.imgBytes&&Bh===0&&(Bh=62500*T1());var A=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&Iu(s,s.stylesheets),s.unsuspend)){var E=s.unsuspend;s.unsuspend=null,E()}},(s.imgBytes>Bh?50:800)+a);return s.unsuspend=c,function(){s.unsuspend=null,clearTimeout(g),clearTimeout(A)}}:null}function Du(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Iu(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var _u=null;function Iu(s,a){s.stylesheets=null,s.unsuspend!==null&&(s.count++,_u=new Map,a.forEach(K1,s),_u=null,Du.call(s))}function K1(s,a){if(!(a.state.loading&4)){var c=_u.get(s);if(c)var g=c.get(null);else{c=new Map,_u.set(s,c);for(var A=s.querySelectorAll("link[data-precedence],style[data-precedence]"),E=0;E<A.length;E++){var x=A[E];(x.nodeName==="LINK"||x.getAttribute("media")!=="not all")&&(c.set(x.dataset.precedence,x),g=x)}g&&c.set(null,g)}A=a.instance,x=A.getAttribute("data-precedence"),E=c.get(x)||g,E===g&&c.set(null,A),c.set(x,A),this.count++,g=Du.bind(this),A.addEventListener("load",g),A.addEventListener("error",g),E?E.parentNode.insertBefore(A,E.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(A,s.firstChild)),a.state.loading|=4}}var jo={$$typeof:L,Provider:null,Consumer:null,_currentValue:Q,_currentValue2:Q,_threadCount:0};function V1(s,a,c,g,A,E,x,B,G){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Et(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Et(0),this.hiddenUpdates=Et(null),this.identifierPrefix=g,this.onUncaughtError=A,this.onCaughtError=E,this.onRecoverableError=x,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=G,this.incompleteTransitions=new Map}function qp(s,a,c,g,A,E,x,B,G,ne,ue,ge){return s=new V1(s,a,c,x,G,ne,ue,ge,B),a=1,E===!0&&(a|=24),E=Hi(3,null,null,a),s.current=E,E.stateNode=s,a=cf(),a.refCount++,s.pooledCache=a,a.refCount++,E.memoizedState={element:g,isDehydrated:c,cache:a},gf(E),s}function Wp(s){return s?(s=da,s):da}function Zp(s,a,c,g,A,E){A=Wp(A),g.context===null?g.context=A:g.pendingContext=A,g=Ks(a),g.payload={element:c},E=E===void 0?null:E,E!==null&&(g.callback=E),c=Vs(s,g,a),c!==null&&(Bi(c,s,a),Co(c,s,a))}function eA(s,a){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var c=s.retryLane;s.retryLane=c!==0&&c<a?c:a}}function Mh(s,a){eA(s,a),(s=s.alternate)&&eA(s,a)}function tA(s){if(s.tag===13||s.tag===31){var a=xr(s,67108864);a!==null&&Bi(a,s,67108864),Mh(s,67108864)}}function iA(s){if(s.tag===13||s.tag===31){var a=zi();a=Ui(a);var c=xr(s,a);c!==null&&Bi(c,s,a),Mh(s,a)}}var Bu=!0;function $1(s,a,c,g){var A=k.T;k.T=null;var E=K.p;try{K.p=2,Oh(s,a,c,g)}finally{K.p=E,k.T=A}}function Y1(s,a,c,g){var A=k.T;k.T=null;var E=K.p;try{K.p=8,Oh(s,a,c,g)}finally{K.p=E,k.T=A}}function Oh(s,a,c,g){if(Bu){var A=Fh(g);if(A===null)yh(s,a,g,Mu,c),sA(s,g);else if(j1(A,s,a,c,g))g.stopPropagation();else if(sA(s,g),a&4&&-1<z1.indexOf(s)){for(;A!==null;){var E=Dn(A);if(E!==null)switch(E.tag){case 3:if(E=E.stateNode,E.current.memoizedState.isDehydrated){var x=at(E.pendingLanes);if(x!==0){var B=E;for(B.pendingLanes|=2,B.entangledLanes|=2;x;){var G=1<<31-rt(x);B.entanglements[1]|=G,x&=~G}Pn(E),(gt&6)===0&&(gu=Se()+500,Ho(0))}}break;case 31:case 13:B=xr(E,2),B!==null&&Bi(B,E,2),pu(),Mh(E,2)}if(E=Fh(g),E===null&&yh(s,a,g,Mu,c),E===A)break;A=E}A!==null&&g.stopPropagation()}else yh(s,a,g,null,c)}}function Fh(s){return s=ia(s),kh(s)}var Mu=null;function kh(s){if(Mu=null,s=pn(s),s!==null){var a=r(s);if(a===null)s=null;else{var c=a.tag;if(c===13){if(s=o(a),s!==null)return s;s=null}else if(c===31){if(s=u(a),s!==null)return s;s=null}else if(c===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;s=null}else a!==s&&(s=null)}}return Mu=s,null}function nA(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(be()){case qe:return 2;case De:return 8;case Oe:case Ne:return 32;case Ye:return 268435456;default:return 32}default:return 32}}var wh=!1,er=null,tr=null,ir=null,Jo=new Map,Xo=new Map,nr=[],z1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function sA(s,a){switch(s){case"focusin":case"focusout":er=null;break;case"dragenter":case"dragleave":tr=null;break;case"mouseover":case"mouseout":ir=null;break;case"pointerover":case"pointerout":Jo.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Xo.delete(a.pointerId)}}function Qo(s,a,c,g,A,E){return s===null||s.nativeEvent!==E?(s={blockedOn:a,domEventName:c,eventSystemFlags:g,nativeEvent:E,targetContainers:[A]},a!==null&&(a=Dn(a),a!==null&&tA(a)),s):(s.eventSystemFlags|=g,a=s.targetContainers,A!==null&&a.indexOf(A)===-1&&a.push(A),s)}function j1(s,a,c,g,A){switch(a){case"focusin":return er=Qo(er,s,a,c,g,A),!0;case"dragenter":return tr=Qo(tr,s,a,c,g,A),!0;case"mouseover":return ir=Qo(ir,s,a,c,g,A),!0;case"pointerover":var E=A.pointerId;return Jo.set(E,Qo(Jo.get(E)||null,s,a,c,g,A)),!0;case"gotpointercapture":return E=A.pointerId,Xo.set(E,Qo(Xo.get(E)||null,s,a,c,g,A)),!0}return!1}function rA(s){var a=pn(s.target);if(a!==null){var c=r(a);if(c!==null){if(a=c.tag,a===13){if(a=o(c),a!==null){s.blockedOn=a,Wi(s.priority,function(){iA(c)});return}}else if(a===31){if(a=u(c),a!==null){s.blockedOn=a,Wi(s.priority,function(){iA(c)});return}}else if(a===3&&c.stateNode.current.memoizedState.isDehydrated){s.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Ou(s){if(s.blockedOn!==null)return!1;for(var a=s.targetContainers;0<a.length;){var c=Fh(s.nativeEvent);if(c===null){c=s.nativeEvent;var g=new c.constructor(c.type,c);ts=g,c.target.dispatchEvent(g),ts=null}else return a=Dn(c),a!==null&&tA(a),s.blockedOn=c,!1;a.shift()}return!0}function aA(s,a,c){Ou(s)&&c.delete(a)}function J1(){wh=!1,er!==null&&Ou(er)&&(er=null),tr!==null&&Ou(tr)&&(tr=null),ir!==null&&Ou(ir)&&(ir=null),Jo.forEach(aA),Xo.forEach(aA)}function Fu(s,a){s.blockedOn===a&&(s.blockedOn=null,wh||(wh=!0,l.unstable_scheduleCallback(l.unstable_NormalPriority,J1)))}var ku=null;function oA(s){ku!==s&&(ku=s,l.unstable_scheduleCallback(l.unstable_NormalPriority,function(){ku===s&&(ku=null);for(var a=0;a<s.length;a+=3){var c=s[a],g=s[a+1],A=s[a+2];if(typeof g!="function"){if(kh(g||c)===null)continue;break}var E=Dn(c);E!==null&&(s.splice(a,3),a-=3,Ff(E,{pending:!0,data:A,method:c.method,action:g},g,A))}}))}function Ua(s){function a(G){return Fu(G,s)}er!==null&&Fu(er,s),tr!==null&&Fu(tr,s),ir!==null&&Fu(ir,s),Jo.forEach(a),Xo.forEach(a);for(var c=0;c<nr.length;c++){var g=nr[c];g.blockedOn===s&&(g.blockedOn=null)}for(;0<nr.length&&(c=nr[0],c.blockedOn===null);)rA(c),c.blockedOn===null&&nr.shift();if(c=(s.ownerDocument||s).$$reactFormReplay,c!=null)for(g=0;g<c.length;g+=3){var A=c[g],E=c[g+1],x=A[fi]||null;if(typeof E=="function")x||oA(c);else if(x){var B=null;if(E&&E.hasAttribute("formAction")){if(A=E,x=E[fi]||null)B=x.formAction;else if(kh(A)!==null)continue}else B=x.action;typeof B=="function"?c[g+1]=B:(c.splice(g,3),g-=3),oA(c)}}}function lA(){function s(E){E.canIntercept&&E.info==="react-transition"&&E.intercept({handler:function(){return new Promise(function(x){return A=x})},focusReset:"manual",scroll:"manual"})}function a(){A!==null&&(A(),A=null),g||setTimeout(c,20)}function c(){if(!g&&!navigation.transition){var E=navigation.currentEntry;E&&E.url!=null&&navigation.navigate(E.url,{state:E.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var g=!1,A=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(c,100),function(){g=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),A!==null&&(A(),A=null)}}}function Uh(s){this._internalRoot=s}wu.prototype.render=Uh.prototype.render=function(s){var a=this._internalRoot;if(a===null)throw Error(i(409));var c=a.current,g=zi();Zp(c,g,s,a,null,null)},wu.prototype.unmount=Uh.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var a=s.containerInfo;Zp(s.current,2,null,s,null,null),pu(),a[Ln]=null}};function wu(s){this._internalRoot=s}wu.prototype.unstable_scheduleHydration=function(s){if(s){var a=Rn();s={blockedOn:null,target:s,priority:a};for(var c=0;c<nr.length&&a!==0&&a<nr[c].priority;c++);nr.splice(c,0,s),c===0&&rA(s)}};var uA=e.version;if(uA!=="19.2.0")throw Error(i(527,uA,"19.2.0"));K.findDOMNode=function(s){var a=s._reactInternals;if(a===void 0)throw typeof s.render=="function"?Error(i(188)):(s=Object.keys(s).join(","),Error(i(268,s)));return s=h(a),s=s!==null?d(s):null,s=s===null?null:s.stateNode,s};var X1={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:k,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Uu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Uu.isDisabled&&Uu.supportsFiber)try{Xe=Uu.inject(X1),Ke=Uu}catch{}}return qo.createRoot=function(s,a){if(!n(s))throw Error(i(299));var c=!1,g="",A=p0,E=A0,x=v0;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(g=a.identifierPrefix),a.onUncaughtError!==void 0&&(A=a.onUncaughtError),a.onCaughtError!==void 0&&(E=a.onCaughtError),a.onRecoverableError!==void 0&&(x=a.onRecoverableError)),a=qp(s,1,!1,null,null,c,g,null,A,E,x,lA),s[Ln]=a.current,vh(s),new Uh(a)},qo.hydrateRoot=function(s,a,c){if(!n(s))throw Error(i(299));var g=!1,A="",E=p0,x=A0,B=v0,G=null;return c!=null&&(c.unstable_strictMode===!0&&(g=!0),c.identifierPrefix!==void 0&&(A=c.identifierPrefix),c.onUncaughtError!==void 0&&(E=c.onUncaughtError),c.onCaughtError!==void 0&&(x=c.onCaughtError),c.onRecoverableError!==void 0&&(B=c.onRecoverableError),c.formState!==void 0&&(G=c.formState)),a=qp(s,1,!0,a,c??null,g,A,G,E,x,B,lA),a.context=Wp(null),c=a.current,g=zi(),g=Ui(g),A=Ks(g),A.callback=null,Vs(c,A,g),c=g,a.current.lanes=c,zt(a,c),Pn(a),s[Ln]=a.current,vh(s),new wu(a)},qo.version="19.2.0",qo}var pA;function Xb(){if(pA)return Gh.exports;pA=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(e){console.error(e)}}return l(),Gh.exports=Jb(),Gh.exports}var Xy=Xb();const yB=Yb(Xy),Qb=l=>l;function qb(l,e=Qb){const t=Pu.useSyncExternalStore(l.subscribe,Pu.useCallback(()=>e(l.getState()),[l,e]),Pu.useCallback(()=>e(l.getInitialState()),[l,e]));return Pu.useDebugValue(t),t}const AA=l=>{const e=q1(l),t=i=>qb(e,i);return Object.assign(t,e),t},EB=(l=>l?AA(l):AA),vA={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1},vl=new Map,Nu=l=>{const e=vl.get(l);return e?Object.fromEntries(Object.entries(e.stores).map(([t,i])=>[t,i.getState()])):{}},Wb=(l,e,t)=>{if(l===void 0)return{type:"untracked",connection:e.connect(t)};const i=vl.get(t.name);if(i)return{type:"tracked",store:l,...i};const n={connection:e.connect(t),stores:{}};return vl.set(t.name,n),{type:"tracked",store:l,...n}},Zb=(l,e)=>{if(e===void 0)return;const t=vl.get(l);t&&(delete t.stores[e],Object.keys(t.stores).length===0&&vl.delete(l))},ex=l=>{var e,t;if(!l)return;const i=l.split(`
`),n=i.findIndex(o=>o.includes("api.setState"));if(n<0)return;const r=((e=i[n+1])==null?void 0:e.trim())||"";return(t=/.+ (.+) .+/.exec(r))==null?void 0:t[1]},tx=(l,e={})=>(t,i,n)=>{const{enabled:r,anonymousActionType:o,store:u,...f}=e;let h;try{h=(r??(vA?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!h)return l(t,i,n);const{connection:d,...m}=Wb(u,h,f);let p=!0;n.setState=((T,S,b)=>{const C=t(T,S);if(!p)return C;const L=b===void 0?{type:o||ex(new Error().stack)||"anonymous"}:typeof b=="string"?{type:b}:b;return u===void 0?(d?.send(L,i()),C):(d?.send({...L,type:`${u}/${L.type}`},{...Nu(f.name),[u]:n.getState()}),C)}),n.devtools={cleanup:()=>{d&&typeof d.unsubscribe=="function"&&d.unsubscribe(),Zb(f.name,u)}};const v=(...T)=>{const S=p;p=!1,t(...T),p=S},y=l(n.setState,i,n);if(m.type==="untracked"?d?.init(y):(m.stores[m.store]=n,d?.init(Object.fromEntries(Object.entries(m.stores).map(([T,S])=>[T,T===m.store?y:S.getState()])))),n.dispatchFromDevtools&&typeof n.dispatch=="function"){let T=!1;const S=n.dispatch;n.dispatch=(...b)=>{(vA?"production":void 0)!=="production"&&b[0].type==="__setState"&&!T&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),T=!0),S(...b)}}return d.subscribe(T=>{var S;switch(T.type){case"ACTION":if(typeof T.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return Vh(T.payload,b=>{if(b.type==="__setState"){if(u===void 0){v(b.state);return}Object.keys(b.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const C=b.state[u];if(C==null)return;JSON.stringify(n.getState())!==JSON.stringify(C)&&v(C);return}n.dispatchFromDevtools&&typeof n.dispatch=="function"&&n.dispatch(b)});case"DISPATCH":switch(T.payload.type){case"RESET":return v(y),u===void 0?d?.init(n.getState()):d?.init(Nu(f.name));case"COMMIT":if(u===void 0){d?.init(n.getState());return}return d?.init(Nu(f.name));case"ROLLBACK":return Vh(T.state,b=>{if(u===void 0){v(b),d?.init(n.getState());return}v(b[u]),d?.init(Nu(f.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return Vh(T.state,b=>{if(u===void 0){v(b);return}JSON.stringify(n.getState())!==JSON.stringify(b[u])&&v(b[u])});case"IMPORT_STATE":{const{nextLiftedState:b}=T.payload,C=(S=b.computedStates.slice(-1)[0])==null?void 0:S.state;if(!C)return;v(u===void 0?C:C[u]),d?.send(null,b);return}case"PAUSE_RECORDING":return p=!p}return}}),y},TB=tx,Vh=(l,e)=>{let t;try{t=JSON.parse(l)}catch(i){console.error("[zustand devtools middleware] Could not parse the received json",i)}t!==void 0&&e(t)};function yl(){return yl=Object.assign?Object.assign.bind():function(l){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(l[i]=t[i])}return l},yl.apply(null,arguments)}const Rl=new ei,ug=new ei,ix=new ei,yA=new $n;function nx(l,e,t){const i=Rl.setFromMatrixPosition(l.matrixWorld);i.project(e);const n=t.width/2,r=t.height/2;return[i.x*n+n,-(i.y*r)+r]}function sx(l,e){const t=Rl.setFromMatrixPosition(l.matrixWorld),i=ug.setFromMatrixPosition(e.matrixWorld),n=t.sub(i),r=e.getWorldDirection(ix);return n.angleTo(r)>Math.PI/2}function rx(l,e,t,i){const n=Rl.setFromMatrixPosition(l.matrixWorld),r=n.clone();r.project(e),yA.set(r.x,r.y),t.setFromCamera(yA,e);const o=t.intersectObjects(i,!0);if(o.length){const u=o[0].distance;return n.distanceTo(t.ray.origin)<u}return!0}function ax(l,e){if(e instanceof rg)return e.zoom;if(e instanceof sg){const t=Rl.setFromMatrixPosition(l.matrixWorld),i=ug.setFromMatrixPosition(e.matrixWorld),n=e.fov*Math.PI/180,r=t.distanceTo(i);return 1/(2*Math.tan(n/2)*r)}else return 1}function ox(l,e,t){if(e instanceof sg||e instanceof rg){const i=Rl.setFromMatrixPosition(l.matrixWorld),n=ug.setFromMatrixPosition(e.matrixWorld),r=i.distanceTo(n),o=(t[1]-t[0])/(e.far-e.near),u=t[1]-o*e.far;return Math.round(o*r+u)}}const Rd=l=>Math.abs(l)<1e-10?0:l;function Qy(l,e,t=""){let i="matrix3d(";for(let n=0;n!==16;n++)i+=Rd(e[n]*l.elements[n])+(n!==15?",":")");return t+i}const lx=(l=>e=>Qy(e,l))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),ux=(l=>(e,t)=>Qy(e,l(t),"translate(-50%,-50%)"))(l=>[1/l,1/l,1/l,1,-1/l,-1/l,-1/l,-1,1/l,1/l,1/l,1,1,1,1,1]);function cx(l){return l&&typeof l=="object"&&"current"in l}const SB=Ie.forwardRef(({children:l,eps:e=.001,style:t,className:i,prepend:n,center:r,fullscreen:o,portal:u,distanceFactor:f,sprite:h=!1,transform:d=!1,occlude:m,onOcclude:p,castShadow:v,receiveShadow:y,material:T,geometry:S,zIndexRange:b=[16777271,0],calculatePosition:C=nx,as:L="div",wrapperClass:D,pointerEvents:_="auto",...w},I)=>{const{gl:O,camera:F,scene:M,size:H,raycaster:P,events:z,viewport:Y}=_s(),[Z]=Ie.useState(()=>document.createElement(L)),k=Ie.useRef(null),K=Ie.useRef(null),Q=Ie.useRef(0),j=Ie.useRef([0,0]),J=Ie.useRef(null),U=Ie.useRef(null),N=u?.current||z.connected||O.domElement.parentNode,V=Ie.useRef(null),q=Ie.useRef(!1),X=Ie.useMemo(()=>m&&m!=="blending"||Array.isArray(m)&&m.length&&cx(m[0]),[m]);Ie.useLayoutEffect(()=>{const ye=O.domElement;m&&m==="blending"?(ye.style.zIndex=`${Math.floor(b[0]/2)}`,ye.style.position="absolute",ye.style.pointerEvents="none"):(ye.style.zIndex=null,ye.style.position=null,ye.style.pointerEvents=null)},[m]),Ie.useLayoutEffect(()=>{if(K.current){const ye=k.current=Xy.createRoot(Z);if(M.updateMatrixWorld(),d)Z.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const fe=C(K.current,F,H);Z.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${fe[0]}px,${fe[1]}px,0);transform-origin:0 0;`}return N&&(n?N.prepend(Z):N.appendChild(Z)),()=>{N&&N.removeChild(Z),ye.unmount()}}},[N,d]),Ie.useLayoutEffect(()=>{D&&(Z.className=D)},[D]);const re=Ie.useMemo(()=>d?{position:"absolute",top:0,left:0,width:H.width,height:H.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:r?"translate3d(-50%,-50%,0)":"none",...o&&{top:-H.height/2,left:-H.width/2,width:H.width,height:H.height},...t},[t,r,o,H,d]),oe=Ie.useMemo(()=>({position:"absolute",pointerEvents:_}),[_]);Ie.useLayoutEffect(()=>{if(q.current=!1,d){var ye;(ye=k.current)==null||ye.render(Ie.createElement("div",{ref:J,style:re},Ie.createElement("div",{ref:U,style:oe},Ie.createElement("div",{ref:I,className:i,style:t,children:l}))))}else{var fe;(fe=k.current)==null||fe.render(Ie.createElement("div",{ref:I,style:re,className:i,children:l}))}});const le=Ie.useRef(!0);Bc(ye=>{if(K.current){F.updateMatrixWorld(),K.current.updateWorldMatrix(!0,!1);const fe=d?j.current:C(K.current,F,H);if(d||Math.abs(Q.current-F.zoom)>e||Math.abs(j.current[0]-fe[0])>e||Math.abs(j.current[1]-fe[1])>e){const me=sx(K.current,F);let Pe=!1;X&&(Array.isArray(m)?Pe=m.map(Ee=>Ee.current):m!=="blending"&&(Pe=[M]));const Be=le.current;if(Pe){const Ee=rx(K.current,F,P,Pe);le.current=Ee&&!me}else le.current=!me;Be!==le.current&&(p?p(!le.current):Z.style.display=le.current?"block":"none");const Ce=Math.floor(b[0]/2),Ae=m?X?[b[0],Ce]:[Ce-1,0]:b;if(Z.style.zIndex=`${ox(K.current,F,Ae)}`,d){const[Ee,pe]=[H.width/2,H.height/2],Re=F.projectionMatrix.elements[5]*pe,{isOrthographicCamera:Te,top:de,left:He,bottom:Le,right:Se}=F,be=lx(F.matrixWorldInverse),qe=Te?`scale(${Re})translate(${Rd(-(Se+He)/2)}px,${Rd((de+Le)/2)}px)`:`translateZ(${Re}px)`;let De=K.current.matrixWorld;h&&(De=F.matrixWorldInverse.clone().transpose().copyPosition(De).scale(K.current.scale),De.elements[3]=De.elements[7]=De.elements[11]=0,De.elements[15]=1),Z.style.width=H.width+"px",Z.style.height=H.height+"px",Z.style.perspective=Te?"":`${Re}px`,J.current&&U.current&&(J.current.style.transform=`${qe}${be}translate(${Ee}px,${pe}px)`,U.current.style.transform=ux(De,1/((f||10)/400)))}else{const Ee=f===void 0?1:ax(K.current,F)*f;Z.style.transform=`translate3d(${fe[0]}px,${fe[1]}px,0) scale(${Ee})`}j.current=fe,Q.current=F.zoom}}if(!X&&V.current&&!q.current)if(d){if(J.current){const fe=J.current.children[0];if(fe!=null&&fe.clientWidth&&fe!=null&&fe.clientHeight){const{isOrthographicCamera:me}=F;if(me||S)w.scale&&(Array.isArray(w.scale)?w.scale instanceof ei?V.current.scale.copy(w.scale.clone().divideScalar(1)):V.current.scale.set(1/w.scale[0],1/w.scale[1],1/w.scale[2]):V.current.scale.setScalar(1/w.scale));else{const Pe=(f||10)/400,Be=fe.clientWidth*Pe,Ce=fe.clientHeight*Pe;V.current.scale.set(Be,Ce,1)}q.current=!0}}}else{const fe=Z.children[0];if(fe!=null&&fe.clientWidth&&fe!=null&&fe.clientHeight){const me=1/Y.factor,Pe=fe.clientWidth*me,Be=fe.clientHeight*me;V.current.scale.set(Pe,Be,1),q.current=!0}V.current.lookAt(ye.camera.position)}});const ve=Ie.useMemo(()=>({vertexShader:d?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[d]);return Ie.createElement("group",yl({},w,{ref:K}),m&&!X&&Ie.createElement("mesh",{castShadow:v,receiveShadow:y,ref:V},S||Ie.createElement("planeGeometry",null),T||Ie.createElement("shaderMaterial",{side:ng,vertexShader:ve.vertexShader,fragmentShader:ve.fragmentShader})))});function fl(l,e,t){return e in l?Object.defineProperty(l,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):l[e]=t,l}function Ld(l,e){(e==null||e>l.length)&&(e=l.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=l[t];return i}function fx(l,e){if(l){if(typeof l=="string")return Ld(l,e);var t=Object.prototype.toString.call(l).slice(8,-1);if(t==="Object"&&l.constructor&&(t=l.constructor.name),t==="Map"||t==="Set")return Array.from(l);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ld(l,e)}}function hx(l){if(Array.isArray(l))return Ld(l)}function dx(l){if(typeof Symbol<"u"&&l[Symbol.iterator]!=null||l["@@iterator"]!=null)return Array.from(l)}function gx(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mx(l){return hx(l)||dx(l)||fx(l)||gx()}new $n;new $n;function px(l,e,t){return Math.max(e,Math.min(t,l))}function Ax(l,e){return px(l-Math.floor(l/e)*e,0,e)}function vx(l,e){var t=Ax(e-l,Math.PI*2);return t>Math.PI&&(t-=Math.PI*2),t}function qy(l,e){if(!(l instanceof e))throw new TypeError("Cannot call a class as a function")}var fn=function l(e,t,i){var n=this;qy(this,l),fl(this,"dot2",function(r,o){return n.x*r+n.y*o}),fl(this,"dot3",function(r,o,u){return n.x*r+n.y*o+n.z*u}),this.x=e,this.y=t,this.z=i},yx=[new fn(1,1,0),new fn(-1,1,0),new fn(1,-1,0),new fn(-1,-1,0),new fn(1,0,1),new fn(-1,0,1),new fn(1,0,-1),new fn(-1,0,-1),new fn(0,1,1),new fn(0,-1,1),new fn(0,1,-1),new fn(0,-1,-1)],EA=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],TA=new Array(512),SA=new Array(512),Ex=function(e){e>0&&e<1&&(e*=65536),e=Math.floor(e),e<256&&(e|=e<<8);for(var t=0;t<256;t++){var i;t&1?i=EA[t]^e&255:i=EA[t]^e>>8&255,TA[t]=TA[t+256]=i,SA[t]=SA[t+256]=yx[i%12]}};Ex(0);function Tx(l){if(typeof l=="number")l=Math.abs(l);else if(typeof l=="string"){var e=l;l=0;for(var t=0;t<e.length;t++)l=(l+(t+1)*(e.charCodeAt(t)%96))%2147483647}return l===0&&(l=311),l}function bA(l){var e=Tx(l);return function(){var t=e*48271%2147483647;return e=t,t/2147483647}}var Sx=function l(e){var t=this;qy(this,l),fl(this,"seed",0),fl(this,"init",function(i){t.seed=i,t.value=bA(i)}),fl(this,"value",bA(this.seed)),this.init(e)};new Sx(Math.random());var bx=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.01,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/(2*Math.PI);return i/Math.atan(1/t)*Math.atan(Math.sin(2*Math.PI*e*n)/t)},Wy=function(e){return 1/(1+e+.48*e*e+.235*e*e*e)},xx=function(e){return e},Cx={in:function(e){return 1-Math.cos(e*Math.PI/2)},out:function(e){return Math.sin(e*Math.PI/2)},inOut:function(e){return-(Math.cos(Math.PI*e)-1)/2}},Rx={in:function(e){return e*e*e},out:function(e){return 1-Math.pow(1-e,3)},inOut:function(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}},Lx={in:function(e){return e*e*e*e*e},out:function(e){return 1-Math.pow(1-e,5)},inOut:function(e){return e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2}},Dx={in:function(e){return 1-Math.sqrt(1-Math.pow(e,2))},out:function(e){return Math.sqrt(1-Math.pow(e-1,2))},inOut:function(e){return e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2}},_x={in:function(e){return e*e*e*e},out:function(e){return 1- --e*e*e*e},inOut:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e}},Ix={in:function(e){return e===0?0:Math.pow(2,10*e-10)},out:function(e){return e===1?1:1-Math.pow(2,-10*e)},inOut:function(e){return e===0?0:e===1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2}};function ri(l,e,t){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:.25,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.01,r=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Wy,u=arguments.length>7&&arguments[7]!==void 0?arguments[7]:.001,f="velocity_"+e;if(l.__damp===void 0&&(l.__damp={}),l.__damp[f]===void 0&&(l.__damp[f]=0),Math.abs(l[e]-t)<=u)return l[e]=t,!1;i=Math.max(1e-4,i);var h=2/i,d=o(h*n),m=l[e]-t,p=t,v=r*i;m=Math.min(Math.max(m,-v),v),t=l[e]-m;var y=(l.__damp[f]+h*m)*n;l.__damp[f]=(l.__damp[f]-h*y)*d;var T=t+(m+y)*d;return p-l[e]>0==T>p&&(T=p,l.__damp[f]=(T-p)/n),l[e]=T,!0}var Bx=function(e){return e&&e.isCamera},Mx=function(e){return e&&e.isLight},Wo=new ei,xA=new Xr,CA=new Xr,Zo=new jr,$h=new ei;function Ox(l,e,t,i,n,r,o){typeof e=="number"?Wo.setScalar(e):Array.isArray(e)?Wo.set(e[0],e[1],e[2]):Wo.copy(e);var u=l.parent;l.updateWorldMatrix(!0,!1),$h.setFromMatrixPosition(l.matrixWorld),Bx(l)||Mx(l)?Zo.lookAt($h,Wo,l.up):Zo.lookAt(Wo,$h,l.up),vc(l.quaternion,CA.setFromRotationMatrix(Zo),t,i,n,r,o),u&&(Zo.extractRotation(u.matrixWorld),xA.setFromRotationMatrix(Zo),vc(l.quaternion,CA.copy(l.quaternion).premultiply(xA.invert()),t,i,n,r,o))}function Ja(l,e,t,i,n,r,o,u){return ri(l,e,l[e]+vx(l[e],t),i,n,r,o,u)}var el=new $n,RA,LA;function Fx(l,e,t,i,n,r,o){return typeof e=="number"?el.setScalar(e):Array.isArray(e)?el.set(e[0],e[1]):el.copy(e),RA=ri(l,"x",el.x,t,i,n,r,o),LA=ri(l,"y",el.y,t,i,n,r,o),RA||LA}var Pa=new ei,DA,_A,IA;function Dd(l,e,t,i,n,r,o){return typeof e=="number"?Pa.setScalar(e):Array.isArray(e)?Pa.set(e[0],e[1],e[2]):Pa.copy(e),DA=ri(l,"x",Pa.x,t,i,n,r,o),_A=ri(l,"y",Pa.y,t,i,n,r,o),IA=ri(l,"z",Pa.z,t,i,n,r,o),DA||_A||IA}var Ur=new Za,BA,MA,OA,FA;function kx(l,e,t,i,n,r,o){return typeof e=="number"?Ur.setScalar(e):Array.isArray(e)?Ur.set(e[0],e[1],e[2],e[3]):Ur.copy(e),BA=ri(l,"x",Ur.x,t,i,n,r,o),MA=ri(l,"y",Ur.y,t,i,n,r,o),OA=ri(l,"z",Ur.z,t,i,n,r,o),FA=ri(l,"w",Ur.w,t,i,n,r,o),BA||MA||OA||FA}var tl=new Z1,kA,wA,UA;function wx(l,e,t,i,n,r,o){return Array.isArray(e)?tl.set(e[0],e[1],e[2],e[3]):tl.copy(e),kA=Ja(l,"x",tl.x,t,i,n,r,o),wA=Ja(l,"y",tl.y,t,i,n,r,o),UA=Ja(l,"z",tl.z,t,i,n,r,o),kA||wA||UA}var Na=new Qi,PA,NA,GA;function Ux(l,e,t,i,n,r,o){return e instanceof Qi?Na.copy(e):Array.isArray(e)?Na.setRGB(e[0],e[1],e[2]):Na.set(e),PA=ri(l,"r",Na.r,t,i,n,r,o),NA=ri(l,"g",Na.g,t,i,n,r,o),GA=ri(l,"b",Na.b,t,i,n,r,o),PA||NA||GA}var Sn=new Xr,Ss=new Za,HA=new Za,il=new Za,KA,VA,$A,YA;function vc(l,e,t,i,n,r,o){var u=l;Array.isArray(e)?Sn.set(e[0],e[1],e[2],e[3]):Sn.copy(e);var f=l.dot(Sn)>0?1:-1;return Sn.x*=f,Sn.y*=f,Sn.z*=f,Sn.w*=f,KA=ri(l,"x",Sn.x,t,i,n,r,o),VA=ri(l,"y",Sn.y,t,i,n,r,o),$A=ri(l,"z",Sn.z,t,i,n,r,o),YA=ri(l,"w",Sn.w,t,i,n,r,o),Ss.set(l.x,l.y,l.z,l.w).normalize(),HA.set(u.__damp.velocity_x,u.__damp.velocity_y,u.__damp.velocity_z,u.__damp.velocity_w),il.copy(Ss).multiplyScalar(HA.dot(Ss)/Ss.dot(Ss)),u.__damp.velocity_x-=il.x,u.__damp.velocity_y-=il.y,u.__damp.velocity_z-=il.z,u.__damp.velocity_w-=il.w,l.set(Ss.x,Ss.y,Ss.z,Ss.w),KA||VA||$A||YA}var nl=new W1,zA,jA,JA;function Px(l,e,t,i,n,r,o){return Array.isArray(e)?nl.set(e[0],e[1],e[2]):nl.copy(e),zA=ri(l,"radius",nl.radius,t,i,n,r,o),jA=Ja(l,"phi",nl.phi,t,i,n,r,o),JA=Ja(l,"theta",nl.theta,t,i,n,r,o),zA||jA||JA}var Gu=new jr,XA=new ei,QA=new Xr,qA=new ei,WA,ZA,ev;function Nx(l,e,t,i,n,r,o){var u=l;return u.__damp===void 0&&(u.__damp={position:new ei,rotation:new Xr,scale:new ei},l.decompose(u.__damp.position,u.__damp.rotation,u.__damp.scale)),Array.isArray(e)?Gu.set.apply(Gu,mx(e)):Gu.copy(e),Gu.decompose(XA,QA,qA),WA=Dd(u.__damp.position,XA,t,i,n,r,o),ZA=vc(u.__damp.rotation,QA,t,i,n,r,o),ev=Dd(u.__damp.scale,qA,t,i,n,r,o),l.compose(u.__damp.position,u.__damp.rotation,u.__damp.scale),WA||ZA||ev}var tv=Object.freeze({__proto__:null,rsqw:bx,exp:Wy,linear:xx,sine:Cx,cubic:Rx,quint:Lx,circ:Dx,quart:_x,expo:Ix,damp:ri,dampLookAt:Ox,dampAngle:Ja,damp2:Fx,damp3:Dd,damp4:kx,dampE:wx,dampC:Ux,dampQ:vc,dampS:Px,dampM:Nx});const Zy=Ie.createContext(null);function bB(){return Ie.useContext(Zy)}function xB({eps:l=1e-5,enabled:e=!0,infinite:t,horizontal:i,pages:n=1,distance:r=1,damping:o=.25,maxSpeed:u=1/0,prepend:f=!1,style:h={},children:d}){const{get:m,setEvents:p,gl:v,size:y,invalidate:T,events:S}=_s(),[b]=Ie.useState(()=>document.createElement("div")),[C]=Ie.useState(()=>document.createElement("div")),[L]=Ie.useState(()=>document.createElement("div")),D=v.domElement.parentNode,_=Ie.useRef(0),w=Ie.useMemo(()=>({el:b,eps:l,fill:C,fixed:L,horizontal:i,damping:o,offset:0,delta:0,scroll:_,pages:n,range(F,M,H=0){const P=F-H,z=P+M+H*2;return this.offset<P?0:this.offset>z?1:(this.offset-P)/(z-P)},curve(F,M,H=0){return Math.sin(this.range(F,M,H)*Math.PI)},visible(F,M,H=0){const P=F-H,z=P+M+H*2;return this.offset>=P&&this.offset<=z}}),[l,o,i,n]);Ie.useEffect(()=>{b.style.position="absolute",b.style.width="100%",b.style.height="100%",b.style[i?"overflowX":"overflowY"]="auto",b.style[i?"overflowY":"overflowX"]="hidden",b.style.top="0px",b.style.left="0px";for(const M in h)b.style[M]=h[M];L.style.position="sticky",L.style.top="0px",L.style.left="0px",L.style.width="100%",L.style.height="100%",L.style.overflow="hidden",b.appendChild(L),C.style.height=i?"100%":`${n*r*100}%`,C.style.width=i?`${n*r*100}%`:"100%",C.style.pointerEvents="none",b.appendChild(C),f?D.prepend(b):D.appendChild(b),b[i?"scrollLeft":"scrollTop"]=1;const O=S.connected||v.domElement;requestAnimationFrame(()=>S.connect==null?void 0:S.connect(b));const F=m().events.compute;return p({compute(M,H){const{left:P,top:z}=D.getBoundingClientRect(),Y=M.clientX-P,Z=M.clientY-z;H.pointer.set(Y/H.size.width*2-1,-(Z/H.size.height)*2+1),H.raycaster.setFromCamera(H.pointer,H.camera)}}),()=>{D.removeChild(b),p({compute:F}),S.connect==null||S.connect(O)}},[n,r,i,b,C,L,D]),Ie.useEffect(()=>{if(S.connected===b){const O=y[i?"width":"height"],F=b[i?"scrollWidth":"scrollHeight"],M=F-O;let H=0,P=!0,z=!0;const Y=()=>{if(!(!e||z)&&(T(),H=b[i?"scrollLeft":"scrollTop"],_.current=H/M,t)){if(!P){if(H>=M){const k=1-w.offset;b[i?"scrollLeft":"scrollTop"]=1,_.current=w.offset=-k,P=!0}else if(H<=0){const k=1+w.offset;b[i?"scrollLeft":"scrollTop"]=F,_.current=w.offset=k,P=!0}}P&&setTimeout(()=>P=!1,40)}};b.addEventListener("scroll",Y,{passive:!0}),requestAnimationFrame(()=>z=!1);const Z=k=>b.scrollLeft+=k.deltaY/2;return i&&b.addEventListener("wheel",Z,{passive:!0}),()=>{b.removeEventListener("scroll",Y),i&&b.removeEventListener("wheel",Z)}}},[b,S,y,t,w,T,i,e]);let I=0;return Bc((O,F)=>{I=w.offset,tv.damp(w,"offset",_.current,o,F,u,void 0,l),tv.damp(w,"delta",Math.abs(I-w.offset),o,F,u,void 0,l),w.delta>l&&T()}),Ie.createElement(Zy.Provider,{value:w},d)}const Gx=parseInt(eb.replace(/\D+/g,""));function iv(l,e){if(e===tb)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),l;if(e===bd||e===Ny){let t=l.getIndex();if(t===null){const o=[],u=l.getAttribute("position");if(u!==void 0){for(let f=0;f<u.count;f++)o.push(f);l.setIndex(o),t=l.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),l}const i=t.count-2,n=[];if(t)if(e===bd)for(let o=1;o<=i;o++)n.push(t.getX(0)),n.push(t.getX(o)),n.push(t.getX(o+1));else for(let o=0;o<i;o++)o%2===0?(n.push(t.getX(o)),n.push(t.getX(o+1)),n.push(t.getX(o+2))):(n.push(t.getX(o+2)),n.push(t.getX(o+1)),n.push(t.getX(o)));n.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=l.clone();return r.setIndex(n),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),l}function yc(l){if(typeof TextDecoder<"u")return new TextDecoder().decode(l);let e="";for(let t=0,i=l.length;t<i;t++)e+=String.fromCharCode(l[t]);try{return decodeURIComponent(escape(e))}catch{return e}}const Vr="srgb",Is="srgb-linear",nv=3001,Hx=3e3;class cg extends Gy{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new zx(t)}),this.register(function(t){return new jx(t)}),this.register(function(t){return new iC(t)}),this.register(function(t){return new nC(t)}),this.register(function(t){return new sC(t)}),this.register(function(t){return new Xx(t)}),this.register(function(t){return new Qx(t)}),this.register(function(t){return new qx(t)}),this.register(function(t){return new Wx(t)}),this.register(function(t){return new Yx(t)}),this.register(function(t){return new Zx(t)}),this.register(function(t){return new Jx(t)}),this.register(function(t){return new tC(t)}),this.register(function(t){return new eC(t)}),this.register(function(t){return new Vx(t)}),this.register(function(t){return new rC(t)}),this.register(function(t){return new aC(t)})}load(e,t,i,n){const r=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const h=ul.extractUrlBase(e);o=ul.resolveURL(h,this.path)}else o=ul.extractUrlBase(e);this.manager.itemStart(e);const u=function(h){n?n(h):console.error(h),r.manager.itemError(e),r.manager.itemEnd(e)},f=new Ac(this.manager);f.setPath(this.path),f.setResponseType("arraybuffer"),f.setRequestHeader(this.requestHeader),f.setWithCredentials(this.withCredentials),f.load(e,function(h){try{r.parse(h,o,function(d){t(d),r.manager.itemEnd(e)},u)}catch(d){u(d)}},i,u)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,n){let r;const o={},u={};if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(yc(new Uint8Array(e.slice(0,4)))===eE){try{o[st.KHR_BINARY_GLTF]=new oC(e)}catch(d){n&&n(d);return}r=JSON.parse(o[st.KHR_BINARY_GLTF].content)}else r=JSON.parse(yc(new Uint8Array(e)));else r=e;if(r.asset===void 0||r.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const f=new EC(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});f.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const d=this.pluginCallbacks[h](f);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),u[d.name]=d,o[d.name]=!0}if(r.extensionsUsed)for(let h=0;h<r.extensionsUsed.length;++h){const d=r.extensionsUsed[h],m=r.extensionsRequired||[];switch(d){case st.KHR_MATERIALS_UNLIT:o[d]=new $x;break;case st.KHR_DRACO_MESH_COMPRESSION:o[d]=new lC(r,this.dracoLoader);break;case st.KHR_TEXTURE_TRANSFORM:o[d]=new uC;break;case st.KHR_MESH_QUANTIZATION:o[d]=new cC;break;default:m.indexOf(d)>=0&&u[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}f.setExtensions(o),f.setPlugins(u),f.parse(i,n)}parseAsync(e,t){const i=this;return new Promise(function(n,r){i.parse(e,t,n,r)})}}function Kx(){let l={};return{get:function(e){return l[e]},add:function(e,t){l[e]=t},remove:function(e){delete l[e]},removeAll:function(){l={}}}}const st={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Vx{constructor(e){this.parser=e,this.name=st.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,n=t.length;i<n;i++){const r=t[i];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let n=t.cache.get(i);if(n)return n;const r=t.json,f=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let h;const d=new Qi(16777215);f.color!==void 0&&d.setRGB(f.color[0],f.color[1],f.color[2],Is);const m=f.range!==void 0?f.range:0;switch(f.type){case"directional":h=new sb(d),h.target.position.set(0,0,-1),h.add(h.target);break;case"point":h=new nb(d),h.distance=m;break;case"spot":h=new ib(d),h.distance=m,f.spot=f.spot||{},f.spot.innerConeAngle=f.spot.innerConeAngle!==void 0?f.spot.innerConeAngle:0,f.spot.outerConeAngle=f.spot.outerConeAngle!==void 0?f.spot.outerConeAngle:Math.PI/4,h.angle=f.spot.outerConeAngle,h.penumbra=1-f.spot.innerConeAngle/f.spot.outerConeAngle,h.target.position.set(0,0,-1),h.add(h.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+f.type)}return h.position.set(0,0,0),h.decay=2,Cs(h,f),f.intensity!==void 0&&(h.intensity=f.intensity),h.name=t.createUniqueName(f.name||"light_"+e),n=Promise.resolve(h),t.cache.add(i,n),n}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,r=i.json.nodes[e],u=(r.extensions&&r.extensions[this.name]||{}).light;return u===void 0?null:this._loadLight(u).then(function(f){return i._getNodeRef(t.cache,u,f)})}}class $x{constructor(){this.name=st.KHR_MATERIALS_UNLIT}getMaterialType(){return za}extendParams(e,t,i){const n=[];e.color=new Qi(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],Is),e.opacity=o[3]}r.baseColorTexture!==void 0&&n.push(i.assignTexture(e,"map",r.baseColorTexture,Vr))}return Promise.all(n)}}class Yx{constructor(e){this.parser=e,this.name=st.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}}class zx{constructor(e){this.parser=e,this.name=st.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:jn}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const u=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new $n(u,u)}return Promise.all(r)}}class jx{constructor(e){this.parser=e,this.name=st.KHR_MATERIALS_DISPERSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:jn}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.dispersion=r.dispersion!==void 0?r.dispersion:0,Promise.resolve()}}class Jx{constructor(e){this.parser=e,this.name=st.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:jn}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}}class Xx{constructor(e){this.parser=e,this.name=st.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:jn}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new Qi(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=n.extensions[this.name];if(o.sheenColorFactor!==void 0){const u=o.sheenColorFactor;t.sheenColor.setRGB(u[0],u[1],u[2],Is)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(i.assignTexture(t,"sheenColorMap",o.sheenColorTexture,Vr)),o.sheenRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}}class Qx{constructor(e){this.parser=e,this.name=st.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:jn}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}}class qx{constructor(e){this.parser=e,this.name=st.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:jn}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const u=o.attenuationColor||[1,1,1];return t.attenuationColor=new Qi().setRGB(u[0],u[1],u[2],Is),Promise.all(r)}}class Wx{constructor(e){this.parser=e,this.name=st.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:jn}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class Zx{constructor(e){this.parser=e,this.name=st.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:jn}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const u=o.specularColorFactor||[1,1,1];return t.specularColor=new Qi().setRGB(u[0],u[1],u[2],Is),o.specularColorTexture!==void 0&&r.push(i.assignTexture(t,"specularColorMap",o.specularColorTexture,Vr)),Promise.all(r)}}class eC{constructor(e){this.parser=e,this.name=st.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:jn}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&r.push(i.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(r)}}class tC{constructor(e){this.parser=e,this.name=st.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:jn}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&r.push(i.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}}class iC{constructor(e){this.parser=e,this.name=st.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,n=i.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const r=n.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}}class nC{constructor(e){this.parser=e,this.name=st.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,r=n.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],u=n.images[o.source];let f=i.textureLoader;if(u.uri){const h=i.options.manager.getHandler(u.uri);h!==null&&(f=h)}return this.detectSupport().then(function(h){if(h)return i.loadTextureImage(e,o.source,f);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class sC{constructor(e){this.parser=e,this.name=st.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,r=n.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],u=n.images[o.source];let f=i.textureLoader;if(u.uri){const h=i.options.manager.getHandler(u.uri);h!==null&&(f=h)}return this.detectSupport().then(function(h){if(h)return i.loadTextureImage(e,o.source,f);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class rC{constructor(e){this.name=st.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const n=i.extensions[this.name],r=this.parser.getDependency("buffer",n.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(u){const f=n.byteOffset||0,h=n.byteLength||0,d=n.count,m=n.byteStride,p=new Uint8Array(u,f,h);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(d,m,p,n.mode,n.filter).then(function(v){return v.buffer}):o.ready.then(function(){const v=new ArrayBuffer(d*m);return o.decodeGltfBuffer(new Uint8Array(v),d,m,p,n.mode,n.filter),v})})}else return null}}class aC{constructor(e){this.name=st.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const n=t.meshes[i.mesh];for(const h of n.primitives)if(h.mode!==hn.TRIANGLES&&h.mode!==hn.TRIANGLE_STRIP&&h.mode!==hn.TRIANGLE_FAN&&h.mode!==void 0)return null;const o=i.extensions[this.name].attributes,u=[],f={};for(const h in o)u.push(this.parser.getDependency("accessor",o[h]).then(d=>(f[h]=d,f[h])));return u.length<1?null:(u.push(this.parser.createNodeMesh(e)),Promise.all(u).then(h=>{const d=h.pop(),m=d.isGroup?d.children:[d],p=h[0].count,v=[];for(const y of m){const T=new jr,S=new ei,b=new Xr,C=new ei(1,1,1),L=new rb(y.geometry,y.material,p);for(let D=0;D<p;D++)f.TRANSLATION&&S.fromBufferAttribute(f.TRANSLATION,D),f.ROTATION&&b.fromBufferAttribute(f.ROTATION,D),f.SCALE&&C.fromBufferAttribute(f.SCALE,D),L.setMatrixAt(D,T.compose(S,b,C));for(const D in f)if(D==="_COLOR_0"){const _=f[D];L.instanceColor=new Hy(_.array,_.itemSize,_.normalized)}else D!=="TRANSLATION"&&D!=="ROTATION"&&D!=="SCALE"&&y.geometry.setAttribute(D,f[D]);Ky.prototype.copy.call(L,y),this.parser.assignFinalMaterial(L),v.push(L)}return d.isGroup?(d.clear(),d.add(...v),d):v[0]}))}}const eE="glTF",sl=12,sv={JSON:1313821514,BIN:5130562};class oC{constructor(e){this.name=st.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,sl);if(this.header={magic:yc(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==eE)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-sl,n=new DataView(e,sl);let r=0;for(;r<i;){const o=n.getUint32(r,!0);r+=4;const u=n.getUint32(r,!0);if(r+=4,u===sv.JSON){const f=new Uint8Array(e,sl+r,o);this.content=yc(f)}else if(u===sv.BIN){const f=sl+r;this.body=e.slice(f,f+o)}r+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class lC{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=st.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,n=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,u={},f={},h={};for(const d in o){const m=_d[d]||d.toLowerCase();u[m]=o[d]}for(const d in e.attributes){const m=_d[d]||d.toLowerCase();if(o[d]!==void 0){const p=i.accessors[e.attributes[d]],v=Xa[p.componentType];h[m]=v.name,f[m]=p.normalized===!0}}return t.getDependency("bufferView",r).then(function(d){return new Promise(function(m,p){n.decodeDracoFile(d,function(v){for(const y in v.attributes){const T=v.attributes[y],S=f[y];S!==void 0&&(T.normalized=S)}m(v)},u,h,Is,p)})})}}class uC{constructor(){this.name=st.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class cC{constructor(){this.name=st.KHR_MESH_QUANTIZATION}}class tE extends _b{constructor(e,t,i,n){super(e,t,i,n)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n*3+n;for(let o=0;o!==n;o++)t[o]=i[r+o];return t}interpolate_(e,t,i,n){const r=this.resultBuffer,o=this.sampleValues,u=this.valueSize,f=u*2,h=u*3,d=n-t,m=(i-t)/d,p=m*m,v=p*m,y=e*h,T=y-h,S=-2*v+3*p,b=v-p,C=1-S,L=b-p+m;for(let D=0;D!==u;D++){const _=o[T+D+u],w=o[T+D+f]*d,I=o[y+D+u],O=o[y+D]*d;r[D]=C*_+L*w+S*I+b*O}return r}}const fC=new Xr;class hC extends tE{interpolate_(e,t,i,n){const r=super.interpolate_(e,t,i,n);return fC.fromArray(r).normalize().toArray(r),r}}const hn={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Xa={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},rv={9728:hb,9729:eo,9984:fb,9985:cb,9986:ub,9987:Vy},av={33071:gb,33648:db,10497:xd},Yh={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_d={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...Gx>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},rr={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},dC={CUBICSPLINE:void 0,LINEAR:zy,STEP:Rb},zh={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function gC(l){return l.DefaultMaterial===void 0&&(l.DefaultMaterial=new $y({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Db})),l.DefaultMaterial}function Pr(l,e,t){for(const i in t.extensions)l[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function Cs(l,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(l.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function mC(l,e,t){let i=!1,n=!1,r=!1;for(let h=0,d=e.length;h<d;h++){const m=e[h];if(m.POSITION!==void 0&&(i=!0),m.NORMAL!==void 0&&(n=!0),m.COLOR_0!==void 0&&(r=!0),i&&n&&r)break}if(!i&&!n&&!r)return Promise.resolve(l);const o=[],u=[],f=[];for(let h=0,d=e.length;h<d;h++){const m=e[h];if(i){const p=m.POSITION!==void 0?t.getDependency("accessor",m.POSITION):l.attributes.position;o.push(p)}if(n){const p=m.NORMAL!==void 0?t.getDependency("accessor",m.NORMAL):l.attributes.normal;u.push(p)}if(r){const p=m.COLOR_0!==void 0?t.getDependency("accessor",m.COLOR_0):l.attributes.color;f.push(p)}}return Promise.all([Promise.all(o),Promise.all(u),Promise.all(f)]).then(function(h){const d=h[0],m=h[1],p=h[2];return i&&(l.morphAttributes.position=d),n&&(l.morphAttributes.normal=m),r&&(l.morphAttributes.color=p),l.morphTargetsRelative=!0,l})}function pC(l,e){if(l.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)l.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(l.morphTargetInfluences.length===t.length){l.morphTargetDictionary={};for(let i=0,n=t.length;i<n;i++)l.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function AC(l){let e;const t=l.extensions&&l.extensions[st.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+jh(t.attributes):e=l.indices+":"+jh(l.attributes)+":"+l.mode,l.targets!==void 0)for(let i=0,n=l.targets.length;i<n;i++)e+=":"+jh(l.targets[i]);return e}function jh(l){let e="";const t=Object.keys(l).sort();for(let i=0,n=t.length;i<n;i++)e+=t[i]+":"+l[t[i]]+";";return e}function Id(l){switch(l){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function vC(l){return l.search(/\.jpe?g($|\?)/i)>0||l.search(/^data\:image\/jpeg/)===0?"image/jpeg":l.search(/\.webp($|\?)/i)>0||l.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const yC=new jr;class EC{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Kx,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,n=!1,r=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,n=navigator.userAgent.indexOf("Firefox")>-1,r=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||n&&r<98?this.textureLoader=new ab(this.options.manager):this.textureLoader=new ob(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Ac(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,n=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const u={scene:o[0][n.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:n.asset,parser:i,userData:{}};return Pr(r,u,n),Cs(u,n),Promise.all(i._invokeAll(function(f){return f.afterRoot&&f.afterRoot(u)})).then(function(){for(const f of u.scenes)f.updateMatrixWorld();e(u)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let n=0,r=t.length;n<r;n++){const o=t[n].joints;for(let u=0,f=o.length;u<f;u++)e[o[u]].isBone=!0}for(let n=0,r=e.length;n<r;n++){const o=e[n];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const n=i.clone(),r=(o,u)=>{const f=this.associations.get(o);f!=null&&this.associations.set(u,f);for(const[h,d]of o.children.entries())r(d,u.children[h])};return r(i,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const n=e(t[i]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let n=0;n<t.length;n++){const r=e(t[n]);r&&i.push(r)}return i}getDependency(e,t){const i=e+":"+t;let n=this.cache.get(i);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(r){return r.loadNode&&r.loadNode(t)});break;case"mesh":n=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!n)throw new Error("Unknown type: "+e);break}this.cache.add(i,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(r,o){return i.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[st.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(r,o){i.load(ul.resolveURL(t.uri,n.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const n=t.byteLength||0,r=t.byteOffset||0;return i.slice(r,r+n)})}loadAccessor(e){const t=this,i=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0){const o=Yh[n.type],u=Xa[n.componentType],f=n.normalized===!0,h=new u(n.count*o);return Promise.resolve(new cl(h,o,f))}const r=[];return n.bufferView!==void 0?r.push(this.getDependency("bufferView",n.bufferView)):r.push(null),n.sparse!==void 0&&(r.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(r).then(function(o){const u=o[0],f=Yh[n.type],h=Xa[n.componentType],d=h.BYTES_PER_ELEMENT,m=d*f,p=n.byteOffset||0,v=n.bufferView!==void 0?i.bufferViews[n.bufferView].byteStride:void 0,y=n.normalized===!0;let T,S;if(v&&v!==m){const b=Math.floor(p/v),C="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+b+":"+n.count;let L=t.cache.get(C);L||(T=new h(u,b*v,n.count*v/d),L=new lb(T,v/d),t.cache.add(C,L)),S=new Lb(L,f,p%v/d,y)}else u===null?T=new h(n.count*f):T=new h(u,p,n.count*f),S=new cl(T,f,y);if(n.sparse!==void 0){const b=Yh.SCALAR,C=Xa[n.sparse.indices.componentType],L=n.sparse.indices.byteOffset||0,D=n.sparse.values.byteOffset||0,_=new C(o[1],L,n.sparse.count*b),w=new h(o[2],D,n.sparse.count*f);u!==null&&(S=new cl(S.array.slice(),S.itemSize,S.normalized));for(let I=0,O=_.length;I<O;I++){const F=_[I];if(S.setX(F,w[I*f]),f>=2&&S.setY(F,w[I*f+1]),f>=3&&S.setZ(F,w[I*f+2]),f>=4&&S.setW(F,w[I*f+3]),f>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return S})}loadTexture(e){const t=this.json,i=this.options,r=t.textures[e].source,o=t.images[r];let u=this.textureLoader;if(o.uri){const f=i.manager.getHandler(o.uri);f!==null&&(u=f)}return this.loadTextureImage(e,r,u)}loadTextureImage(e,t,i){const n=this,r=this.json,o=r.textures[e],u=r.images[t],f=(u.uri||u.bufferView)+":"+o.sampler;if(this.textureCache[f])return this.textureCache[f];const h=this.loadImageSource(t,i).then(function(d){d.flipY=!1,d.name=o.name||u.name||"",d.name===""&&typeof u.uri=="string"&&u.uri.startsWith("data:image/")===!1&&(d.name=u.uri);const p=(r.samplers||{})[o.sampler]||{};return d.magFilter=rv[p.magFilter]||eo,d.minFilter=rv[p.minFilter]||Vy,d.wrapS=av[p.wrapS]||xd,d.wrapT=av[p.wrapT]||xd,n.associations.set(d,{textures:e}),d}).catch(function(){return null});return this.textureCache[f]=h,h}loadImageSource(e,t){const i=this,n=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(m=>m.clone());const o=n.images[e],u=self.URL||self.webkitURL;let f=o.uri||"",h=!1;if(o.bufferView!==void 0)f=i.getDependency("bufferView",o.bufferView).then(function(m){h=!0;const p=new Blob([m],{type:o.mimeType});return f=u.createObjectURL(p),f});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const d=Promise.resolve(f).then(function(m){return new Promise(function(p,v){let y=p;t.isImageBitmapLoader===!0&&(y=function(T){const S=new Cd(T);S.needsUpdate=!0,p(S)}),t.load(ul.resolveURL(m,r.path),y,void 0,v)})}).then(function(m){return h===!0&&u.revokeObjectURL(f),Cs(m,o),m.userData.mimeType=o.mimeType||vC(o.uri),m}).catch(function(m){throw console.error("THREE.GLTFLoader: Couldn't load texture",f),m});return this.sourceCache[e]=d,d}assignTexture(e,t,i,n){const r=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(o=o.clone(),o.channel=i.texCoord),r.extensions[st.KHR_TEXTURE_TRANSFORM]){const u=i.extensions!==void 0?i.extensions[st.KHR_TEXTURE_TRANSFORM]:void 0;if(u){const f=r.associations.get(o);o=r.extensions[st.KHR_TEXTURE_TRANSFORM].extendTexture(o,u),r.associations.set(o,f)}}return n!==void 0&&(typeof n=="number"&&(n=n===nv?Vr:Is),"colorSpace"in o?o.colorSpace=n:o.encoding=n===Vr?nv:Hx),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const n=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const u="PointsMaterial:"+i.uuid;let f=this.cache.get(u);f||(f=new mb,Ph.prototype.copy.call(f,i),f.color.copy(i.color),f.map=i.map,f.sizeAttenuation=!1,this.cache.add(u,f)),i=f}else if(e.isLine){const u="LineBasicMaterial:"+i.uuid;let f=this.cache.get(u);f||(f=new pb,Ph.prototype.copy.call(f,i),f.color.copy(i.color),f.map=i.map,this.cache.add(u,f)),i=f}if(n||r||o){let u="ClonedMaterial:"+i.uuid+":";n&&(u+="derivative-tangents:"),r&&(u+="vertex-colors:"),o&&(u+="flat-shading:");let f=this.cache.get(u);f||(f=i.clone(),r&&(f.vertexColors=!0),o&&(f.flatShading=!0),n&&(f.normalScale&&(f.normalScale.y*=-1),f.clearcoatNormalScale&&(f.clearcoatNormalScale.y*=-1)),this.cache.add(u,f),this.associations.set(f,this.associations.get(i))),i=f}e.material=i}getMaterialType(){return $y}loadMaterial(e){const t=this,i=this.json,n=this.extensions,r=i.materials[e];let o;const u={},f=r.extensions||{},h=[];if(f[st.KHR_MATERIALS_UNLIT]){const m=n[st.KHR_MATERIALS_UNLIT];o=m.getMaterialType(),h.push(m.extendParams(u,r,t))}else{const m=r.pbrMetallicRoughness||{};if(u.color=new Qi(1,1,1),u.opacity=1,Array.isArray(m.baseColorFactor)){const p=m.baseColorFactor;u.color.setRGB(p[0],p[1],p[2],Is),u.opacity=p[3]}m.baseColorTexture!==void 0&&h.push(t.assignTexture(u,"map",m.baseColorTexture,Vr)),u.metalness=m.metallicFactor!==void 0?m.metallicFactor:1,u.roughness=m.roughnessFactor!==void 0?m.roughnessFactor:1,m.metallicRoughnessTexture!==void 0&&(h.push(t.assignTexture(u,"metalnessMap",m.metallicRoughnessTexture)),h.push(t.assignTexture(u,"roughnessMap",m.metallicRoughnessTexture))),o=this._invokeOne(function(p){return p.getMaterialType&&p.getMaterialType(e)}),h.push(Promise.all(this._invokeAll(function(p){return p.extendMaterialParams&&p.extendMaterialParams(e,u)})))}r.doubleSided===!0&&(u.side=ng);const d=r.alphaMode||zh.OPAQUE;if(d===zh.BLEND?(u.transparent=!0,u.depthWrite=!1):(u.transparent=!1,d===zh.MASK&&(u.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==za&&(h.push(t.assignTexture(u,"normalMap",r.normalTexture)),u.normalScale=new $n(1,1),r.normalTexture.scale!==void 0)){const m=r.normalTexture.scale;u.normalScale.set(m,m)}if(r.occlusionTexture!==void 0&&o!==za&&(h.push(t.assignTexture(u,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(u.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==za){const m=r.emissiveFactor;u.emissive=new Qi().setRGB(m[0],m[1],m[2],Is)}return r.emissiveTexture!==void 0&&o!==za&&h.push(t.assignTexture(u,"emissiveMap",r.emissiveTexture,Vr)),Promise.all(h).then(function(){const m=new o(u);return r.name&&(m.name=r.name),Cs(m,r),t.associations.set(m,{materials:e}),r.extensions&&Pr(n,m,r),m})}createUniqueName(e){const t=Ab.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,n=this.primitiveCache;function r(u){return i[st.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(u,t).then(function(f){return ov(f,u,t)})}const o=[];for(let u=0,f=e.length;u<f;u++){const h=e[u],d=AC(h),m=n[d];if(m)o.push(m.promise);else{let p;h.extensions&&h.extensions[st.KHR_DRACO_MESH_COMPRESSION]?p=r(h):p=ov(new Yy,h,t),n[d]={primitive:h,promise:p},o.push(p)}}return Promise.all(o)}loadMesh(e){const t=this,i=this.json,n=this.extensions,r=i.meshes[e],o=r.primitives,u=[];for(let f=0,h=o.length;f<h;f++){const d=o[f].material===void 0?gC(this.cache):this.getDependency("material",o[f].material);u.push(d)}return u.push(t.loadGeometries(o)),Promise.all(u).then(function(f){const h=f.slice(0,f.length-1),d=f[f.length-1],m=[];for(let v=0,y=d.length;v<y;v++){const T=d[v],S=o[v];let b;const C=h[v];if(S.mode===hn.TRIANGLES||S.mode===hn.TRIANGLE_STRIP||S.mode===hn.TRIANGLE_FAN||S.mode===void 0)b=r.isSkinnedMesh===!0?new vb(T,C):new Mc(T,C),b.isSkinnedMesh===!0&&b.normalizeSkinWeights(),S.mode===hn.TRIANGLE_STRIP?b.geometry=iv(b.geometry,Ny):S.mode===hn.TRIANGLE_FAN&&(b.geometry=iv(b.geometry,bd));else if(S.mode===hn.LINES)b=new yb(T,C);else if(S.mode===hn.LINE_STRIP)b=new Eb(T,C);else if(S.mode===hn.LINE_LOOP)b=new Tb(T,C);else if(S.mode===hn.POINTS)b=new Sb(T,C);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+S.mode);Object.keys(b.geometry.morphAttributes).length>0&&pC(b,r),b.name=t.createUniqueName(r.name||"mesh_"+e),Cs(b,r),S.extensions&&Pr(n,b,S),t.assignFinalMaterial(b),m.push(b)}for(let v=0,y=m.length;v<y;v++)t.associations.set(m[v],{meshes:e,primitives:v});if(m.length===1)return r.extensions&&Pr(n,m[0],r),m[0];const p=new Nh;r.extensions&&Pr(n,p,r),t.associations.set(p,{meshes:e});for(let v=0,y=m.length;v<y;v++)p.add(m[v]);return p})}loadCamera(e){let t;const i=this.json.cameras[e],n=i[i.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new sg(ag.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):i.type==="orthographic"&&(t=new rg(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),Cs(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let n=0,r=t.joints.length;n<r;n++)i.push(this._loadNodeShallow(t.joints[n]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(n){const r=n.pop(),o=n,u=[],f=[];for(let h=0,d=o.length;h<d;h++){const m=o[h];if(m){u.push(m);const p=new jr;r!==null&&p.fromArray(r.array,h*16),f.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[h])}return new bb(u,f)})}loadAnimation(e){const t=this.json,i=this,n=t.animations[e],r=n.name?n.name:"animation_"+e,o=[],u=[],f=[],h=[],d=[];for(let m=0,p=n.channels.length;m<p;m++){const v=n.channels[m],y=n.samplers[v.sampler],T=v.target,S=T.node,b=n.parameters!==void 0?n.parameters[y.input]:y.input,C=n.parameters!==void 0?n.parameters[y.output]:y.output;T.node!==void 0&&(o.push(this.getDependency("node",S)),u.push(this.getDependency("accessor",b)),f.push(this.getDependency("accessor",C)),h.push(y),d.push(T))}return Promise.all([Promise.all(o),Promise.all(u),Promise.all(f),Promise.all(h),Promise.all(d)]).then(function(m){const p=m[0],v=m[1],y=m[2],T=m[3],S=m[4],b=[];for(let C=0,L=p.length;C<L;C++){const D=p[C],_=v[C],w=y[C],I=T[C],O=S[C];if(D===void 0)continue;D.updateMatrix&&D.updateMatrix();const F=i._createAnimationTracks(D,_,w,I,O);if(F)for(let M=0;M<F.length;M++)b.push(F[M])}return new xb(r,void 0,b)})}createNodeMesh(e){const t=this.json,i=this,n=t.nodes[e];return n.mesh===void 0?null:i.getDependency("mesh",n.mesh).then(function(r){const o=i._getNodeRef(i.meshCache,n.mesh,r);return n.weights!==void 0&&o.traverse(function(u){if(u.isMesh)for(let f=0,h=n.weights.length;f<h;f++)u.morphTargetInfluences[f]=n.weights[f]}),o})}loadNode(e){const t=this.json,i=this,n=t.nodes[e],r=i._loadNodeShallow(e),o=[],u=n.children||[];for(let h=0,d=u.length;h<d;h++)o.push(i.getDependency("node",u[h]));const f=n.skin===void 0?Promise.resolve(null):i.getDependency("skin",n.skin);return Promise.all([r,Promise.all(o),f]).then(function(h){const d=h[0],m=h[1],p=h[2];p!==null&&d.traverse(function(v){v.isSkinnedMesh&&v.bind(p,yC)});for(let v=0,y=m.length;v<y;v++)d.add(m[v]);return d})}_loadNodeShallow(e){const t=this.json,i=this.extensions,n=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const r=t.nodes[e],o=r.name?n.createUniqueName(r.name):"",u=[],f=n._invokeOne(function(h){return h.createNodeMesh&&h.createNodeMesh(e)});return f&&u.push(f),r.camera!==void 0&&u.push(n.getDependency("camera",r.camera).then(function(h){return n._getNodeRef(n.cameraCache,r.camera,h)})),n._invokeAll(function(h){return h.createNodeAttachment&&h.createNodeAttachment(e)}).forEach(function(h){u.push(h)}),this.nodeCache[e]=Promise.all(u).then(function(h){let d;if(r.isBone===!0?d=new Cb:h.length>1?d=new Nh:h.length===1?d=h[0]:d=new Ky,d!==h[0])for(let m=0,p=h.length;m<p;m++)d.add(h[m]);if(r.name&&(d.userData.name=r.name,d.name=o),Cs(d,r),r.extensions&&Pr(i,d,r),r.matrix!==void 0){const m=new jr;m.fromArray(r.matrix),d.applyMatrix4(m)}else r.translation!==void 0&&d.position.fromArray(r.translation),r.rotation!==void 0&&d.quaternion.fromArray(r.rotation),r.scale!==void 0&&d.scale.fromArray(r.scale);return n.associations.has(d)||n.associations.set(d,{}),n.associations.get(d).nodes=e,d}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],n=this,r=new Nh;i.name&&(r.name=n.createUniqueName(i.name)),Cs(r,i),i.extensions&&Pr(t,r,i);const o=i.nodes||[],u=[];for(let f=0,h=o.length;f<h;f++)u.push(n.getDependency("node",o[f]));return Promise.all(u).then(function(f){for(let d=0,m=f.length;d<m;d++)r.add(f[d]);const h=d=>{const m=new Map;for(const[p,v]of n.associations)(p instanceof Ph||p instanceof Cd)&&m.set(p,v);return d.traverse(p=>{const v=n.associations.get(p);v!=null&&m.set(p,v)}),m};return n.associations=h(r),r})}_createAnimationTracks(e,t,i,n,r){const o=[],u=e.name?e.name:e.uuid,f=[];rr[r.path]===rr.weights?e.traverse(function(p){p.morphTargetInfluences&&f.push(p.name?p.name:p.uuid)}):f.push(u);let h;switch(rr[r.path]){case rr.weights:h=fA;break;case rr.rotation:h=hA;break;case rr.position:case rr.scale:h=cA;break;default:switch(i.itemSize){case 1:h=fA;break;case 2:case 3:default:h=cA;break}break}const d=n.interpolation!==void 0?dC[n.interpolation]:zy,m=this._getArrayFromAccessor(i);for(let p=0,v=f.length;p<v;p++){const y=new h(f[p]+"."+rr[r.path],t.array,m,d);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(y),o.push(y)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=Id(t.constructor),n=new Float32Array(t.length);for(let r=0,o=t.length;r<o;r++)n[r]=t[r]*i;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const n=this instanceof hA?hC:tE;return new n(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function TC(l,e,t){const i=e.attributes,n=new og;if(i.POSITION!==void 0){const u=t.json.accessors[i.POSITION],f=u.min,h=u.max;if(f!==void 0&&h!==void 0){if(n.set(new ei(f[0],f[1],f[2]),new ei(h[0],h[1],h[2])),u.normalized){const d=Id(Xa[u.componentType]);n.min.multiplyScalar(d),n.max.multiplyScalar(d)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const u=new ei,f=new ei;for(let h=0,d=r.length;h<d;h++){const m=r[h];if(m.POSITION!==void 0){const p=t.json.accessors[m.POSITION],v=p.min,y=p.max;if(v!==void 0&&y!==void 0){if(f.setX(Math.max(Math.abs(v[0]),Math.abs(y[0]))),f.setY(Math.max(Math.abs(v[1]),Math.abs(y[1]))),f.setZ(Math.max(Math.abs(v[2]),Math.abs(y[2]))),p.normalized){const T=Id(Xa[p.componentType]);f.multiplyScalar(T)}u.max(f)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(u)}l.boundingBox=n;const o=new jy;n.getCenter(o.center),o.radius=n.min.distanceTo(n.max)/2,l.boundingSphere=o}function ov(l,e,t){const i=e.attributes,n=[];function r(o,u){return t.getDependency("accessor",o).then(function(f){l.setAttribute(u,f)})}for(const o in i){const u=_d[o]||o.toLowerCase();u in l.attributes||n.push(r(i[o],u))}if(e.indices!==void 0&&!l.index){const o=t.getDependency("accessor",e.indices).then(function(u){l.setIndex(u)});n.push(o)}return Cs(l,e),TC(l,e,t),Promise.all(n).then(function(){return e.targets!==void 0?mC(l,e.targets,t):l})}const Jh=new WeakMap;class SC extends Gy{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,n){const r=new Ac(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,o=>{const u={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(o,u).then(t).catch(n)},i,n)}decodeDracoFile(e,t,i,n){const r={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!i};this.decodeGeometry(e,r).then(t)}decodeGeometry(e,t){for(const f in t.attributeTypes){const h=t.attributeTypes[f];h.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[f]=h.name)}const i=JSON.stringify(t);if(Jh.has(e)){const f=Jh.get(e);if(f.key===i)return f.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const r=this.workerNextTaskID++,o=e.byteLength,u=this._getWorker(r,o).then(f=>(n=f,new Promise((h,d)=>{n._callbacks[r]={resolve:h,reject:d},n.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(f=>this._createGeometry(f.geometry));return u.catch(()=>!0).then(()=>{n&&r&&this._releaseTask(n,r)}),Jh.set(e,{key:i,promise:u}),u}_createGeometry(e){const t=new Yy;e.index&&t.setIndex(new cl(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const n=e.attributes[i],r=n.name,o=n.array,u=n.itemSize;t.setAttribute(r,new cl(o,u))}return t}_loadLibrary(e,t){const i=new Ac(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((n,r)=>{i.load(e,n,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{const n=i[0];e||(this.decoderConfig.wasmBinary=i[1]);const r=bC.toString(),o=["/* draco decoder */",n,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(r){const o=r.data;switch(o.type){case"decode":n._callbacks[o.id].resolve(o);break;case"error":n._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,r){return n._taskLoad>r._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function bC(){let l,e;onmessage=function(o){const u=o.data;switch(u.type){case"init":l=u.decoderConfig,e=new Promise(function(d){l.onModuleLoaded=function(m){d({draco:m})},DracoDecoderModule(l)});break;case"decode":const f=u.buffer,h=u.taskConfig;e.then(d=>{const m=d.draco,p=new m.Decoder,v=new m.DecoderBuffer;v.Init(new Int8Array(f),f.byteLength);try{const y=t(m,p,v,h),T=y.attributes.map(S=>S.array.buffer);y.index&&T.push(y.index.array.buffer),self.postMessage({type:"decode",id:u.id,geometry:y},T)}catch(y){console.error(y),self.postMessage({type:"error",id:u.id,error:y.message})}finally{m.destroy(v),m.destroy(p)}});break}};function t(o,u,f,h){const d=h.attributeIDs,m=h.attributeTypes;let p,v;const y=u.GetEncodedGeometryType(f);if(y===o.TRIANGULAR_MESH)p=new o.Mesh,v=u.DecodeBufferToMesh(f,p);else if(y===o.POINT_CLOUD)p=new o.PointCloud,v=u.DecodeBufferToPointCloud(f,p);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!v.ok()||p.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+v.error_msg());const T={index:null,attributes:[]};for(const S in d){const b=self[m[S]];let C,L;if(h.useUniqueIDs)L=d[S],C=u.GetAttributeByUniqueId(p,L);else{if(L=u.GetAttributeId(p,o[d[S]]),L===-1)continue;C=u.GetAttribute(p,L)}T.attributes.push(n(o,u,p,S,b,C))}return y===o.TRIANGULAR_MESH&&(T.index=i(o,u,p)),o.destroy(p),T}function i(o,u,f){const d=f.num_faces()*3,m=d*4,p=o._malloc(m);u.GetTrianglesUInt32Array(f,m,p);const v=new Uint32Array(o.HEAPF32.buffer,p,d).slice();return o._free(p),{array:v,itemSize:1}}function n(o,u,f,h,d,m){const p=m.num_components(),y=f.num_points()*p,T=y*d.BYTES_PER_ELEMENT,S=r(o,d),b=o._malloc(T);u.GetAttributeDataArrayForAllPoints(f,m,S,T,b);const C=new d(o.HEAPF32.buffer,b,y).slice();return o._free(b),{name:h,array:C,itemSize:p}}function r(o,u){switch(u){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}let Hu;const Xh=()=>{if(Hu)return Hu;const l="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",e="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),i=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let n=l;WebAssembly.validate(t)&&(n=e);let r;const o=WebAssembly.instantiate(u(n),{}).then(m=>{r=m.instance,r.exports.__wasm_call_ctors()});function u(m){const p=new Uint8Array(m.length);for(let y=0;y<m.length;++y){const T=m.charCodeAt(y);p[y]=T>96?T-71:T>64?T-65:T>47?T+4:T>46?63:62}let v=0;for(let y=0;y<m.length;++y)p[v++]=p[y]<60?i[p[y]]:(p[y]-60)*64+p[++y];return p.buffer.slice(0,v)}function f(m,p,v,y,T,S){const b=r.exports.sbrk,C=v+3&-4,L=b(C*y),D=b(T.length),_=new Uint8Array(r.exports.memory.buffer);_.set(T,D);const w=m(L,v,y,D,T.length);if(w===0&&S&&S(L,C,y),p.set(_.subarray(L,L+v*y)),b(L-b(0)),w!==0)throw new Error(`Malformed buffer data: ${w}`)}const h={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},d={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return Hu={ready:o,supported:!0,decodeVertexBuffer(m,p,v,y,T){f(r.exports.meshopt_decodeVertexBuffer,m,p,v,y,r.exports[h[T]])},decodeIndexBuffer(m,p,v,y){f(r.exports.meshopt_decodeIndexBuffer,m,p,v,y)},decodeIndexSequence(m,p,v,y){f(r.exports.meshopt_decodeIndexSequence,m,p,v,y)},decodeGltfBuffer(m,p,v,y,T,S){f(r.exports[d[T]],m,p,v,y,r.exports[h[S]])}},Hu};function xC(){var l=Object.create(null);function e(n,r){var o=n.id,u=n.name,f=n.dependencies;f===void 0&&(f=[]);var h=n.init;h===void 0&&(h=function(){});var d=n.getTransferables;if(d===void 0&&(d=null),!l[o])try{f=f.map(function(p){return p&&p.isWorkerModule&&(e(p,function(v){if(v instanceof Error)throw v}),p=l[p.id].value),p}),h=i("<"+u+">.init",h),d&&(d=i("<"+u+">.getTransferables",d));var m=null;typeof h=="function"?m=h.apply(void 0,f):console.error("worker module init function failed to rehydrate"),l[o]={id:o,value:m,getTransferables:d},r(m)}catch(p){p&&p.noLog||console.error(p),r(p)}}function t(n,r){var o,u=n.id,f=n.args;(!l[u]||typeof l[u].value!="function")&&r(new Error("Worker module "+u+": not found or its 'init' did not return a function"));try{var h=(o=l[u]).value.apply(o,f);h&&typeof h.then=="function"?h.then(d,function(m){return r(m instanceof Error?m:new Error(""+m))}):d(h)}catch(m){r(m)}function d(m){try{var p=l[u].getTransferables&&l[u].getTransferables(m);(!p||!Array.isArray(p)||!p.length)&&(p=void 0),r(m,p)}catch(v){console.error(v),r(v)}}}function i(n,r){var o=void 0;self.troikaDefine=function(f){return o=f};var u=URL.createObjectURL(new Blob(["/** "+n.replace(/\*/g,"")+` **/

troikaDefine(
`+r+`
)`],{type:"application/javascript"}));try{importScripts(u)}catch(f){console.error(f)}return URL.revokeObjectURL(u),delete self.troikaDefine,o}self.addEventListener("message",function(n){var r=n.data,o=r.messageId,u=r.action,f=r.data;try{u==="registerModule"&&e(f,function(h){h instanceof Error?postMessage({messageId:o,success:!1,error:h.message}):postMessage({messageId:o,success:!0,result:{isCallable:typeof h=="function"}})}),u==="callModule"&&t(f,function(h,d){h instanceof Error?postMessage({messageId:o,success:!1,error:h.message}):postMessage({messageId:o,success:!0,result:h},d||void 0)})}catch(h){postMessage({messageId:o,success:!1,error:h.stack})}})}function CC(l){var e=function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return e._getInitResult().then(function(n){if(typeof n=="function")return n.apply(void 0,t);throw new Error("Worker module function was called but `init` did not return a callable function")})};return e._getInitResult=function(){var t=l.dependencies,i=l.init;t=Array.isArray(t)?t.map(function(r){return r&&(r=r.onMainThread||r,r._getInitResult&&(r=r._getInitResult())),r}):[];var n=Promise.all(t).then(function(r){return i.apply(null,r)});return e._getInitResult=function(){return n},n},e}var iE=function(){var l=!1;if(typeof window<"u"&&typeof window.document<"u")try{var e=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));e.terminate(),l=!0}catch(t){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+t.message+"]")}return iE=function(){return l},l},RC=0,LC=0,Qh=!1,hl=Object.create(null),dl=Object.create(null),Bd=Object.create(null);function so(l){if((!l||typeof l.init!="function")&&!Qh)throw new Error("requires `options.init` function");var e=l.dependencies,t=l.init,i=l.getTransferables,n=l.workerId,r=CC(l);n==null&&(n="#default");var o="workerModule"+ ++RC,u=l.name||o,f=null;e=e&&e.map(function(d){return typeof d=="function"&&!d.workerModuleData&&(Qh=!0,d=so({workerId:n,name:"<"+u+"> function dependency: "+d.name,init:`function(){return (
`+oc(d)+`
)}`}),Qh=!1),d&&d.workerModuleData&&(d=d.workerModuleData),d});function h(){for(var d=[],m=arguments.length;m--;)d[m]=arguments[m];if(!iE())return r.apply(void 0,d);if(!f){f=lv(n,"registerModule",h.workerModuleData);var p=function(){f=null,dl[n].delete(p)};(dl[n]||(dl[n]=new Set)).add(p)}return f.then(function(v){var y=v.isCallable;if(y)return lv(n,"callModule",{id:o,args:d});throw new Error("Worker module function was called but `init` did not return a callable function")})}return h.workerModuleData={isWorkerModule:!0,id:o,name:u,dependencies:e,init:oc(t),getTransferables:i&&oc(i)},h.onMainThread=r,h}function DC(l){dl[l]&&dl[l].forEach(function(e){e()}),hl[l]&&(hl[l].terminate(),delete hl[l])}function oc(l){var e=l.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function _C(l){var e=hl[l];if(!e){var t=oc(xC);e=hl[l]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+l.replace(/\*/g,"")+` **/

;(`+t+")()"],{type:"application/javascript"}))),e.onmessage=function(i){var n=i.data,r=n.messageId,o=Bd[r];if(!o)throw new Error("WorkerModule response with empty or unknown messageId");delete Bd[r],o(n)}}return e}function lv(l,e,t){return new Promise(function(i,n){var r=++LC;Bd[r]=function(o){o.success?i(o.result):n(new Error("Error in worker "+e+" call: "+o.error))},_C(l).postMessage({messageId:r,action:e,data:t})})}function nE(){var l=(function(e){function t(j,J,U,N,V,q,X,re){var oe=1-X;re.x=oe*oe*j+2*oe*X*U+X*X*V,re.y=oe*oe*J+2*oe*X*N+X*X*q}function i(j,J,U,N,V,q,X,re,oe,le){var ve=1-oe;le.x=ve*ve*ve*j+3*ve*ve*oe*U+3*ve*oe*oe*V+oe*oe*oe*X,le.y=ve*ve*ve*J+3*ve*ve*oe*N+3*ve*oe*oe*q+oe*oe*oe*re}function n(j,J){for(var U=/([MLQCZ])([^MLQCZ]*)/g,N,V,q,X,re;N=U.exec(j);){var oe=N[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(le){return parseFloat(le)});switch(N[1]){case"M":X=V=oe[0],re=q=oe[1];break;case"L":(oe[0]!==X||oe[1]!==re)&&J("L",X,re,X=oe[0],re=oe[1]);break;case"Q":{J("Q",X,re,X=oe[2],re=oe[3],oe[0],oe[1]);break}case"C":{J("C",X,re,X=oe[4],re=oe[5],oe[0],oe[1],oe[2],oe[3]);break}case"Z":(X!==V||re!==q)&&J("L",X,re,V,q);break}}}function r(j,J,U){U===void 0&&(U=16);var N={x:0,y:0};n(j,function(V,q,X,re,oe,le,ve,ye,fe){switch(V){case"L":J(q,X,re,oe);break;case"Q":{for(var me=q,Pe=X,Be=1;Be<U;Be++)t(q,X,le,ve,re,oe,Be/(U-1),N),J(me,Pe,N.x,N.y),me=N.x,Pe=N.y;break}case"C":{for(var Ce=q,Ae=X,Ee=1;Ee<U;Ee++)i(q,X,le,ve,ye,fe,re,oe,Ee/(U-1),N),J(Ce,Ae,N.x,N.y),Ce=N.x,Ae=N.y;break}}})}var o="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",u="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",f=new WeakMap,h={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function d(j,J){var U=j.getContext?j.getContext("webgl",h):j,N=f.get(U);if(!N){let ve=function(Ce){var Ae=q[Ce];if(!Ae&&(Ae=q[Ce]=U.getExtension(Ce),!Ae))throw new Error(Ce+" not supported");return Ae},ye=function(Ce,Ae){var Ee=U.createShader(Ae);return U.shaderSource(Ee,Ce),U.compileShader(Ee),Ee},fe=function(Ce,Ae,Ee,pe){if(!X[Ce]){var Re={},Te={},de=U.createProgram();U.attachShader(de,ye(Ae,U.VERTEX_SHADER)),U.attachShader(de,ye(Ee,U.FRAGMENT_SHADER)),U.linkProgram(de),X[Ce]={program:de,transaction:function(Le){U.useProgram(de),Le({setUniform:function(be,qe){for(var De=[],Oe=arguments.length-2;Oe-- >0;)De[Oe]=arguments[Oe+2];var Ne=Te[qe]||(Te[qe]=U.getUniformLocation(de,qe));U["uniform"+be].apply(U,[Ne].concat(De))},setAttribute:function(be,qe,De,Oe,Ne){var Ye=Re[be];Ye||(Ye=Re[be]={buf:U.createBuffer(),loc:U.getAttribLocation(de,be),data:null}),U.bindBuffer(U.ARRAY_BUFFER,Ye.buf),U.vertexAttribPointer(Ye.loc,qe,U.FLOAT,!1,0,0),U.enableVertexAttribArray(Ye.loc),V?U.vertexAttribDivisor(Ye.loc,Oe):ve("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(Ye.loc,Oe),Ne!==Ye.data&&(U.bufferData(U.ARRAY_BUFFER,Ne,De),Ye.data=Ne)}})}}}X[Ce].transaction(pe)},me=function(Ce,Ae){oe++;try{U.activeTexture(U.TEXTURE0+oe);var Ee=re[Ce];Ee||(Ee=re[Ce]=U.createTexture(),U.bindTexture(U.TEXTURE_2D,Ee),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.NEAREST),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.NEAREST)),U.bindTexture(U.TEXTURE_2D,Ee),Ae(Ee,oe)}finally{oe--}},Pe=function(Ce,Ae,Ee){var pe=U.createFramebuffer();le.push(pe),U.bindFramebuffer(U.FRAMEBUFFER,pe),U.activeTexture(U.TEXTURE0+Ae),U.bindTexture(U.TEXTURE_2D,Ce),U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.TEXTURE_2D,Ce,0);try{Ee(pe)}finally{U.deleteFramebuffer(pe),U.bindFramebuffer(U.FRAMEBUFFER,le[--le.length-1]||null)}},Be=function(){q={},X={},re={},oe=-1,le.length=0};var V=typeof WebGL2RenderingContext<"u"&&U instanceof WebGL2RenderingContext,q={},X={},re={},oe=-1,le=[];U.canvas.addEventListener("webglcontextlost",function(Ce){Be(),Ce.preventDefault()},!1),f.set(U,N={gl:U,isWebGL2:V,getExtension:ve,withProgram:fe,withTexture:me,withTextureFramebuffer:Pe,handleContextLoss:Be})}J(N)}function m(j,J,U,N,V,q,X,re){X===void 0&&(X=15),re===void 0&&(re=null),d(j,function(oe){var le=oe.gl,ve=oe.withProgram,ye=oe.withTexture;ye("copy",function(fe,me){le.texImage2D(le.TEXTURE_2D,0,le.RGBA,V,q,0,le.RGBA,le.UNSIGNED_BYTE,J),ve("copy",o,u,function(Pe){var Be=Pe.setUniform,Ce=Pe.setAttribute;Ce("aUV",2,le.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),Be("1i","image",me),le.bindFramebuffer(le.FRAMEBUFFER,re||null),le.disable(le.BLEND),le.colorMask(X&8,X&4,X&2,X&1),le.viewport(U,N,V,q),le.scissor(U,N,V,q),le.drawArrays(le.TRIANGLES,0,3)})})})}function p(j,J,U){var N=j.width,V=j.height;d(j,function(q){var X=q.gl,re=new Uint8Array(N*V*4);X.readPixels(0,0,N,V,X.RGBA,X.UNSIGNED_BYTE,re),j.width=J,j.height=U,m(X,re,0,0,N,V)})}var v=Object.freeze({__proto__:null,withWebGLContext:d,renderImageData:m,resizeWebGLCanvasWithoutClearing:p});function y(j,J,U,N,V,q){q===void 0&&(q=1);var X=new Uint8Array(j*J),re=N[2]-N[0],oe=N[3]-N[1],le=[];r(U,function(Ce,Ae,Ee,pe){le.push({x1:Ce,y1:Ae,x2:Ee,y2:pe,minX:Math.min(Ce,Ee),minY:Math.min(Ae,pe),maxX:Math.max(Ce,Ee),maxY:Math.max(Ae,pe)})}),le.sort(function(Ce,Ae){return Ce.maxX-Ae.maxX});for(var ve=0;ve<j;ve++)for(var ye=0;ye<J;ye++){var fe=Pe(N[0]+re*(ve+.5)/j,N[1]+oe*(ye+.5)/J),me=Math.pow(1-Math.abs(fe)/V,q)/2;fe<0&&(me=1-me),me=Math.max(0,Math.min(255,Math.round(me*255))),X[ye*j+ve]=me}return X;function Pe(Ce,Ae){for(var Ee=1/0,pe=1/0,Re=le.length;Re--;){var Te=le[Re];if(Te.maxX+pe<=Ce)break;if(Ce+pe>Te.minX&&Ae-pe<Te.maxY&&Ae+pe>Te.minY){var de=b(Ce,Ae,Te.x1,Te.y1,Te.x2,Te.y2);de<Ee&&(Ee=de,pe=Math.sqrt(Ee))}}return Be(Ce,Ae)&&(pe=-pe),pe}function Be(Ce,Ae){for(var Ee=0,pe=le.length;pe--;){var Re=le[pe];if(Re.maxX<=Ce)break;var Te=Re.y1>Ae!=Re.y2>Ae&&Ce<(Re.x2-Re.x1)*(Ae-Re.y1)/(Re.y2-Re.y1)+Re.x1;Te&&(Ee+=Re.y1<Re.y2?1:-1)}return Ee!==0}}function T(j,J,U,N,V,q,X,re,oe,le){q===void 0&&(q=1),re===void 0&&(re=0),oe===void 0&&(oe=0),le===void 0&&(le=0),S(j,J,U,N,V,q,X,null,re,oe,le)}function S(j,J,U,N,V,q,X,re,oe,le,ve){q===void 0&&(q=1),oe===void 0&&(oe=0),le===void 0&&(le=0),ve===void 0&&(ve=0);for(var ye=y(j,J,U,N,V,q),fe=new Uint8Array(ye.length*4),me=0;me<ye.length;me++)fe[me*4+ve]=ye[me];m(X,fe,oe,le,j,J,1<<3-ve,re)}function b(j,J,U,N,V,q){var X=V-U,re=q-N,oe=X*X+re*re,le=oe?Math.max(0,Math.min(1,((j-U)*X+(J-N)*re)/oe)):0,ve=j-(U+le*X),ye=J-(N+le*re);return ve*ve+ye*ye}var C=Object.freeze({__proto__:null,generate:y,generateIntoCanvas:T,generateIntoFramebuffer:S}),L="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",D="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",_="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",w=new Float32Array([0,0,2,0,0,2]),I=null,O=!1,F={},M=new WeakMap;function H(j){if(!O&&!Z(j))throw new Error("WebGL generation not supported")}function P(j,J,U,N,V,q,X){if(q===void 0&&(q=1),X===void 0&&(X=null),!X&&(X=I,!X)){var re=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!re)throw new Error("OffscreenCanvas or DOM canvas not supported");X=I=re.getContext("webgl",{depth:!1})}H(X);var oe=new Uint8Array(j*J*4);d(X,function(fe){var me=fe.gl,Pe=fe.withTexture,Be=fe.withTextureFramebuffer;Pe("readable",function(Ce,Ae){me.texImage2D(me.TEXTURE_2D,0,me.RGBA,j,J,0,me.RGBA,me.UNSIGNED_BYTE,null),Be(Ce,Ae,function(Ee){Y(j,J,U,N,V,q,me,Ee,0,0,0),me.readPixels(0,0,j,J,me.RGBA,me.UNSIGNED_BYTE,oe)})})});for(var le=new Uint8Array(j*J),ve=0,ye=0;ve<oe.length;ve+=4)le[ye++]=oe[ve];return le}function z(j,J,U,N,V,q,X,re,oe,le){q===void 0&&(q=1),re===void 0&&(re=0),oe===void 0&&(oe=0),le===void 0&&(le=0),Y(j,J,U,N,V,q,X,null,re,oe,le)}function Y(j,J,U,N,V,q,X,re,oe,le,ve){q===void 0&&(q=1),oe===void 0&&(oe=0),le===void 0&&(le=0),ve===void 0&&(ve=0),H(X);var ye=[];r(U,function(fe,me,Pe,Be){ye.push(fe,me,Pe,Be)}),ye=new Float32Array(ye),d(X,function(fe){var me=fe.gl,Pe=fe.isWebGL2,Be=fe.getExtension,Ce=fe.withProgram,Ae=fe.withTexture,Ee=fe.withTextureFramebuffer,pe=fe.handleContextLoss;if(Ae("rawDistances",function(Re,Te){(j!==Re._lastWidth||J!==Re._lastHeight)&&me.texImage2D(me.TEXTURE_2D,0,me.RGBA,Re._lastWidth=j,Re._lastHeight=J,0,me.RGBA,me.UNSIGNED_BYTE,null),Ce("main",L,D,function(de){var He=de.setAttribute,Le=de.setUniform,Se=!Pe&&Be("ANGLE_instanced_arrays"),be=!Pe&&Be("EXT_blend_minmax");He("aUV",2,me.STATIC_DRAW,0,w),He("aLineSegment",4,me.DYNAMIC_DRAW,1,ye),Le.apply(void 0,["4f","uGlyphBounds"].concat(N)),Le("1f","uMaxDistance",V),Le("1f","uExponent",q),Ee(Re,Te,function(qe){me.enable(me.BLEND),me.colorMask(!0,!0,!0,!0),me.viewport(0,0,j,J),me.scissor(0,0,j,J),me.blendFunc(me.ONE,me.ONE),me.blendEquationSeparate(me.FUNC_ADD,Pe?me.MAX:be.MAX_EXT),me.clear(me.COLOR_BUFFER_BIT),Pe?me.drawArraysInstanced(me.TRIANGLES,0,3,ye.length/4):Se.drawArraysInstancedANGLE(me.TRIANGLES,0,3,ye.length/4)})}),Ce("post",o,_,function(de){de.setAttribute("aUV",2,me.STATIC_DRAW,0,w),de.setUniform("1i","tex",Te),me.bindFramebuffer(me.FRAMEBUFFER,re),me.disable(me.BLEND),me.colorMask(ve===0,ve===1,ve===2,ve===3),me.viewport(oe,le,j,J),me.scissor(oe,le,j,J),me.drawArrays(me.TRIANGLES,0,3)})}),me.isContextLost())throw pe(),new Error("webgl context lost")})}function Z(j){var J=!j||j===I?F:j.canvas||j,U=M.get(J);if(U===void 0){O=!0;var N=null;try{var V=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],q=P(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,j);U=q&&V.length===q.length&&q.every(function(X,re){return X===V[re]}),U||(N="bad trial run results",console.info(V,q))}catch(X){U=!1,N=X.message}N&&console.warn("WebGL SDF generation not supported:",N),O=!1,M.set(J,U)}return U}var k=Object.freeze({__proto__:null,generate:P,generateIntoCanvas:z,generateIntoFramebuffer:Y,isSupported:Z});function K(j,J,U,N,V,q){V===void 0&&(V=Math.max(N[2]-N[0],N[3]-N[1])/2),q===void 0&&(q=1);try{return P.apply(k,arguments)}catch(X){return console.info("WebGL SDF generation failed, falling back to JS",X),y.apply(C,arguments)}}function Q(j,J,U,N,V,q,X,re,oe,le){V===void 0&&(V=Math.max(N[2]-N[0],N[3]-N[1])/2),q===void 0&&(q=1),re===void 0&&(re=0),oe===void 0&&(oe=0),le===void 0&&(le=0);try{return z.apply(k,arguments)}catch(ve){return console.info("WebGL SDF generation failed, falling back to JS",ve),T.apply(C,arguments)}}return e.forEachPathCommand=n,e.generate=K,e.generateIntoCanvas=Q,e.javascript=C,e.pathToLineSegments=r,e.webgl=k,e.webglUtils=v,Object.defineProperty(e,"__esModule",{value:!0}),e})({});return l}function IC(){var l=(function(e){var t={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},i={},n={};i.L=1,n[1]="L",Object.keys(t).forEach(function(pe,Re){i[pe]=1<<Re+1,n[i[pe]]=pe}),Object.freeze(i);var r=i.LRI|i.RLI|i.FSI,o=i.L|i.R|i.AL,u=i.B|i.S|i.WS|i.ON|i.FSI|i.LRI|i.RLI|i.PDI,f=i.BN|i.RLE|i.LRE|i.RLO|i.LRO|i.PDF,h=i.S|i.WS|i.B|r|i.PDI|f,d=null;function m(){if(!d){d=new Map;var pe=function(Te){if(t.hasOwnProperty(Te)){var de=0;t[Te].split(",").forEach(function(He){var Le=He.split("+"),Se=Le[0],be=Le[1];Se=parseInt(Se,36),be=be?parseInt(be,36):0,d.set(de+=Se,i[Te]);for(var qe=0;qe<be;qe++)d.set(++de,i[Te])})}};for(var Re in t)pe(Re)}}function p(pe){return m(),d.get(pe.codePointAt(0))||i.L}function v(pe){return n[p(pe)]}var y={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function T(pe,Re){var Te=36,de=0,He=new Map,Le=Re&&new Map,Se;return pe.split(",").forEach(function be(qe){if(qe.indexOf("+")!==-1)for(var De=+qe;De--;)be(Se);else{Se=qe;var Oe=qe.split(">"),Ne=Oe[0],Ye=Oe[1];Ne=String.fromCodePoint(de+=parseInt(Ne,Te)),Ye=String.fromCodePoint(de+=parseInt(Ye,Te)),He.set(Ne,Ye),Re&&Le.set(Ye,Ne)}}),{map:He,reverseMap:Le}}var S,b,C;function L(){if(!S){var pe=T(y.pairs,!0),Re=pe.map,Te=pe.reverseMap;S=Re,b=Te,C=T(y.canonical,!1).map}}function D(pe){return L(),S.get(pe)||null}function _(pe){return L(),b.get(pe)||null}function w(pe){return L(),C.get(pe)||null}var I=i.L,O=i.R,F=i.EN,M=i.ES,H=i.ET,P=i.AN,z=i.CS,Y=i.B,Z=i.S,k=i.ON,K=i.BN,Q=i.NSM,j=i.AL,J=i.LRO,U=i.RLO,N=i.LRE,V=i.RLE,q=i.PDF,X=i.LRI,re=i.RLI,oe=i.FSI,le=i.PDI;function ve(pe,Re){for(var Te=125,de=new Uint32Array(pe.length),He=0;He<pe.length;He++)de[He]=p(pe[He]);var Le=new Map;function Se(yi,Ni){var Ei=de[yi];de[yi]=Ni,Le.set(Ei,Le.get(Ei)-1),Ei&u&&Le.set(u,Le.get(u)-1),Le.set(Ni,(Le.get(Ni)||0)+1),Ni&u&&Le.set(u,(Le.get(u)||0)+1)}for(var be=new Uint8Array(pe.length),qe=new Map,De=[],Oe=null,Ne=0;Ne<pe.length;Ne++)Oe||De.push(Oe={start:Ne,end:pe.length-1,level:Re==="rtl"?1:Re==="ltr"?0:Ol(Ne,!1)}),de[Ne]&Y&&(Oe.end=Ne,Oe=null);for(var Ye=V|N|U|J|r|le|q|Y,ct=function(yi){return yi+(yi&1?1:2)},Bt=function(yi){return yi+(yi&1?2:1)},Xe=0;Xe<De.length;Xe++){Oe=De[Xe];var Ke=[{_level:Oe.level,_override:0,_isolate:0}],we=void 0,rt=0,Dt=0,Ai=0;Le.clear();for(var yt=Oe.start;yt<=Oe.end;yt++){var Ve=de[yt];if(we=Ke[Ke.length-1],Le.set(Ve,(Le.get(Ve)||0)+1),Ve&u&&Le.set(u,(Le.get(u)||0)+1),Ve&Ye)if(Ve&(V|N)){be[yt]=we._level;var ft=(Ve===V?Bt:ct)(we._level);ft<=Te&&!rt&&!Dt?Ke.push({_level:ft,_override:0,_isolate:0}):rt||Dt++}else if(Ve&(U|J)){be[yt]=we._level;var wi=(Ve===U?Bt:ct)(we._level);wi<=Te&&!rt&&!Dt?Ke.push({_level:wi,_override:Ve&U?O:I,_isolate:0}):rt||Dt++}else if(Ve&r){Ve&oe&&(Ve=Ol(yt+1,!0)===1?re:X),be[yt]=we._level,we._override&&Se(yt,we._override);var at=(Ve===re?Bt:ct)(we._level);at<=Te&&rt===0&&Dt===0?(Ai++,Ke.push({_level:at,_override:0,_isolate:1,_isolInitIndex:yt})):rt++}else if(Ve&le){if(rt>0)rt--;else if(Ai>0){for(Dt=0;!Ke[Ke.length-1]._isolate;)Ke.pop();var We=Ke[Ke.length-1]._isolInitIndex;We!=null&&(qe.set(We,yt),qe.set(yt,We)),Ke.pop(),Ai--}we=Ke[Ke.length-1],be[yt]=we._level,we._override&&Se(yt,we._override)}else Ve&q?(rt===0&&(Dt>0?Dt--:!we._isolate&&Ke.length>1&&(Ke.pop(),we=Ke[Ke.length-1])),be[yt]=we._level):Ve&Y&&(be[yt]=Oe.level);else be[yt]=we._level,we._override&&Ve!==K&&Se(yt,we._override)}for(var _t=[],It=null,Je=Oe.start;Je<=Oe.end;Je++){var Et=de[Je];if(!(Et&f)){var zt=be[Je],ai=Et&r,Kt=Et===le;It&&zt===It._level?(It._end=Je,It._endsWithIsolInit=ai):_t.push(It={_start:Je,_end:Je,_level:zt,_startsWithPDI:Kt,_endsWithIsolInit:ai})}}for(var Ri=[],mn=0;mn<_t.length;mn++){var Ui=_t[mn];if(!Ui._startsWithPDI||Ui._startsWithPDI&&!qe.has(Ui._start)){for(var qi=[It=Ui],Rn=void 0;It&&It._endsWithIsolInit&&(Rn=qe.get(It._end))!=null;)for(var Wi=mn+1;Wi<_t.length;Wi++)if(_t[Wi]._start===Rn){qi.push(It=_t[Wi]);break}for(var kt=[],Mt=0;Mt<qi.length;Mt++)for(var fi=qi[Mt],Ln=fi._start;Ln<=fi._end;Ln++)kt.push(Ln);for(var ro=be[kt[0]],Ll=Oe.level,Qr=kt[0]-1;Qr>=0;Qr--)if(!(de[Qr]&f)){Ll=be[Qr];break}var qr=kt[kt.length-1],hr=be[qr],Wr=Oe.level;if(!(de[qr]&r)){for(var pn=qr+1;pn<=Oe.end;pn++)if(!(de[pn]&f)){Wr=be[pn];break}}Ri.push({_seqIndices:kt,_sosType:Math.max(Ll,ro)%2?O:I,_eosType:Math.max(Wr,hr)%2?O:I})}}for(var Dn=0;Dn<Ri.length;Dn++){var Jn=Ri[Dn],Fe=Jn._seqIndices,wt=Jn._sosType,Dl=Jn._eosType,Xn=be[Fe[0]]&1?O:I;if(Le.get(Q))for(var Zi=0;Zi<Fe.length;Zi++){var Qn=Fe[Zi];if(de[Qn]&Q){for(var ao=wt,dr=Zi-1;dr>=0;dr--)if(!(de[Fe[dr]]&f)){ao=de[Fe[dr]];break}Se(Qn,ao&(r|le)?k:ao)}}if(Le.get(F))for(var gr=0;gr<Fe.length;gr++){var _l=Fe[gr];if(de[_l]&F)for(var qn=gr-1;qn>=-1;qn--){var mr=qn===-1?wt:de[Fe[qn]];if(mr&o){mr===j&&Se(_l,P);break}}}if(Le.get(j))for(var Pi=0;Pi<Fe.length;Pi++){var Ti=Fe[Pi];de[Ti]&j&&Se(Ti,O)}if(Le.get(M)||Le.get(z))for(var Ms=1;Ms<Fe.length-1;Ms++){var oo=Fe[Ms];if(de[oo]&(M|z)){for(var _n=0,Zr=0,Os=Ms-1;Os>=0&&(_n=de[Fe[Os]],!!(_n&f));Os--);for(var lo=Ms+1;lo<Fe.length&&(Zr=de[Fe[lo]],!!(Zr&f));lo++);_n===Zr&&(de[oo]===M?_n===F:_n&(F|P))&&Se(oo,_n)}}if(Le.get(F))for(var Gt=0;Gt<Fe.length;Gt++){var uo=Fe[Gt];if(de[uo]&F){for(var pr=Gt-1;pr>=0&&de[Fe[pr]]&(H|f);pr--)Se(Fe[pr],F);for(Gt++;Gt<Fe.length&&de[Fe[Gt]]&(H|f|F);Gt++)de[Fe[Gt]]!==F&&Se(Fe[Gt],F)}}if(Le.get(H)||Le.get(M)||Le.get(z))for(var Wn=0;Wn<Fe.length;Wn++){var Zn=Fe[Wn];if(de[Zn]&(H|M|z)){Se(Zn,k);for(var Ar=Wn-1;Ar>=0&&de[Fe[Ar]]&f;Ar--)Se(Fe[Ar],k);for(var vr=Wn+1;vr<Fe.length&&de[Fe[vr]]&f;vr++)Se(Fe[vr],k)}}if(Le.get(F))for(var In=0,Il=wt;In<Fe.length;In++){var co=Fe[In],ea=de[co];ea&F?Il===I&&Se(co,I):ea&o&&(Il=ea)}if(Le.get(u)){var es=O|F|P,Bl=es|I,ta=[];{for(var An=[],vi=0;vi<Fe.length;vi++)if(de[Fe[vi]]&u){var ts=pe[Fe[vi]],ia=void 0;if(D(ts)!==null)if(An.length<63)An.push({char:ts,seqIndex:vi});else break;else if((ia=_(ts))!==null)for(var en=An.length-1;en>=0;en--){var Bn=An[en].char;if(Bn===ia||Bn===_(w(ts))||D(w(Bn))===ts){ta.push([An[en].seqIndex,vi]),An.length=en;break}}}ta.sort(function(yi,Ni){return yi[0]-Ni[0]})}for(var na=0;na<ta.length;na++){for(var sa=ta[na],yr=sa[0],is=sa[1],tn=!1,Si=0,ns=yr+1;ns<is;ns++){var vn=Fe[ns];if(de[vn]&Bl){tn=!0;var ra=de[vn]&es?O:I;if(ra===Xn){Si=ra;break}}}if(tn&&!Si){Si=wt;for(var Fs=yr-1;Fs>=0;Fs--){var fo=Fe[Fs];if(de[fo]&Bl){var Er=de[fo]&es?O:I;Er!==Xn?Si=Er:Si=Xn;break}}}if(Si){if(de[Fe[yr]]=de[Fe[is]]=Si,Si!==Xn){for(var Mn=yr+1;Mn<Fe.length;Mn++)if(!(de[Fe[Mn]]&f)){p(pe[Fe[Mn]])&Q&&(de[Fe[Mn]]=Si);break}}if(Si!==Xn){for(var ks=is+1;ks<Fe.length;ks++)if(!(de[Fe[ks]]&f)){p(pe[Fe[ks]])&Q&&(de[Fe[ks]]=Si);break}}}}for(var Ht=0;Ht<Fe.length;Ht++)if(de[Fe[Ht]]&u){for(var On=Ht,ws=Ht,ss=wt,Tr=Ht-1;Tr>=0;Tr--)if(de[Fe[Tr]]&f)On=Tr;else{ss=de[Fe[Tr]]&es?O:I;break}for(var aa=Dl,rs=Ht+1;rs<Fe.length;rs++)if(de[Fe[rs]]&(u|f))ws=rs;else{aa=de[Fe[rs]]&es?O:I;break}for(var as=On;as<=ws;as++)de[Fe[as]]=ss===aa?ss:Xn;Ht=ws}}}for(var oi=Oe.start;oi<=Oe.end;oi++){var Ml=be[oi],oa=de[oi];if(Ml&1?oa&(I|F|P)&&be[oi]++:oa&O?be[oi]++:oa&(P|F)&&(be[oi]+=2),oa&f&&(be[oi]=oi===0?Oe.level:be[oi-1]),oi===Oe.end||p(pe[oi])&(Z|Y))for(var la=oi;la>=0&&p(pe[la])&h;la--)be[la]=Oe.level}}return{levels:be,paragraphs:De};function Ol(yi,Ni){for(var Ei=yi;Ei<pe.length;Ei++){var Fn=de[Ei];if(Fn&(O|j))return 1;if(Fn&(Y|I)||Ni&&Fn===le)return 0;if(Fn&r){var Fl=ho(Ei);Ei=Fl===-1?pe.length:Fl}}return 0}function ho(yi){for(var Ni=1,Ei=yi+1;Ei<pe.length;Ei++){var Fn=de[Ei];if(Fn&Y)break;if(Fn&le){if(--Ni===0)return Ei}else Fn&r&&Ni++}return-1}}var ye="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",fe;function me(){if(!fe){var pe=T(ye,!0),Re=pe.map,Te=pe.reverseMap;Te.forEach(function(de,He){Re.set(He,de)}),fe=Re}}function Pe(pe){return me(),fe.get(pe)||null}function Be(pe,Re,Te,de){var He=pe.length;Te=Math.max(0,Te==null?0:+Te),de=Math.min(He-1,de==null?He-1:+de);for(var Le=new Map,Se=Te;Se<=de;Se++)if(Re[Se]&1){var be=Pe(pe[Se]);be!==null&&Le.set(Se,be)}return Le}function Ce(pe,Re,Te,de){var He=pe.length;Te=Math.max(0,Te==null?0:+Te),de=Math.min(He-1,de==null?He-1:+de);var Le=[];return Re.paragraphs.forEach(function(Se){var be=Math.max(Te,Se.start),qe=Math.min(de,Se.end);if(be<qe){for(var De=Re.levels.slice(be,qe+1),Oe=qe;Oe>=be&&p(pe[Oe])&h;Oe--)De[Oe]=Se.level;for(var Ne=Se.level,Ye=1/0,ct=0;ct<De.length;ct++){var Bt=De[ct];Bt>Ne&&(Ne=Bt),Bt<Ye&&(Ye=Bt|1)}for(var Xe=Ne;Xe>=Ye;Xe--)for(var Ke=0;Ke<De.length;Ke++)if(De[Ke]>=Xe){for(var we=Ke;Ke+1<De.length&&De[Ke+1]>=Xe;)Ke++;Ke>we&&Le.push([we+be,Ke+be])}}}),Le}function Ae(pe,Re,Te,de){var He=Ee(pe,Re,Te,de),Le=[].concat(pe);return He.forEach(function(Se,be){Le[be]=(Re.levels[Se]&1?Pe(pe[Se]):null)||pe[Se]}),Le.join("")}function Ee(pe,Re,Te,de){for(var He=Ce(pe,Re,Te,de),Le=[],Se=0;Se<pe.length;Se++)Le[Se]=Se;return He.forEach(function(be){for(var qe=be[0],De=be[1],Oe=Le.slice(qe,De+1),Ne=Oe.length;Ne--;)Le[De-Ne]=Oe[Ne]}),Le}return e.closingToOpeningBracket=_,e.getBidiCharType=p,e.getBidiCharTypeName=v,e.getCanonicalBracket=w,e.getEmbeddingLevels=ve,e.getMirroredCharacter=Pe,e.getMirroredCharactersMap=Be,e.getReorderSegments=Ce,e.getReorderedIndices=Ee,e.getReorderedString=Ae,e.openingToClosingBracket=D,Object.defineProperty(e,"__esModule",{value:!0}),e})({});return l}const sE=/\bvoid\s+main\s*\(\s*\)\s*{/g;function Md(l){const e=/^[ \t]*#include +<([\w\d./]+)>/gm;function t(i,n){let r=Ob[n];return r?Md(r):i}return l.replace(e,t)}const pi=[];for(let l=0;l<256;l++)pi[l]=(l<16?"0":"")+l.toString(16);function BC(){const l=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(pi[l&255]+pi[l>>8&255]+pi[l>>16&255]+pi[l>>24&255]+"-"+pi[e&255]+pi[e>>8&255]+"-"+pi[e>>16&15|64]+pi[e>>24&255]+"-"+pi[t&63|128]+pi[t>>8&255]+"-"+pi[t>>16&255]+pi[t>>24&255]+pi[i&255]+pi[i>>8&255]+pi[i>>16&255]+pi[i>>24&255]).toUpperCase()}const Nr=Object.assign||function(){let l=arguments[0];for(let e=1,t=arguments.length;e<t;e++){let i=arguments[e];if(i)for(let n in i)Object.prototype.hasOwnProperty.call(i,n)&&(l[n]=i[n])}return l},MC=Date.now(),uv=new WeakMap,cv=new Map;let OC=1e10;function Od(l,e){const t=UC(e);let i=uv.get(l);if(i||uv.set(l,i=Object.create(null)),i[t])return new i[t];const n=`_onBeforeCompile${t}`,r=function(h,d){l.onBeforeCompile.call(this,h,d);const m=this.customProgramCacheKey()+"|"+h.vertexShader+"|"+h.fragmentShader;let p=cv[m];if(!p){const v=FC(this,h,e,t);p=cv[m]=v}h.vertexShader=p.vertexShader,h.fragmentShader=p.fragmentShader,Nr(h.uniforms,this.uniforms),e.timeUniform&&(h.uniforms[e.timeUniform]={get value(){return Date.now()-MC}}),this[n]&&this[n](h)},o=function(){return u(e.chained?l:l.clone())},u=function(h){const d=Object.create(h,f);return Object.defineProperty(d,"baseMaterial",{value:l}),Object.defineProperty(d,"id",{value:OC++}),d.uuid=BC(),d.uniforms=Nr({},h.uniforms,e.uniforms),d.defines=Nr({},h.defines,e.defines),d.defines[`TROIKA_DERIVED_MATERIAL_${t}`]="",d.extensions=Nr({},h.extensions,e.extensions),d._listeners=void 0,d},f={constructor:{value:o},isDerivedMaterial:{value:!0},type:{get:()=>l.type,set:h=>{l.type=h}},isDerivedFrom:{writable:!0,configurable:!0,value:function(h){const d=this.baseMaterial;return h===d||d.isDerivedMaterial&&d.isDerivedFrom(h)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return l.customProgramCacheKey()+"|"+t}},onBeforeCompile:{get(){return r},set(h){this[n]=h}},copy:{writable:!0,configurable:!0,value:function(h){return l.copy.call(this,h),!l.isShaderMaterial&&!l.isDerivedMaterial&&(Nr(this.extensions,h.extensions),Nr(this.defines,h.defines),Nr(this.uniforms,Jy.clone(h.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const h=new l.constructor;return u(h).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let h=this._depthMaterial;return h||(h=this._depthMaterial=Od(l.isDerivedMaterial?l.getDepthMaterial():new Bb({depthPacking:Mb}),e),h.defines.IS_DEPTH_MATERIAL="",h.uniforms=this.uniforms),h}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let h=this._distanceMaterial;return h||(h=this._distanceMaterial=Od(l.isDerivedMaterial?l.getDistanceMaterial():new Ib,e),h.defines.IS_DISTANCE_MATERIAL="",h.uniforms=this.uniforms),h}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:h,_distanceMaterial:d}=this;h&&h.dispose(),d&&d.dispose(),l.dispose.call(this)}}};return i[t]=o,new o}function FC(l,{vertexShader:e,fragmentShader:t},i,n){let{vertexDefs:r,vertexMainIntro:o,vertexMainOutro:u,vertexTransform:f,fragmentDefs:h,fragmentMainIntro:d,fragmentMainOutro:m,fragmentColorTransform:p,customRewriter:v,timeUniform:y}=i;if(r=r||"",o=o||"",u=u||"",h=h||"",d=d||"",m=m||"",(f||v)&&(e=Md(e)),(p||v)&&(t=t.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),t=Md(t)),v){let T=v({vertexShader:e,fragmentShader:t});e=T.vertexShader,t=T.fragmentShader}if(p){let T=[];t=t.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,S=>(T.push(S),"")),m=`${p}
${T.join(`
`)}
${m}`}if(y){const T=`
uniform float ${y};
`;r=T+r,h=T+h}return f&&(e=`vec3 troika_position_${n};
vec3 troika_normal_${n};
vec2 troika_uv_${n};
${e}
`,r=`${r}
void troikaVertexTransform${n}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${f}
}
`,o=`
troika_position_${n} = vec3(position);
troika_normal_${n} = vec3(normal);
troika_uv_${n} = vec2(uv);
troikaVertexTransform${n}(troika_position_${n}, troika_normal_${n}, troika_uv_${n});
${o}
`,e=e.replace(/\b(position|normal|uv)\b/g,(T,S,b,C)=>/\battribute\s+vec[23]\s+$/.test(C.substr(0,b))?S:`troika_${S}_${n}`),l.map&&l.map.channel>0||(e=e.replace(/\bMAP_UV\b/g,`troika_uv_${n}`))),e=fv(e,n,r,o,u),t=fv(t,n,h,d,m),{vertexShader:e,fragmentShader:t}}function fv(l,e,t,i,n){return(i||n||t)&&(l=l.replace(sE,`
${t}
void troikaOrigMain${e}() {`),l+=`
void main() {
  ${i}
  troikaOrigMain${e}();
  ${n}
}`),l}function kC(l,e){return l==="uniforms"?void 0:typeof e=="function"?e.toString():e}let wC=0;const hv=new Map;function UC(l){const e=JSON.stringify(l,kC);let t=hv.get(e);return t==null&&hv.set(e,t=++wC),t}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function PC(){return typeof window>"u"&&(self.window=self),(function(l){var e={parse:function(n){var r=e._bin,o=new Uint8Array(n);if(r.readASCII(o,0,4)=="ttcf"){var u=4;r.readUshort(o,u),u+=2,r.readUshort(o,u),u+=2;var f=r.readUint(o,u);u+=4;for(var h=[],d=0;d<f;d++){var m=r.readUint(o,u);u+=4,h.push(e._readFont(o,m))}return h}return[e._readFont(o,0)]},_readFont:function(n,r){var o=e._bin,u=r;o.readFixed(n,r),r+=4;var f=o.readUshort(n,r);r+=2,o.readUshort(n,r),r+=2,o.readUshort(n,r),r+=2,o.readUshort(n,r),r+=2;for(var h=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],d={_data:n,_offset:u},m={},p=0;p<f;p++){var v=o.readASCII(n,r,4);r+=4,o.readUint(n,r),r+=4;var y=o.readUint(n,r);r+=4;var T=o.readUint(n,r);r+=4,m[v]={offset:y,length:T}}for(p=0;p<h.length;p++){var S=h[p];m[S]&&(d[S.trim()]=e[S.trim()].parse(n,m[S].offset,m[S].length,d))}return d},_tabOffset:function(n,r,o){for(var u=e._bin,f=u.readUshort(n,o+4),h=o+12,d=0;d<f;d++){var m=u.readASCII(n,h,4);h+=4,u.readUint(n,h),h+=4;var p=u.readUint(n,h);if(h+=4,u.readUint(n,h),h+=4,m==r)return p}return 0}};e._bin={readFixed:function(n,r){return(n[r]<<8|n[r+1])+(n[r+2]<<8|n[r+3])/65540},readF2dot14:function(n,r){return e._bin.readShort(n,r)/16384},readInt:function(n,r){return e._bin._view(n).getInt32(r)},readInt8:function(n,r){return e._bin._view(n).getInt8(r)},readShort:function(n,r){return e._bin._view(n).getInt16(r)},readUshort:function(n,r){return e._bin._view(n).getUint16(r)},readUshorts:function(n,r,o){for(var u=[],f=0;f<o;f++)u.push(e._bin.readUshort(n,r+2*f));return u},readUint:function(n,r){return e._bin._view(n).getUint32(r)},readUint64:function(n,r){return 4294967296*e._bin.readUint(n,r)+e._bin.readUint(n,r+4)},readASCII:function(n,r,o){for(var u="",f=0;f<o;f++)u+=String.fromCharCode(n[r+f]);return u},readUnicode:function(n,r,o){for(var u="",f=0;f<o;f++){var h=n[r++]<<8|n[r++];u+=String.fromCharCode(h)}return u},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(n,r,o){var u=e._bin._tdec;return u&&r==0&&o==n.length?u.decode(n):e._bin.readASCII(n,r,o)},readBytes:function(n,r,o){for(var u=[],f=0;f<o;f++)u.push(n[r+f]);return u},readASCIIArray:function(n,r,o){for(var u=[],f=0;f<o;f++)u.push(String.fromCharCode(n[r+f]));return u},_view:function(n){return n._dataView||(n._dataView=n.buffer?new DataView(n.buffer,n.byteOffset,n.byteLength):new DataView(new Uint8Array(n).buffer))}},e._lctf={},e._lctf.parse=function(n,r,o,u,f){var h=e._bin,d={},m=r;h.readFixed(n,r),r+=4;var p=h.readUshort(n,r);r+=2;var v=h.readUshort(n,r);r+=2;var y=h.readUshort(n,r);return r+=2,d.scriptList=e._lctf.readScriptList(n,m+p),d.featureList=e._lctf.readFeatureList(n,m+v),d.lookupList=e._lctf.readLookupList(n,m+y,f),d},e._lctf.readLookupList=function(n,r,o){var u=e._bin,f=r,h=[],d=u.readUshort(n,r);r+=2;for(var m=0;m<d;m++){var p=u.readUshort(n,r);r+=2;var v=e._lctf.readLookupTable(n,f+p,o);h.push(v)}return h},e._lctf.readLookupTable=function(n,r,o){var u=e._bin,f=r,h={tabs:[]};h.ltype=u.readUshort(n,r),r+=2,h.flag=u.readUshort(n,r),r+=2;var d=u.readUshort(n,r);r+=2;for(var m=h.ltype,p=0;p<d;p++){var v=u.readUshort(n,r);r+=2;var y=o(n,m,f+v,h);h.tabs.push(y)}return h},e._lctf.numOfOnes=function(n){for(var r=0,o=0;o<32;o++)(n>>>o&1)!=0&&r++;return r},e._lctf.readClassDef=function(n,r){var o=e._bin,u=[],f=o.readUshort(n,r);if(r+=2,f==1){var h=o.readUshort(n,r);r+=2;var d=o.readUshort(n,r);r+=2;for(var m=0;m<d;m++)u.push(h+m),u.push(h+m),u.push(o.readUshort(n,r)),r+=2}if(f==2){var p=o.readUshort(n,r);for(r+=2,m=0;m<p;m++)u.push(o.readUshort(n,r)),r+=2,u.push(o.readUshort(n,r)),r+=2,u.push(o.readUshort(n,r)),r+=2}return u},e._lctf.getInterval=function(n,r){for(var o=0;o<n.length;o+=3){var u=n[o],f=n[o+1];if(n[o+2],u<=r&&r<=f)return o}return-1},e._lctf.readCoverage=function(n,r){var o=e._bin,u={};u.fmt=o.readUshort(n,r),r+=2;var f=o.readUshort(n,r);return r+=2,u.fmt==1&&(u.tab=o.readUshorts(n,r,f)),u.fmt==2&&(u.tab=o.readUshorts(n,r,3*f)),u},e._lctf.coverageIndex=function(n,r){var o=n.tab;if(n.fmt==1)return o.indexOf(r);if(n.fmt==2){var u=e._lctf.getInterval(o,r);if(u!=-1)return o[u+2]+(r-o[u])}return-1},e._lctf.readFeatureList=function(n,r){var o=e._bin,u=r,f=[],h=o.readUshort(n,r);r+=2;for(var d=0;d<h;d++){var m=o.readASCII(n,r,4);r+=4;var p=o.readUshort(n,r);r+=2;var v=e._lctf.readFeatureTable(n,u+p);v.tag=m.trim(),f.push(v)}return f},e._lctf.readFeatureTable=function(n,r){var o=e._bin,u=r,f={},h=o.readUshort(n,r);r+=2,h>0&&(f.featureParams=u+h);var d=o.readUshort(n,r);r+=2,f.tab=[];for(var m=0;m<d;m++)f.tab.push(o.readUshort(n,r+2*m));return f},e._lctf.readScriptList=function(n,r){var o=e._bin,u=r,f={},h=o.readUshort(n,r);r+=2;for(var d=0;d<h;d++){var m=o.readASCII(n,r,4);r+=4;var p=o.readUshort(n,r);r+=2,f[m.trim()]=e._lctf.readScriptTable(n,u+p)}return f},e._lctf.readScriptTable=function(n,r){var o=e._bin,u=r,f={},h=o.readUshort(n,r);r+=2,h>0&&(f.default=e._lctf.readLangSysTable(n,u+h));var d=o.readUshort(n,r);r+=2;for(var m=0;m<d;m++){var p=o.readASCII(n,r,4);r+=4;var v=o.readUshort(n,r);r+=2,f[p.trim()]=e._lctf.readLangSysTable(n,u+v)}return f},e._lctf.readLangSysTable=function(n,r){var o=e._bin,u={};o.readUshort(n,r),r+=2,u.reqFeature=o.readUshort(n,r),r+=2;var f=o.readUshort(n,r);return r+=2,u.features=o.readUshorts(n,r,f),u},e.CFF={},e.CFF.parse=function(n,r,o){var u=e._bin;(n=new Uint8Array(n.buffer,r,o))[r=0],n[++r],n[++r],n[++r],r++;var f=[];r=e.CFF.readIndex(n,r,f);for(var h=[],d=0;d<f.length-1;d++)h.push(u.readASCII(n,r+f[d],f[d+1]-f[d]));r+=f[f.length-1];var m=[];r=e.CFF.readIndex(n,r,m);var p=[];for(d=0;d<m.length-1;d++)p.push(e.CFF.readDict(n,r+m[d],r+m[d+1]));r+=m[m.length-1];var v=p[0],y=[];r=e.CFF.readIndex(n,r,y);var T=[];for(d=0;d<y.length-1;d++)T.push(u.readASCII(n,r+y[d],y[d+1]-y[d]));if(r+=y[y.length-1],e.CFF.readSubrs(n,r,v),v.CharStrings){r=v.CharStrings,y=[],r=e.CFF.readIndex(n,r,y);var S=[];for(d=0;d<y.length-1;d++)S.push(u.readBytes(n,r+y[d],y[d+1]-y[d]));v.CharStrings=S}if(v.ROS){r=v.FDArray;var b=[];for(r=e.CFF.readIndex(n,r,b),v.FDArray=[],d=0;d<b.length-1;d++){var C=e.CFF.readDict(n,r+b[d],r+b[d+1]);e.CFF._readFDict(n,C,T),v.FDArray.push(C)}r+=b[b.length-1],r=v.FDSelect,v.FDSelect=[];var L=n[r];if(r++,L!=3)throw L;var D=u.readUshort(n,r);for(r+=2,d=0;d<D+1;d++)v.FDSelect.push(u.readUshort(n,r),n[r+2]),r+=3}return v.Encoding&&(v.Encoding=e.CFF.readEncoding(n,v.Encoding,v.CharStrings.length)),v.charset&&(v.charset=e.CFF.readCharset(n,v.charset,v.CharStrings.length)),e.CFF._readFDict(n,v,T),v},e.CFF._readFDict=function(n,r,o){var u;for(var f in r.Private&&(u=r.Private[1],r.Private=e.CFF.readDict(n,u,u+r.Private[0]),r.Private.Subrs&&e.CFF.readSubrs(n,u+r.Private.Subrs,r.Private)),r)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(f)!=-1&&(r[f]=o[r[f]-426+35])},e.CFF.readSubrs=function(n,r,o){var u=e._bin,f=[];r=e.CFF.readIndex(n,r,f);var h,d=f.length;h=d<1240?107:d<33900?1131:32768,o.Bias=h,o.Subrs=[];for(var m=0;m<f.length-1;m++)o.Subrs.push(u.readBytes(n,r+f[m],f[m+1]-f[m]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(n,r){for(var o=0;o<n.charset.length;o++)if(n.charset[o]==r)return o;return-1},e.CFF.glyphBySE=function(n,r){return r<0||r>255?-1:e.CFF.glyphByUnicode(n,e.CFF.tableSE[r])},e.CFF.readEncoding=function(n,r,o){e._bin;var u=[".notdef"],f=n[r];if(r++,f!=0)throw"error: unknown encoding format: "+f;var h=n[r];r++;for(var d=0;d<h;d++)u.push(n[r+d]);return u},e.CFF.readCharset=function(n,r,o){var u=e._bin,f=[".notdef"],h=n[r];if(r++,h==0)for(var d=0;d<o;d++){var m=u.readUshort(n,r);r+=2,f.push(m)}else{if(h!=1&&h!=2)throw"error: format: "+h;for(;f.length<o;){m=u.readUshort(n,r),r+=2;var p=0;for(h==1?(p=n[r],r++):(p=u.readUshort(n,r),r+=2),d=0;d<=p;d++)f.push(m),m++}}return f},e.CFF.readIndex=function(n,r,o){var u=e._bin,f=u.readUshort(n,r)+1,h=n[r+=2];if(r++,h==1)for(var d=0;d<f;d++)o.push(n[r+d]);else if(h==2)for(d=0;d<f;d++)o.push(u.readUshort(n,r+2*d));else if(h==3)for(d=0;d<f;d++)o.push(16777215&u.readUint(n,r+3*d-1));else if(f!=1)throw"unsupported offset size: "+h+", count: "+f;return(r+=f*h)-1},e.CFF.getCharString=function(n,r,o){var u=e._bin,f=n[r],h=n[r+1];n[r+2],n[r+3],n[r+4];var d=1,m=null,p=null;f<=20&&(m=f,d=1),f==12&&(m=100*f+h,d=2),21<=f&&f<=27&&(m=f,d=1),f==28&&(p=u.readShort(n,r+1),d=3),29<=f&&f<=31&&(m=f,d=1),32<=f&&f<=246&&(p=f-139,d=1),247<=f&&f<=250&&(p=256*(f-247)+h+108,d=2),251<=f&&f<=254&&(p=256*-(f-251)-h-108,d=2),f==255&&(p=u.readInt(n,r+1)/65535,d=5),o.val=p??"o"+m,o.size=d},e.CFF.readCharString=function(n,r,o){for(var u=r+o,f=e._bin,h=[];r<u;){var d=n[r],m=n[r+1];n[r+2],n[r+3],n[r+4];var p=1,v=null,y=null;d<=20&&(v=d,p=1),d==12&&(v=100*d+m,p=2),d!=19&&d!=20||(v=d,p=2),21<=d&&d<=27&&(v=d,p=1),d==28&&(y=f.readShort(n,r+1),p=3),29<=d&&d<=31&&(v=d,p=1),32<=d&&d<=246&&(y=d-139,p=1),247<=d&&d<=250&&(y=256*(d-247)+m+108,p=2),251<=d&&d<=254&&(y=256*-(d-251)-m-108,p=2),d==255&&(y=f.readInt(n,r+1)/65535,p=5),h.push(y??"o"+v),r+=p}return h},e.CFF.readDict=function(n,r,o){for(var u=e._bin,f={},h=[];r<o;){var d=n[r],m=n[r+1];n[r+2],n[r+3],n[r+4];var p=1,v=null,y=null;if(d==28&&(y=u.readShort(n,r+1),p=3),d==29&&(y=u.readInt(n,r+1),p=5),32<=d&&d<=246&&(y=d-139,p=1),247<=d&&d<=250&&(y=256*(d-247)+m+108,p=2),251<=d&&d<=254&&(y=256*-(d-251)-m-108,p=2),d==255)throw y=u.readInt(n,r+1)/65535,p=5,"unknown number";if(d==30){var T=[];for(p=1;;){var S=n[r+p];p++;var b=S>>4,C=15&S;if(b!=15&&T.push(b),C!=15&&T.push(C),C==15)break}for(var L="",D=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],_=0;_<T.length;_++)L+=D[T[_]];y=parseFloat(L)}d<=21&&(v=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][d],p=1,d==12&&(v=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][m],p=2)),v!=null?(f[v]=h.length==1?h[0]:h,h=[]):h.push(y),r+=p}return f},e.cmap={},e.cmap.parse=function(n,r,o){n=new Uint8Array(n.buffer,r,o),r=0;var u=e._bin,f={};u.readUshort(n,r),r+=2;var h=u.readUshort(n,r);r+=2;var d=[];f.tables=[];for(var m=0;m<h;m++){var p=u.readUshort(n,r);r+=2;var v=u.readUshort(n,r);r+=2;var y=u.readUint(n,r);r+=4;var T="p"+p+"e"+v,S=d.indexOf(y);if(S==-1){var b;S=f.tables.length,d.push(y);var C=u.readUshort(n,y);C==0?b=e.cmap.parse0(n,y):C==4?b=e.cmap.parse4(n,y):C==6?b=e.cmap.parse6(n,y):C==12?b=e.cmap.parse12(n,y):console.debug("unknown format: "+C,p,v,y),f.tables.push(b)}if(f[T]!=null)throw"multiple tables for one platform+encoding";f[T]=S}return f},e.cmap.parse0=function(n,r){var o=e._bin,u={};u.format=o.readUshort(n,r),r+=2;var f=o.readUshort(n,r);r+=2,o.readUshort(n,r),r+=2,u.map=[];for(var h=0;h<f-6;h++)u.map.push(n[r+h]);return u},e.cmap.parse4=function(n,r){var o=e._bin,u=r,f={};f.format=o.readUshort(n,r),r+=2;var h=o.readUshort(n,r);r+=2,o.readUshort(n,r),r+=2;var d=o.readUshort(n,r);r+=2;var m=d/2;f.searchRange=o.readUshort(n,r),r+=2,f.entrySelector=o.readUshort(n,r),r+=2,f.rangeShift=o.readUshort(n,r),r+=2,f.endCount=o.readUshorts(n,r,m),r+=2*m,r+=2,f.startCount=o.readUshorts(n,r,m),r+=2*m,f.idDelta=[];for(var p=0;p<m;p++)f.idDelta.push(o.readShort(n,r)),r+=2;for(f.idRangeOffset=o.readUshorts(n,r,m),r+=2*m,f.glyphIdArray=[];r<u+h;)f.glyphIdArray.push(o.readUshort(n,r)),r+=2;return f},e.cmap.parse6=function(n,r){var o=e._bin,u={};u.format=o.readUshort(n,r),r+=2,o.readUshort(n,r),r+=2,o.readUshort(n,r),r+=2,u.firstCode=o.readUshort(n,r),r+=2;var f=o.readUshort(n,r);r+=2,u.glyphIdArray=[];for(var h=0;h<f;h++)u.glyphIdArray.push(o.readUshort(n,r)),r+=2;return u},e.cmap.parse12=function(n,r){var o=e._bin,u={};u.format=o.readUshort(n,r),r+=2,r+=2,o.readUint(n,r),r+=4,o.readUint(n,r),r+=4;var f=o.readUint(n,r);r+=4,u.groups=[];for(var h=0;h<f;h++){var d=r+12*h,m=o.readUint(n,d+0),p=o.readUint(n,d+4),v=o.readUint(n,d+8);u.groups.push([m,p,v])}return u},e.glyf={},e.glyf.parse=function(n,r,o,u){for(var f=[],h=0;h<u.maxp.numGlyphs;h++)f.push(null);return f},e.glyf._parseGlyf=function(n,r){var o=e._bin,u=n._data,f=e._tabOffset(u,"glyf",n._offset)+n.loca[r];if(n.loca[r]==n.loca[r+1])return null;var h={};if(h.noc=o.readShort(u,f),f+=2,h.xMin=o.readShort(u,f),f+=2,h.yMin=o.readShort(u,f),f+=2,h.xMax=o.readShort(u,f),f+=2,h.yMax=o.readShort(u,f),f+=2,h.xMin>=h.xMax||h.yMin>=h.yMax)return null;if(h.noc>0){h.endPts=[];for(var d=0;d<h.noc;d++)h.endPts.push(o.readUshort(u,f)),f+=2;var m=o.readUshort(u,f);if(f+=2,u.length-f<m)return null;h.instructions=o.readBytes(u,f,m),f+=m;var p=h.endPts[h.noc-1]+1;for(h.flags=[],d=0;d<p;d++){var v=u[f];if(f++,h.flags.push(v),(8&v)!=0){var y=u[f];f++;for(var T=0;T<y;T++)h.flags.push(v),d++}}for(h.xs=[],d=0;d<p;d++){var S=(2&h.flags[d])!=0,b=(16&h.flags[d])!=0;S?(h.xs.push(b?u[f]:-u[f]),f++):b?h.xs.push(0):(h.xs.push(o.readShort(u,f)),f+=2)}for(h.ys=[],d=0;d<p;d++)S=(4&h.flags[d])!=0,b=(32&h.flags[d])!=0,S?(h.ys.push(b?u[f]:-u[f]),f++):b?h.ys.push(0):(h.ys.push(o.readShort(u,f)),f+=2);var C=0,L=0;for(d=0;d<p;d++)C+=h.xs[d],L+=h.ys[d],h.xs[d]=C,h.ys[d]=L}else{var D;h.parts=[];do{D=o.readUshort(u,f),f+=2;var _={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(h.parts.push(_),_.glyphIndex=o.readUshort(u,f),f+=2,1&D){var w=o.readShort(u,f);f+=2;var I=o.readShort(u,f);f+=2}else w=o.readInt8(u,f),f++,I=o.readInt8(u,f),f++;2&D?(_.m.tx=w,_.m.ty=I):(_.p1=w,_.p2=I),8&D?(_.m.a=_.m.d=o.readF2dot14(u,f),f+=2):64&D?(_.m.a=o.readF2dot14(u,f),f+=2,_.m.d=o.readF2dot14(u,f),f+=2):128&D&&(_.m.a=o.readF2dot14(u,f),f+=2,_.m.b=o.readF2dot14(u,f),f+=2,_.m.c=o.readF2dot14(u,f),f+=2,_.m.d=o.readF2dot14(u,f),f+=2)}while(32&D);if(256&D){var O=o.readUshort(u,f);for(f+=2,h.instr=[],d=0;d<O;d++)h.instr.push(u[f]),f++}}return h},e.GDEF={},e.GDEF.parse=function(n,r,o,u){var f=r;r+=4;var h=e._bin.readUshort(n,r);return{glyphClassDef:h===0?null:e._lctf.readClassDef(n,f+h)}},e.GPOS={},e.GPOS.parse=function(n,r,o,u){return e._lctf.parse(n,r,o,u,e.GPOS.subt)},e.GPOS.subt=function(n,r,o,u){var f=e._bin,h=o,d={};if(d.fmt=f.readUshort(n,o),o+=2,r==1||r==2||r==3||r==7||r==8&&d.fmt<=2){var m=f.readUshort(n,o);o+=2,d.coverage=e._lctf.readCoverage(n,m+h)}if(r==1&&d.fmt==1){var p=f.readUshort(n,o);o+=2,p!=0&&(d.pos=e.GPOS.readValueRecord(n,o,p))}else if(r==2&&d.fmt>=1&&d.fmt<=2){p=f.readUshort(n,o),o+=2;var v=f.readUshort(n,o);o+=2;var y=e._lctf.numOfOnes(p),T=e._lctf.numOfOnes(v);if(d.fmt==1){d.pairsets=[];var S=f.readUshort(n,o);o+=2;for(var b=0;b<S;b++){var C=h+f.readUshort(n,o);o+=2;var L=f.readUshort(n,C);C+=2;for(var D=[],_=0;_<L;_++){var w=f.readUshort(n,C);C+=2,p!=0&&(P=e.GPOS.readValueRecord(n,C,p),C+=2*y),v!=0&&(z=e.GPOS.readValueRecord(n,C,v),C+=2*T),D.push({gid2:w,val1:P,val2:z})}d.pairsets.push(D)}}if(d.fmt==2){var I=f.readUshort(n,o);o+=2;var O=f.readUshort(n,o);o+=2;var F=f.readUshort(n,o);o+=2;var M=f.readUshort(n,o);for(o+=2,d.classDef1=e._lctf.readClassDef(n,h+I),d.classDef2=e._lctf.readClassDef(n,h+O),d.matrix=[],b=0;b<F;b++){var H=[];for(_=0;_<M;_++){var P=null,z=null;p!=0&&(P=e.GPOS.readValueRecord(n,o,p),o+=2*y),v!=0&&(z=e.GPOS.readValueRecord(n,o,v),o+=2*T),H.push({val1:P,val2:z})}d.matrix.push(H)}}}else if(r==4&&d.fmt==1)d.markCoverage=e._lctf.readCoverage(n,f.readUshort(n,o)+h),d.baseCoverage=e._lctf.readCoverage(n,f.readUshort(n,o+2)+h),d.markClassCount=f.readUshort(n,o+4),d.markArray=e.GPOS.readMarkArray(n,f.readUshort(n,o+6)+h),d.baseArray=e.GPOS.readBaseArray(n,f.readUshort(n,o+8)+h,d.markClassCount);else if(r==6&&d.fmt==1)d.mark1Coverage=e._lctf.readCoverage(n,f.readUshort(n,o)+h),d.mark2Coverage=e._lctf.readCoverage(n,f.readUshort(n,o+2)+h),d.markClassCount=f.readUshort(n,o+4),d.mark1Array=e.GPOS.readMarkArray(n,f.readUshort(n,o+6)+h),d.mark2Array=e.GPOS.readBaseArray(n,f.readUshort(n,o+8)+h,d.markClassCount);else{if(r==9&&d.fmt==1){var Y=f.readUshort(n,o);o+=2;var Z=f.readUint(n,o);if(o+=4,u.ltype==9)u.ltype=Y;else if(u.ltype!=Y)throw"invalid extension substitution";return e.GPOS.subt(n,u.ltype,h+Z)}console.debug("unsupported GPOS table LookupType",r,"format",d.fmt)}return d},e.GPOS.readValueRecord=function(n,r,o){var u=e._bin,f=[];return f.push(1&o?u.readShort(n,r):0),r+=1&o?2:0,f.push(2&o?u.readShort(n,r):0),r+=2&o?2:0,f.push(4&o?u.readShort(n,r):0),r+=4&o?2:0,f.push(8&o?u.readShort(n,r):0),r+=8&o?2:0,f},e.GPOS.readBaseArray=function(n,r,o){var u=e._bin,f=[],h=r,d=u.readUshort(n,r);r+=2;for(var m=0;m<d;m++){for(var p=[],v=0;v<o;v++)p.push(e.GPOS.readAnchorRecord(n,h+u.readUshort(n,r))),r+=2;f.push(p)}return f},e.GPOS.readMarkArray=function(n,r){var o=e._bin,u=[],f=r,h=o.readUshort(n,r);r+=2;for(var d=0;d<h;d++){var m=e.GPOS.readAnchorRecord(n,o.readUshort(n,r+2)+f);m.markClass=o.readUshort(n,r),u.push(m),r+=4}return u},e.GPOS.readAnchorRecord=function(n,r){var o=e._bin,u={};return u.fmt=o.readUshort(n,r),u.x=o.readShort(n,r+2),u.y=o.readShort(n,r+4),u},e.GSUB={},e.GSUB.parse=function(n,r,o,u){return e._lctf.parse(n,r,o,u,e.GSUB.subt)},e.GSUB.subt=function(n,r,o,u){var f=e._bin,h=o,d={};if(d.fmt=f.readUshort(n,o),o+=2,r!=1&&r!=2&&r!=4&&r!=5&&r!=6)return null;if(r==1||r==2||r==4||r==5&&d.fmt<=2||r==6&&d.fmt<=2){var m=f.readUshort(n,o);o+=2,d.coverage=e._lctf.readCoverage(n,h+m)}if(r==1&&d.fmt>=1&&d.fmt<=2){if(d.fmt==1)d.delta=f.readShort(n,o),o+=2;else if(d.fmt==2){var p=f.readUshort(n,o);o+=2,d.newg=f.readUshorts(n,o,p),o+=2*d.newg.length}}else if(r==2&&d.fmt==1){p=f.readUshort(n,o),o+=2,d.seqs=[];for(var v=0;v<p;v++){var y=f.readUshort(n,o)+h;o+=2;var T=f.readUshort(n,y);d.seqs.push(f.readUshorts(n,y+2,T))}}else if(r==4)for(d.vals=[],p=f.readUshort(n,o),o+=2,v=0;v<p;v++){var S=f.readUshort(n,o);o+=2,d.vals.push(e.GSUB.readLigatureSet(n,h+S))}else if(r==5&&d.fmt==2){if(d.fmt==2){var b=f.readUshort(n,o);o+=2,d.cDef=e._lctf.readClassDef(n,h+b),d.scset=[];var C=f.readUshort(n,o);for(o+=2,v=0;v<C;v++){var L=f.readUshort(n,o);o+=2,d.scset.push(L==0?null:e.GSUB.readSubClassSet(n,h+L))}}}else if(r==6&&d.fmt==3){if(d.fmt==3){for(v=0;v<3;v++){p=f.readUshort(n,o),o+=2;for(var D=[],_=0;_<p;_++)D.push(e._lctf.readCoverage(n,h+f.readUshort(n,o+2*_)));o+=2*p,v==0&&(d.backCvg=D),v==1&&(d.inptCvg=D),v==2&&(d.ahedCvg=D)}p=f.readUshort(n,o),o+=2,d.lookupRec=e.GSUB.readSubstLookupRecords(n,o,p)}}else{if(r==7&&d.fmt==1){var w=f.readUshort(n,o);o+=2;var I=f.readUint(n,o);if(o+=4,u.ltype==9)u.ltype=w;else if(u.ltype!=w)throw"invalid extension substitution";return e.GSUB.subt(n,u.ltype,h+I)}console.debug("unsupported GSUB table LookupType",r,"format",d.fmt)}return d},e.GSUB.readSubClassSet=function(n,r){var o=e._bin.readUshort,u=r,f=[],h=o(n,r);r+=2;for(var d=0;d<h;d++){var m=o(n,r);r+=2,f.push(e.GSUB.readSubClassRule(n,u+m))}return f},e.GSUB.readSubClassRule=function(n,r){var o=e._bin.readUshort,u={},f=o(n,r),h=o(n,r+=2);r+=2,u.input=[];for(var d=0;d<f-1;d++)u.input.push(o(n,r)),r+=2;return u.substLookupRecords=e.GSUB.readSubstLookupRecords(n,r,h),u},e.GSUB.readSubstLookupRecords=function(n,r,o){for(var u=e._bin.readUshort,f=[],h=0;h<o;h++)f.push(u(n,r),u(n,r+2)),r+=4;return f},e.GSUB.readChainSubClassSet=function(n,r){var o=e._bin,u=r,f=[],h=o.readUshort(n,r);r+=2;for(var d=0;d<h;d++){var m=o.readUshort(n,r);r+=2,f.push(e.GSUB.readChainSubClassRule(n,u+m))}return f},e.GSUB.readChainSubClassRule=function(n,r){for(var o=e._bin,u={},f=["backtrack","input","lookahead"],h=0;h<f.length;h++){var d=o.readUshort(n,r);r+=2,h==1&&d--,u[f[h]]=o.readUshorts(n,r,d),r+=2*u[f[h]].length}return d=o.readUshort(n,r),r+=2,u.subst=o.readUshorts(n,r,2*d),r+=2*u.subst.length,u},e.GSUB.readLigatureSet=function(n,r){var o=e._bin,u=r,f=[],h=o.readUshort(n,r);r+=2;for(var d=0;d<h;d++){var m=o.readUshort(n,r);r+=2,f.push(e.GSUB.readLigature(n,u+m))}return f},e.GSUB.readLigature=function(n,r){var o=e._bin,u={chain:[]};u.nglyph=o.readUshort(n,r),r+=2;var f=o.readUshort(n,r);r+=2;for(var h=0;h<f-1;h++)u.chain.push(o.readUshort(n,r)),r+=2;return u},e.head={},e.head.parse=function(n,r,o){var u=e._bin,f={};return u.readFixed(n,r),r+=4,f.fontRevision=u.readFixed(n,r),r+=4,u.readUint(n,r),r+=4,u.readUint(n,r),r+=4,f.flags=u.readUshort(n,r),r+=2,f.unitsPerEm=u.readUshort(n,r),r+=2,f.created=u.readUint64(n,r),r+=8,f.modified=u.readUint64(n,r),r+=8,f.xMin=u.readShort(n,r),r+=2,f.yMin=u.readShort(n,r),r+=2,f.xMax=u.readShort(n,r),r+=2,f.yMax=u.readShort(n,r),r+=2,f.macStyle=u.readUshort(n,r),r+=2,f.lowestRecPPEM=u.readUshort(n,r),r+=2,f.fontDirectionHint=u.readShort(n,r),r+=2,f.indexToLocFormat=u.readShort(n,r),r+=2,f.glyphDataFormat=u.readShort(n,r),r+=2,f},e.hhea={},e.hhea.parse=function(n,r,o){var u=e._bin,f={};return u.readFixed(n,r),r+=4,f.ascender=u.readShort(n,r),r+=2,f.descender=u.readShort(n,r),r+=2,f.lineGap=u.readShort(n,r),r+=2,f.advanceWidthMax=u.readUshort(n,r),r+=2,f.minLeftSideBearing=u.readShort(n,r),r+=2,f.minRightSideBearing=u.readShort(n,r),r+=2,f.xMaxExtent=u.readShort(n,r),r+=2,f.caretSlopeRise=u.readShort(n,r),r+=2,f.caretSlopeRun=u.readShort(n,r),r+=2,f.caretOffset=u.readShort(n,r),r+=2,r+=8,f.metricDataFormat=u.readShort(n,r),r+=2,f.numberOfHMetrics=u.readUshort(n,r),r+=2,f},e.hmtx={},e.hmtx.parse=function(n,r,o,u){for(var f=e._bin,h={aWidth:[],lsBearing:[]},d=0,m=0,p=0;p<u.maxp.numGlyphs;p++)p<u.hhea.numberOfHMetrics&&(d=f.readUshort(n,r),r+=2,m=f.readShort(n,r),r+=2),h.aWidth.push(d),h.lsBearing.push(m);return h},e.kern={},e.kern.parse=function(n,r,o,u){var f=e._bin,h=f.readUshort(n,r);if(r+=2,h==1)return e.kern.parseV1(n,r-2,o,u);var d=f.readUshort(n,r);r+=2;for(var m={glyph1:[],rval:[]},p=0;p<d;p++){r+=2,o=f.readUshort(n,r),r+=2;var v=f.readUshort(n,r);r+=2;var y=v>>>8;if((y&=15)!=0)throw"unknown kern table format: "+y;r=e.kern.readFormat0(n,r,m)}return m},e.kern.parseV1=function(n,r,o,u){var f=e._bin;f.readFixed(n,r),r+=4;var h=f.readUint(n,r);r+=4;for(var d={glyph1:[],rval:[]},m=0;m<h;m++){f.readUint(n,r),r+=4;var p=f.readUshort(n,r);r+=2,f.readUshort(n,r),r+=2;var v=p>>>8;if((v&=15)!=0)throw"unknown kern table format: "+v;r=e.kern.readFormat0(n,r,d)}return d},e.kern.readFormat0=function(n,r,o){var u=e._bin,f=-1,h=u.readUshort(n,r);r+=2,u.readUshort(n,r),r+=2,u.readUshort(n,r),r+=2,u.readUshort(n,r),r+=2;for(var d=0;d<h;d++){var m=u.readUshort(n,r);r+=2;var p=u.readUshort(n,r);r+=2;var v=u.readShort(n,r);r+=2,m!=f&&(o.glyph1.push(m),o.rval.push({glyph2:[],vals:[]}));var y=o.rval[o.rval.length-1];y.glyph2.push(p),y.vals.push(v),f=m}return r},e.loca={},e.loca.parse=function(n,r,o,u){var f=e._bin,h=[],d=u.head.indexToLocFormat,m=u.maxp.numGlyphs+1;if(d==0)for(var p=0;p<m;p++)h.push(f.readUshort(n,r+(p<<1))<<1);if(d==1)for(p=0;p<m;p++)h.push(f.readUint(n,r+(p<<2)));return h},e.maxp={},e.maxp.parse=function(n,r,o){var u=e._bin,f={},h=u.readUint(n,r);return r+=4,f.numGlyphs=u.readUshort(n,r),r+=2,h==65536&&(f.maxPoints=u.readUshort(n,r),r+=2,f.maxContours=u.readUshort(n,r),r+=2,f.maxCompositePoints=u.readUshort(n,r),r+=2,f.maxCompositeContours=u.readUshort(n,r),r+=2,f.maxZones=u.readUshort(n,r),r+=2,f.maxTwilightPoints=u.readUshort(n,r),r+=2,f.maxStorage=u.readUshort(n,r),r+=2,f.maxFunctionDefs=u.readUshort(n,r),r+=2,f.maxInstructionDefs=u.readUshort(n,r),r+=2,f.maxStackElements=u.readUshort(n,r),r+=2,f.maxSizeOfInstructions=u.readUshort(n,r),r+=2,f.maxComponentElements=u.readUshort(n,r),r+=2,f.maxComponentDepth=u.readUshort(n,r),r+=2),f},e.name={},e.name.parse=function(n,r,o){var u=e._bin,f={};u.readUshort(n,r),r+=2;var h=u.readUshort(n,r);r+=2,u.readUshort(n,r);for(var d,m=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],p=r+=2,v=0;v<h;v++){var y=u.readUshort(n,r);r+=2;var T=u.readUshort(n,r);r+=2;var S=u.readUshort(n,r);r+=2;var b=u.readUshort(n,r);r+=2;var C=u.readUshort(n,r);r+=2;var L=u.readUshort(n,r);r+=2;var D,_=m[b],w=p+12*h+L;if(y==0)D=u.readUnicode(n,w,C/2);else if(y==3&&T==0)D=u.readUnicode(n,w,C/2);else if(T==0)D=u.readASCII(n,w,C);else if(T==1)D=u.readUnicode(n,w,C/2);else if(T==3)D=u.readUnicode(n,w,C/2);else{if(y!=1)throw"unknown encoding "+T+", platformID: "+y;D=u.readASCII(n,w,C),console.debug("reading unknown MAC encoding "+T+" as ASCII")}var I="p"+y+","+S.toString(16);f[I]==null&&(f[I]={}),f[I][_!==void 0?_:b]=D,f[I]._lang=S}for(var O in f)if(f[O].postScriptName!=null&&f[O]._lang==1033)return f[O];for(var O in f)if(f[O].postScriptName!=null&&f[O]._lang==0)return f[O];for(var O in f)if(f[O].postScriptName!=null&&f[O]._lang==3084)return f[O];for(var O in f)if(f[O].postScriptName!=null)return f[O];for(var O in f){d=O;break}return console.debug("returning name table with languageID "+f[d]._lang),f[d]},e["OS/2"]={},e["OS/2"].parse=function(n,r,o){var u=e._bin.readUshort(n,r);r+=2;var f={};if(u==0)e["OS/2"].version0(n,r,f);else if(u==1)e["OS/2"].version1(n,r,f);else if(u==2||u==3||u==4)e["OS/2"].version2(n,r,f);else{if(u!=5)throw"unknown OS/2 table version: "+u;e["OS/2"].version5(n,r,f)}return f},e["OS/2"].version0=function(n,r,o){var u=e._bin;return o.xAvgCharWidth=u.readShort(n,r),r+=2,o.usWeightClass=u.readUshort(n,r),r+=2,o.usWidthClass=u.readUshort(n,r),r+=2,o.fsType=u.readUshort(n,r),r+=2,o.ySubscriptXSize=u.readShort(n,r),r+=2,o.ySubscriptYSize=u.readShort(n,r),r+=2,o.ySubscriptXOffset=u.readShort(n,r),r+=2,o.ySubscriptYOffset=u.readShort(n,r),r+=2,o.ySuperscriptXSize=u.readShort(n,r),r+=2,o.ySuperscriptYSize=u.readShort(n,r),r+=2,o.ySuperscriptXOffset=u.readShort(n,r),r+=2,o.ySuperscriptYOffset=u.readShort(n,r),r+=2,o.yStrikeoutSize=u.readShort(n,r),r+=2,o.yStrikeoutPosition=u.readShort(n,r),r+=2,o.sFamilyClass=u.readShort(n,r),r+=2,o.panose=u.readBytes(n,r,10),r+=10,o.ulUnicodeRange1=u.readUint(n,r),r+=4,o.ulUnicodeRange2=u.readUint(n,r),r+=4,o.ulUnicodeRange3=u.readUint(n,r),r+=4,o.ulUnicodeRange4=u.readUint(n,r),r+=4,o.achVendID=[u.readInt8(n,r),u.readInt8(n,r+1),u.readInt8(n,r+2),u.readInt8(n,r+3)],r+=4,o.fsSelection=u.readUshort(n,r),r+=2,o.usFirstCharIndex=u.readUshort(n,r),r+=2,o.usLastCharIndex=u.readUshort(n,r),r+=2,o.sTypoAscender=u.readShort(n,r),r+=2,o.sTypoDescender=u.readShort(n,r),r+=2,o.sTypoLineGap=u.readShort(n,r),r+=2,o.usWinAscent=u.readUshort(n,r),r+=2,o.usWinDescent=u.readUshort(n,r),r+=2},e["OS/2"].version1=function(n,r,o){var u=e._bin;return r=e["OS/2"].version0(n,r,o),o.ulCodePageRange1=u.readUint(n,r),r+=4,o.ulCodePageRange2=u.readUint(n,r),r+=4},e["OS/2"].version2=function(n,r,o){var u=e._bin;return r=e["OS/2"].version1(n,r,o),o.sxHeight=u.readShort(n,r),r+=2,o.sCapHeight=u.readShort(n,r),r+=2,o.usDefault=u.readUshort(n,r),r+=2,o.usBreak=u.readUshort(n,r),r+=2,o.usMaxContext=u.readUshort(n,r),r+=2},e["OS/2"].version5=function(n,r,o){var u=e._bin;return r=e["OS/2"].version2(n,r,o),o.usLowerOpticalPointSize=u.readUshort(n,r),r+=2,o.usUpperOpticalPointSize=u.readUshort(n,r),r+=2},e.post={},e.post.parse=function(n,r,o){var u=e._bin,f={};return f.version=u.readFixed(n,r),r+=4,f.italicAngle=u.readFixed(n,r),r+=4,f.underlinePosition=u.readShort(n,r),r+=2,f.underlineThickness=u.readShort(n,r),r+=2,f},e==null&&(e={}),e.U==null&&(e.U={}),e.U.codeToGlyph=function(n,r){var o=n.cmap,u=-1;if(o.p0e4!=null?u=o.p0e4:o.p3e1!=null?u=o.p3e1:o.p1e0!=null?u=o.p1e0:o.p0e3!=null&&(u=o.p0e3),u==-1)throw"no familiar platform and encoding!";var f=o.tables[u];if(f.format==0)return r>=f.map.length?0:f.map[r];if(f.format==4){for(var h=-1,d=0;d<f.endCount.length;d++)if(r<=f.endCount[d]){h=d;break}return h==-1||f.startCount[h]>r?0:65535&(f.idRangeOffset[h]!=0?f.glyphIdArray[r-f.startCount[h]+(f.idRangeOffset[h]>>1)-(f.idRangeOffset.length-h)]:r+f.idDelta[h])}if(f.format==12){if(r>f.groups[f.groups.length-1][1])return 0;for(d=0;d<f.groups.length;d++){var m=f.groups[d];if(m[0]<=r&&r<=m[1])return m[2]+(r-m[0])}return 0}throw"unknown cmap table format "+f.format},e.U.glyphToPath=function(n,r){var o={cmds:[],crds:[]};if(n.SVG&&n.SVG.entries[r]){var u=n.SVG.entries[r];return u==null?o:(typeof u=="string"&&(u=e.SVG.toPath(u),n.SVG.entries[r]=u),u)}if(n.CFF){var f={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:n.CFF.Private?n.CFF.Private.defaultWidthX:0,open:!1},h=n.CFF,d=n.CFF.Private;if(h.ROS){for(var m=0;h.FDSelect[m+2]<=r;)m+=2;d=h.FDArray[h.FDSelect[m+1]].Private}e.U._drawCFF(n.CFF.CharStrings[r],f,h,d,o)}else n.glyf&&e.U._drawGlyf(r,n,o);return o},e.U._drawGlyf=function(n,r,o){var u=r.glyf[n];u==null&&(u=r.glyf[n]=e.glyf._parseGlyf(r,n)),u!=null&&(u.noc>-1?e.U._simpleGlyph(u,o):e.U._compoGlyph(u,r,o))},e.U._simpleGlyph=function(n,r){for(var o=0;o<n.noc;o++){for(var u=o==0?0:n.endPts[o-1]+1,f=n.endPts[o],h=u;h<=f;h++){var d=h==u?f:h-1,m=h==f?u:h+1,p=1&n.flags[h],v=1&n.flags[d],y=1&n.flags[m],T=n.xs[h],S=n.ys[h];if(h==u)if(p){if(!v){e.U.P.moveTo(r,T,S);continue}e.U.P.moveTo(r,n.xs[d],n.ys[d])}else v?e.U.P.moveTo(r,n.xs[d],n.ys[d]):e.U.P.moveTo(r,(n.xs[d]+T)/2,(n.ys[d]+S)/2);p?v&&e.U.P.lineTo(r,T,S):y?e.U.P.qcurveTo(r,T,S,n.xs[m],n.ys[m]):e.U.P.qcurveTo(r,T,S,(T+n.xs[m])/2,(S+n.ys[m])/2)}e.U.P.closePath(r)}},e.U._compoGlyph=function(n,r,o){for(var u=0;u<n.parts.length;u++){var f={cmds:[],crds:[]},h=n.parts[u];e.U._drawGlyf(h.glyphIndex,r,f);for(var d=h.m,m=0;m<f.crds.length;m+=2){var p=f.crds[m],v=f.crds[m+1];o.crds.push(p*d.a+v*d.b+d.tx),o.crds.push(p*d.c+v*d.d+d.ty)}for(m=0;m<f.cmds.length;m++)o.cmds.push(f.cmds[m])}},e.U._getGlyphClass=function(n,r){var o=e._lctf.getInterval(r,n);return o==-1?0:r[o+2]},e.U._applySubs=function(n,r,o,u){for(var f=n.length-r-1,h=0;h<o.tabs.length;h++)if(o.tabs[h]!=null){var d,m=o.tabs[h];if(!m.coverage||(d=e._lctf.coverageIndex(m.coverage,n[r]))!=-1){if(o.ltype==1)n[r],m.fmt==1?n[r]=n[r]+m.delta:n[r]=m.newg[d];else if(o.ltype==4)for(var p=m.vals[d],v=0;v<p.length;v++){var y=p[v],T=y.chain.length;if(!(T>f)){for(var S=!0,b=0,C=0;C<T;C++){for(;n[r+b+(1+C)]==-1;)b++;y.chain[C]!=n[r+b+(1+C)]&&(S=!1)}if(S){for(n[r]=y.nglyph,C=0;C<T+b;C++)n[r+C+1]=-1;break}}}else if(o.ltype==5&&m.fmt==2)for(var L=e._lctf.getInterval(m.cDef,n[r]),D=m.cDef[L+2],_=m.scset[D],w=0;w<_.length;w++){var I=_[w],O=I.input;if(!(O.length>f)){for(S=!0,C=0;C<O.length;C++){var F=e._lctf.getInterval(m.cDef,n[r+1+C]);if(L==-1&&m.cDef[F+2]!=O[C]){S=!1;break}}if(S){var M=I.substLookupRecords;for(v=0;v<M.length;v+=2)M[v],M[v+1]}}}else if(o.ltype==6&&m.fmt==3){if(!e.U._glsCovered(n,m.backCvg,r-m.backCvg.length)||!e.U._glsCovered(n,m.inptCvg,r)||!e.U._glsCovered(n,m.ahedCvg,r+m.inptCvg.length))continue;var H=m.lookupRec;for(w=0;w<H.length;w+=2){L=H[w];var P=u[H[w+1]];e.U._applySubs(n,r+L,P,u)}}}}},e.U._glsCovered=function(n,r,o){for(var u=0;u<r.length;u++)if(e._lctf.coverageIndex(r[u],n[o+u])==-1)return!1;return!0},e.U.glyphsToPath=function(n,r,o){for(var u={cmds:[],crds:[]},f=0,h=0;h<r.length;h++){var d=r[h];if(d!=-1){for(var m=h<r.length-1&&r[h+1]!=-1?r[h+1]:0,p=e.U.glyphToPath(n,d),v=0;v<p.crds.length;v+=2)u.crds.push(p.crds[v]+f),u.crds.push(p.crds[v+1]);for(o&&u.cmds.push(o),v=0;v<p.cmds.length;v++)u.cmds.push(p.cmds[v]);o&&u.cmds.push("X"),f+=n.hmtx.aWidth[d],h<r.length-1&&(f+=e.U.getPairAdjustment(n,d,m))}}return u},e.U.P={},e.U.P.moveTo=function(n,r,o){n.cmds.push("M"),n.crds.push(r,o)},e.U.P.lineTo=function(n,r,o){n.cmds.push("L"),n.crds.push(r,o)},e.U.P.curveTo=function(n,r,o,u,f,h,d){n.cmds.push("C"),n.crds.push(r,o,u,f,h,d)},e.U.P.qcurveTo=function(n,r,o,u,f){n.cmds.push("Q"),n.crds.push(r,o,u,f)},e.U.P.closePath=function(n){n.cmds.push("Z")},e.U._drawCFF=function(n,r,o,u,f){for(var h=r.stack,d=r.nStems,m=r.haveWidth,p=r.width,v=r.open,y=0,T=r.x,S=r.y,b=0,C=0,L=0,D=0,_=0,w=0,I=0,O=0,F=0,M=0,H={val:0,size:0};y<n.length;){e.CFF.getCharString(n,y,H);var P=H.val;if(y+=H.size,P=="o1"||P=="o18")h.length%2!=0&&!m&&(p=h.shift()+u.nominalWidthX),d+=h.length>>1,h.length=0,m=!0;else if(P=="o3"||P=="o23")h.length%2!=0&&!m&&(p=h.shift()+u.nominalWidthX),d+=h.length>>1,h.length=0,m=!0;else if(P=="o4")h.length>1&&!m&&(p=h.shift()+u.nominalWidthX,m=!0),v&&e.U.P.closePath(f),S+=h.pop(),e.U.P.moveTo(f,T,S),v=!0;else if(P=="o5")for(;h.length>0;)T+=h.shift(),S+=h.shift(),e.U.P.lineTo(f,T,S);else if(P=="o6"||P=="o7")for(var z=h.length,Y=P=="o6",Z=0;Z<z;Z++){var k=h.shift();Y?T+=k:S+=k,Y=!Y,e.U.P.lineTo(f,T,S)}else if(P=="o8"||P=="o24"){z=h.length;for(var K=0;K+6<=z;)b=T+h.shift(),C=S+h.shift(),L=b+h.shift(),D=C+h.shift(),T=L+h.shift(),S=D+h.shift(),e.U.P.curveTo(f,b,C,L,D,T,S),K+=6;P=="o24"&&(T+=h.shift(),S+=h.shift(),e.U.P.lineTo(f,T,S))}else{if(P=="o11")break;if(P=="o1234"||P=="o1235"||P=="o1236"||P=="o1237")P=="o1234"&&(C=S,L=(b=T+h.shift())+h.shift(),M=D=C+h.shift(),w=D,O=S,T=(I=(_=(F=L+h.shift())+h.shift())+h.shift())+h.shift(),e.U.P.curveTo(f,b,C,L,D,F,M),e.U.P.curveTo(f,_,w,I,O,T,S)),P=="o1235"&&(b=T+h.shift(),C=S+h.shift(),L=b+h.shift(),D=C+h.shift(),F=L+h.shift(),M=D+h.shift(),_=F+h.shift(),w=M+h.shift(),I=_+h.shift(),O=w+h.shift(),T=I+h.shift(),S=O+h.shift(),h.shift(),e.U.P.curveTo(f,b,C,L,D,F,M),e.U.P.curveTo(f,_,w,I,O,T,S)),P=="o1236"&&(b=T+h.shift(),C=S+h.shift(),L=b+h.shift(),M=D=C+h.shift(),w=D,I=(_=(F=L+h.shift())+h.shift())+h.shift(),O=w+h.shift(),T=I+h.shift(),e.U.P.curveTo(f,b,C,L,D,F,M),e.U.P.curveTo(f,_,w,I,O,T,S)),P=="o1237"&&(b=T+h.shift(),C=S+h.shift(),L=b+h.shift(),D=C+h.shift(),F=L+h.shift(),M=D+h.shift(),_=F+h.shift(),w=M+h.shift(),I=_+h.shift(),O=w+h.shift(),Math.abs(I-T)>Math.abs(O-S)?T=I+h.shift():S=O+h.shift(),e.U.P.curveTo(f,b,C,L,D,F,M),e.U.P.curveTo(f,_,w,I,O,T,S));else if(P=="o14"){if(h.length>0&&!m&&(p=h.shift()+o.nominalWidthX,m=!0),h.length==4){var Q=h.shift(),j=h.shift(),J=h.shift(),U=h.shift(),N=e.CFF.glyphBySE(o,J),V=e.CFF.glyphBySE(o,U);e.U._drawCFF(o.CharStrings[N],r,o,u,f),r.x=Q,r.y=j,e.U._drawCFF(o.CharStrings[V],r,o,u,f)}v&&(e.U.P.closePath(f),v=!1)}else if(P=="o19"||P=="o20")h.length%2!=0&&!m&&(p=h.shift()+u.nominalWidthX),d+=h.length>>1,h.length=0,m=!0,y+=d+7>>3;else if(P=="o21")h.length>2&&!m&&(p=h.shift()+u.nominalWidthX,m=!0),S+=h.pop(),T+=h.pop(),v&&e.U.P.closePath(f),e.U.P.moveTo(f,T,S),v=!0;else if(P=="o22")h.length>1&&!m&&(p=h.shift()+u.nominalWidthX,m=!0),T+=h.pop(),v&&e.U.P.closePath(f),e.U.P.moveTo(f,T,S),v=!0;else if(P=="o25"){for(;h.length>6;)T+=h.shift(),S+=h.shift(),e.U.P.lineTo(f,T,S);b=T+h.shift(),C=S+h.shift(),L=b+h.shift(),D=C+h.shift(),T=L+h.shift(),S=D+h.shift(),e.U.P.curveTo(f,b,C,L,D,T,S)}else if(P=="o26")for(h.length%2&&(T+=h.shift());h.length>0;)b=T,C=S+h.shift(),T=L=b+h.shift(),S=(D=C+h.shift())+h.shift(),e.U.P.curveTo(f,b,C,L,D,T,S);else if(P=="o27")for(h.length%2&&(S+=h.shift());h.length>0;)C=S,L=(b=T+h.shift())+h.shift(),D=C+h.shift(),T=L+h.shift(),S=D,e.U.P.curveTo(f,b,C,L,D,T,S);else if(P=="o10"||P=="o29"){var q=P=="o10"?u:o;if(h.length==0)console.debug("error: empty stack");else{var X=h.pop(),re=q.Subrs[X+q.Bias];r.x=T,r.y=S,r.nStems=d,r.haveWidth=m,r.width=p,r.open=v,e.U._drawCFF(re,r,o,u,f),T=r.x,S=r.y,d=r.nStems,m=r.haveWidth,p=r.width,v=r.open}}else if(P=="o30"||P=="o31"){var oe=h.length,le=(K=0,P=="o31");for(K+=oe-(z=-3&oe);K<z;)le?(C=S,L=(b=T+h.shift())+h.shift(),S=(D=C+h.shift())+h.shift(),z-K==5?(T=L+h.shift(),K++):T=L,le=!1):(b=T,C=S+h.shift(),L=b+h.shift(),D=C+h.shift(),T=L+h.shift(),z-K==5?(S=D+h.shift(),K++):S=D,le=!0),e.U.P.curveTo(f,b,C,L,D,T,S),K+=4}else{if((P+"").charAt(0)=="o")throw console.debug("Unknown operation: "+P,n),P;h.push(P)}}}r.x=T,r.y=S,r.nStems=d,r.haveWidth=m,r.width=p,r.open=v};var t=e,i={Typr:t};return l.Typr=t,l.default=i,Object.defineProperty(l,"__esModule",{value:!0}),l})({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function NC(){return(function(l){var e=Uint8Array,t=Uint16Array,i=Uint32Array,n=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),r=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u=function(P,z){for(var Y=new t(31),Z=0;Z<31;++Z)Y[Z]=z+=1<<P[Z-1];var k=new i(Y[30]);for(Z=1;Z<30;++Z)for(var K=Y[Z];K<Y[Z+1];++K)k[K]=K-Y[Z]<<5|Z;return[Y,k]},f=u(n,2),h=f[0],d=f[1];h[28]=258,d[258]=28;for(var m=u(r,0)[0],p=new t(32768),v=0;v<32768;++v){var y=(43690&v)>>>1|(21845&v)<<1;y=(61680&(y=(52428&y)>>>2|(13107&y)<<2))>>>4|(3855&y)<<4,p[v]=((65280&y)>>>8|(255&y)<<8)>>>1}var T=function(P,z,Y){for(var Z=P.length,k=0,K=new t(z);k<Z;++k)++K[P[k]-1];var Q,j=new t(z);for(k=0;k<z;++k)j[k]=j[k-1]+K[k-1]<<1;{Q=new t(1<<z);var J=15-z;for(k=0;k<Z;++k)if(P[k])for(var U=k<<4|P[k],N=z-P[k],V=j[P[k]-1]++<<N,q=V|(1<<N)-1;V<=q;++V)Q[p[V]>>>J]=U}return Q},S=new e(288);for(v=0;v<144;++v)S[v]=8;for(v=144;v<256;++v)S[v]=9;for(v=256;v<280;++v)S[v]=7;for(v=280;v<288;++v)S[v]=8;var b=new e(32);for(v=0;v<32;++v)b[v]=5;var C=T(S,9),L=T(b,5),D=function(P){for(var z=P[0],Y=1;Y<P.length;++Y)P[Y]>z&&(z=P[Y]);return z},_=function(P,z,Y){var Z=z/8|0;return(P[Z]|P[Z+1]<<8)>>(7&z)&Y},w=function(P,z){var Y=z/8|0;return(P[Y]|P[Y+1]<<8|P[Y+2]<<16)>>(7&z)},I=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],O=function(P,z,Y){var Z=new Error(z||I[P]);if(Z.code=P,Error.captureStackTrace&&Error.captureStackTrace(Z,O),!Y)throw Z;return Z},F=function(P,z,Y){var Z=P.length;if(!Z||Y&&!Y.l&&Z<5)return z||new e(0);var k=!z||Y,K=!Y||Y.i;Y||(Y={}),z||(z=new e(3*Z));var Q,j=function(we){var rt=z.length;if(we>rt){var Dt=new e(Math.max(2*rt,we));Dt.set(z),z=Dt}},J=Y.f||0,U=Y.p||0,N=Y.b||0,V=Y.l,q=Y.d,X=Y.m,re=Y.n,oe=8*Z;do{if(!V){Y.f=J=_(P,U,1);var le=_(P,U+1,3);if(U+=3,!le){var ve=P[(Te=((Q=U)/8|0)+(7&Q&&1)+4)-4]|P[Te-3]<<8,ye=Te+ve;if(ye>Z){K&&O(0);break}k&&j(N+ve),z.set(P.subarray(Te,ye),N),Y.b=N+=ve,Y.p=U=8*ye;continue}if(le==1)V=C,q=L,X=9,re=5;else if(le==2){var fe=_(P,U,31)+257,me=_(P,U+10,15)+4,Pe=fe+_(P,U+5,31)+1;U+=14;for(var Be=new e(Pe),Ce=new e(19),Ae=0;Ae<me;++Ae)Ce[o[Ae]]=_(P,U+3*Ae,7);U+=3*me;var Ee=D(Ce),pe=(1<<Ee)-1,Re=T(Ce,Ee);for(Ae=0;Ae<Pe;){var Te,de=Re[_(P,U,pe)];if(U+=15&de,(Te=de>>>4)<16)Be[Ae++]=Te;else{var He=0,Le=0;for(Te==16?(Le=3+_(P,U,3),U+=2,He=Be[Ae-1]):Te==17?(Le=3+_(P,U,7),U+=3):Te==18&&(Le=11+_(P,U,127),U+=7);Le--;)Be[Ae++]=He}}var Se=Be.subarray(0,fe),be=Be.subarray(fe);X=D(Se),re=D(be),V=T(Se,X),q=T(be,re)}else O(1);if(U>oe){K&&O(0);break}}k&&j(N+131072);for(var qe=(1<<X)-1,De=(1<<re)-1,Oe=U;;Oe=U){var Ne=(He=V[w(P,U)&qe])>>>4;if((U+=15&He)>oe){K&&O(0);break}if(He||O(2),Ne<256)z[N++]=Ne;else{if(Ne==256){Oe=U,V=null;break}var Ye=Ne-254;if(Ne>264){var ct=n[Ae=Ne-257];Ye=_(P,U,(1<<ct)-1)+h[Ae],U+=ct}var Bt=q[w(P,U)&De],Xe=Bt>>>4;if(Bt||O(3),U+=15&Bt,be=m[Xe],Xe>3&&(ct=r[Xe],be+=w(P,U)&(1<<ct)-1,U+=ct),U>oe){K&&O(0);break}k&&j(N+131072);for(var Ke=N+Ye;N<Ke;N+=4)z[N]=z[N-be],z[N+1]=z[N+1-be],z[N+2]=z[N+2-be],z[N+3]=z[N+3-be];N=Ke}}Y.l=V,Y.p=Oe,Y.b=N,V&&(J=1,Y.m=X,Y.d=q,Y.n=re)}while(!J);return N==z.length?z:(function(we,rt,Dt){(Dt==null||Dt>we.length)&&(Dt=we.length);var Ai=new(we instanceof t?t:we instanceof i?i:e)(Dt-rt);return Ai.set(we.subarray(rt,Dt)),Ai})(z,0,N)},M=new e(0),H=typeof TextDecoder<"u"&&new TextDecoder;try{H.decode(M,{stream:!0})}catch{}return l.convert_streams=function(P){var z=new DataView(P),Y=0;function Z(){var fe=z.getUint16(Y);return Y+=2,fe}function k(){var fe=z.getUint32(Y);return Y+=4,fe}function K(fe){ve.setUint16(ye,fe),ye+=2}function Q(fe){ve.setUint32(ye,fe),ye+=4}for(var j={signature:k(),flavor:k(),length:k(),numTables:Z(),reserved:Z(),totalSfntSize:k(),majorVersion:Z(),minorVersion:Z(),metaOffset:k(),metaLength:k(),metaOrigLength:k(),privOffset:k(),privLength:k()},J=0;Math.pow(2,J)<=j.numTables;)J++;J--;for(var U=16*Math.pow(2,J),N=16*j.numTables-U,V=12,q=[],X=0;X<j.numTables;X++)q.push({tag:k(),offset:k(),compLength:k(),origLength:k(),origChecksum:k()}),V+=16;var re,oe=new Uint8Array(12+16*q.length+q.reduce((function(fe,me){return fe+me.origLength+4}),0)),le=oe.buffer,ve=new DataView(le),ye=0;return Q(j.flavor),K(j.numTables),K(U),K(J),K(N),q.forEach((function(fe){Q(fe.tag),Q(fe.origChecksum),Q(V),Q(fe.origLength),fe.outOffset=V,(V+=fe.origLength)%4!=0&&(V+=4-V%4)})),q.forEach((function(fe){var me,Pe=P.slice(fe.offset,fe.offset+fe.compLength);if(fe.compLength!=fe.origLength){var Be=new Uint8Array(fe.origLength);me=new Uint8Array(Pe,2),F(me,Be)}else Be=new Uint8Array(Pe);oe.set(Be,fe.outOffset);var Ce=0;(V=fe.outOffset+fe.origLength)%4!=0&&(Ce=4-V%4),oe.set(new Uint8Array(Ce).buffer,fe.outOffset+fe.origLength),re=V+Ce})),le.slice(0,re)},Object.defineProperty(l,"__esModule",{value:!0}),l})({}).convert_streams}function GC(l,e){const t={M:2,L:2,Q:4,C:6,Z:0},i={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},n=1,r=2,o=4,u=8,f=16,h=32;let d;function m(I){if(!d){const O={R:r,L:n,D:o,C:f,U:h,T:u};d=new Map;for(let F in i){let M=0;i[F].split(",").forEach(H=>{let[P,z]=H.split("+");P=parseInt(P,36),z=z?parseInt(z,36):0,d.set(M+=P,O[F]);for(let Y=z;Y--;)d.set(++M,O[F])})}}return d.get(I)||h}const p=1,v=2,y=3,T=4,S=[null,"isol","init","fina","medi"];function b(I){const O=new Uint8Array(I.length);let F=h,M=p,H=-1;for(let P=0;P<I.length;P++){const z=I.codePointAt(P);let Y=m(z)|0,Z=p;Y&u||(F&(n|o|f)?Y&(r|o|f)?(Z=y,(M===p||M===y)&&O[H]++):Y&(n|h)&&(M===v||M===T)&&O[H]--:F&(r|h)&&(M===v||M===T)&&O[H]--,M=O[P]=Z,F=Y,H=P,z>65535&&P++)}return O}function C(I,O){const F=[];for(let H=0;H<O.length;H++){const P=O.codePointAt(H);P>65535&&H++,F.push(l.U.codeToGlyph(I,P))}const M=I.GSUB;if(M){const{lookupList:H,featureList:P}=M;let z;const Y=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,Z=[];P.forEach(k=>{if(Y.test(k.tag))for(let K=0;K<k.tab.length;K++){if(Z[k.tab[K]])continue;Z[k.tab[K]]=!0;const Q=H[k.tab[K]],j=/^(isol|init|fina|medi)$/.test(k.tag);j&&!z&&(z=b(O));for(let J=0;J<F.length;J++)(!z||!j||S[z[J]]===k.tag)&&l.U._applySubs(F,J,Q,H)}})}return F}function L(I,O){const F=new Int16Array(O.length*3);let M=0;for(;M<O.length;M++){const Y=O[M];if(Y===-1)continue;F[M*3+2]=I.hmtx.aWidth[Y];const Z=I.GPOS;if(Z){const k=Z.lookupList;for(let K=0;K<k.length;K++){const Q=k[K];for(let j=0;j<Q.tabs.length;j++){const J=Q.tabs[j];if(Q.ltype===1){if(l._lctf.coverageIndex(J.coverage,Y)!==-1&&J.pos){z(J.pos,M);break}}else if(Q.ltype===2){let U=null,N=H();if(N!==-1){const V=l._lctf.coverageIndex(J.coverage,O[N]);if(V!==-1){if(J.fmt===1){const q=J.pairsets[V];for(let X=0;X<q.length;X++)q[X].gid2===Y&&(U=q[X])}else if(J.fmt===2){const q=l.U._getGlyphClass(O[N],J.classDef1),X=l.U._getGlyphClass(Y,J.classDef2);U=J.matrix[q][X]}if(U){U.val1&&z(U.val1,N),U.val2&&z(U.val2,M);break}}}}else if(Q.ltype===4){const U=l._lctf.coverageIndex(J.markCoverage,Y);if(U!==-1){const N=H(P),V=N===-1?-1:l._lctf.coverageIndex(J.baseCoverage,O[N]);if(V!==-1){const q=J.markArray[U],X=J.baseArray[V][q.markClass];F[M*3]=X.x-q.x+F[N*3]-F[N*3+2],F[M*3+1]=X.y-q.y+F[N*3+1];break}}}else if(Q.ltype===6){const U=l._lctf.coverageIndex(J.mark1Coverage,Y);if(U!==-1){const N=H();if(N!==-1){const V=O[N];if(D(I,V)===3){const q=l._lctf.coverageIndex(J.mark2Coverage,V);if(q!==-1){const X=J.mark1Array[U],re=J.mark2Array[q][X.markClass];F[M*3]=re.x-X.x+F[N*3]-F[N*3+2],F[M*3+1]=re.y-X.y+F[N*3+1];break}}}}}}}}else if(I.kern&&!I.cff){const k=H();if(k!==-1){const K=I.kern.glyph1.indexOf(O[k]);if(K!==-1){const Q=I.kern.rval[K].glyph2.indexOf(Y);Q!==-1&&(F[k*3+2]+=I.kern.rval[K].vals[Q])}}}}return F;function H(Y){for(let Z=M-1;Z>=0;Z--)if(O[Z]!==-1&&(!Y||Y(O[Z])))return Z;return-1}function P(Y){return D(I,Y)===1}function z(Y,Z){for(let k=0;k<3;k++)F[Z*3+k]+=Y[k]||0}}function D(I,O){const F=I.GDEF&&I.GDEF.glyphClassDef;return F?l.U._getGlyphClass(O,F):0}function _(...I){for(let O=0;O<I.length;O++)if(typeof I[O]=="number")return I[O]}function w(I){const O=Object.create(null),F=I["OS/2"],M=I.hhea,H=I.head.unitsPerEm,P=_(F&&F.sTypoAscender,M&&M.ascender,H),z={unitsPerEm:H,ascender:P,descender:_(F&&F.sTypoDescender,M&&M.descender,0),capHeight:_(F&&F.sCapHeight,P),xHeight:_(F&&F.sxHeight,P),lineGap:_(F&&F.sTypoLineGap,M&&M.lineGap),supportsCodePoint(Y){return l.U.codeToGlyph(I,Y)>0},forEachGlyph(Y,Z,k,K){let Q=0;const j=1/z.unitsPerEm*Z,J=C(I,Y);let U=0;const N=L(I,J);return J.forEach((V,q)=>{if(V!==-1){let X=O[V];if(!X){const{cmds:re,crds:oe}=l.U.glyphToPath(I,V);let le="",ve=0;for(let Be=0,Ce=re.length;Be<Ce;Be++){const Ae=t[re[Be]];le+=re[Be];for(let Ee=1;Ee<=Ae;Ee++)le+=(Ee>1?",":"")+oe[ve++]}let ye,fe,me,Pe;if(oe.length){ye=fe=1/0,me=Pe=-1/0;for(let Be=0,Ce=oe.length;Be<Ce;Be+=2){let Ae=oe[Be],Ee=oe[Be+1];Ae<ye&&(ye=Ae),Ee<fe&&(fe=Ee),Ae>me&&(me=Ae),Ee>Pe&&(Pe=Ee)}}else ye=me=fe=Pe=0;X=O[V]={index:V,advanceWidth:I.hmtx.aWidth[V],xMin:ye,yMin:fe,xMax:me,yMax:Pe,path:le}}K.call(null,X,Q+N[q*3]*j,N[q*3+1]*j,U),Q+=N[q*3+2]*j,k&&(Q+=k*Z)}U+=Y.codePointAt(U)>65535?2:1}),Q}};return z}return function(O){const F=new Uint8Array(O,0,4),M=l._bin.readASCII(F,0,4);if(M==="wOFF")O=e(O);else if(M==="wOF2")throw new Error("woff2 fonts not supported");return w(l.parse(O)[0])}}const HC=so({name:"Typr Font Parser",dependencies:[PC,NC,GC],init(l,e,t){const i=l(),n=e();return t(i,n)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function KC(){return(function(l){var e=function(){this.buckets=new Map};e.prototype.add=function(L){var D=L>>5;this.buckets.set(D,(this.buckets.get(D)||0)|1<<(31&L))},e.prototype.has=function(L){var D=this.buckets.get(L>>5);return D!==void 0&&(D&1<<(31&L))!=0},e.prototype.serialize=function(){var L=[];return this.buckets.forEach((function(D,_){L.push((+_).toString(36)+":"+D.toString(36))})),L.join(",")},e.prototype.deserialize=function(L){var D=this;this.buckets.clear(),L.split(",").forEach((function(_){var w=_.split(":");D.buckets.set(parseInt(w[0],36),parseInt(w[1],36))}))};var t=Math.pow(2,8),i=t-1,n=~i;function r(L){var D=(function(w){return w&n})(L).toString(16),_=(function(w){return(w&n)+t-1})(L).toString(16);return"codepoint-index/plane"+(L>>16)+"/"+D+"-"+_+".json"}function o(L,D){var _=L&i,w=D.codePointAt(_/6|0);return((w=(w||48)-48)&1<<_%6)!=0}function u(L,D){var _;(_=L,_.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map((function(w){return w.split("-").map((function(I){return parseInt(I.trim(),16)}))}))).forEach((function(w){var I=w[0],O=w[1];O===void 0&&(O=I),D(I,O)}))}function f(L,D){u(L,(function(_,w){for(var I=_;I<=w;I++)D(I)}))}var h={},d={},m=new WeakMap,p="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function v(L){var D=m.get(L);return D||(D=new e,f(L.ranges,(function(_){return D.add(_)})),m.set(L,D)),D}var y,T=new Map;function S(L,D,_){return L[D]?D:L[_]?_:(function(w){for(var I in w)return I})(L)}function b(L,D){var _=D;if(!L.includes(_)){_=1/0;for(var w=0;w<L.length;w++)Math.abs(L[w]-D)<Math.abs(_-D)&&(_=L[w])}return _}function C(L){return y||(y=new Set,f("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",(function(D){y.add(D)}))),y.has(L)}return l.CodePointSet=e,l.clearCache=function(){h={},d={}},l.getFontsForString=function(L,D){D===void 0&&(D={});var _,w=D.lang;w===void 0&&(w=new RegExp("\\p{Script=Hangul}","u").test(_=L)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(_)?"ja":"en");var I=D.category;I===void 0&&(I="sans-serif");var O=D.style;O===void 0&&(O="normal");var F=D.weight;F===void 0&&(F=400);var M=(D.dataUrl||p).replace(/\/$/g,""),H=new Map,P=new Uint8Array(L.length),z={},Y={},Z=new Array(L.length),k=new Map,K=!1;function Q(U){var N=T.get(U);return N||(N=fetch(M+"/"+U).then((function(V){if(!V.ok)throw new Error(V.statusText);return V.json().then((function(q){if(!Array.isArray(q)||q[0]!==1)throw new Error("Incorrect schema version; need 1, got "+q[0]);return q[1]}))})).catch((function(V){if(M!==p)return K||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+M+'", trying default CDN. '+V.message),K=!0),M=p,T.delete(U),Q(U);throw V})),T.set(U,N)),N}for(var j=function(U){var N=L.codePointAt(U),V=r(N);Z[U]=V,h[V]||k.has(V)||k.set(V,Q(V).then((function(q){h[V]=q}))),N>65535&&(U++,J=U)},J=0;J<L.length;J++)j(J);return Promise.all(k.values()).then((function(){k.clear();for(var U=function(V){var q=L.codePointAt(V),X=null,re=h[Z[V]],oe=void 0;for(var le in re){var ve=Y[le];if(ve===void 0&&(ve=Y[le]=new RegExp(le).test(w||"en")),ve){for(var ye in oe=le,re[le])if(o(q,re[le][ye])){X=ye;break}break}}if(!X){e:for(var fe in re)if(fe!==oe){for(var me in re[fe])if(o(q,re[fe][me])){X=me;break e}}}X||(console.debug("No font coverage for U+"+q.toString(16)),X="latin"),Z[V]=X,d[X]||k.has(X)||k.set(X,Q("font-meta/"+X+".json").then((function(Pe){d[X]=Pe}))),q>65535&&(V++,N=V)},N=0;N<L.length;N++)U(N);return Promise.all(k.values())})).then((function(){for(var U,N=null,V=0;V<L.length;V++){var q=L.codePointAt(V);if(N&&(C(q)||v(N).has(q)))P[V]=P[V-1];else{N=d[Z[V]];var X=z[N.id];if(!X){var re=N.typeforms,oe=S(re,I,"sans-serif"),le=S(re[oe],O,"normal"),ve=b((U=re[oe])===null||U===void 0?void 0:U[le],F);X=z[N.id]=M+"/font-files/"+N.id+"/"+oe+"."+le+"."+ve+".woff"}var ye=H.get(X);ye==null&&(ye=H.size,H.set(X,ye)),P[V]=ye}q>65535&&(V++,P[V]=P[V-1])}return{fontUrls:Array.from(H.keys()),chars:P}}))},Object.defineProperty(l,"__esModule",{value:!0}),l})({})}function VC(l,e){const t=Object.create(null),i=Object.create(null);function n(o,u){const f=h=>{console.error(`Failure loading font ${o}`,h)};try{const h=new XMLHttpRequest;h.open("get",o,!0),h.responseType="arraybuffer",h.onload=function(){if(h.status>=400)f(new Error(h.statusText));else if(h.status>0)try{const d=l(h.response);d.src=o,u(d)}catch(d){f(d)}},h.onerror=f,h.send()}catch(h){f(h)}}function r(o,u){let f=t[o];f?u(f):i[o]?i[o].push(u):(i[o]=[u],n(o,h=>{h.src=o,t[o]=h,i[o].forEach(d=>d(h)),delete i[o]}))}return function(o,u,{lang:f,fonts:h=[],style:d="normal",weight:m="normal",unicodeFontsURL:p}={}){const v=new Uint8Array(o.length),y=[];o.length||C();const T=new Map,S=[];if(d!=="italic"&&(d="normal"),typeof m!="number"&&(m=m==="bold"?700:400),h&&!Array.isArray(h)&&(h=[h]),h=h.slice().filter(D=>!D.lang||D.lang.test(f)).reverse(),h.length){let I=0;(function O(F=0){for(let M=F,H=o.length;M<H;M++){const P=o.codePointAt(M);if(I===1&&y[v[M-1]].supportsCodePoint(P)||M>0&&/\s/.test(o[M]))v[M]=v[M-1],I===2&&(S[S.length-1][1]=M);else for(let z=v[M],Y=h.length;z<=Y;z++)if(z===Y){const Z=I===2?S[S.length-1]:S[S.length]=[M,M];Z[1]=M,I=2}else{v[M]=z;const{src:Z,unicodeRange:k}=h[z];if(!k||L(P,k)){const K=t[Z];if(!K){r(Z,()=>{O(M)});return}if(K.supportsCodePoint(P)){let Q=T.get(K);typeof Q!="number"&&(Q=y.length,y.push(K),T.set(K,Q)),v[M]=Q,I=1;break}}}P>65535&&M+1<H&&(v[M+1]=v[M],M++,I===2&&(S[S.length-1][1]=M))}b()})()}else S.push([0,o.length-1]),b();function b(){if(S.length){const D=S.map(_=>o.substring(_[0],_[1]+1)).join(`
`);e.getFontsForString(D,{lang:f||void 0,style:d,weight:m,dataUrl:p}).then(({fontUrls:_,chars:w})=>{const I=y.length;let O=0;S.forEach(M=>{for(let H=0,P=M[1]-M[0];H<=P;H++)v[M[0]+H]=w[O++]+I;O++});let F=0;_.forEach((M,H)=>{r(M,P=>{y[H+I]=P,++F===_.length&&C()})})})}else C()}function C(){u({chars:v,fonts:y})}function L(D,_){for(let w=0;w<_.length;w++){const[I,O=I]=_[w];if(I<=D&&D<=O)return!0}return!1}}}const $C=so({name:"FontResolver",dependencies:[VC,HC,KC],init(l,e,t){return l(e,t())}});function YC(l,e){const i=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,n="[^\\S\\u00A0]",r=new RegExp(`${n}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function o({text:y,lang:T,fonts:S,style:b,weight:C,preResolvedFonts:L,unicodeFontsURL:D},_){const w=({chars:I,fonts:O})=>{let F,M;const H=[];for(let P=0;P<I.length;P++)I[P]!==M?(M=I[P],H.push(F={start:P,end:P,fontObj:O[I[P]]})):F.end=P;_(H)};L?w(L):l(y,w,{lang:T,fonts:S,style:b,weight:C,unicodeFontsURL:D})}function u({text:y="",font:T,lang:S,sdfGlyphSize:b=64,fontSize:C=400,fontWeight:L=1,fontStyle:D="normal",letterSpacing:_=0,lineHeight:w="normal",maxWidth:I=1/0,direction:O,textAlign:F="left",textIndent:M=0,whiteSpace:H="normal",overflowWrap:P="normal",anchorX:z=0,anchorY:Y=0,metricsOnly:Z=!1,unicodeFontsURL:k,preResolvedFonts:K=null,includeCaretPositions:Q=!1,chunkedBoundsSize:j=8192,colorRanges:J=null},U){const N=m(),V={fontLoad:0,typesetting:0};y.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),y=y.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),C=+C,_=+_,I=+I,w=w||"normal",M=+M,o({text:y,lang:S,style:D,weight:L,fonts:typeof T=="string"?[{src:T}]:T,unicodeFontsURL:k,preResolvedFonts:K},q=>{V.fontLoad=m()-N;const X=isFinite(I);let re=null,oe=null,le=null,ve=null,ye=null,fe=null,me=null,Pe=null,Be=0,Ce=0,Ae=H!=="nowrap";const Ee=new Map,pe=m();let Re=M,Te=0,de=new p;const He=[de];q.forEach(De=>{const{fontObj:Oe}=De,{ascender:Ne,descender:Ye,unitsPerEm:ct,lineGap:Bt,capHeight:Xe,xHeight:Ke}=Oe;let we=Ee.get(Oe);if(!we){const Ve=C/ct,ft=w==="normal"?(Ne-Ye+Bt)*Ve:w*C,wi=(ft-(Ne-Ye)*Ve)/2,at=Math.min(ft,(Ne-Ye)*Ve),We=(Ne+Ye)/2*Ve+at/2;we={index:Ee.size,src:Oe.src,fontObj:Oe,fontSizeMult:Ve,unitsPerEm:ct,ascender:Ne*Ve,descender:Ye*Ve,capHeight:Xe*Ve,xHeight:Ke*Ve,lineHeight:ft,baseline:-wi-Ne*Ve,caretTop:We,caretBottom:We-at},Ee.set(Oe,we)}const{fontSizeMult:rt}=we,Dt=y.slice(De.start,De.end+1);let Ai,yt;Oe.forEachGlyph(Dt,C,_,(Ve,ft,wi,at)=>{ft+=Te,at+=De.start,Ai=ft,yt=Ve;const We=y.charAt(at),_t=Ve.advanceWidth*rt,It=de.count;let Je;if("isEmpty"in Ve||(Ve.isWhitespace=!!We&&new RegExp(n).test(We),Ve.canBreakAfter=!!We&&r.test(We),Ve.isEmpty=Ve.xMin===Ve.xMax||Ve.yMin===Ve.yMax||i.test(We)),!Ve.isWhitespace&&!Ve.isEmpty&&Ce++,Ae&&X&&!Ve.isWhitespace&&ft+_t+Re>I&&It){if(de.glyphAt(It-1).glyphObj.canBreakAfter)Je=new p,Re=-ft;else for(let zt=It;zt--;)if(zt===0&&P==="break-word"){Je=new p,Re=-ft;break}else if(de.glyphAt(zt).glyphObj.canBreakAfter){Je=de.splitAt(zt+1);const ai=Je.glyphAt(0).x;Re-=ai;for(let Kt=Je.count;Kt--;)Je.glyphAt(Kt).x-=ai;break}Je&&(de.isSoftWrapped=!0,de=Je,He.push(de),Be=I)}let Et=de.glyphAt(de.count);Et.glyphObj=Ve,Et.x=ft+Re,Et.y=wi,Et.width=_t,Et.charIndex=at,Et.fontData=we,We===`
`&&(de=new p,He.push(de),Re=-(ft+_t+_*C)+M)}),Te=Ai+yt.advanceWidth*rt+_*C});let Le=0;He.forEach(De=>{let Oe=!0;for(let Ne=De.count;Ne--;){const Ye=De.glyphAt(Ne);Oe&&!Ye.glyphObj.isWhitespace&&(De.width=Ye.x+Ye.width,De.width>Be&&(Be=De.width),Oe=!1);let{lineHeight:ct,capHeight:Bt,xHeight:Xe,baseline:Ke}=Ye.fontData;ct>De.lineHeight&&(De.lineHeight=ct);const we=Ke-De.baseline;we<0&&(De.baseline+=we,De.cap+=we,De.ex+=we),De.cap=Math.max(De.cap,De.baseline+Bt),De.ex=Math.max(De.ex,De.baseline+Xe)}De.baseline-=Le,De.cap-=Le,De.ex-=Le,Le+=De.lineHeight});let Se=0,be=0;if(z&&(typeof z=="number"?Se=-z:typeof z=="string"&&(Se=-Be*(z==="left"?0:z==="center"?.5:z==="right"?1:h(z)))),Y&&(typeof Y=="number"?be=-Y:typeof Y=="string"&&(be=Y==="top"?0:Y==="top-baseline"?-He[0].baseline:Y==="top-cap"?-He[0].cap:Y==="top-ex"?-He[0].ex:Y==="middle"?Le/2:Y==="bottom"?Le:Y==="bottom-baseline"?-He[He.length-1].baseline:h(Y)*Le)),!Z){const De=e.getEmbeddingLevels(y,O);re=new Uint16Array(Ce),oe=new Uint8Array(Ce),le=new Float32Array(Ce*2),ve={},me=[1/0,1/0,-1/0,-1/0],Pe=[],Q&&(fe=new Float32Array(y.length*4)),J&&(ye=new Uint8Array(Ce*3));let Oe=0,Ne=-1,Ye=-1,ct,Bt;if(He.forEach((Xe,Ke)=>{let{count:we,width:rt}=Xe;if(we>0){let Dt=0;for(let at=we;at--&&Xe.glyphAt(at).glyphObj.isWhitespace;)Dt++;let Ai=0,yt=0;if(F==="center")Ai=(Be-rt)/2;else if(F==="right")Ai=Be-rt;else if(F==="justify"&&Xe.isSoftWrapped){let at=0;for(let We=we-Dt;We--;)Xe.glyphAt(We).glyphObj.isWhitespace&&at++;yt=(Be-rt)/at}if(yt||Ai){let at=0;for(let We=0;We<we;We++){let _t=Xe.glyphAt(We);const It=_t.glyphObj;_t.x+=Ai+at,yt!==0&&It.isWhitespace&&We<we-Dt&&(at+=yt,_t.width+=yt)}}const Ve=e.getReorderSegments(y,De,Xe.glyphAt(0).charIndex,Xe.glyphAt(Xe.count-1).charIndex);for(let at=0;at<Ve.length;at++){const[We,_t]=Ve[at];let It=1/0,Je=-1/0;for(let Et=0;Et<we;Et++)if(Xe.glyphAt(Et).charIndex>=We){let zt=Et,ai=Et;for(;ai<we;ai++){let Kt=Xe.glyphAt(ai);if(Kt.charIndex>_t)break;ai<we-Dt&&(It=Math.min(It,Kt.x),Je=Math.max(Je,Kt.x+Kt.width))}for(let Kt=zt;Kt<ai;Kt++){const Ri=Xe.glyphAt(Kt);Ri.x=Je-(Ri.x+Ri.width-It)}break}}let ft;const wi=at=>ft=at;for(let at=0;at<we;at++){const We=Xe.glyphAt(at);ft=We.glyphObj;const _t=ft.index,It=De.levels[We.charIndex]&1;if(It){const Je=e.getMirroredCharacter(y[We.charIndex]);Je&&We.fontData.fontObj.forEachGlyph(Je,0,0,wi)}if(Q){const{charIndex:Je,fontData:Et}=We,zt=We.x+Se,ai=We.x+We.width+Se;fe[Je*4]=It?ai:zt,fe[Je*4+1]=It?zt:ai,fe[Je*4+2]=Xe.baseline+Et.caretBottom+be,fe[Je*4+3]=Xe.baseline+Et.caretTop+be;const Kt=Je-Ne;Kt>1&&d(fe,Ne,Kt),Ne=Je}if(J){const{charIndex:Je}=We;for(;Je>Ye;)Ye++,J.hasOwnProperty(Ye)&&(Bt=J[Ye])}if(!ft.isWhitespace&&!ft.isEmpty){const Je=Oe++,{fontSizeMult:Et,src:zt,index:ai}=We.fontData,Kt=ve[zt]||(ve[zt]={});Kt[_t]||(Kt[_t]={path:ft.path,pathBounds:[ft.xMin,ft.yMin,ft.xMax,ft.yMax]});const Ri=We.x+Se,mn=We.y+Xe.baseline+be;le[Je*2]=Ri,le[Je*2+1]=mn;const Ui=Ri+ft.xMin*Et,qi=mn+ft.yMin*Et,Rn=Ri+ft.xMax*Et,Wi=mn+ft.yMax*Et;Ui<me[0]&&(me[0]=Ui),qi<me[1]&&(me[1]=qi),Rn>me[2]&&(me[2]=Rn),Wi>me[3]&&(me[3]=Wi),Je%j===0&&(ct={start:Je,end:Je,rect:[1/0,1/0,-1/0,-1/0]},Pe.push(ct)),ct.end++;const kt=ct.rect;if(Ui<kt[0]&&(kt[0]=Ui),qi<kt[1]&&(kt[1]=qi),Rn>kt[2]&&(kt[2]=Rn),Wi>kt[3]&&(kt[3]=Wi),re[Je]=_t,oe[Je]=ai,J){const Mt=Je*3;ye[Mt]=Bt>>16&255,ye[Mt+1]=Bt>>8&255,ye[Mt+2]=Bt&255}}}}}),fe){const Xe=y.length-Ne;Xe>1&&d(fe,Ne,Xe)}}const qe=[];Ee.forEach(({index:De,src:Oe,unitsPerEm:Ne,ascender:Ye,descender:ct,lineHeight:Bt,capHeight:Xe,xHeight:Ke})=>{qe[De]={src:Oe,unitsPerEm:Ne,ascender:Ye,descender:ct,lineHeight:Bt,capHeight:Xe,xHeight:Ke}}),V.typesetting=m()-pe,U({glyphIds:re,glyphFontIndices:oe,glyphPositions:le,glyphData:ve,fontData:qe,caretPositions:fe,glyphColors:ye,chunkedBounds:Pe,fontSize:C,topBaseline:be+He[0].baseline,blockBounds:[Se,be-Le,Se+Be,be],visibleBounds:me,timings:V})})}function f(y,T){u({...y,metricsOnly:!0},S=>{const[b,C,L,D]=S.blockBounds;T({width:L-b,height:D-C})})}function h(y){let T=y.match(/^([\d.]+)%$/),S=T?parseFloat(T[1]):NaN;return isNaN(S)?0:S/100}function d(y,T,S){const b=y[T*4],C=y[T*4+1],L=y[T*4+2],D=y[T*4+3],_=(C-b)/S;for(let w=0;w<S;w++){const I=(T+w)*4;y[I]=b+_*w,y[I+1]=b+_*(w+1),y[I+2]=L,y[I+3]=D}}function m(){return(self.performance||Date).now()}function p(){this.data=[]}const v=["glyphObj","x","y","width","charIndex","fontData"];return p.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/v.length)},glyphAt(y){let T=p.flyweight;return T.data=this.data,T.index=y,T},splitAt(y){let T=new p;return T.data=this.data.splice(y*v.length),T}},p.flyweight=v.reduce((y,T,S,b)=>(Object.defineProperty(y,T,{get(){return this.data[this.index*v.length+S]},set(C){this.data[this.index*v.length+S]=C}}),y),{data:null,index:0}),{typeset:u,measure:f}}const $r=()=>(self.performance||Date).now(),Oc=nE();let dv;function zC(l,e,t,i,n,r,o,u,f,h,d=!0){return d?JC(l,e,t,i,n,r,o,u,f,h).then(null,m=>(dv||(console.warn("WebGL SDF generation failed, falling back to JS",m),dv=!0),mv(l,e,t,i,n,r,o,u,f,h))):mv(l,e,t,i,n,r,o,u,f,h)}const lc=[],jC=5;let Fd=0;function rE(){const l=$r();for(;lc.length&&$r()-l<jC;)lc.shift()();Fd=lc.length?setTimeout(rE,0):0}const JC=(...l)=>new Promise((e,t)=>{lc.push(()=>{const i=$r();try{Oc.webgl.generateIntoCanvas(...l),e({timing:$r()-i})}catch(n){t(n)}}),Fd||(Fd=setTimeout(rE,0))}),XC=4,QC=2e3,gv={};let qC=0;function mv(l,e,t,i,n,r,o,u,f,h){const d="TroikaTextSDFGenerator_JS_"+qC++%XC;let m=gv[d];return m||(m=gv[d]={workerModule:so({name:d,workerId:d,dependencies:[nE,$r],init(p,v){const y=p().javascript.generate;return function(...T){const S=v();return{textureData:y(...T),timing:v()-S}}},getTransferables(p){return[p.textureData.buffer]}}),requests:0,idleTimer:null}),m.requests++,clearTimeout(m.idleTimer),m.workerModule(l,e,t,i,n,r).then(({textureData:p,timing:v})=>{const y=$r(),T=new Uint8Array(p.length*4);for(let S=0;S<p.length;S++)T[S*4+h]=p[S];return Oc.webglUtils.renderImageData(o,T,u,f,l,e,1<<3-h),v+=$r()-y,--m.requests===0&&(m.idleTimer=setTimeout(()=>{DC(d)},QC)),{timing:v}})}function WC(l){l._warm||(Oc.webgl.isSupported(l),l._warm=!0)}const ZC=Oc.webglUtils.resizeWebGLCanvasWithoutClearing,ol={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},eR=new Qi;function Ga(){return(self.performance||Date).now()}const pv=Object.create(null);function aE(l,e){l=nR({},l);const t=Ga(),i=[];if(l.font&&i.push({label:"user",src:sR(l.font)}),l.font=i,l.text=""+l.text,l.sdfGlyphSize=l.sdfGlyphSize||ol.sdfGlyphSize,l.unicodeFontsURL=l.unicodeFontsURL||ol.unicodeFontsURL,l.colorRanges!=null){let p={};for(let v in l.colorRanges)if(l.colorRanges.hasOwnProperty(v)){let y=l.colorRanges[v];typeof y!="number"&&(y=eR.set(y).getHex()),p[v]=y}l.colorRanges=p}Object.freeze(l);const{textureWidth:n,sdfExponent:r}=ol,{sdfGlyphSize:o}=l,u=n/o*4;let f=pv[o];if(!f){const p=document.createElement("canvas");p.width=n,p.height=o*256/u,f=pv[o]={glyphCount:0,sdfGlyphSize:o,sdfCanvas:p,sdfTexture:new Cd(p,void 0,void 0,void 0,eo,eo),contextLost:!1,glyphsByFont:new Map},f.sdfTexture.generateMipmaps=!1,tR(f)}const{sdfTexture:h,sdfCanvas:d}=f;uE(l).then(p=>{const{glyphIds:v,glyphFontIndices:y,fontData:T,glyphPositions:S,fontSize:b,timings:C}=p,L=[],D=new Float32Array(v.length*4);let _=0,w=0;const I=Ga(),O=T.map(z=>{let Y=f.glyphsByFont.get(z.src);return Y||f.glyphsByFont.set(z.src,Y=new Map),Y});v.forEach((z,Y)=>{const Z=y[Y],{src:k,unitsPerEm:K}=T[Z];let Q=O[Z].get(z);if(!Q){const{path:V,pathBounds:q}=p.glyphData[k][z],X=Math.max(q[2]-q[0],q[3]-q[1])/o*(ol.sdfMargin*o+.5),re=f.glyphCount++,oe=[q[0]-X,q[1]-X,q[2]+X,q[3]+X];O[Z].set(z,Q={path:V,atlasIndex:re,sdfViewBox:oe}),L.push(Q)}const{sdfViewBox:j}=Q,J=S[w++],U=S[w++],N=b/K;D[_++]=J+j[0]*N,D[_++]=U+j[1]*N,D[_++]=J+j[2]*N,D[_++]=U+j[3]*N,v[Y]=Q.atlasIndex}),C.quads=(C.quads||0)+(Ga()-I);const F=Ga();C.sdf={};const M=d.height,H=Math.ceil(f.glyphCount/u),P=Math.pow(2,Math.ceil(Math.log2(H*o)));P>M&&(console.info(`Increasing SDF texture size ${M}->${P}`),ZC(d,n,P),h.dispose()),Promise.all(L.map(z=>oE(z,f,l.gpuAccelerateSDF).then(({timing:Y})=>{C.sdf[z.atlasIndex]=Y}))).then(()=>{L.length&&!f.contextLost&&(lE(f),h.needsUpdate=!0),C.sdfTotal=Ga()-F,C.total=Ga()-t,e(Object.freeze({parameters:l,sdfTexture:h,sdfGlyphSize:o,sdfExponent:r,glyphBounds:D,glyphAtlasIndices:v,glyphColors:p.glyphColors,caretPositions:p.caretPositions,chunkedBounds:p.chunkedBounds,ascender:p.ascender,descender:p.descender,lineHeight:p.lineHeight,capHeight:p.capHeight,xHeight:p.xHeight,topBaseline:p.topBaseline,blockBounds:p.blockBounds,visibleBounds:p.visibleBounds,timings:p.timings}))})}),Promise.resolve().then(()=>{f.contextLost||WC(d)})}function oE({path:l,atlasIndex:e,sdfViewBox:t},{sdfGlyphSize:i,sdfCanvas:n,contextLost:r},o){if(r)return Promise.resolve({timing:-1});const{textureWidth:u,sdfExponent:f}=ol,h=Math.max(t[2]-t[0],t[3]-t[1]),d=Math.floor(e/4),m=d%(u/i)*i,p=Math.floor(d/(u/i))*i,v=e%4;return zC(i,i,l,t,h,f,n,m,p,v,o)}function tR(l){const e=l.sdfCanvas;e.addEventListener("webglcontextlost",t=>{console.log("Context Lost",t),t.preventDefault(),l.contextLost=!0}),e.addEventListener("webglcontextrestored",t=>{console.log("Context Restored",t),l.contextLost=!1;const i=[];l.glyphsByFont.forEach(n=>{n.forEach(r=>{i.push(oE(r,l,!0))})}),Promise.all(i).then(()=>{lE(l),l.sdfTexture.needsUpdate=!0})})}function iR({font:l,characters:e,sdfGlyphSize:t},i){let n=Array.isArray(e)?e.join(`
`):""+e;aE({font:l,sdfGlyphSize:t,text:n},i)}function nR(l,e){for(let t in e)e.hasOwnProperty(t)&&(l[t]=e[t]);return l}let Ku;function sR(l){return Ku||(Ku=typeof document>"u"?{}:document.createElement("a")),Ku.href=l,Ku.href}function lE(l){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:e,sdfTexture:t}=l,{width:i,height:n}=e,r=l.sdfCanvas.getContext("webgl");let o=t.image.data;(!o||o.length!==i*n*4)&&(o=new Uint8Array(i*n*4),t.image={width:i,height:n,data:o},t.flipY=!1,t.isDataTexture=!0),r.readPixels(0,0,i,n,r.RGBA,r.UNSIGNED_BYTE,o)}}const rR=so({name:"Typesetter",dependencies:[YC,$C,IC],init(l,e,t){return l(e,t())}}),uE=so({name:"Typesetter",dependencies:[rR],init(l){return function(e){return new Promise(t=>{l.typeset(e,t)})}},getTransferables(l){const e=[];for(let t in l)l[t]&&l[t].buffer&&e.push(l[t].buffer);return e}});uE.onMainThread;const Av={};function aR(l){let e=Av[l];return e||(e=Av[l]=new lg(1,1,l,l).translate(.5,.5,0)),e}const oR="aTroikaGlyphBounds",vv="aTroikaGlyphIndex",lR="aTroikaGlyphColor";class uR extends Fb{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new jy,this.boundingBox=new og}computeBoundingSphere(){}computeBoundingBox(){}set detail(e){if(e!==this._detail){this._detail=e,(typeof e!="number"||e<1)&&(e=1);let t=aR(e);["position","normal","uv"].forEach(i=>{this.attributes[i]=t.attributes[i].clone()}),this.setIndex(t.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,t,i,n,r){this.updateAttributeData(oR,e,4),this.updateAttributeData(vv,t,1),this.updateAttributeData(lR,r,3),this._blockBounds=i,this._chunkedBounds=n,this.instanceCount=t.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:t,boundingBox:i}=this;if(t){const{PI:n,floor:r,min:o,max:u,sin:f,cos:h}=Math,d=n/2,m=n*2,p=Math.abs(t),v=e[0]/p,y=e[2]/p,T=r((v+d)/m)!==r((y+d)/m)?-p:o(f(v)*p,f(y)*p),S=r((v-d)/m)!==r((y-d)/m)?p:u(f(v)*p,f(y)*p),b=r((v+n)/m)!==r((y+n)/m)?p*2:u(p-h(v)*p,p-h(y)*p);i.min.set(T,e[1],t<0?-b:0),i.max.set(S,e[3],t<0?0:b)}else i.min.set(e[0],e[1],0),i.max.set(e[2],e[3],0);i.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let t=this.getAttribute(vv).count,i=this._chunkedBounds;if(i)for(let n=i.length;n--;){t=i[n].end;let r=i[n].rect;if(r[1]<e.w&&r[3]>e.y&&r[0]<e.z&&r[2]>e.x)break}this.instanceCount=t}updateAttributeData(e,t,i){const n=this.getAttribute(e);t?n&&n.array.length===t.length?(n.array.set(t),n.needsUpdate=!0):(this.setAttribute(e,new Hy(t,i)),delete this._maxInstanceCount,this.dispose()):n&&this.deleteAttribute(e)}}const cR=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,fR=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,hR=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,dR=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function gR(l){const e=Od(l,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new $n},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Za(0,0,0,0)},uTroikaClipRect:{value:new Za(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new $n},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Qi},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new kb},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:cR,vertexTransform:fR,fragmentDefs:hR,fragmentColorTransform:dR,customRewriter({vertexShader:t,fragmentShader:i}){let n=/\buniform\s+vec3\s+diffuse\b/;return n.test(i)&&(i=i.replace(n,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),n.test(t)||(t=t.replace(sE,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:t,fragmentShader:i}}});return e.transparent=!0,e.forceSinglePass=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}const fg=new za({color:16777215,side:ng,transparent:!0}),yv=8421504,Ev=new jr,Vu=new ei,qh=new ei,rl=[],mR=new ei,Wh="+x+y";function Tv(l){return Array.isArray(l)?l[0]:l}let cE=()=>{const l=new Mc(new lg(1,1),fg);return cE=()=>l,l},fE=()=>{const l=new Mc(new lg(1,1,32,1),fg);return fE=()=>l,l};const pR={type:"syncstart"},AR={type:"synccomplete"},hE=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],vR=hE.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let dE=class extends Mc{constructor(){const e=new uR;super(e,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=yv,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=Wh,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(pR),aE({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);const i=this._queuedSyncs;i&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{i.forEach(n=>n&&n())})),this.dispatchEvent(AR),e&&e()})))}onBeforeRender(e,t,i,n,r,o){this.sync(),r.isTroikaTextMaterial&&this._prepareForRender(r)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(e){return gR(e)}get material(){let e=this._derivedMaterial;const t=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=fg.clone());if((!e||!e.isDerivedFrom(t))&&(e=this._derivedMaterial=this.createDerivedMaterial(t),t.addEventListener("dispose",function i(){t.removeEventListener("dispose",i),e.dispose()})),this.hasOutline()){let i=e._outlineMtl;return i||(i=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),i.isTextOutlineMaterial=!0,i.depthWrite=!1,i.map=null,e.addEventListener("dispose",function n(){e.removeEventListener("dispose",n),i.dispose()})),[i,e]}else return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return Tv(this.material).getDepthMaterial()}set customDepthMaterial(e){}get customDistanceMaterial(){return Tv(this.material).getDistanceMaterial()}set customDistanceMaterial(e){}_prepareForRender(e){const t=e.isTextOutlineMaterial,i=e.uniforms,n=this.textRenderInfo;if(n){const{sdfTexture:u,blockBounds:f}=n;i.uTroikaSDFTexture.value=u,i.uTroikaSDFTextureSize.value.set(u.image.width,u.image.height),i.uTroikaSDFGlyphSize.value=n.sdfGlyphSize,i.uTroikaSDFExponent.value=n.sdfExponent,i.uTroikaTotalBounds.value.fromArray(f),i.uTroikaUseGlyphColors.value=!t&&!!n.glyphColors;let h=0,d=0,m=0,p,v,y,T=0,S=0;if(t){let{outlineWidth:C,outlineOffsetX:L,outlineOffsetY:D,outlineBlur:_,outlineOpacity:w}=this;h=this._parsePercent(C)||0,d=Math.max(0,this._parsePercent(_)||0),p=w,T=this._parsePercent(L)||0,S=this._parsePercent(D)||0}else m=Math.max(0,this._parsePercent(this.strokeWidth)||0),m&&(y=this.strokeColor,i.uTroikaStrokeColor.value.set(y??yv),v=this.strokeOpacity,v==null&&(v=1)),p=this.fillOpacity;i.uTroikaEdgeOffset.value=h,i.uTroikaPositionOffset.value.set(T,S),i.uTroikaBlurRadius.value=d,i.uTroikaStrokeWidth.value=m,i.uTroikaStrokeOpacity.value=v,i.uTroikaFillOpacity.value=p??1,i.uTroikaCurveRadius.value=this.curveRadius||0;let b=this.clipRect;if(b&&Array.isArray(b)&&b.length===4)i.uTroikaClipRect.value.fromArray(b);else{const C=(this.fontSize||.1)*100;i.uTroikaClipRect.value.set(f[0]-C,f[1]-C,f[2]+C,f[3]+C)}this.geometry.applyClipRect(i.uTroikaClipRect.value)}i.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const r=t?this.outlineColor||0:this.color;if(r==null)delete e.color;else{const u=e.hasOwnProperty("color")?e.color:e.color=new Qi;(r!==u._input||typeof r=="object")&&u.set(u._input=r)}let o=this.orientation||Wh;if(o!==e._orientation){let u=i.uTroikaOrient.value;o=o.replace(/[^-+xyz]/g,"");let f=o!==Wh&&o.match(/^([-+])([xyz])([-+])([xyz])$/);if(f){let[,h,d,m,p]=f;Vu.set(0,0,0)[d]=h==="-"?1:-1,qh.set(0,0,0)[p]=m==="-"?-1:1,Ev.lookAt(mR,Vu.cross(qh),qh),u.setFromMatrix4(Ev)}else u.identity();e._orientation=o}}_parsePercent(e){if(typeof e=="string"){let t=e.match(/^(-?[\d.]+)%$/),i=t?parseFloat(t[1]):NaN;e=(isNaN(i)?0:i/100)*this.fontSize}return e}localPositionToTextCoords(e,t=new $n){t.copy(e);const i=this.curveRadius;return i&&(t.x=Math.atan2(e.x,Math.abs(i)-Math.abs(e.z))*Math.abs(i)),t}worldPositionToTextCoords(e,t=new $n){return Vu.copy(e),this.localPositionToTextCoords(this.worldToLocal(Vu),t)}raycast(e,t){const{textRenderInfo:i,curveRadius:n}=this;if(i){const r=i.blockBounds,o=n?fE():cE(),u=o.geometry,{position:f,uv:h}=u.attributes;for(let d=0;d<h.count;d++){let m=r[0]+h.getX(d)*(r[2]-r[0]);const p=r[1]+h.getY(d)*(r[3]-r[1]);let v=0;n&&(v=n-Math.cos(m/n)*n,m=Math.sin(m/n)*n),f.setXYZ(d,m,p,v)}u.boundingSphere=this.geometry.boundingSphere,u.boundingBox=this.geometry.boundingBox,o.matrixWorld=this.matrixWorld,o.material.side=this.material.side,rl.length=0,o.raycast(e,rl);for(let d=0;d<rl.length;d++)rl[d].object=this,t.push(rl[d])}}copy(e){const t=this.geometry;return super.copy(e),this.geometry=t,vR.forEach(i=>{this[i]=e[i]}),this}clone(){return new this.constructor().copy(this)}};hE.forEach(l=>{const e="_private_"+l;Object.defineProperty(dE.prototype,l,{get(){return this[e]},set(t){t!==this[e]&&(this[e]=t,this._needsSync=!0)}})});new og;new Qi;const RB=Ie.forwardRef(({sdfGlyphSize:l=64,anchorX:e="center",anchorY:t="middle",font:i,fontSize:n=1,children:r,characters:o,onSync:u,...f},h)=>{const d=_s(({invalidate:y})=>y),[m]=Ie.useState(()=>new dE),[p,v]=Ie.useMemo(()=>{const y=[];let T="";return Ie.Children.forEach(r,S=>{typeof S=="string"||typeof S=="number"?T+=S:y.push(S)}),[y,T]},[r]);return Py(()=>new Promise(y=>iR({font:i,characters:o},y)),["troika-text",i,o]),Ie.useLayoutEffect(()=>void m.sync(()=>{d(),u&&u(m)})),Ie.useEffect(()=>()=>m.dispose(),[m]),Ie.createElement("primitive",yl({object:m,ref:h,font:i,text:v,anchorX:e,anchorY:t,fontSize:n,sdfGlyphSize:l},f),p)});function LB(l,e,t,i){var n;return n=class extends wb{constructor(r){super({vertexShader:e,fragmentShader:t,...r});for(const o in l)this.uniforms[o]=new Ub(l[o]),Object.defineProperty(this,o,{get(){return this.uniforms[o].value},set(u){this.uniforms[o].value=u}});this.uniforms=Jy.clone(this.uniforms)}},n.key=ag.generateUUID(),n}let $u=null,gE="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function mE(l=!0,e=!0,t){return i=>{t&&t(i),l&&($u||($u=new SC),$u.setDecoderPath(typeof l=="string"?l:gE),i.setDRACOLoader($u)),e&&i.setMeshoptDecoder(typeof Xh=="function"?Xh():Xh)}}const hg=(l,e,t,i)=>ig(cg,l,mE(e,t,i));hg.preload=(l,e,t,i)=>ig.preload(cg,l,mE(e,t,i));hg.clear=l=>ig.clear(cg,l);hg.setDecoderPath=l=>{gE=l};function yR(l,e,t){const i=_s(v=>v.size),n=_s(v=>v.viewport),r=typeof l=="number"?l:i.width*n.dpr,o=typeof e=="number"?e:i.height*n.dpr,u=(typeof l=="number"?t:l)||{},{samples:f=0,depth:h,...d}=u,m=h??u.depthBuffer,p=Ie.useMemo(()=>{const v=new Pb(r,o,{minFilter:eo,magFilter:eo,type:Nb,...d});return m&&(v.depthTexture=new Gb(r,o,Hb)),v.samples=f,v},[]);return Ie.useLayoutEffect(()=>{p.setSize(r,o),f&&(p.samples=f)},[f,p,r,o]),Ie.useEffect(()=>()=>p.dispose(),[]),p}const ER=l=>typeof l=="function",DB=Ie.forwardRef(({envMap:l,resolution:e=256,frames:t=1/0,makeDefault:i,children:n,...r},o)=>{const u=_s(({set:S})=>S),f=_s(({camera:S})=>S),h=_s(({size:S})=>S),d=Ie.useRef(null);Ie.useImperativeHandle(o,()=>d.current,[]);const m=Ie.useRef(null),p=yR(e);Ie.useLayoutEffect(()=>{r.manual||(d.current.aspect=h.width/h.height)},[h,r]),Ie.useLayoutEffect(()=>{d.current.updateProjectionMatrix()});let v=0,y=null;const T=ER(n);return Bc(S=>{T&&(t===1/0||v<t)&&(m.current.visible=!1,S.gl.setRenderTarget(p),y=S.scene.background,l&&(S.scene.background=l),S.gl.render(S.scene,d.current),S.scene.background=y,S.gl.setRenderTarget(null),m.current.visible=!0,v++)}),Ie.useLayoutEffect(()=>{if(i){const S=f;return u(()=>({camera:d.current})),()=>u(()=>({camera:S}))}},[d,i,u]),Ie.createElement(Ie.Fragment,null,Ie.createElement("perspectiveCamera",yl({ref:d},r),!T&&n),Ie.createElement("group",{ref:m},T&&n(p.texture)))}),TR="modulepreload",SR=function(l,e){return new URL(l,e).href},Sv={},bR=function(e,t,i){let n=Promise.resolve();if(t&&t.length>0){let h=function(d){return Promise.all(d.map(m=>Promise.resolve(m).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};const o=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),f=u?.nonce||u?.getAttribute("nonce");n=h(t.map(d=>{if(d=SR(d,i),d in Sv)return;Sv[d]=!0;const m=d.endsWith(".css"),p=m?'[rel="stylesheet"]':"";if(i)for(let y=o.length-1;y>=0;y--){const T=o[y];if(T.href===d&&(!m||T.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${p}`))return;const v=document.createElement("link");if(v.rel=m?"stylesheet":TR,m||(v.as="script"),v.crossOrigin="",v.href=d,f&&v.setAttribute("nonce",f),document.head.appendChild(v),m)return new Promise((y,T)=>{v.addEventListener("load",y),v.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${d}`)))})}))}function r(o){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=o,window.dispatchEvent(u),!u.defaultPrevented)throw o}return n.then(o=>{for(const u of o||[])u.status==="rejected"&&r(u.reason);return e().catch(r)})},xe=Number.isFinite||function(l){return typeof l=="number"&&isFinite(l)},xR=Number.isSafeInteger||function(l){return typeof l=="number"&&Math.abs(l)<=CR},CR=Number.MAX_SAFE_INTEGER||9007199254740991;let ke=(function(l){return l.NETWORK_ERROR="networkError",l.MEDIA_ERROR="mediaError",l.KEY_SYSTEM_ERROR="keySystemError",l.MUX_ERROR="muxError",l.OTHER_ERROR="otherError",l})({}),te=(function(l){return l.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",l.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",l.KEY_SYSTEM_NO_SESSION="keySystemNoSession",l.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",l.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",l.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",l.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",l.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",l.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",l.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",l.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",l.MANIFEST_LOAD_ERROR="manifestLoadError",l.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",l.MANIFEST_PARSING_ERROR="manifestParsingError",l.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",l.LEVEL_EMPTY_ERROR="levelEmptyError",l.LEVEL_LOAD_ERROR="levelLoadError",l.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",l.LEVEL_PARSING_ERROR="levelParsingError",l.LEVEL_SWITCH_ERROR="levelSwitchError",l.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",l.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",l.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",l.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",l.FRAG_LOAD_ERROR="fragLoadError",l.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",l.FRAG_DECRYPT_ERROR="fragDecryptError",l.FRAG_PARSING_ERROR="fragParsingError",l.FRAG_GAP="fragGap",l.REMUX_ALLOC_ERROR="remuxAllocError",l.KEY_LOAD_ERROR="keyLoadError",l.KEY_LOAD_TIMEOUT="keyLoadTimeOut",l.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",l.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",l.BUFFER_APPEND_ERROR="bufferAppendError",l.BUFFER_APPENDING_ERROR="bufferAppendingError",l.BUFFER_STALLED_ERROR="bufferStalledError",l.BUFFER_FULL_ERROR="bufferFullError",l.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",l.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",l.ASSET_LIST_LOAD_ERROR="assetListLoadError",l.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",l.ASSET_LIST_PARSING_ERROR="assetListParsingError",l.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",l.INTERNAL_EXCEPTION="internalException",l.INTERNAL_ABORTED="aborted",l.ATTACH_MEDIA_ERROR="attachMediaError",l.UNKNOWN="unknown",l})({}),R=(function(l){return l.MEDIA_ATTACHING="hlsMediaAttaching",l.MEDIA_ATTACHED="hlsMediaAttached",l.MEDIA_DETACHING="hlsMediaDetaching",l.MEDIA_DETACHED="hlsMediaDetached",l.MEDIA_ENDED="hlsMediaEnded",l.STALL_RESOLVED="hlsStallResolved",l.BUFFER_RESET="hlsBufferReset",l.BUFFER_CODECS="hlsBufferCodecs",l.BUFFER_CREATED="hlsBufferCreated",l.BUFFER_APPENDING="hlsBufferAppending",l.BUFFER_APPENDED="hlsBufferAppended",l.BUFFER_EOS="hlsBufferEos",l.BUFFERED_TO_END="hlsBufferedToEnd",l.BUFFER_FLUSHING="hlsBufferFlushing",l.BUFFER_FLUSHED="hlsBufferFlushed",l.MANIFEST_LOADING="hlsManifestLoading",l.MANIFEST_LOADED="hlsManifestLoaded",l.MANIFEST_PARSED="hlsManifestParsed",l.LEVEL_SWITCHING="hlsLevelSwitching",l.LEVEL_SWITCHED="hlsLevelSwitched",l.LEVEL_LOADING="hlsLevelLoading",l.LEVEL_LOADED="hlsLevelLoaded",l.LEVEL_UPDATED="hlsLevelUpdated",l.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",l.LEVELS_UPDATED="hlsLevelsUpdated",l.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",l.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",l.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",l.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",l.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",l.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",l.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",l.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",l.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",l.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",l.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",l.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",l.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",l.CUES_PARSED="hlsCuesParsed",l.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",l.INIT_PTS_FOUND="hlsInitPtsFound",l.FRAG_LOADING="hlsFragLoading",l.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",l.FRAG_LOADED="hlsFragLoaded",l.FRAG_DECRYPTED="hlsFragDecrypted",l.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",l.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",l.FRAG_PARSING_METADATA="hlsFragParsingMetadata",l.FRAG_PARSED="hlsFragParsed",l.FRAG_BUFFERED="hlsFragBuffered",l.FRAG_CHANGED="hlsFragChanged",l.FPS_DROP="hlsFpsDrop",l.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",l.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",l.ERROR="hlsError",l.DESTROYING="hlsDestroying",l.KEY_LOADING="hlsKeyLoading",l.KEY_LOADED="hlsKeyLoaded",l.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",l.BACK_BUFFER_REACHED="hlsBackBufferReached",l.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",l.ASSET_LIST_LOADING="hlsAssetListLoading",l.ASSET_LIST_LOADED="hlsAssetListLoaded",l.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",l.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",l.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",l.INTERSTITIAL_STARTED="hlsInterstitialStarted",l.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",l.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",l.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",l.INTERSTITIAL_ENDED="hlsInterstitialEnded",l.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",l.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",l.EVENT_CUE_ENTER="hlsEventCueEnter",l})({});var tt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},_e={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Ha{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){const i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class RR{constructor(e,t,i,n=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ha(e),this.fast_=new Ha(t),this.defaultTTFB_=n,this.ttfb_=new Ha(e)}update(e,t){const{slow_:i,fast_:n,ttfb_:r}=this;i.halfLife!==e&&(this.slow_=new Ha(e,i.getEstimate(),i.getTotalWeight())),n.halfLife!==t&&(this.fast_=new Ha(t,n.getEstimate(),n.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new Ha(e,r.getEstimate(),r.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const i=8*t,n=e/1e3,r=i/n;this.fast_.sample(n,r),this.slow_.sample(n,r)}sampleTTFB(e){const t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function LR(l,e,t){return(e=_R(e))in l?Object.defineProperty(l,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):l[e]=t,l}function xt(){return xt=Object.assign?Object.assign.bind():function(l){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(l[i]=t[i])}return l},xt.apply(null,arguments)}function bv(l,e){var t=Object.keys(l);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(l);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(l,n).enumerable})),t.push.apply(t,i)}return t}function At(l){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?bv(Object(t),!0).forEach(function(i){LR(l,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(t)):bv(Object(t)).forEach(function(i){Object.defineProperty(l,i,Object.getOwnPropertyDescriptor(t,i))})}return l}function DR(l,e){if(typeof l!="object"||!l)return l;var t=l[Symbol.toPrimitive];if(t!==void 0){var i=t.call(l,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(l)}function _R(l){var e=DR(l,"string");return typeof e=="symbol"?e:e+""}class gn{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const i=`[${e}]:`;this.trace=lr,this.debug=t.debug.bind(null,i),this.log=t.log.bind(null,i),this.warn=t.warn.bind(null,i),this.info=t.info.bind(null,i),this.error=t.error.bind(null,i)}}const lr=function(){},IR={trace:lr,debug:lr,log:lr,warn:lr,info:lr,error:lr};function kd(){return xt({},IR)}function BR(l,e){const t=self.console[l];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${l}] >`):lr}function xv(l,e,t){return e[l]?e[l].bind(e):BR(l,t)}const wd=kd();function MR(l,e,t){const i=kd();if(typeof console=="object"&&l===!0||typeof l=="object"){const n=["debug","log","info","warn","error"];n.forEach(r=>{i[r]=xv(r,l,t)});try{i.log(`Debug logs enabled for "${e}" in hls.js version 1.6.13`)}catch{return kd()}n.forEach(r=>{wd[r]=xv(r,l)})}else xt(wd,i);return i}const vt=wd;function Bs(l=!0){return typeof self>"u"?void 0:(l||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function OR(l){return typeof self<"u"&&l===self.ManagedMediaSource}function pE(l,e){const t=Object.keys(l),i=Object.keys(e),n=t.length,r=i.length;return!n||!r||n===r&&!t.some(o=>i.indexOf(o)===-1)}function Xi(l,e=!1){if(typeof TextDecoder<"u"){const h=new TextDecoder("utf-8").decode(l);if(e){const d=h.indexOf("\0");return d!==-1?h.substring(0,d):h}return h.replace(/\0/g,"")}const t=l.length;let i,n,r,o="",u=0;for(;u<t;){if(i=l[u++],i===0&&e)return o;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(i);break;case 12:case 13:n=l[u++],o+=String.fromCharCode((i&31)<<6|n&63);break;case 14:n=l[u++],r=l[u++],o+=String.fromCharCode((i&15)<<12|(n&63)<<6|(r&63)<<0);break}}return o}function xi(l){let e="";for(let t=0;t<l.length;t++){let i=l[t].toString(16);i.length<2&&(i="0"+i),e+=i}return e}function AE(l){return Uint8Array.from(l.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function FR(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var Zh={exports:{}},Cv;function kR(){return Cv||(Cv=1,(function(l,e){(function(t){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,u={buildAbsoluteURL:function(f,h,d){if(d=d||{},f=f.trim(),h=h.trim(),!h){if(!d.alwaysNormalize)return f;var m=u.parseURL(f);if(!m)throw new Error("Error trying to parse base URL.");return m.path=u.normalizePath(m.path),u.buildURLFromParts(m)}var p=u.parseURL(h);if(!p)throw new Error("Error trying to parse relative URL.");if(p.scheme)return d.alwaysNormalize?(p.path=u.normalizePath(p.path),u.buildURLFromParts(p)):h;var v=u.parseURL(f);if(!v)throw new Error("Error trying to parse base URL.");if(!v.netLoc&&v.path&&v.path[0]!=="/"){var y=n.exec(v.path);v.netLoc=y[1],v.path=y[2]}v.netLoc&&!v.path&&(v.path="/");var T={scheme:v.scheme,netLoc:p.netLoc,path:null,params:p.params,query:p.query,fragment:p.fragment};if(!p.netLoc&&(T.netLoc=v.netLoc,p.path[0]!=="/"))if(!p.path)T.path=v.path,p.params||(T.params=v.params,p.query||(T.query=v.query));else{var S=v.path,b=S.substring(0,S.lastIndexOf("/")+1)+p.path;T.path=u.normalizePath(b)}return T.path===null&&(T.path=d.alwaysNormalize?u.normalizePath(p.path):p.path),u.buildURLFromParts(T)},parseURL:function(f){var h=i.exec(f);return h?{scheme:h[1]||"",netLoc:h[2]||"",path:h[3]||"",params:h[4]||"",query:h[5]||"",fragment:h[6]||""}:null},normalizePath:function(f){for(f=f.split("").reverse().join("").replace(r,"");f.length!==(f=f.replace(o,"")).length;);return f.split("").reverse().join("")},buildURLFromParts:function(f){return f.scheme+f.netLoc+f.path+f.params+f.query+f.fragment}};l.exports=u})()})(Zh)),Zh.exports}var dg=kR();class Fc{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Rt={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class gg{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,wR(this,"stats")}setByteRange(e,t){const i=e.split("@",2);let n;i.length===1?n=t?.byteRangeEndOffset||0:n=parseInt(i[1]),this._byteRange=[n,parseInt(i[0])+n]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Rt.AUDIO]:null,[Rt.VIDEO]:null,[Rt.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Fc),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=dg.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Rt.AUDIO]=null,e[Rt.VIDEO]=null,e[Rt.AUDIOVIDEO]=null}}function Zt(l){return l.sn!=="initSegment"}class uc extends gg{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(xe(e)&&xe(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const i=Object.keys(t);if(i.length===1){const n=this._decryptdata=t[i[0]]||null;n&&(this._decryptdata=n.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=xe(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const i=Object.keys(this.levelkeys),n=i.length;if(n>1||n===1&&(t=this.levelkeys[i[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!xe(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Zt(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var i;const n=t[e];n&&!((i=this._decryptdata)!=null&&i.keyId)&&(this._decryptdata=n.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,i,n,r,o=!1){const{elementaryStreams:u}=this,f=u[e];if(!f){u[e]={startPTS:t,endPTS:i,startDTS:n,endDTS:r,partial:o};return}f.startPTS=Math.min(f.startPTS,t),f.endPTS=Math.max(f.endPTS,i),f.startDTS=Math.min(f.startDTS,n),f.endDTS=Math.max(f.endDTS,r)}}class vE extends gg{constructor(e,t,i,n,r){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=n;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function yE(l,e){const t=Object.getPrototypeOf(l);if(t){const i=Object.getOwnPropertyDescriptor(t,e);return i||yE(t,e)}}function wR(l,e){const t=yE(l,e);t&&(t.enumerable=!0,Object.defineProperty(l,e,t))}const Rv=Math.pow(2,32)-1,UR=[].push,EE={video:1,audio:2,id3:3,text:4};function ii(l){return String.fromCharCode.apply(null,l)}function TE(l,e){const t=l[e]<<8|l[e+1];return t<0?65536+t:t}function ze(l,e){const t=SE(l,e);return t<0?4294967296+t:t}function Lv(l,e){let t=ze(l,e);return t*=Math.pow(2,32),t+=ze(l,e+4),t}function SE(l,e){return l[e]<<24|l[e+1]<<16|l[e+2]<<8|l[e+3]}function PR(l){const e=l.byteLength;for(let t=0;t<e;){const i=ze(l,t);if(i>8&&l[t+4]===109&&l[t+5]===111&&l[t+6]===111&&l[t+7]===102)return!0;t=i>1?t+i:e}return!1}function et(l,e){const t=[];if(!e.length)return t;const i=l.byteLength;for(let n=0;n<i;){const r=ze(l,n),o=ii(l.subarray(n+4,n+8)),u=r>1?n+r:i;if(o===e[0])if(e.length===1)t.push(l.subarray(n+8,u));else{const f=et(l.subarray(n+8,u),e.slice(1));f.length&&UR.apply(t,f)}n=u}return t}function NR(l){const e=[],t=l[0];let i=8;const n=ze(l,i);i+=4;let r=0,o=0;t===0?(r=ze(l,i),o=ze(l,i+4),i+=8):(r=Lv(l,i),o=Lv(l,i+8),i+=16),i+=2;let u=l.length+o;const f=TE(l,i);i+=2;for(let h=0;h<f;h++){let d=i;const m=ze(l,d);d+=4;const p=m&2147483647;if((m&2147483648)>>>31===1)return vt.warn("SIDX has hierarchical references (not supported)"),null;const y=ze(l,d);d+=4,e.push({referenceSize:p,subsegmentDuration:y,info:{duration:y/n,start:u,end:u+p-1}}),u+=p,d+=4,i=d}return{earliestPresentationTime:r,timescale:n,version:t,referencesCount:f,references:e}}function bE(l){const e=[],t=et(l,["moov","trak"]);for(let n=0;n<t.length;n++){const r=t[n],o=et(r,["tkhd"])[0];if(o){let u=o[0];const f=ze(o,u===0?12:20),h=et(r,["mdia","mdhd"])[0];if(h){u=h[0];const d=ze(h,u===0?12:20),m=et(r,["mdia","hdlr"])[0];if(m){const p=ii(m.subarray(8,12)),v={soun:Rt.AUDIO,vide:Rt.VIDEO}[p],y=et(r,["mdia","minf","stbl","stsd"])[0],T=GR(y);v?(e[f]={timescale:d,type:v,stsd:T},e[v]=At({timescale:d,id:f},T)):e[f]={timescale:d,type:p,stsd:T}}}}}return et(l,["moov","mvex","trex"]).forEach(n=>{const r=ze(n,4),o=e[r];o&&(o.default={duration:ze(n,12),flags:ze(n,20)})}),e}function GR(l){const e=l.subarray(8),t=e.subarray(86),i=ii(e.subarray(4,8));let n=i,r;const o=i==="enca"||i==="encv";if(o){const h=et(e,[i])[0].subarray(i==="enca"?28:78);et(h,["sinf"]).forEach(m=>{const p=et(m,["schm"])[0];if(p){const v=ii(p.subarray(4,8));if(v==="cbcs"||v==="cenc"){const y=et(m,["frma"])[0];y&&(n=ii(y))}}})}const u=n;switch(n){case"avc1":case"avc2":case"avc3":case"avc4":{const f=et(t,["avcC"])[0];f&&f.length>3&&(n+="."+zu(f[1])+zu(f[2])+zu(f[3]),r=Yu(u==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const f=et(e,[i])[0],h=et(f.subarray(28),["esds"])[0];if(h&&h.length>7){let d=4;if(h[d++]!==3)break;d=ed(h,d),d+=2;const m=h[d++];if(m&128&&(d+=2),m&64&&(d+=h[d++]),h[d++]!==4)break;d=ed(h,d);const p=h[d++];if(p===64)n+="."+zu(p);else break;if(d+=12,h[d++]!==5)break;d=ed(h,d);const v=h[d++];let y=(v&248)>>3;y===31&&(y+=1+((v&7)<<3)+((h[d]&224)>>5)),n+="."+y}break}case"hvc1":case"hev1":{const f=et(t,["hvcC"])[0];if(f&&f.length>12){const h=f[1],d=["","A","B","C"][h>>6],m=h&31,p=ze(f,2),v=(h&32)>>5?"H":"L",y=f[12],T=f.subarray(6,12);n+="."+d+m,n+="."+HR(p).toString(16).toUpperCase(),n+="."+v+y;let S="";for(let b=T.length;b--;){const C=T[b];(C||S)&&(S="."+C.toString(16).toUpperCase()+S)}n+=S}r=Yu(u=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{n=Yu(n,t)||n;break}case"vp09":{const f=et(t,["vpcC"])[0];if(f&&f.length>6){const h=f[4],d=f[5],m=f[6]>>4&15;n+="."+Hn(h)+"."+Hn(d)+"."+Hn(m)}break}case"av01":{const f=et(t,["av1C"])[0];if(f&&f.length>2){const h=f[1]>>>5,d=f[1]&31,m=f[2]>>>7?"H":"M",p=(f[2]&64)>>6,v=(f[2]&32)>>5,y=h===2&&p?v?12:10:p?10:8,T=(f[2]&16)>>4,S=(f[2]&8)>>3,b=(f[2]&4)>>2,C=f[2]&3;n+="."+h+"."+Hn(d)+m+"."+Hn(y)+"."+T+"."+S+b+C+"."+Hn(1)+"."+Hn(1)+"."+Hn(1)+"."+0,r=Yu("dav1",t)}break}}return{codec:n,encrypted:o,supplemental:r}}function Yu(l,e){const t=et(e,["dvvC"]),i=t.length?t[0]:et(e,["dvcC"])[0];if(i){const n=i[2]>>1&127,r=i[2]<<5&32|i[3]>>3&31;return l+"."+Hn(n)+"."+Hn(r)}}function HR(l){let e=0;for(let t=0;t<32;t++)e|=(l>>t&1)<<31-t;return e>>>0}function ed(l,e){const t=e+5;for(;l[e++]&128&&e<t;);return e}function zu(l){return("0"+l.toString(16).toUpperCase()).slice(-2)}function Hn(l){return(l<10?"0":"")+l}function KR(l,e){if(!l||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&xE(l,(i,n)=>{const r=i.subarray(8,24);r.some(o=>o!==0)||(vt.log(`[eme] Patching keyId in 'enc${n?"a":"v"}>sinf>>tenc' box: ${xi(r)} -> ${xi(t)}`),i.set(t,8))})}function VR(l){const e=[];return xE(l,t=>e.push(t.subarray(8,24))),e}function xE(l,e){et(l,["moov","trak"]).forEach(i=>{const n=et(i,["mdia","minf","stbl","stsd"])[0];if(!n)return;const r=n.subarray(8);let o=et(r,["enca"]);const u=o.length>0;u||(o=et(r,["encv"])),o.forEach(f=>{const h=u?f.subarray(28):f.subarray(78);et(h,["sinf"]).forEach(m=>{const p=CE(m);p&&e(p,u)})})})}function CE(l){const e=et(l,["schm"])[0];if(e){const t=ii(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const i=et(l,["schi","tenc"])[0];if(i)return i}}}function $R(l,e,t){const i={},n=et(l,["moof","traf"]);for(let r=0;r<n.length;r++){const o=n[r],u=et(o,["tfhd"])[0],f=ze(u,4),h=e[f];if(!h)continue;i[f]||(i[f]={start:NaN,duration:0,sampleCount:0,timescale:h.timescale,type:h.type});const d=i[f],m=et(o,["tfdt"])[0];if(m){const L=m[0];let D=ze(m,4);L===1&&(D===Rv?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(D*=Rv+1,D+=ze(m,8))),xe(D)&&(!xe(d.start)||D<d.start)&&(d.start=D)}const p=h.default,v=ze(u,0)|p?.flags;let y=p?.duration||0;v&8&&(v&2?y=ze(u,12):y=ze(u,8));const T=et(o,["trun"]);let S=d.start||0,b=0,C=y;for(let L=0;L<T.length;L++){const D=T[L],_=ze(D,4),w=d.sampleCount;d.sampleCount+=_;const I=D[3]&1,O=D[3]&4,F=D[2]&1,M=D[2]&2,H=D[2]&4,P=D[2]&8;let z=8,Y=_;for(I&&(z+=4),O&&_&&(!(D[z+1]&1)&&d.keyFrameIndex===void 0&&(d.keyFrameIndex=w),z+=4,F?(C=ze(D,z),z+=4):C=y,M&&(z+=4),P&&(z+=4),S+=C,b+=C,Y--);Y--;)F?(C=ze(D,z),z+=4):C=y,M&&(z+=4),H&&(D[z+1]&1||d.keyFrameIndex===void 0&&(d.keyFrameIndex=d.sampleCount-(Y+1),d.keyFrameStart=S),z+=4),P&&(z+=4),S+=C,b+=C;!b&&y&&(b+=y*_)}d.duration+=b}if(!Object.keys(i).some(r=>i[r].duration)){let r=1/0,o=0;const u=et(l,["sidx"]);for(let f=0;f<u.length;f++){const h=NR(u[f]);if(h!=null&&h.references){r=Math.min(r,h.earliestPresentationTime/h.timescale);const d=h.references.reduce((m,p)=>m+p.info.duration||0,0);o=Math.max(o,d+h.earliestPresentationTime/h.timescale)}}o&&xe(o)&&Object.keys(i).forEach(f=>{i[f].duration||(i[f].duration=o*i[f].timescale-i[f].start)})}return i}function YR(l){const e={valid:null,remainder:null},t=et(l,["moof"]);if(t.length<2)return e.remainder=l,e;const i=t[t.length-1];return e.valid=l.slice(0,i.byteOffset-8),e.remainder=l.slice(i.byteOffset-8),e}function dn(l,e){const t=new Uint8Array(l.length+e.length);return t.set(l),t.set(e,l.length),t}function Dv(l,e){const t=[],i=e.samples,n=e.timescale,r=e.id;let o=!1;return et(i,["moof"]).map(f=>{const h=f.byteOffset-8;et(f,["traf"]).map(m=>{const p=et(m,["tfdt"]).map(v=>{const y=v[0];let T=ze(v,4);return y===1&&(T*=Math.pow(2,32),T+=ze(v,8)),T/n})[0];return p!==void 0&&(l=p),et(m,["tfhd"]).map(v=>{const y=ze(v,4),T=ze(v,0)&16777215,S=(T&1)!==0,b=(T&2)!==0,C=(T&8)!==0;let L=0;const D=(T&16)!==0;let _=0;const w=(T&32)!==0;let I=8;y===r&&(S&&(I+=8),b&&(I+=4),C&&(L=ze(v,I),I+=4),D&&(_=ze(v,I),I+=4),w&&(I+=4),e.type==="video"&&(o=kc(e.codec)),et(m,["trun"]).map(O=>{const F=O[0],M=ze(O,0)&16777215,H=(M&1)!==0;let P=0;const z=(M&4)!==0,Y=(M&256)!==0;let Z=0;const k=(M&512)!==0;let K=0;const Q=(M&1024)!==0,j=(M&2048)!==0;let J=0;const U=ze(O,4);let N=8;H&&(P=ze(O,N),N+=4),z&&(N+=4);let V=P+h;for(let q=0;q<U;q++){if(Y?(Z=ze(O,N),N+=4):Z=L,k?(K=ze(O,N),N+=4):K=_,Q&&(N+=4),j&&(F===0?J=ze(O,N):J=SE(O,N),N+=4),e.type===Rt.VIDEO){let X=0;for(;X<K;){const re=ze(i,V);if(V+=4,zR(o,i[V])){const oe=i.subarray(V,V+re);mg(oe,o?2:1,l+J/n,t)}V+=re,X+=re+4}}l+=Z/n}}))})})}),t}function kc(l){if(!l)return!1;const e=l.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function zR(l,e){if(l){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function mg(l,e,t,i){const n=RE(l);let r=0;r+=e;let o=0,u=0,f=0;for(;r<n.length;){o=0;do{if(r>=n.length)break;f=n[r++],o+=f}while(f===255);u=0;do{if(r>=n.length)break;f=n[r++],u+=f}while(f===255);const h=n.length-r;let d=r;if(u<h)r+=u;else if(u>h){vt.error(`Malformed SEI payload. ${u} is too small, only ${h} bytes left to parse.`);break}if(o===4){if(n[d++]===181){const p=TE(n,d);if(d+=2,p===49){const v=ze(n,d);if(d+=4,v===1195456820){const y=n[d++];if(y===3){const T=n[d++],S=31&T,b=64&T,C=b?2+S*3:0,L=new Uint8Array(C);if(b){L[0]=T;for(let D=1;D<C;D++)L[D]=n[d++]}i.push({type:y,payloadType:o,pts:t,bytes:L})}}}}}else if(o===5&&u>16){const m=[];for(let y=0;y<16;y++){const T=n[d++].toString(16);m.push(T.length==1?"0"+T:T),(y===3||y===5||y===7||y===9)&&m.push("-")}const p=u-16,v=new Uint8Array(p);for(let y=0;y<p;y++)v[y]=n[d++];i.push({payloadType:o,pts:t,uuid:m.join(""),userData:Xi(v),userDataBytes:v})}}}function RE(l){const e=l.byteLength,t=[];let i=1;for(;i<e-2;)l[i]===0&&l[i+1]===0&&l[i+2]===3?(t.push(i+2),i+=2):i++;if(t.length===0)return l;const n=e-t.length,r=new Uint8Array(n);let o=0;for(i=0;i<n;o++,i++)o===t[0]&&(o++,t.shift()),r[i]=l[o];return r}function jR(l){const e=l[0];let t="",i="",n=0,r=0,o=0,u=0,f=0,h=0;if(e===0){for(;ii(l.subarray(h,h+1))!=="\0";)t+=ii(l.subarray(h,h+1)),h+=1;for(t+=ii(l.subarray(h,h+1)),h+=1;ii(l.subarray(h,h+1))!=="\0";)i+=ii(l.subarray(h,h+1)),h+=1;i+=ii(l.subarray(h,h+1)),h+=1,n=ze(l,12),r=ze(l,16),u=ze(l,20),f=ze(l,24),h=28}else if(e===1){h+=4,n=ze(l,h),h+=4;const m=ze(l,h);h+=4;const p=ze(l,h);for(h+=4,o=2**32*m+p,xR(o)||(o=Number.MAX_SAFE_INTEGER,vt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),u=ze(l,h),h+=4,f=ze(l,h),h+=4;ii(l.subarray(h,h+1))!=="\0";)t+=ii(l.subarray(h,h+1)),h+=1;for(t+=ii(l.subarray(h,h+1)),h+=1;ii(l.subarray(h,h+1))!=="\0";)i+=ii(l.subarray(h,h+1)),h+=1;i+=ii(l.subarray(h,h+1)),h+=1}const d=l.subarray(h,l.byteLength);return{schemeIdUri:t,value:i,timeScale:n,presentationTime:o,presentationTimeDelta:r,eventDuration:u,id:f,payload:d}}function JR(l,...e){const t=e.length;let i=8,n=t;for(;n--;)i+=e[n].byteLength;const r=new Uint8Array(i);for(r[0]=i>>24&255,r[1]=i>>16&255,r[2]=i>>8&255,r[3]=i&255,r.set(l,4),n=0,i=8;n<t;n++)r.set(e[n],i),i+=e[n].byteLength;return r}function XR(l,e,t){if(l.byteLength!==16)throw new RangeError("Invalid system id");let i,n;i=0,n=new Uint8Array;let r;i>0?(r=new Uint8Array(4),e.length>0&&new DataView(r.buffer).setUint32(0,e.length,!1)):r=new Uint8Array;const o=new Uint8Array(4);return t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),JR([112,115,115,104],new Uint8Array([i,0,0,0]),l,r,n,o,t)}function QR(l){const e=[];if(l instanceof ArrayBuffer){const t=l.byteLength;let i=0;for(;i+32<t;){const n=new DataView(l,i),r=qR(n);e.push(r),i+=r.size}}return e}function qR(l){const e=l.getUint32(0),t=l.byteOffset,i=l.byteLength;if(i<e)return{offset:t,size:i};if(l.getUint32(4)!==1886614376)return{offset:t,size:e};const r=l.getUint32(8)>>>24;if(r!==0&&r!==1)return{offset:t,size:e};const o=l.buffer,u=xi(new Uint8Array(o,t+12,16));let f=null,h=null,d=0;if(r===0)d=28;else{const p=l.getUint32(28);if(!p||i<32+p*16)return{offset:t,size:e};f=[];for(let v=0;v<p;v++)f.push(new Uint8Array(o,t+32+v*16,16));d=32+p*16}if(!d)return{offset:t,size:e};const m=l.getUint32(d);return e-32<m?{offset:t,size:e}:(h=new Uint8Array(o,t+d+4,m),{version:r,systemId:u,kids:f,data:h,offset:t,size:e})}const LE=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),to={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function pg(l,e){const t=to[e];return!!t&&!!t[l.slice(0,4)]}function El(l,e,t=!0){return!l.split(",").some(i=>!Ag(i,e,t))}function Ag(l,e,t=!0){var i;const n=Bs(t);return(i=n?.isTypeSupported(Tl(l,e)))!=null?i:!1}function Tl(l,e){return`${e}/mp4;codecs=${l}`}function _v(l){if(l){const e=l.substring(0,4);return to.video[e]}return 2}function Ec(l){const e=LE();return l.split(",").reduce((t,i)=>{const r=e&&kc(i)?9:to.video[i];return r?(r*2+t)/(t?3:2):(to.audio[i]+t)/(t?2:1)},0)}const td={};function WR(l,e=!0){if(td[l])return td[l];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[l];for(let n=0;n<t.length;n++){var i;if(Ag(t[n],"audio",e))return td[l]=t[n],t[n];if(t[n]==="mp3"&&(i=Bs(e))!=null&&i.isTypeSupported("audio/mpeg"))return""}return l}const ZR=/flac|opus|mp4a\.40\.34/i;function Tc(l,e=!0){return l.replace(ZR,t=>WR(t.toLowerCase(),e))}function eL(l,e){const t=[];if(l){const i=l.split(",");for(let n=0;n<i.length;n++)pg(i[n],"video")||t.push(i[n])}return e&&t.push(e),t.join(",")}function cc(l,e){if(l&&(l.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(l)!==-1)&&(Iv(l,"audio")||Iv(l,"video")))return l;if(e){const t=e.split(",");if(t.length>1){if(l){for(let i=t.length;i--;)if(t[i].substring(0,4)===l.substring(0,4))return t[i]}return t[0]}}return e||l}function Iv(l,e){return pg(l,e)&&Ag(l,e)}function tL(l){const e=l.split(",");for(let t=0;t<e.length;t++){const i=e[t].split(".");i.length>2&&i[0]==="avc1"&&(e[t]=`avc1.${parseInt(i[1]).toString(16)}${("000"+parseInt(i[2]).toString(16)).slice(-4)}`)}return e.join(",")}function iL(l){if(l.startsWith("av01.")){const e=l.split("."),t=["0","111","01","01","01","0"];for(let i=e.length;i>4&&i<10;i++)e[i]=t[i-4];return e.join(".")}return l}function Bv(l){const e=Bs(l)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Ud(l){return l.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const nL={supported:!0,powerEfficient:!0,smooth:!0},sL={supported:!1,smooth:!1,powerEfficient:!1},DE={supported:!0,configurations:[],decodingInfoResults:[nL]};function _E(l,e){return{supported:!1,configurations:e,decodingInfoResults:[sL],error:l}}function rL(l,e,t,i,n,r){const o=l.videoCodec,u=l.audioCodec?l.audioGroups:null,f=r?.audioCodec,h=r?.channels,d=h?parseInt(h):f?1/0:2;let m=null;if(u!=null&&u.length)try{u.length===1&&u[0]?m=e.groups[u[0]].channels:m=u.reduce((p,v)=>{if(v){const y=e.groups[v];if(!y)throw new Error(`Audio track group ${v} not found`);Object.keys(y.channels).forEach(T=>{p[T]=(p[T]||0)+y.channels[T]})}return p},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(p=>kc(p))||l.width>1920&&l.height>1088||l.height>1920&&l.width>1088||l.frameRate>Math.max(i,30)||l.videoRange!=="SDR"&&l.videoRange!==t||l.bitrate>Math.max(n,8e6))||!!m&&xe(d)&&Object.keys(m).some(p=>parseInt(p)>d)}function IE(l,e,t,i={}){const n=l.videoCodec;if(!n&&!l.audioCodec||!t)return Promise.resolve(DE);const r=[],o=aL(l),u=o.length,f=oL(l,e,u>0),h=f.length;for(let d=u||1*h||1;d--;){const m={type:"media-source"};if(u&&(m.video=o[d%u]),h){m.audio=f[d%h];const p=m.audio.bitrate;m.video&&p&&(m.video.bitrate-=p)}r.push(m)}if(n){const d=navigator.userAgent;if(n.split(",").some(m=>kc(m))&&LE())return Promise.resolve(_E(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${d})`),r))}return Promise.all(r.map(d=>{const m=uL(d);return i[m]||(i[m]=t.decodingInfo(d))})).then(d=>({supported:!d.some(m=>!m.supported),configurations:r,decodingInfoResults:d})).catch(d=>({supported:!1,configurations:r,decodingInfoResults:[],error:d}))}function aL(l){var e;const t=(e=l.videoCodec)==null?void 0:e.split(","),i=BE(l),n=l.width||640,r=l.height||480,o=l.frameRate||30,u=l.videoRange.toLowerCase();return t?t.map(f=>{const h={contentType:Tl(iL(f),"video"),width:n,height:r,bitrate:i,framerate:o};return u!=="sdr"&&(h.transferFunction=u),h}):[]}function oL(l,e,t){var i;const n=(i=l.audioCodec)==null?void 0:i.split(","),r=BE(l);return n&&l.audioGroups?l.audioGroups.reduce((o,u)=>{var f;const h=u?(f=e.groups[u])==null?void 0:f.tracks:null;return h?h.reduce((d,m)=>{if(m.groupId===u){const p=parseFloat(m.channels||"");n.forEach(v=>{const y={contentType:Tl(v,"audio"),bitrate:t?lL(v,r):r};p&&(y.channels=""+p),d.push(y)})}return d},o):o},[]):[]}function lL(l,e){if(e<=1)return 1;let t=128e3;return l==="ec-3"?t=768e3:l==="ac-3"&&(t=64e4),Math.min(e/2,t)}function BE(l){return Math.ceil(Math.max(l.bitrate*.9,l.averageBitrate)/1e3)*1e3||1}function uL(l){let e="";const{audio:t,video:i}=l;if(i){const n=Ud(i.contentType);e+=`${n}_r${i.height}x${i.width}f${Math.ceil(i.framerate)}${i.transferFunction||"sd"}_${Math.ceil(i.bitrate/1e5)}`}if(t){const n=Ud(t.contentType);e+=`${i?"_":""}${n}_c${t.channels}`}return e}const Pd=["NONE","TYPE-0","TYPE-1",null];function cL(l){return Pd.indexOf(l)>-1}const Sc=["SDR","PQ","HLG"];function fL(l){return!!l&&Sc.indexOf(l)>-1}var gl={No:"",Yes:"YES",v2:"v2"};function Mv(l){const{canSkipUntil:e,canSkipDateRanges:t,age:i}=l,n=i<e/2;return e&&n?t?gl.v2:gl.Yes:gl.No}class Nd{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class io{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const i=(t=e.supplemental)==null?void 0:t.videoCodec;i&&i!==e.videoCodec&&(this.codecSet+=`,${i.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Ov(this._audioGroups,e)}hasSubtitleGroup(e){return Ov(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(t)===-1&&i.push(t)}else if(e==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(t)===-1&&i.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Ov(l,e){return!e||!l?!1:l.indexOf(e)!==-1}function hL(){if(typeof matchMedia=="function"){const l=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(l.media!==e.media)return l.matches===!0}return!1}function dL(l,e){let t=!1,i=[];if(l&&(t=l!=="SDR",i=[l]),e){i=e.allowedVideoRanges||Sc.slice(0);const n=i.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:n&&hL(),t||(i=["SDR"])}return{preferHDR:t,allowedVideoRanges:i}}const gL=l=>{const e=new WeakSet;return(t,i)=>{if(l&&(i=l(t,i)),typeof i=="object"&&i!==null){if(e.has(i))return;e.add(i)}return i}},Lt=(l,e)=>JSON.stringify(l,gL(e));function mL(l,e,t,i,n){const r=Object.keys(l),o=i?.channels,u=i?.audioCodec,f=n?.videoCodec,h=o&&parseInt(o)===2;let d=!1,m=!1,p=1/0,v=1/0,y=1/0,T=1/0,S=0,b=[];const{preferHDR:C,allowedVideoRanges:L}=dL(e,n);for(let O=r.length;O--;){const F=l[r[O]];d||(d=F.channels[2]>0),p=Math.min(p,F.minHeight),v=Math.min(v,F.minFramerate),y=Math.min(y,F.minBitrate),L.filter(H=>F.videoRanges[H]>0).length>0&&(m=!0)}p=xe(p)?p:0,v=xe(v)?v:0;const D=Math.max(1080,p),_=Math.max(30,v);y=xe(y)?y:t,t=Math.max(y,t),m||(e=void 0);const w=r.length>1;return{codecSet:r.reduce((O,F)=>{const M=l[F];if(F===O)return O;if(b=m?L.filter(H=>M.videoRanges[H]>0):[],w){if(M.minBitrate>t)return Nn(F,`min bitrate of ${M.minBitrate} > current estimate of ${t}`),O;if(!M.hasDefaultAudio)return Nn(F,"no renditions with default or auto-select sound found"),O;if(u&&F.indexOf(u.substring(0,4))%5!==0)return Nn(F,`audio codec preference "${u}" not found`),O;if(o&&!h){if(!M.channels[o])return Nn(F,`no renditions with ${o} channel sound found (channels options: ${Object.keys(M.channels)})`),O}else if((!u||h)&&d&&M.channels[2]===0)return Nn(F,"no renditions with stereo sound found"),O;if(M.minHeight>D)return Nn(F,`min resolution of ${M.minHeight} > maximum of ${D}`),O;if(M.minFramerate>_)return Nn(F,`min framerate of ${M.minFramerate} > maximum of ${_}`),O;if(!b.some(H=>M.videoRanges[H]>0))return Nn(F,`no variants with VIDEO-RANGE of ${Lt(b)} found`),O;if(f&&F.indexOf(f.substring(0,4))%5!==0)return Nn(F,`video codec preference "${f}" not found`),O;if(M.maxScore<S)return Nn(F,`max score of ${M.maxScore} < selected max of ${S}`),O}return O&&(Ec(F)>=Ec(O)||M.fragmentError>l[O].fragmentError)?O:(T=M.minIndex,S=M.maxScore,F)},void 0),videoRanges:b,preferHDR:C,minFramerate:v,minBitrate:y,minIndex:T}}function Nn(l,e){vt.log(`[abr] start candidates with "${l}" ignored because ${e}`)}function ME(l){return l.reduce((e,t)=>{let i=e.groups[t.groupId];i||(i=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(t);const n=t.channels||"2";return i.channels[n]=(i.channels[n]||0)+1,i.hasDefault=i.hasDefault||t.default,i.hasAutoSelect=i.hasAutoSelect||t.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function pL(l,e,t,i){return l.slice(t,i+1).reduce((n,r,o)=>{if(!r.codecSet)return n;const u=r.audioGroups;let f=n[r.codecSet];f||(n[r.codecSet]=f={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!u,fragmentError:0}),f.minBitrate=Math.min(f.minBitrate,r.bitrate);const h=Math.min(r.height,r.width);return f.minHeight=Math.min(f.minHeight,h),f.minFramerate=Math.min(f.minFramerate,r.frameRate),f.minIndex=Math.min(f.minIndex,o),f.maxScore=Math.max(f.maxScore,r.score),f.fragmentError+=r.fragmentError,f.videoRanges[r.videoRange]=(f.videoRanges[r.videoRange]||0)+1,u&&u.forEach(d=>{if(!d)return;const m=e.groups[d];m&&(f.hasDefaultAudio=f.hasDefaultAudio||e.hasDefaultAudio?m.hasDefault:m.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(m.channels).forEach(p=>{f.channels[p]=(f.channels[p]||0)+m.channels[p]}))}),n},{})}function Fv(l){if(!l)return l;const{lang:e,assocLang:t,characteristics:i,channels:n,audioCodec:r}=l;return{lang:e,assocLang:t,characteristics:i,channels:n,audioCodec:r}}function Vn(l,e,t){if("attrs"in l){const i=e.indexOf(l);if(i!==-1)return i}for(let i=0;i<e.length;i++){const n=e[i];if(Yr(l,n,t))return i}return-1}function Yr(l,e,t){const{groupId:i,name:n,lang:r,assocLang:o,default:u}=l,f=l.forced;return(i===void 0||e.groupId===i)&&(n===void 0||e.name===n)&&(r===void 0||AL(r,e.lang))&&(r===void 0||e.assocLang===o)&&(u===void 0||e.default===u)&&(f===void 0||e.forced===f)&&(!("characteristics"in l)||vL(l.characteristics||"",e.characteristics))&&(t===void 0||t(l,e))}function AL(l,e="--"){return l.length===e.length?l===e:l.startsWith(e)||e.startsWith(l)}function vL(l,e=""){const t=l.split(","),i=e.split(",");return t.length===i.length&&!t.some(n=>i.indexOf(n)===-1)}function Kr(l,e){const{audioCodec:t,channels:i}=l;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(i===void 0||i===(e.channels||"2"))}function yL(l,e,t,i,n){const r=e[i],u=e.reduce((p,v,y)=>{const T=v.uri;return(p[T]||(p[T]=[])).push(y),p},{})[r.uri];u.length>1&&(i=Math.max.apply(Math,u));const f=r.videoRange,h=r.frameRate,d=r.codecSet.substring(0,4),m=kv(e,i,p=>{if(p.videoRange!==f||p.frameRate!==h||p.codecSet.substring(0,4)!==d)return!1;const v=p.audioGroups,y=t.filter(T=>!v||v.indexOf(T.groupId)!==-1);return Vn(l,y,n)>-1});return m>-1?m:kv(e,i,p=>{const v=p.audioGroups,y=t.filter(T=>!v||v.indexOf(T.groupId)!==-1);return Vn(l,y,n)>-1})}function kv(l,e,t){for(let i=e;i>-1;i--)if(t(l[i]))return i;for(let i=e+1;i<l.length;i++)if(t(l[i]))return i;return-1}function bc(l,e){var t;return!!l&&l!==((t=e.loadLevelObj)==null?void 0:t.uri)}class OE extends gn{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var i;const{fragCurrent:n,partCurrent:r,hls:o}=this,{autoLevelEnabled:u,media:f}=o;if(!n||!f)return;const h=performance.now(),d=r?r.stats:n.stats,m=r?r.duration:n.duration,p=h-d.loading.start,v=o.minAutoLevel,y=n.level,T=this._nextAutoLevel;if(d.aborted||d.loaded&&d.loaded===d.total||y<=v){this.clearTimer(),this._nextAutoLevel=-1;return}if(!u)return;const S=T>-1&&T!==y,b=!!t||S;if(!b&&(f.paused||!f.playbackRate||!f.readyState))return;const C=o.mainForwardBufferInfo;if(!b&&C===null)return;const L=this.bwEstimator.getEstimateTTFB(),D=Math.abs(f.playbackRate);if(p<=Math.max(L,1e3*(m/(D*2))))return;const _=C?C.len/D:0,w=d.loading.first?d.loading.first-d.loading.start:-1,I=d.loaded&&w>-1,O=this.getBwEstimate(),F=o.levels,M=F[y],H=Math.max(d.loaded,Math.round(m*(n.bitrate||M.averageBitrate)/8));let P=I?p-w:p;P<1&&I&&(P=Math.min(p,d.loaded*8/O));const z=I?d.loaded*1e3/P:0,Y=L/1e3,Z=z?(H-d.loaded)/z:H*8/O+Y;if(Z<=_)return;const k=z?z*8:O,K=((i=t?.details||this.hls.latestLevelDetails)==null?void 0:i.live)===!0,Q=this.hls.config.abrBandWidthUpFactor;let j=Number.POSITIVE_INFINITY,J;for(J=y-1;J>v;J--){const q=F[J].maxBitrate,X=!F[J].details||K;if(j=this.getTimeToLoadFrag(Y,k,m*q,X),j<Math.min(_,m+Y))break}if(j>=Z||j>m*10)return;I?this.bwEstimator.sample(p-Math.min(L,w),d.loaded):this.bwEstimator.sampleTTFB(p);const U=F[J].maxBitrate;this.getBwEstimate()*Q>U&&this.resetEstimator(U);const N=this.findBestLevel(U,v,J,0,_,1,1);N>-1&&(J=N),this.warn(`Fragment ${n.sn}${r?" part "+r.index:""} of level ${y} is loading too slowly;
      Fragment duration: ${n.duration.toFixed(3)}
      Time to underbuffer: ${_.toFixed(3)} s
      Estimated load time for current fragment: ${Z.toFixed(3)} s
      Estimated load time for down switch fragment: ${j.toFixed(3)} s
      TTFB estimate: ${w|0} ms
      Current BW estimate: ${xe(O)?O|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${J} @ ${U|0} bps`),o.nextLoadLevel=o.nextAutoLevel=J,this.clearTimer();const V=()=>{if(this.clearTimer(),this.fragCurrent===n&&this.hls.loadLevel===J&&J>0){const q=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${J>0?"and switching down":""}
      Fragment duration: ${n.duration.toFixed(3)} s
      Time to underbuffer: ${q.toFixed(3)} s`),n.abortRequests(),this.fragCurrent=this.partCurrent=null,J>v){let X=this.findBestLevel(this.hls.levels[v].bitrate,v,J,0,q,1,1);X===-1&&(X=v),this.hls.nextLoadLevel=this.hls.nextAutoLevel=X,this.resetEstimator(this.hls.levels[X].bitrate)}}};S||Z>j*2?V():this.timer=self.setInterval(V,j*1e3),o.trigger(R.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:r,stats:d})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new RR(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.FRAG_LOADING,this.onFragLoading,this),e.on(R.FRAG_LOADED,this.onFragLoaded,this),e.on(R.FRAG_BUFFERED,this.onFragBuffered,this),e.on(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(R.LEVEL_LOADED,this.onLevelLoaded,this),e.on(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(R.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(R.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.FRAG_LOADING,this.onFragLoading,this),e.off(R.FRAG_LOADED,this.onFragLoaded,this),e.off(R.FRAG_BUFFERED,this.onFragBuffered,this),e.off(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(R.LEVEL_LOADED,this.onLevelLoaded,this),e.off(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(R.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(R.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var n;this.fragCurrent=i,this.partCurrent=(n=t.part)!=null?n:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case te.BUFFER_ADD_CODEC_ERROR:case te.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case te.FRAG_LOAD_TIMEOUT:{const i=t.frag,{fragCurrent:n,partCurrent:r}=this;if(i&&n&&i.sn===n.sn&&i.level===n.level){const o=performance.now(),u=r?r.stats:i.stats,f=o-u.loading.start,h=u.loading.first?u.loading.first-u.loading.start:-1;if(u.loaded&&h>-1){const m=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(f-Math.min(m,h),u.loaded)}else this.bwEstimator.sampleTTFB(f)}break}}}getTimeToLoadFrag(e,t,i,n){const r=e+i/t,o=n?e+this.lastLevelLoadSec:0;return r+o}onLevelLoaded(e,t){const i=this.hls.config,{loading:n}=t.stats,r=n.end-n.first;xe(r)&&(this.lastLevelLoadSec=r/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:i}){const n=i?i.stats:t.stats;if(t.type===_e.MAIN&&this.bwEstimator.sampleTTFB(n.loading.first-n.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const r=i?i.duration:t.duration,o=this.hls.levels[t.level],u=(o.loaded?o.loaded.bytes:0)+n.loaded,f=(o.loaded?o.loaded.duration:0)+r;o.loaded={bytes:u,duration:f},o.realBitrate=Math.round(8*u/f)}if(t.bitrateTest){const r={stats:n,frag:t,part:i,id:t.type};this.onFragBuffered(R.FRAG_BUFFERED,r),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:i,part:n}=t,r=n!=null&&n.stats.loaded?n.stats:i.stats;if(r.aborted||this.ignoreFragment(i))return;const o=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,r.loaded),r.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==_e.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,i=this.getBwEstimate(),n=this.hls.config.maxStarvationDelay,r=this.findBestLevel(i,t,e,0,n,1,1);if(r>-1)return r;const o=this.hls.firstLevel,u=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${u}`),u}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!n||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const r=i&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,r)&&o[e].loadError<=o[r].loadError)return e}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;const{maxAutoLevel:n,config:r,minAutoLevel:o}=i,u=t?t.duration:e?e.duration:0,f=this.getBwEstimate(),h=this.getStarvationDelay();let d=r.abrBandWidthFactor,m=r.abrBandWidthUpFactor;if(h){const S=this.findBestLevel(f,o,n,h,0,d,m);if(S>=0)return this.rebufferNotice=-1,S}let p=u?Math.min(u,r.maxStarvationDelay):r.maxStarvationDelay;if(!h){const S=this.bitrateTestDelay;S&&(p=(u?Math.min(u,r.maxLoadingDelay):r.maxLoadingDelay)-S,this.info(`bitrate test took ${Math.round(1e3*S)}ms, set first fragment max fetchDuration to ${Math.round(1e3*p)} ms`),d=m=1)}const v=this.findBestLevel(f,o,n,h,p,d,m);if(this.rebufferNotice!==v&&(this.rebufferNotice=v,this.info(`${h?"rebuffering expected":"buffer is empty"}, optimal quality level ${v}`)),v>-1)return v;const y=i.levels[o],T=i.loadLevelObj;return T&&y?.bitrate<T.bitrate?o:i.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const i=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,n=e.mainForwardBufferInfo;return(n?n.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,i,n,r,o,u){var f;const h=n+r,d=this.lastLoadedFragLevel,m=d===-1?this.hls.firstLevel:d,{fragCurrent:p,partCurrent:v}=this,{levels:y,allAudioTracks:T,loadLevel:S,config:b}=this.hls;if(y.length===1)return 0;const C=y[m],L=!!((f=this.hls.latestLevelDetails)!=null&&f.live),D=S===-1||d===-1;let _,w="SDR",I=C?.frameRate||0;const{audioPreference:O,videoPreference:F}=b,M=this.audioTracksByGroup||(this.audioTracksByGroup=ME(T));let H=-1;if(D){if(this.firstSelection!==-1)return this.firstSelection;const k=this.codecTiers||(this.codecTiers=pL(y,M,t,i)),K=mL(k,w,e,O,F),{codecSet:Q,videoRanges:j,minFramerate:J,minBitrate:U,minIndex:N,preferHDR:V}=K;H=N,_=Q,w=V?j[j.length-1]:j[0],I=J,e=Math.max(e,U),this.log(`picked start tier ${Lt(K)}`)}else _=C?.codecSet,w=C?.videoRange;const P=v?v.duration:p?p.duration:0,z=this.bwEstimator.getEstimateTTFB()/1e3,Y=[];for(let k=i;k>=t;k--){var Z;const K=y[k],Q=k>m;if(!K)continue;if(b.useMediaCapabilities&&!K.supportedResult&&!K.supportedPromise){const X=navigator.mediaCapabilities;typeof X?.decodingInfo=="function"&&rL(K,M,w,I,e,O)?(K.supportedPromise=IE(K,M,X,this.supportedCache),K.supportedPromise.then(re=>{if(!this.hls)return;K.supportedResult=re;const oe=this.hls.levels,le=oe.indexOf(K);re.error?this.warn(`MediaCapabilities decodingInfo error: "${re.error}" for level ${le} ${Lt(re)}`):re.supported?re.decodingInfoResults.some(ve=>ve.smooth===!1||ve.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${le} not smooth or powerEfficient: ${Lt(re)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${le} ${Lt(re)}`),le>-1&&oe.length>1&&(this.log(`Removing unsupported level ${le}`),this.hls.removeLevel(le),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(re=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${re}`)})):K.supportedResult=DE}if((_&&K.codecSet!==_||w&&K.videoRange!==w||Q&&I>K.frameRate||!Q&&I>0&&I<K.frameRate||(Z=K.supportedResult)!=null&&(Z=Z.decodingInfoResults)!=null&&Z.some(X=>X.smooth===!1))&&(!D||k!==H)){Y.push(k);continue}const j=K.details,J=(v?j?.partTarget:j?.averagetargetduration)||P;let U;Q?U=u*e:U=o*e;const N=P&&n>=P*2&&r===0?K.averageBitrate:K.maxBitrate,V=this.getTimeToLoadFrag(z,U,N*J,j===void 0);if(U>=N&&(k===d||K.loadError===0&&K.fragmentError===0)&&(V<=z||!xe(V)||L&&!this.bitrateTestDelay||V<h)){const X=this.forcedAutoLevel;return k!==S&&(X===-1||X!==S)&&(Y.length&&this.trace(`Skipped level(s) ${Y.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${y[Y[0]].codecs}" ${y[Y[0]].videoRange}; not compatible with "${_}" ${w}`),this.info(`switch candidate:${m}->${k} adjustedbw(${Math.round(U)})-bitrate=${Math.round(U-N)} ttfb:${z.toFixed(1)} avgDuration:${J.toFixed(1)} maxFetchDuration:${h.toFixed(1)} fetchDuration:${V.toFixed(1)} firstSelection:${D} codecSet:${K.codecSet} videoRange:${K.videoRange} hls.loadLevel:${S}`)),D&&(this.firstSelection=k),k}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:i}=this.hls;return Math.min(Math.max(e,i),t)}}const FE={search:function(l,e){let t=0,i=l.length-1,n=null,r=null;for(;t<=i;){n=(t+i)/2|0,r=l[n];const o=e(r);if(o>0)t=n+1;else if(o<0)i=n-1;else return r}return null}};function EL(l,e,t){if(e===null||!Array.isArray(l)||!l.length||!xe(e))return null;const i=l[0].programDateTime;if(e<(i||0))return null;const n=l[l.length-1].endProgramDateTime;if(e>=(n||0))return null;for(let r=0;r<l.length;++r){const o=l[r];if(SL(e,t,o))return o}return null}function Jr(l,e,t=0,i=0,n=.005){let r=null;if(l){r=e[1+l.sn-e[0].sn]||null;const u=l.endDTS-t;u>0&&u<15e-7&&(t+=15e-7),r&&l.level!==r.level&&r.end<=l.end&&(r=e[2+l.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(r=e[0]);if(r&&((!l||l.level===r.level)&&wv(t,i,r)===0||TL(r,l,Math.min(n,i))))return r;const o=FE.search(e,wv.bind(null,t,i));return o&&(o!==l||!r)?o:r}function TL(l,e,t){if(e&&e.start===0&&e.level<l.level&&(e.endPTS||0)>0){const i=e.tagList.reduce((n,r)=>(r[0]==="INF"&&(n+=parseFloat(r[1])),n),t);return l.start<=i}return!1}function wv(l=0,e=0,t){if(t.start<=l&&t.start+t.duration>l)return 0;const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-i<=l?1:t.start-i>l&&t.start?-1:0}function SL(l,e,t){const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-i>l}function kE(l,e,t){if(l&&l.startCC<=e&&l.endCC>=e){let i=l.fragments;const{fragmentHint:n}=l;n&&(i=i.concat(n));let r;return FE.search(i,o=>o.cc<e?1:o.cc>e?-1:(r=o,o.end<=t?1:o.start>t?-1:0)),r||null}return null}function xc(l){switch(l.details){case te.FRAG_LOAD_TIMEOUT:case te.KEY_LOAD_TIMEOUT:case te.LEVEL_LOAD_TIMEOUT:case te.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function wE(l){return l.details.startsWith("key")}function UE(l){return wE(l)&&!!l.frag&&!l.frag.decryptdata}function Uv(l,e){const t=xc(e);return l.default[`${t?"timeout":"error"}Retry`]}function vg(l,e){const t=l.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*l.retryDelayMs,l.maxRetryDelayMs)}function Pv(l){return At(At({},l),{errorRetry:null,timeoutRetry:null})}function Cc(l,e,t,i){if(!l)return!1;const n=i?.code,r=e<l.maxNumRetry&&(bL(n)||!!t);return l.shouldRetry?l.shouldRetry(l,e,t,i,r):r}function bL(l){return Gd(l)||!!l&&(l<400||l>499)}function Gd(l){return l===0&&navigator.onLine===!1}var ni={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},Oi={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4,SwitchToSDR:8};class PE extends gn{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(R.ERROR,this.onError,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(R.ERROR,this.onError,this),e.off(R.ERROR,this.onErrorOut,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===_e.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,i=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||i===-1?t.loadLevel:i}variantHasKey(e,t){if(e){var i;if((i=e.details)!=null&&i.hasKey(t))return!0;const n=e.audioGroups;if(n)return this.hls.allAudioTracks.filter(o=>n.indexOf(o.groupId)>=0).some(o=>{var u;return(u=o.details)==null?void 0:u.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var i;if(t.fatal)return;const n=this.hls,r=t.context;switch(t.details){case te.FRAG_LOAD_ERROR:case te.FRAG_LOAD_TIMEOUT:case te.KEY_LOAD_ERROR:case te.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case te.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction=Qa();return}case te.FRAG_GAP:case te.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=ni.SendAlternateToPenaltyBox;return}case te.LEVEL_EMPTY_ERROR:case te.LEVEL_PARSING_ERROR:{var o;const f=t.parent===_e.MAIN?t.level:n.loadLevel;t.details===te.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(o=o.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,f):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,f))}return;case te.LEVEL_LOAD_ERROR:case te.LEVEL_LOAD_TIMEOUT:typeof r?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level));return;case te.AUDIO_TRACK_LOAD_ERROR:case te.AUDIO_TRACK_LOAD_TIMEOUT:case te.SUBTITLE_LOAD_ERROR:case te.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const f=n.loadLevelObj;if(f&&(r.type===tt.AUDIO_TRACK&&f.hasAudioGroup(r.groupId)||r.type===tt.SUBTITLE_TRACK&&f.hasSubtitleGroup(r.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=ni.SendAlternateToPenaltyBox,t.errorAction.flags=Oi.MoveAllAlternatesMatchingHost;return}}return;case te.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:ni.SendAlternateToPenaltyBox,flags:Oi.MoveAllAlternatesMatchingHDCP};return;case te.KEY_SYSTEM_SESSION_UPDATE_FAILED:case te.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case te.KEY_SYSTEM_NO_SESSION:t.errorAction={action:ni.SendAlternateToPenaltyBox,flags:Oi.MoveAllAlternatesMatchingKey};return;case te.BUFFER_ADD_CODEC_ERROR:case te.REMUX_ALLOC_ERROR:case te.BUFFER_APPEND_ERROR:if(!t.errorAction){var u;t.errorAction=this.getLevelSwitchAction(t,(u=t.level)!=null?u:n.loadLevel)}return;case te.INTERNAL_EXCEPTION:case te.BUFFER_APPENDING_ERROR:case te.BUFFER_FULL_ERROR:case te.LEVEL_SWITCH_ERROR:case te.BUFFER_STALLED_ERROR:case te.BUFFER_SEEK_OVER_HOLE:case te.BUFFER_NUDGE_ON_STALL:t.errorAction=Qa();return}t.type===ke.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Qa())}getPlaylistRetryOrSwitchAction(e,t){const i=this.hls,n=Uv(i.config.playlistLoadPolicy,e),r=this.playlistError++;if(Cc(n,r,xc(e),e.response))return{action:ni.RetryRequest,flags:Oi.None,retryConfig:n,retryCount:r};const u=this.getLevelSwitchAction(e,t);return n&&(u.retryConfig=n,u.retryCount=r),u}getFragRetryOrSwitchAction(e){const t=this.hls,i=this.getVariantLevelIndex(e.frag),n=t.levels[i],{fragLoadPolicy:r,keyLoadPolicy:o}=t.config,u=Uv(wE(e)?o:r,e),f=t.levels.reduce((d,m)=>d+m.fragmentError,0);if(n&&(e.details!==te.FRAG_GAP&&n.fragmentError++,!UE(e)&&Cc(u,f,xc(e),e.response)))return{action:ni.RetryRequest,flags:Oi.None,retryConfig:u,retryCount:f};const h=this.getLevelSwitchAction(e,i);return u&&(h.retryConfig=u,h.retryCount=f),h}getLevelSwitchAction(e,t){const i=this.hls;t==null&&(t=i.loadLevel);const n=this.hls.levels[t];if(n){var r,o;const h=e.details;n.loadError++,h===te.BUFFER_APPEND_ERROR&&n.fragmentError++;let d=-1;const{levels:m,loadLevel:p,minAutoLevel:v,maxAutoLevel:y}=i;!i.autoLevelEnabled&&!i.config.preserveManualLevelOnError&&(i.loadLevel=-1);const T=(r=e.frag)==null?void 0:r.type,b=(T===_e.AUDIO&&h===te.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(h===te.BUFFER_ADD_CODEC_ERROR||h===te.BUFFER_APPEND_ERROR))&&m.some(({audioCodec:w})=>n.audioCodec!==w),L=e.sourceBufferName==="video"&&(h===te.BUFFER_ADD_CODEC_ERROR||h===te.BUFFER_APPEND_ERROR)&&m.some(({codecSet:w,audioCodec:I})=>n.codecSet!==w&&n.audioCodec===I),{type:D,groupId:_}=(o=e.context)!=null?o:{};for(let w=m.length;w--;){const I=(w+p)%m.length;if(I!==p&&I>=v&&I<=y&&m[I].loadError===0){var u,f;const O=m[I];if(h===te.FRAG_GAP&&T===_e.MAIN&&e.frag){const F=m[I].details;if(F){const M=Jr(e.frag,F.fragments,e.frag.start);if(M!=null&&M.gap)continue}}else{if(D===tt.AUDIO_TRACK&&O.hasAudioGroup(_)||D===tt.SUBTITLE_TRACK&&O.hasSubtitleGroup(_))continue;if(T===_e.AUDIO&&(u=n.audioGroups)!=null&&u.some(F=>O.hasAudioGroup(F))||T===_e.SUBTITLE&&(f=n.subtitleGroups)!=null&&f.some(F=>O.hasSubtitleGroup(F))||b&&n.audioCodec===O.audioCodec||L&&n.codecSet===O.codecSet||!b&&n.codecSet!==O.codecSet)continue}d=I;break}}if(d>-1&&i.loadLevel!==d)return e.levelRetry=!0,this.playlistError=0,{action:ni.SendAlternateToPenaltyBox,flags:Oi.None,nextAutoLevel:d}}return{action:ni.SendAlternateToPenaltyBox,flags:Oi.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case ni.DoNothing:break;case ni.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==te.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break;case ni.RetryRequest:break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,i=e.errorAction;if(!i)return;const{flags:n}=i,r=i.nextAutoLevel;switch(n){case Oi.None:this.switchLevel(e,r);break;case Oi.MoveAllAlternatesMatchingHDCP:{const f=this.getVariantLevelIndex(e.frag),h=t.levels[f],d=h?.attrs["HDCP-LEVEL"];if(i.hdcpLevel=d,d==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(d){t.maxHdcpLevel=Pd[Pd.indexOf(d)-1],i.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Oi.MoveAllAlternatesMatchingKey:{const f=e.decryptdata;if(f){const h=this.hls.levels,d=h.length;for(let p=d;p--;)if(this.variantHasKey(h[p],f)){var o,u;this.log(`Banned key found in level ${p} (${h[p].bitrate}bps) or audio group "${(o=h[p].audioGroups)==null?void 0:o.join(",")}" (${(u=e.frag)==null?void 0:u.type} fragment) ${xi(f.keyId||[])}`),h[p].fragmentError++,h[p].loadError++,this.log(`Removing level ${p} with key error (${e.error})`),this.hls.removeLevel(p)}const m=e.frag;if(this.hls.levels.length<d)i.resolved=!0;else if(m&&m.type!==_e.MAIN){const p=m.decryptdata;p&&!f.matches(p)&&(i.resolved=!0)}}break}}i.resolved||this.switchLevel(e,r)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===te.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const i=Ud(e.mimeType),n=this.hls.levels;for(let r=n.length;r--;)n[r][`${e.sourceBufferName}Codec`]===i&&(this.log(`Removing level ${r} for ${e.details} ("${i}" not supported)`),this.hls.removeLevel(r))}}}function Qa(l){const e={action:ni.DoNothing,flags:Oi.None};return l&&(e.resolved=!0),e}var si={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class xL{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.BUFFER_APPENDED,this.onBufferAppended,this),e.on(R.FRAG_BUFFERED,this.onFragBuffered,this),e.on(R.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.BUFFER_APPENDED,this.onBufferAppended,this),e.off(R.FRAG_BUFFERED,this.onFragBuffered,this),e.off(R.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const i=this.activePartLists[t];if(i)for(let n=i.length;n--;){const r=i[n];if(!r)break;if(r.start<=e&&e<=r.end&&r.loaded)return r}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,i){const{fragments:n}=this,r=Object.keys(n);for(let o=r.length;o--;){const u=n[r[o]];if(u?.body.type===t&&(!i||u.buffered)){const f=u.body;if(f.start<=e&&e<=f.end)return f}}return null}detectEvictedFragments(e,t,i,n,r){this.timeRanges&&(this.timeRanges[e]=t);const o=n?.fragment.sn||-1;Object.keys(this.fragments).forEach(u=>{const f=this.fragments[u];if(!f||o>=f.body.sn)return;if(!f.buffered&&(!f.loaded||r)){f.body.type===i&&this.removeFragment(f.body);return}const h=f.range[e];if(h){if(h.time.length===0){this.removeFragment(f.body);return}h.time.some(d=>{const m=!this.isTimeBuffered(d.startPTS,d.endPTS,t);return m&&this.removeFragment(f.body),m})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const i=e.frag,n=Ka(i),r=this.fragments[n];if(!r||r.buffered&&i.gap)return;const o=!i.relurl;Object.keys(t).forEach(u=>{const f=i.elementaryStreams[u];if(!f)return;const h=t[u],d=o||f.partial===!0;r.range[u]=this.getBufferedTimes(i,e.part,d,h)}),r.loaded=null,Object.keys(r.range).length?(r.buffered=!0,(r.body.endList=i.endList||r.body.endList)&&(this.endListFragments[r.body.type]=r),ju(r)||this.removeParts(i.sn-1,i.type)):this.removeFragment(r.body)}removeParts(e,t){const i=this.activePartLists[t];i&&(this.activePartLists[t]=Nv(i,n=>n.fragment.sn>=e))}fragBuffered(e,t){const i=Ka(e);let n=this.fragments[i];!n&&t&&(n=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,n.buffered=!0)}getBufferedTimes(e,t,i,n){const r={time:[],partial:i},o=e.start,u=e.end,f=e.minEndPTS||u,h=e.maxStartPTS||o;for(let d=0;d<n.length;d++){const m=n.start(d)-this.bufferPadding,p=n.end(d)+this.bufferPadding;if(h>=m&&f<=p){r.time.push({startPTS:Math.max(o,n.start(d)),endPTS:Math.min(u,n.end(d))});break}else if(o<p&&u>m){const v=Math.max(o,n.start(d)),y=Math.min(u,n.end(d));y>v&&(r.partial=!0,r.time.push({startPTS:v,endPTS:y}))}else if(u<=m)break}return r}getPartialFragment(e){let t=null,i,n,r,o=0;const{bufferPadding:u,fragments:f}=this;return Object.keys(f).forEach(h=>{const d=f[h];d&&ju(d)&&(n=d.body.start-u,r=d.body.end+u,e>=n&&e<=r&&(i=Math.min(e-n,r-e),o<=i&&(t=d.body,o=i)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||ju(t))}getState(e){const t=Ka(e),i=this.fragments[t];return i?i.buffered?ju(i)?si.PARTIAL:si.OK:si.APPENDING:si.NOT_LOADED}isTimeBuffered(e,t,i){let n,r;for(let o=0;o<i.length;o++){if(n=i.start(o)-this.bufferPadding,r=i.end(o)+this.bufferPadding,e>=n&&t<=r)return!0;if(t<=n)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const i=t.frag,n=t.part?null:t,r=Ka(i);this.fragments[r]={body:i,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:i,part:n,timeRanges:r,type:o}=t;if(i.sn==="initSegment")return;const u=i.type;if(n){let h=this.activePartLists[u];h||(this.activePartLists[u]=h=[]),h.push(n)}this.timeRanges=r;const f=r[o];this.detectEvictedFragments(o,f,u,n)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Ka(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,i=Object.keys(t);if(!e)return i.length>0;for(let n=i.length;n--;){const r=t[i[n]];if(r?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,i,n,r){n&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const u=this.fragments[o];if(!u)return;const f=u.body;f.type!==i||n&&!f.gap||f.start<t&&f.end>e&&(u.buffered||r)&&this.removeFragment(f)})}removeFragment(e){const t=Ka(e);e.clearElementaryStreamInfo();const i=this.activePartLists[e.type];if(i){const n=e.sn;this.activePartLists[e.type]=Nv(i,r=>r.fragment.sn!==n)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(i=>i.clearElementaryStreamInfo())}}function ju(l){var e,t,i;return l.buffered&&!!(l.body.gap||(e=l.range.video)!=null&&e.partial||(t=l.range.audio)!=null&&t.partial||(i=l.range.audiovideo)!=null&&i.partial)}function Ka(l){return`${l.type}_${l.level}_${l.sn}`}function Nv(l,e){return l.filter(t=>{const i=e(t);return i||t.clearElementaryStreamInfo(),i})}var fr={cbc:0,ctr:1};class CL{constructor(e,t,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=i}decrypt(e,t){switch(this.aesMode){case fr.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case fr.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function RL(l){const e=l.byteLength,t=e&&new DataView(l.buffer).getUint8(e-1);return t?l.slice(0,e-t):l}class LL{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),i=new Uint32Array(4);for(let n=0;n<4;n++)i[n]=t.getUint32(n*4);return i}initTable(){const e=this.sBox,t=this.invSBox,i=this.subMix,n=i[0],r=i[1],o=i[2],u=i[3],f=this.invSubMix,h=f[0],d=f[1],m=f[2],p=f[3],v=new Uint32Array(256);let y=0,T=0,S=0;for(S=0;S<256;S++)S<128?v[S]=S<<1:v[S]=S<<1^283;for(S=0;S<256;S++){let b=T^T<<1^T<<2^T<<3^T<<4;b=b>>>8^b&255^99,e[y]=b,t[b]=y;const C=v[y],L=v[C],D=v[L];let _=v[b]*257^b*16843008;n[y]=_<<24|_>>>8,r[y]=_<<16|_>>>16,o[y]=_<<8|_>>>24,u[y]=_,_=D*16843009^L*65537^C*257^y*16843008,h[b]=_<<24|_>>>8,d[b]=_<<16|_>>>16,m[b]=_<<8|_>>>24,p[b]=_,y?(y=C^v[v[v[D^C]]],T^=v[v[T]]):y=T=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let i=!0,n=0;for(;n<t.length&&i;)i=t[n]===this.key[n],n++;if(i)return;this.key=t;const r=this.keySize=t.length;if(r!==4&&r!==6&&r!==8)throw new Error("Invalid aes key size="+r);const o=this.ksRows=(r+6+1)*4;let u,f;const h=this.keySchedule=new Uint32Array(o),d=this.invKeySchedule=new Uint32Array(o),m=this.sBox,p=this.rcon,v=this.invSubMix,y=v[0],T=v[1],S=v[2],b=v[3];let C,L;for(u=0;u<o;u++){if(u<r){C=h[u]=t[u];continue}L=C,u%r===0?(L=L<<8|L>>>24,L=m[L>>>24]<<24|m[L>>>16&255]<<16|m[L>>>8&255]<<8|m[L&255],L^=p[u/r|0]<<24):r>6&&u%r===4&&(L=m[L>>>24]<<24|m[L>>>16&255]<<16|m[L>>>8&255]<<8|m[L&255]),h[u]=C=(h[u-r]^L)>>>0}for(f=0;f<o;f++)u=o-f,f&3?L=h[u]:L=h[u-4],f<4||u<=4?d[f]=L:d[f]=y[m[L>>>24]]^T[m[L>>>16&255]]^S[m[L>>>8&255]]^b[m[L&255]],d[f]=d[f]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,i){const n=this.keySize+6,r=this.invKeySchedule,o=this.invSBox,u=this.invSubMix,f=u[0],h=u[1],d=u[2],m=u[3],p=this.uint8ArrayToUint32Array_(i);let v=p[0],y=p[1],T=p[2],S=p[3];const b=new Int32Array(e),C=new Int32Array(b.length);let L,D,_,w,I,O,F,M,H,P,z,Y,Z,k;const K=this.networkToHostOrderSwap;for(;t<b.length;){for(H=K(b[t]),P=K(b[t+1]),z=K(b[t+2]),Y=K(b[t+3]),I=H^r[0],O=Y^r[1],F=z^r[2],M=P^r[3],Z=4,k=1;k<n;k++)L=f[I>>>24]^h[O>>16&255]^d[F>>8&255]^m[M&255]^r[Z],D=f[O>>>24]^h[F>>16&255]^d[M>>8&255]^m[I&255]^r[Z+1],_=f[F>>>24]^h[M>>16&255]^d[I>>8&255]^m[O&255]^r[Z+2],w=f[M>>>24]^h[I>>16&255]^d[O>>8&255]^m[F&255]^r[Z+3],I=L,O=D,F=_,M=w,Z=Z+4;L=o[I>>>24]<<24^o[O>>16&255]<<16^o[F>>8&255]<<8^o[M&255]^r[Z],D=o[O>>>24]<<24^o[F>>16&255]<<16^o[M>>8&255]<<8^o[I&255]^r[Z+1],_=o[F>>>24]<<24^o[M>>16&255]<<16^o[I>>8&255]<<8^o[O&255]^r[Z+2],w=o[M>>>24]<<24^o[I>>16&255]<<16^o[O>>8&255]<<8^o[F&255]^r[Z+3],C[t]=K(L^v),C[t+1]=K(w^y),C[t+2]=K(_^T),C[t+3]=K(D^S),v=H,y=P,T=z,S=Y,t=t+4}return C.buffer}}class DL{constructor(e,t,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=i}expandKey(){const e=_L(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function _L(l){switch(l){case fr.cbc:return"AES-CBC";case fr.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${l}`)}}const IL=16;class yg{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?RL(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i,n){return this.useSoftware?new Promise((r,o)=>{const u=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(u,t,i,n);const f=this.flush();f?r(f.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i,n)}softwareDecrypt(e,t,i,n){const{currentIV:r,currentResult:o,remainderData:u}=this;if(n!==fr.cbc||t.byteLength!==16)return vt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),u&&(e=dn(u,e),this.remainderData=null);const f=this.getValidChunk(e);if(!f.length)return null;r&&(i=r);let h=this.softwareDecrypter;h||(h=this.softwareDecrypter=new LL),h.expandKey(t);const d=o;return this.currentResult=h.decrypt(f.buffer,0,i),this.currentIV=f.slice(-16).buffer,d||null}webCryptoDecrypt(e,t,i,n){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,i,n));this.key=t,this.fastAesKey=new DL(this.subtle,t,n)}return this.fastAesKey.expandKey().then(r=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new CL(this.subtle,new Uint8Array(i),n).decrypt(e.buffer,r)):Promise.reject(new Error("web crypto not initialized"))).catch(r=>(vt.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(e,t,i,n)))}onWebCryptoError(e,t,i,n){const r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i,n);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const i=e.length-e.length%IL;return i!==e.length&&(t=e.slice(0,i),this.remainderData=e.slice(i)),t}logOnce(e){this.logEnabled&&(vt.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Gv=Math.pow(2,17);class BL{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const i=e.url;if(!i)return Promise.reject(new Rs({type:ke.NETWORK_ERROR,details:te.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const n=this.config,r=n.fLoader,o=n.loader;return new Promise((u,f)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(y=>y[0]==="GAP")){f(Kv(e));return}else e.gap=!1;const h=this.loader=r?new r(n):new o(n),d=Hv(e);e.loader=h;const m=Pv(n.fragLoadPolicy.default),p={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Gv};e.stats=h.stats;const v={onSuccess:(y,T,S,b)=>{this.resetLoader(e,h);let C=y.data;S.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(C.slice(0,16)),C=C.slice(16)),u({frag:e,part:null,payload:C,networkDetails:b})},onError:(y,T,S,b)=>{this.resetLoader(e,h),f(new Rs({type:ke.NETWORK_ERROR,details:te.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:At({url:i,data:void 0},y),error:new Error(`HTTP Error ${y.code} ${y.text}`),networkDetails:S,stats:b}))},onAbort:(y,T,S)=>{this.resetLoader(e,h),f(new Rs({type:ke.NETWORK_ERROR,details:te.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:S,stats:y}))},onTimeout:(y,T,S)=>{this.resetLoader(e,h),f(new Rs({type:ke.NETWORK_ERROR,details:te.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${p.timeout}ms`),networkDetails:S,stats:y}))}};t&&(v.onProgress=(y,T,S,b)=>t({frag:e,part:null,payload:S,networkDetails:b})),h.load(d,p,v)})}loadPart(e,t,i){this.abort();const n=this.config,r=n.fLoader,o=n.loader;return new Promise((u,f)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){f(Kv(e,t));return}const h=this.loader=r?new r(n):new o(n),d=Hv(e,t);e.loader=h;const m=Pv(n.fragLoadPolicy.default),p={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Gv};t.stats=h.stats,h.load(d,p,{onSuccess:(v,y,T,S)=>{this.resetLoader(e,h),this.updateStatsFromPart(e,t);const b={frag:e,part:t,payload:v.data,networkDetails:S};i(b),u(b)},onError:(v,y,T,S)=>{this.resetLoader(e,h),f(new Rs({type:ke.NETWORK_ERROR,details:te.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:At({url:d.url,data:void 0},v),error:new Error(`HTTP Error ${v.code} ${v.text}`),networkDetails:T,stats:S}))},onAbort:(v,y,T)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,h),f(new Rs({type:ke.NETWORK_ERROR,details:te.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:T,stats:v}))},onTimeout:(v,y,T)=>{this.resetLoader(e,h),f(new Rs({type:ke.NETWORK_ERROR,details:te.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${p.timeout}ms`),networkDetails:T,stats:v}))}})})}updateStatsFromPart(e,t){const i=e.stats,n=t.stats,r=n.total;if(i.loaded+=n.loaded,r){const f=Math.round(e.duration/t.duration),h=Math.min(Math.round(i.loaded/r),f),m=(f-h)*Math.round(i.loaded/h);i.total=i.loaded+m}else i.total=Math.max(i.loaded,i.total);const o=i.loading,u=n.loading;o.start?o.first+=u.first-u.start:(o.start=u.start,o.first=u.first),o.end=u.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Hv(l,e=null){const t=e||l,i={frag:l,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},n=t.byteRangeStartOffset,r=t.byteRangeEndOffset;if(xe(n)&&xe(r)){var o;let u=n,f=r;if(l.sn==="initSegment"&&ML((o=l.decryptdata)==null?void 0:o.method)){const h=r-n;h%16&&(f=r+(16-h%16)),n!==0&&(i.resetIV=!0,u=n-16)}i.rangeStart=u,i.rangeEnd=f}return i}function Kv(l,e){const t=new Error(`GAP ${l.gap?"tag":"attribute"} found`),i={type:ke.MEDIA_ERROR,details:te.FRAG_GAP,fatal:!1,frag:l,error:t,networkDetails:null};return e&&(i.part=e),(e||l).stats.aborted=!0,new Rs(i)}function ML(l){return l==="AES-128"||l==="AES-256"}class Rs extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class NE extends gn{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class wc{constructor(e,t,i,n=0,r=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Ju(),this.buffering={audio:Ju(),video:Ju(),audiovideo:Ju()},this.level=e,this.sn=t,this.id=i,this.size=n,this.part=r,this.partial=o}}function Ju(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Vv={length:0,start:()=>0,end:()=>0};class je{static isBuffered(e,t){if(e){const i=je.getBuffered(e);for(let n=i.length;n--;)if(t>=i.start(n)&&t<=i.end(n))return!0}return!1}static bufferedRanges(e){if(e){const t=je.getBuffered(e);return je.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}static bufferInfo(e,t,i){if(e){const n=je.bufferedRanges(e);if(n.length)return je.bufferedInfo(n,t,i)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.length>1&&e.sort((d,m)=>d.start-m.start||m.end-d.end);let n=-1,r=[];if(i)for(let d=0;d<e.length;d++){t>=e[d].start&&t<=e[d].end&&(n=d);const m=r.length;if(m){const p=r[m-1].end;e[d].start-p<i?e[d].end>p&&(r[m-1].end=e[d].end):r.push(e[d])}else r.push(e[d])}else r=e;let o=0,u,f=t,h=t;for(let d=0;d<r.length;d++){const m=r[d].start,p=r[d].end;if(n===-1&&t>=m&&t<=p&&(n=d),t+i>=m&&t<p)f=m,h=p,o=h-t;else if(t+i<m){u=m;break}}return{len:o,start:f||0,end:h||0,nextStart:u,buffered:e,bufferedIndex:n}}static getBuffered(e){try{return e.buffered||Vv}catch(t){return vt.log("failed to get media.buffered",t),Vv}}}const GE=/\{\$([a-zA-Z0-9-_]+)\}/g;function $v(l){return GE.test(l)}function Hd(l,e){if(l.variableList!==null||l.hasVariableRefs){const t=l.variableList;return e.replace(GE,i=>{const n=i.substring(2,i.length-1),r=t?.[n];return r===void 0?(l.playlistParsingError||(l.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${n}"`)),i):r})}return e}function Yv(l,e,t){let i=l.variableList;i||(l.variableList=i={});let n,r;if("QUERYPARAM"in e){n=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(n))r=o.get(n);else throw new Error(`"${n}" does not match any query parameter in URI: "${t}"`)}catch(o){l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else n=e.NAME,r=e.VALUE;n in i?l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${n}"`)):i[n]=r||""}function OL(l,e,t){const i=e.IMPORT;if(t&&i in t){let n=l.variableList;n||(l.variableList=n={}),n[i]=t[i]}else l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const FL=/^(\d+)x(\d+)$/,zv=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Pt{constructor(e,t){typeof e=="string"&&(e=Pt.parseAttrList(e,t)),xt(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const i=new Uint8Array(t.length/2);for(let n=0;n<t.length/2;n++)i[n]=parseInt(t.slice(n*2,n*2+2),16);return i}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const i=this[e];return(i?i.split(/[ ,]+/):[]).reduce((n,r)=>(n[r.toLowerCase()]=!0,n),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=FL.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let i;const n={};for(zv.lastIndex=0;(i=zv.exec(e))!==null;){const o=i[1].trim();let u=i[2];const f=u.indexOf('"')===0&&u.lastIndexOf('"')===u.length-1;let h=!1;if(f)u=u.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":h=!0}if(t&&(f||h))u=Hd(t,u);else if(!h&&!f)switch(o){case"CLOSED-CAPTIONS":if(u==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":vt.warn(`${e}: attribute ${o} is missing quotes`)}n[o]=u}return n}}const kL="com.apple.hls.interstitial";function wL(l){return l!=="ID"&&l!=="CLASS"&&l!=="CUE"&&l!=="START-DATE"&&l!=="DURATION"&&l!=="END-DATE"&&l!=="END-ON-NEXT"}function UL(l){return l==="SCTE35-OUT"||l==="SCTE35-IN"||l==="SCTE35-CMD"}class Eg{constructor(e,t,i=0){var n;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(n=t?.tagOrder)!=null?n:i,t){const r=t.attr;for(const o in r)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==r[o]){vt.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=xt(new Pt({}),r,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const r=t?.endDate||new Date(this.attr["END-DATE"]);xe(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(vt.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(xe(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===kL}get isValid(){return!!this.id&&!this._badValueForSameId&&xe(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const PL=10;class HE{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let i=t.decryptdata;return i||(t.setKeyFormat(e.keyFormat),i=t.decryptdata),!!i&&e.matches(i)})}get hasProgramDateTime(){return this.fragments.length?xe(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||PL}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let i=e.length;i--;)if(e[i].index>t)return e[i].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Rc(l,e){return l.length===e.length?!l.some((t,i)=>t!==e[i]):!1}function jv(l,e){return!l&&!e?!0:!l||!e?!1:Rc(l,e)}function qa(l){return l==="AES-128"||l==="AES-256"||l==="AES-256-CTR"}function Tg(l){switch(l){case"AES-128":case"AES-256":return fr.cbc;case"AES-256-CTR":return fr.ctr;default:throw new Error(`invalid full segment method ${l}`)}}function Sg(l){return Uint8Array.from(atob(l),e=>e.charCodeAt(0))}function Kd(l){return Uint8Array.from(unescape(encodeURIComponent(l)),e=>e.charCodeAt(0))}function NL(l){const e=Kd(l).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function KE(l){const e=function(i,n,r){const o=i[n];i[n]=i[r],i[r]=o};e(l,0,3),e(l,1,2),e(l,4,5),e(l,6,7)}function VE(l){const e=l.split(":");let t=null;if(e[0]==="data"&&e.length===2){const i=e[1].split(";"),n=i[i.length-1].split(",");if(n.length===2){const r=n[0]==="base64",o=n[1];r?(i.splice(-1,1),t=Sg(o)):t=NL(o)}}return t}const Lc=typeof self<"u"?self:void 0;var Nt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},ci={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function fc(l){switch(l){case ci.FAIRPLAY:return Nt.FAIRPLAY;case ci.PLAYREADY:return Nt.PLAYREADY;case ci.WIDEVINE:return Nt.WIDEVINE;case ci.CLEARKEY:return Nt.CLEARKEY}}function id(l){switch(l){case Nt.FAIRPLAY:return ci.FAIRPLAY;case Nt.PLAYREADY:return ci.PLAYREADY;case Nt.WIDEVINE:return ci.WIDEVINE;case Nt.CLEARKEY:return ci.CLEARKEY}}function ll(l){const{drmSystems:e,widevineLicenseUrl:t}=l,i=e?[Nt.FAIRPLAY,Nt.WIDEVINE,Nt.PLAYREADY,Nt.CLEARKEY].filter(n=>!!e[n]):[];return!i[Nt.WIDEVINE]&&t&&i.push(Nt.WIDEVINE),i}const bg=(function(l){return Lc!=null&&(l=Lc.navigator)!=null&&l.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function GL(l,e,t,i){let n;switch(l){case Nt.FAIRPLAY:n=["cenc","sinf"];break;case Nt.WIDEVINE:case Nt.PLAYREADY:n=["cenc"];break;case Nt.CLEARKEY:n=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${l}`)}return HL(n,e,t,i)}function HL(l,e,t,i){return[{initDataTypes:l,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(r=>({contentType:`audio/mp4; codecs=${r}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:t.map(r=>({contentType:`video/mp4; codecs=${r}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function KL(l){var e;return!!l&&(l.sessionType==="persistent-license"||!!((e=l.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function $E(l){const e=new Uint16Array(l.buffer,l.byteOffset,l.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),i=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(o){const u=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(u){const f=Sg(u).subarray(0,16);return KE(f),f}}return null}let Xu={};class cr{static clearKeyUriToKeyIdMap(){Xu={}}static setKeyIdForUri(e,t){Xu[e]=t}constructor(e,t,i,n=[1],r=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=n,this.iv=r,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!qa(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(AE(o)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Rc(e.keyFormatVersions,this.keyFormatVersions)&&jv(e.iv,this.iv)&&jv(e.keyId,this.keyId)}isSupported(){if(this.method){if(qa(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case ci.FAIRPLAY:case ci.WIDEVINE:case ci.PLAYREADY:case ci.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(qa(this.method)){let r=this.iv;return r||(typeof e!="number"&&(vt.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),r=$L(e)),new cr(this.method,this.uri,"identity",this.keyFormatVersions,r)}if(this.keyId){const r=Xu[this.uri];if(r&&!Rc(this.keyId,r)&&cr.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const i=VE(this.uri);if(i)switch(this.keyFormat){case ci.WIDEVINE:if(this.pssh=i,!this.keyId){const r=QR(i.buffer);if(r.length){var n;const o=r[0];this.keyId=(n=o.kids)!=null&&n.length?o.kids[0]:null}}this.keyId||(this.keyId=Jv(t));break;case ci.PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=XR(r,null,i),this.keyId=$E(i);break}default:{let r=i.subarray(0,16);if(r.length!==16){const o=new Uint8Array(16);o.set(r,16-r.length),r=o}this.keyId=r;break}}if(!this.keyId||this.keyId.byteLength!==16){let r;r=VL(t),r||(r=Jv(t),r||(r=Xu[this.uri])),r&&(this.keyId=r,cr.setKeyIdForUri(this.uri,r))}return this}}function VL(l){const e=l?.[ci.WIDEVINE];return e?e.keyId:null}function Jv(l){const e=l?.[ci.PLAYREADY];if(e){const t=VE(e.uri);if(t)return $E(t)}return null}function $L(l){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=l>>8*(15-t)&255;return e}const Xv=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Qv=/#EXT-X-MEDIA:(.*)/g,YL=/^#EXT(?:INF|-X-TARGETDURATION):/m,nd=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),zL=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Cn{static findGroup(e,t){for(let i=0;i<e.length;i++){const n=e[i];if(n.id===t)return n}}static resolve(e,t){return dg.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return YL.test(e)}static parseMasterPlaylist(e,t){const i=$v(e),n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},r=[];if(Xv.lastIndex=0,!e.startsWith("#EXTM3U"))return n.playlistParsingError=new Error("no EXTM3U delimiter"),n;let o;for(;(o=Xv.exec(e))!=null;)if(o[1]){var u;const h=new Pt(o[1],n),d=Hd(n,o[2]),m={attrs:h,bitrate:h.decimalInteger("BANDWIDTH")||h.decimalInteger("AVERAGE-BANDWIDTH"),name:h.NAME,url:Cn.resolve(d,t)},p=h.decimalResolution("RESOLUTION");p&&(m.width=p.width,m.height=p.height),Zv(h.CODECS,m);const v=h["SUPPLEMENTAL-CODECS"];v&&(m.supplemental={},Zv(v,m.supplemental)),(u=m.unknownCodecs)!=null&&u.length||r.push(m),n.levels.push(m)}else if(o[3]){const h=o[3],d=o[4];switch(h){case"SESSION-DATA":{const m=new Pt(d,n),p=m["DATA-ID"];p&&(n.sessionData===null&&(n.sessionData={}),n.sessionData[p]=m);break}case"SESSION-KEY":{const m=qv(d,t,n);m.encrypted&&m.isSupported()?(n.sessionKeys===null&&(n.sessionKeys=[]),n.sessionKeys.push(m)):vt.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${d}"`);break}case"DEFINE":{{const m=new Pt(d,n);Yv(n,m,t)}break}case"CONTENT-STEERING":{const m=new Pt(d,n);n.contentSteering={uri:Cn.resolve(m["SERVER-URI"],t),pathwayId:m["PATHWAY-ID"]||"."};break}case"START":{n.startTimeOffset=Wv(d);break}}}const f=r.length>0&&r.length<n.levels.length;return n.levels=f?r:n.levels,n.levels.length===0&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(e,t,i){let n;const r={},o=i.levels,u={AUDIO:o.map(h=>({id:h.attrs.AUDIO,audioCodec:h.audioCodec})),SUBTITLES:o.map(h=>({id:h.attrs.SUBTITLES,textCodec:h.textCodec})),"CLOSED-CAPTIONS":[]};let f=0;for(Qv.lastIndex=0;(n=Qv.exec(e))!==null;){const h=new Pt(n[1],i),d=h.TYPE;if(d){const m=u[d],p=r[d]||[];r[d]=p;const v=h.LANGUAGE,y=h["ASSOC-LANGUAGE"],T=h.CHANNELS,S=h.CHARACTERISTICS,b=h["INSTREAM-ID"],C={attrs:h,bitrate:0,id:f++,groupId:h["GROUP-ID"]||"",name:h.NAME||v||"",type:d,default:h.bool("DEFAULT"),autoselect:h.bool("AUTOSELECT"),forced:h.bool("FORCED"),lang:v,url:h.URI?Cn.resolve(h.URI,t):""};if(y&&(C.assocLang=y),T&&(C.channels=T),S&&(C.characteristics=S),b&&(C.instreamId=b),m!=null&&m.length){const L=Cn.findGroup(m,C.groupId)||m[0];ey(C,L,"audioCodec"),ey(C,L,"textCodec")}p.push(C)}}return r}static parseLevelPlaylist(e,t,i,n,r,o){var u;const f={url:t},h=new HE(t),d=h.fragments,m=[];let p=null,v=0,y=0,T=0,S=0,b=0,C=null,L=new uc(n,f),D,_,w,I=-1,O=!1,F=null,M;if(nd.lastIndex=0,h.m3u8=e,h.hasVariableRefs=$v(e),((u=nd.exec(e))==null?void 0:u[0])!=="#EXTM3U")return h.playlistParsingError=new Error("Missing format identifier #EXTM3U"),h;for(;(D=nd.exec(e))!==null;){O&&(O=!1,L=new uc(n,f),L.playlistOffset=T,L.setStart(T),L.sn=v,L.cc=S,b&&(L.bitrate=b),L.level=i,p&&(L.initSegment=p,p.rawProgramDateTime&&(L.rawProgramDateTime=p.rawProgramDateTime,p.rawProgramDateTime=null),F&&(L.setByteRange(F),F=null)));const Y=D[1];if(Y){L.duration=parseFloat(Y);const Z=(" "+D[2]).slice(1);L.title=Z||null,L.tagList.push(Z?["INF",Y,Z]:["INF",Y])}else if(D[3]){if(xe(L.duration)){L.playlistOffset=T,L.setStart(T),w&&iy(L,w,h),L.sn=v,L.level=i,L.cc=S,d.push(L);const Z=(" "+D[3]).slice(1);L.relurl=Hd(h,Z),Vd(L,C,m),C=L,T+=L.duration,v++,y=0,O=!0}}else{if(D=D[0].match(zL),!D){vt.warn("No matches on slow regex match for level playlist!");continue}for(_=1;_<D.length&&D[_]===void 0;_++);const Z=(" "+D[_]).slice(1),k=(" "+D[_+1]).slice(1),K=D[_+2]?(" "+D[_+2]).slice(1):null;switch(Z){case"BYTERANGE":C?L.setByteRange(k,C):L.setByteRange(k);break;case"PROGRAM-DATE-TIME":L.rawProgramDateTime=k,L.tagList.push(["PROGRAM-DATE-TIME",k]),I===-1&&(I=d.length);break;case"PLAYLIST-TYPE":h.type&&bs(h,Z,D),h.type=k.toUpperCase();break;case"MEDIA-SEQUENCE":h.startSN!==0?bs(h,Z,D):d.length>0&&ny(h,Z,D),v=h.startSN=parseInt(k);break;case"SKIP":{h.skippedSegments&&bs(h,Z,D);const Q=new Pt(k,h),j=Q.decimalInteger("SKIPPED-SEGMENTS");if(xe(j)){h.skippedSegments+=j;for(let U=j;U--;)d.push(null);v+=j}const J=Q.enumeratedString("RECENTLY-REMOVED-DATERANGES");J&&(h.recentlyRemovedDateranges=(h.recentlyRemovedDateranges||[]).concat(J.split("	")));break}case"TARGETDURATION":h.targetduration!==0&&bs(h,Z,D),h.targetduration=Math.max(parseInt(k),1);break;case"VERSION":h.version!==null&&bs(h,Z,D),h.version=parseInt(k);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":h.live||bs(h,Z,D),h.live=!1;break;case"#":(k||K)&&L.tagList.push(K?[k,K]:[k]);break;case"DISCONTINUITY":S++,L.tagList.push(["DIS"]);break;case"GAP":L.gap=!0,L.tagList.push([Z]);break;case"BITRATE":L.tagList.push([Z,k]),b=parseInt(k)*1e3,xe(b)?L.bitrate=b:b=0;break;case"DATERANGE":{const Q=new Pt(k,h),j=new Eg(Q,h.dateRanges[Q.ID],h.dateRangeTagCount);h.dateRangeTagCount++,j.isValid||h.skippedSegments?h.dateRanges[j.id]=j:vt.warn(`Ignoring invalid DATERANGE tag: "${k}"`),L.tagList.push(["EXT-X-DATERANGE",k]);break}case"DEFINE":{{const Q=new Pt(k,h);"IMPORT"in Q?OL(h,Q,o):Yv(h,Q,t)}break}case"DISCONTINUITY-SEQUENCE":h.startCC!==0?bs(h,Z,D):d.length>0&&ny(h,Z,D),h.startCC=S=parseInt(k);break;case"KEY":{const Q=qv(k,t,h);if(Q.isSupported()){if(Q.method==="NONE"){w=void 0;break}w||(w={});const j=w[Q.keyFormat];j!=null&&j.matches(Q)||(j&&(w=xt({},w)),w[Q.keyFormat]=Q)}else vt.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${k}"`);break}case"START":h.startTimeOffset=Wv(k);break;case"MAP":{const Q=new Pt(k,h);if(L.duration){const j=new uc(n,f);ty(j,Q,i,w),p=j,L.initSegment=p,p.rawProgramDateTime&&!L.rawProgramDateTime&&(L.rawProgramDateTime=p.rawProgramDateTime)}else{const j=L.byteRangeEndOffset;if(j){const J=L.byteRangeStartOffset;F=`${j-J}@${J}`}else F=null;ty(L,Q,i,w),p=L,O=!0}p.cc=S;break}case"SERVER-CONTROL":{M&&bs(h,Z,D),M=new Pt(k),h.canBlockReload=M.bool("CAN-BLOCK-RELOAD"),h.canSkipUntil=M.optionalFloat("CAN-SKIP-UNTIL",0),h.canSkipDateRanges=h.canSkipUntil>0&&M.bool("CAN-SKIP-DATERANGES"),h.partHoldBack=M.optionalFloat("PART-HOLD-BACK",0),h.holdBack=M.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{h.partTarget&&bs(h,Z,D);const Q=new Pt(k);h.partTarget=Q.decimalFloatingPoint("PART-TARGET");break}case"PART":{let Q=h.partList;Q||(Q=h.partList=[]);const j=y>0?Q[Q.length-1]:void 0,J=y++,U=new Pt(k,h),N=new vE(U,L,f,J,j);Q.push(N),L.duration+=N.duration;break}case"PRELOAD-HINT":{const Q=new Pt(k,h);h.preloadHint=Q;break}case"RENDITION-REPORT":{const Q=new Pt(k,h);h.renditionReports=h.renditionReports||[],h.renditionReports.push(Q);break}default:vt.warn(`line parsed but not handled: ${D}`);break}}}C&&!C.relurl?(d.pop(),T-=C.duration,h.partList&&(h.fragmentHint=C)):h.partList&&(Vd(L,C,m),L.cc=S,h.fragmentHint=L,w&&iy(L,w,h)),h.targetduration||(h.playlistParsingError=new Error("Missing Target Duration"));const H=d.length,P=d[0],z=d[H-1];if(T+=h.skippedSegments*h.targetduration,T>0&&H&&z){h.averagetargetduration=T/H;const Y=z.sn;h.endSN=Y!=="initSegment"?Y:0,h.live||(z.endList=!0),I>0&&(JL(d,I),P&&m.unshift(P))}return h.fragmentHint&&(T+=h.fragmentHint.duration),h.totalduration=T,m.length&&h.dateRangeTagCount&&P&&YE(m,h),h.endCC=S,h}}function YE(l,e){let t=l.length;if(!t)if(e.hasProgramDateTime){const u=e.fragments[e.fragments.length-1];l.push(u),t++}else return;const i=l[t-1],n=e.live?1/0:e.totalduration,r=Object.keys(e.dateRanges);for(let u=r.length;u--;){const f=e.dateRanges[r[u]],h=f.startDate.getTime();f.tagAnchor=i.ref;for(let d=t;d--;){var o;if(((o=l[d])==null?void 0:o.sn)<e.startSN)break;const m=jL(e,h,l,d,n);if(m!==-1){f.tagAnchor=e.fragments[m].ref;break}}}}function jL(l,e,t,i,n){const r=t[i];if(r){const u=r.programDateTime;if(e>=u||i===0){var o;const f=(((o=t[i+1])==null?void 0:o.start)||n)-r.start;if(e<=u+f*1e3){const h=t[i].sn-l.startSN;if(h<0)return-1;const d=l.fragments;if(d.length>t.length){const p=(t[i+1]||d[d.length-1]).sn-l.startSN;for(let v=p;v>h;v--){const y=d[v].programDateTime;if(e>=y&&e<y+d[v].duration*1e3)return v}}return h}}}return-1}function qv(l,e,t){var i,n;const r=new Pt(l,t),o=(i=r.METHOD)!=null?i:"",u=r.URI,f=r.hexadecimalInteger("IV"),h=r.KEYFORMATVERSIONS,d=(n=r.KEYFORMAT)!=null?n:"identity";u&&r.IV&&!f&&vt.error(`Invalid IV: ${r.IV}`);const m=u?Cn.resolve(u,e):"",p=(h||"1").split("/").map(Number).filter(Number.isFinite);return new cr(o,m,d,p,f,r.KEYID)}function Wv(l){const t=new Pt(l).decimalFloatingPoint("TIME-OFFSET");return xe(t)?t:null}function Zv(l,e){let t=(l||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{const n=t.filter(r=>pg(r,i));n.length&&(e[`${i}Codec`]=n.map(r=>r.split("/")[0]).join(","),t=t.filter(r=>n.indexOf(r)===-1))}),e.unknownCodecs=t}function ey(l,e,t){const i=e[t];i&&(l[t]=i)}function JL(l,e){let t=l[e];for(let i=e;i--;){const n=l[i];if(!n)return;n.programDateTime=t.programDateTime-n.duration*1e3,t=n}}function Vd(l,e,t){l.rawProgramDateTime?t.push(l):e!=null&&e.programDateTime&&(l.programDateTime=e.endProgramDateTime)}function ty(l,e,t,i){l.relurl=e.URI,e.BYTERANGE&&l.setByteRange(e.BYTERANGE),l.level=t,l.sn="initSegment",i&&(l.levelkeys=i),l.initSegment=null}function iy(l,e,t){l.levelkeys=e;const{encryptedFragments:i}=t;(!i.length||i[i.length-1].levelkeys!==e)&&Object.keys(e).some(n=>e[n].isCommonEncryption)&&i.push(l)}function bs(l,e,t){l.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function ny(l,e,t){l.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function sd(l,e){const t=e.startPTS;if(xe(t)){let i=0,n;e.sn>l.sn?(i=t-l.start,n=l):(i=l.start-t,n=e),n.duration!==i&&n.setDuration(i)}else e.sn>l.sn?l.cc===e.cc&&l.minEndPTS?e.setStart(l.start+(l.minEndPTS-l.start)):e.setStart(l.start+l.duration):e.setStart(Math.max(l.start-e.duration,0))}function zE(l,e,t,i,n,r,o){i-t<=0&&(o.warn("Fragment should have a positive duration",e),i=t+e.duration,r=n+e.duration);let f=t,h=i;const d=e.startPTS,m=e.endPTS;if(xe(d)){const b=Math.abs(d-t);l&&b>l.totalduration?o.warn(`media timestamps and playlist times differ by ${b}s for level ${e.level} ${l.url}`):xe(e.deltaPTS)?e.deltaPTS=Math.max(b,e.deltaPTS):e.deltaPTS=b,f=Math.max(t,d),t=Math.min(t,d),n=e.startDTS!==void 0?Math.min(n,e.startDTS):n,h=Math.min(i,m),i=Math.max(i,m),r=e.endDTS!==void 0?Math.max(r,e.endDTS):r}const p=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(i-e.start),e.startPTS=t,e.maxStartPTS=f,e.startDTS=n,e.endPTS=i,e.minEndPTS=h,e.endDTS=r;const v=e.sn;if(!l||v<l.startSN||v>l.endSN)return 0;let y;const T=v-l.startSN,S=l.fragments;for(S[T]=e,y=T;y>0;y--)sd(S[y],S[y-1]);for(y=T;y<S.length-1;y++)sd(S[y],S[y+1]);return l.fragmentHint&&sd(S[S.length-1],l.fragmentHint),l.PTSKnown=l.alignedSliding=!0,p}function XL(l,e,t){if(l===e)return;let i=null;const n=l.fragments;for(let d=n.length-1;d>=0;d--){const m=n[d].initSegment;if(m){i=m;break}}l.fragmentHint&&delete l.fragmentHint.endPTS;let r;WL(l,e,(d,m,p,v)=>{if((!e.startCC||e.skippedSegments)&&m.cc!==d.cc){const y=d.cc-m.cc;for(let T=p;T<v.length;T++)v[T].cc+=y;e.endCC=v[v.length-1].cc}xe(d.startPTS)&&xe(d.endPTS)&&(m.setStart(m.startPTS=d.startPTS),m.startDTS=d.startDTS,m.maxStartPTS=d.maxStartPTS,m.endPTS=d.endPTS,m.endDTS=d.endDTS,m.minEndPTS=d.minEndPTS,m.setDuration(d.endPTS-d.startPTS),m.duration&&(r=m),e.PTSKnown=e.alignedSliding=!0),d.hasStreams&&(m.elementaryStreams=d.elementaryStreams),m.loader=d.loader,d.hasStats&&(m.stats=d.stats),d.initSegment&&(m.initSegment=d.initSegment,i=d.initSegment)});const o=e.fragments,u=e.fragmentHint?o.concat(e.fragmentHint):o;if(i&&u.forEach(d=>{var m;d&&(!d.initSegment||d.initSegment.relurl===((m=i)==null?void 0:m.relurl))&&(d.initSegment=i)}),e.skippedSegments){if(e.deltaUpdateFailed=o.some(d=>!d),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let d=e.skippedSegments;d--;)o.shift();e.startSN=o[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=QL(l.dateRanges,e,t));const d=l.fragments.filter(m=>m.rawProgramDateTime);if(l.hasProgramDateTime&&!e.hasProgramDateTime)for(let m=1;m<u.length;m++)u[m].programDateTime===null&&Vd(u[m],u[m-1],d);YE(d,e)}e.endCC=o[o.length-1].cc}if(!e.startCC){var f;const d=XE(l,e.startSN-1);e.startCC=(f=d?.cc)!=null?f:o[0].cc}qL(l.partList,e.partList,(d,m)=>{m.elementaryStreams=d.elementaryStreams,m.stats=d.stats}),r?zE(e,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS,t):jE(l,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=l.driftStartTime,e.driftStart=l.driftStart;const h=e.advancedDateTime;if(e.advanced&&h){const d=e.edge;e.driftStart||(e.driftStartTime=h,e.driftStart=d),e.driftEndTime=h,e.driftEnd=d}else e.driftEndTime=l.driftEndTime,e.driftEnd=l.driftEnd,e.advancedDateTime=l.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=l.requestScheduled)}function QL(l,e,t){const{dateRanges:i,recentlyRemovedDateranges:n}=e,r=xt({},l);n&&n.forEach(f=>{delete r[f]});const u=Object.keys(r).length;return u?(Object.keys(i).forEach(f=>{const h=r[f],d=new Eg(i[f].attr,h);d.isValid?(r[f]=d,h||(d.tagOrder+=u)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Lt(i[f].attr)}"`)}),r):i}function qL(l,e,t){if(l&&e){let i=0;for(let n=0,r=l.length;n<=r;n++){const o=l[n],u=e[n+i];o&&u&&o.index===u.index&&o.fragment.sn===u.fragment.sn?t(o,u):i--}}}function WL(l,e,t){const i=e.skippedSegments,n=Math.max(l.startSN,e.startSN)-e.startSN,r=(l.fragmentHint?1:0)+(i?e.endSN:Math.min(l.endSN,e.endSN))-e.startSN,o=e.startSN-l.startSN,u=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,f=l.fragmentHint?l.fragments.concat(l.fragmentHint):l.fragments;for(let h=n;h<=r;h++){const d=f[o+h];let m=u[h];if(i&&!m&&d&&(m=e.fragments[h]=d),d&&m){t(d,m,h,u);const p=d.relurl,v=m.relurl;if(p&&ZL(p,v)){e.playlistParsingError=sy(`media sequence mismatch ${m.sn}:`,l,e,d,m);return}else if(d.cc!==m.cc){e.playlistParsingError=sy(`discontinuity sequence mismatch (${d.cc}!=${m.cc})`,l,e,d,m);return}}}}function sy(l,e,t,i,n){return new Error(`${l} ${n.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function jE(l,e,t=!0){const i=e.startSN+e.skippedSegments-l.startSN,n=l.fragments,r=i>=0;let o=0;if(r&&i<n.length)o=n[i].start;else if(r&&e.startSN===l.endSN+1)o=l.fragmentEnd;else if(r&&t)o=l.fragmentStart+i*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=l.fragmentStart;else return;$d(e,o)}function $d(l,e){if(e){const t=l.fragments;for(let i=l.skippedSegments;i<t.length;i++)t[i].addStart(e);l.fragmentHint&&l.fragmentHint.addStart(e)}}function JE(l,e=1/0){let t=1e3*l.targetduration;if(l.updated){const i=l.fragments;if(i.length&&t*4>e){const r=i[i.length-1].duration*1e3;r<t&&(t=r)}}else t/=2;return Math.round(t)}function XE(l,e,t){if(!l)return null;let i=l.fragments[e-l.startSN];return i||(i=l.fragmentHint,i&&i.sn===e)?i:e<l.startSN&&t&&t.sn===e?t:null}function ry(l,e,t){return l?QE(l.partList,e,t):null}function QE(l,e,t){if(l)for(let i=l.length;i--;){const n=l[i];if(n.index===t&&n.fragment.sn===e)return n}return null}function qE(l){l.forEach((e,t)=>{var i;(i=e.details)==null||i.fragments.forEach(n=>{n.level=t,n.initSegment&&(n.initSegment.level=t)})})}function ZL(l,e){return l!==e&&e?ay(l)!==ay(e):!1}function ay(l){return l.replace(/\?[^?]*$/,"")}function ml(l,e){for(let i=0,n=l.length;i<n;i++){var t;if(((t=l[i])==null?void 0:t.cc)===e)return l[i]}return null}function eD(l,e){return!!(l&&e.startCC<l.endCC&&e.endCC>l.startCC)}function oy(l,e){const t=l.start+e;l.startPTS=t,l.setStart(t),l.endPTS=t+l.duration}function WE(l,e){const t=e.fragments;for(let i=0,n=t.length;i<n;i++)oy(t[i],l);e.fragmentHint&&oy(e.fragmentHint,l),e.alignedSliding=!0}function tD(l,e){l&&(ZE(e,l),e.alignedSliding||Dc(e,l),!e.alignedSliding&&!e.skippedSegments&&jE(l,e,!1))}function ZE(l,e){if(!eD(e,l))return;const t=Math.min(e.endCC,l.endCC),i=ml(e.fragments,t),n=ml(l.fragments,t);if(!i||!n)return;vt.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const r=i.start-n.start;WE(r,l)}function Dc(l,e){if(!l.hasProgramDateTime||!e.hasProgramDateTime)return;const t=l.fragments,i=e.fragments;if(!t.length||!i.length)return;let n,r;const o=Math.min(e.endCC,l.endCC);e.startCC<o&&l.startCC<o&&(n=ml(i,o),r=ml(t,o)),(!n||!r)&&(n=i[Math.floor(i.length/2)],r=ml(t,n.cc)||t[Math.floor(t.length/2)]);const u=n.programDateTime,f=r.programDateTime;if(!u||!f)return;const h=(f-u)/1e3-(r.start-n.start);WE(h,l)}function Ci(l,e,t){ki(l,e,t),l.addEventListener(e,t)}function ki(l,e,t){l.removeEventListener(e,t)}const iD={toString:function(l){let e="";const t=l.length;for(let i=0;i<t;i++)e+=`[${l.start(i).toFixed(3)}-${l.end(i).toFixed(3)}]`;return e}},ce={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Uc extends NE{constructor(e,t,i,n,r){super(n,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ce.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:u,media:f,mediaBuffer:h,state:d}=this,m=f?f.currentTime:0,p=je.bufferInfo(h||f,m,o.maxBufferHole),v=!p.len;if(this.log(`Media seeking to ${xe(m)?m.toFixed(3):m}, state: ${d}, ${v?"out of":"in"} buffer`),this.state===ce.ENDED)this.resetLoadingState();else if(u){const y=o.maxFragLookUpTolerance,T=u.start-y,S=u.start+u.duration+y;if(v||S<p.start||T>p.end){const b=m>S;(m<T||b)&&(b&&u.loader&&(this.log(`Cancelling fragment load for seek (sn: ${u.sn})`),u.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(f){this.fragmentTracker.removeFragmentsInRange(m,1/0,this.playlistType,!0);const y=this.lastCurrentTime;if(m>y&&(this.lastCurrentTime=m),!this.loadingParts){const T=Math.max(p.end,m),S=this.shouldLoadParts(this.getLevelDetails(),T);S&&(this.log(`LL-Part loading ON after seeking to ${m.toFixed(2)} with buffer @${T.toFixed(2)}`),this.loadingParts=S)}}this.hls.hasEnoughToStart||(this.log(`Setting ${v?"startPosition":"nextLoadPosition"} to ${m} for seek without enough to start`),this.nextLoadPosition=m,v&&(this.startPosition=m)),v&&this.state===ce.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=r,this.hls=e,this.fragmentLoader=new BL(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new yg(e.config)}registerListeners(){const{hls:e}=this;e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(R.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(R.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===ce.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ce.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const i=e.end||0,n=this.config.timelineOffset||0;if(i<=n)return!1;const r=e.buffered;this.config.maxBufferHole&&r&&r.length>1&&(e=je.bufferedInfo(r,e.start,0));const o=e.nextStart;if(o&&o>n&&o<t.edge||this.media.currentTime<e.start)return!1;const f=t.partList;if(f!=null&&f.length){const d=f[f.length-1];return je.isBuffered(this.media,d.start+d.duration/2)}const h=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(h)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const i=this.media=this.mediaBuffer=t.media;Ci(i,"seeking",this.onMediaSeeking),Ci(i,"ended",this.onMediaEnded);const n=this.config;this.levels&&n.autoStartLoad&&this.state===ce.STOPPED&&this.startLoad(n.startPosition)}onMediaDetaching(e,t){const i=!!t.transferMedia,n=this.media;if(n!==null){if(n.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),ki(n,"seeking",this.onMediaSeeking),ki(n,"ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=ce.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this.startFragRequested=!0,this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){const n=r=>{const o=r.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${r.part?" part: "+r.part.index:""} of ${this.fragInfo(o,!1,r.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(r)};this._doFragLoad(e,t,i,n).then(r=>{if(!r)return;const o=this.state,u=r.frag;if(this.fragContextChanged(u)){(o===ce.FRAG_LOADING||!this.fragCurrent&&o===ce.PARSING)&&(this.fragmentTracker.removeFragment(u),this.state=ce.IDLE);return}"payload"in r&&(this.log(`Loaded ${u.type} sn: ${u.sn} of ${this.playlistLabel()} ${u.level}`),this.hls.trigger(R.FRAG_LOADED,r)),this._handleFragmentLoadComplete(r)}).catch(r=>{this.state===ce.STOPPED||this.state===ce.ERROR||(this.warn(`Frag error: ${r?.message||r}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:i}=this;if(i.getState(e)===si.APPENDING){const r=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,r),u=Math.max(e.duration,o?o.len:this.config.maxBufferLength),f=this.backtrackFragment;((f?e.sn-f.sn:0)===1||this.reduceMaxBufferLength(u,e.duration))&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===si.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,i=null){if(!(e-t))return;const n={startOffset:e,endOffset:t,type:i};this.hls.trigger(R.BUFFER_FLUSHING,n)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(i=>{const n=i?.frag;if(!n||this.fragContextChanged(n)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:n}=this,{frag:r,payload:o}=i,u=r.decryptdata;if(o&&o.byteLength>0&&u!=null&&u.key&&u.iv&&qa(u.method)){const f=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),u.key.buffer,u.iv.buffer,Tg(u.method)).catch(h=>{throw n.trigger(R.ERROR,{type:ke.MEDIA_ERROR,details:te.FRAG_DECRYPT_ERROR,fatal:!1,error:h,reason:h.message,frag:r}),h}).then(h=>{const d=self.performance.now();return n.trigger(R.FRAG_DECRYPTED,{frag:r,payload:h,stats:{tstart:f,tdecrypt:d}}),i.payload=h,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===ce.STOPPED||this.state===ce.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const i=e.frag.stats;this.state!==ce.STOPPED&&(this.state=ce.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var i,n;const r=e.tracks;if(r&&!t.encrypted&&((i=r.audio)!=null&&i.encrypted||(n=r.video)!=null&&n.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,u=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(u.message),!o||o.mediaKeys?!1:(this.hls.trigger(R.ERROR,{type:ke.KEY_SYSTEM_ERROR,details:te.KEY_SYSTEM_NO_KEYS,fatal:!1,error:u,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${i?iD.toString(je.getBuffered(i)):"(detached)"})`),Zt(e)){var n;if(e.type!==_e.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(u=>!!o[u])){this.state=ce.IDLE;return}}const r=(n=this.levels)==null?void 0:n[e.level];r!=null&&r.fragmentError&&(this.log(`Resetting level fragment error count of ${r.fragmentError} on frag buffered`),r.fragmentError=0)}this.state=ce.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:i,part:n,partsLoaded:r}=e,o=!r||r.length===0||r.some(f=>!f),u=new wc(i.level,i.sn,i.stats.chunkCount+1,0,n?n.index:-1,!o);t.flush(u)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,n){var r;this.fragCurrent=e;const o=t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let u=null;if(e.encrypted&&!((r=e.decryptdata)!=null&&r.key)){if(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=ce.KEY_LOADING,this.fragCurrent=e,u=this.keyLoader.load(e).then(p=>{if(!this.fragContextChanged(p.frag))return this.hls.trigger(R.KEY_LOADED,p),this.state===ce.KEY_LOADING&&(this.state=ce.IDLE),p}),this.hls.trigger(R.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(u=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),u&&this.log("[eme] blocking frag load until media-keys acquired"));const f=this.fragPrevious;if(Zt(e)&&(!f||e.sn!==f.sn)){const p=this.shouldLoadParts(t.details,e.end);p!==this.loadingParts&&(this.log(`LL-Part loading ${p?"ON":"OFF"} loading sn ${f?.sn}->${e.sn}`),this.loadingParts=p)}if(i=Math.max(e.start,i||0),this.loadingParts&&Zt(e)){const p=o.partList;if(p&&n){i>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);const v=this.getNextPart(p,e,i);if(v>-1){const y=p[v];e=this.fragCurrent=y.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${y.index} (${v}/${p.length-1}) of ${this.fragInfo(e,!1,y)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=y.start+y.duration,this.state=ce.FRAG_LOADING;let T;return u?T=u.then(S=>!S||this.fragContextChanged(S.frag)?null:this.doFragPartsLoad(e,y,t,n)).catch(S=>this.handleFragLoadError(S)):T=this.doFragPartsLoad(e,y,t,n).catch(S=>this.handleFragLoadError(S)),this.hls.trigger(R.FRAG_LOADING,{frag:e,part:y,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):T}else if(!e.url||this.loadedEndOfParts(p,i))return Promise.resolve(null)}}if(Zt(e)&&this.loadingParts){var h;this.log(`LL-Part loading OFF after next part miss @${i.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(h=o.partList)==null?void 0:h.filter(p=>p.loaded).map(p=>`[${p.start}-${p.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(i.toFixed(3))}`),xe(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ce.FRAG_LOADING;const d=this.config.progressive;let m;return d&&u?m=u.then(p=>!p||this.fragContextChanged(p.frag)?null:this.fragmentLoader.load(e,n)).catch(p=>this.handleFragLoadError(p)):m=Promise.all([this.fragmentLoader.load(e,d?n:void 0),u]).then(([p])=>(!d&&n&&n(p),p)).catch(p=>this.handleFragLoadError(p)),this.hls.trigger(R.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):m}doFragPartsLoad(e,t,i,n){return new Promise((r,o)=>{var u;const f=[],h=(u=i.details)==null?void 0:u.partList,d=m=>{this.fragmentLoader.loadPart(e,m,n).then(p=>{f[m.index]=p;const v=p.part;this.hls.trigger(R.FRAG_LOADED,p);const y=ry(i.details,e.sn,m.index+1)||QE(h,e.sn,m.index+1);if(y)d(y);else return r({frag:e,part:v,partsLoaded:f})}).catch(o)};d(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===te.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===ke.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(R.ERROR,t)}else this.hls.trigger(R.ERROR,{type:ke.OTHER_ERROR,details:te.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ce.PARSING){!this.fragCurrent&&this.state!==ce.STOPPED&&this.state!==ce.ERROR&&(this.state=ce.IDLE);return}const{frag:i,part:n,level:r}=t,o=self.performance.now();i.stats.parsing.end=o,n&&(n.stats.parsing.end=o);const u=this.getLevelDetails(),h=u&&i.sn>u.endSN||this.shouldLoadParts(u,i.end);h!==this.loadingParts&&(this.log(`LL-Part loading ${h?"ON":"OFF"} after parsing segment ending @${i.end.toFixed(2)}`),this.loadingParts=h),this.updateLevelTiming(i,n,r,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var i;const r=e.partList[0];if(r.fragment.type===_e.SUBTITLE)return!1;const o=r.end+(((i=e.fragmentHint)==null?void 0:i.duration)||0);if(t>=o){var n;if((this.hls.hasEnoughToStart?((n=this.media)==null?void 0:n.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:i}=this,{level:n,sn:r,part:o}=e;if(!(t!=null&&t[n]))return this.warn(`Levels object was unset while buffering fragment ${r} of ${this.playlistLabel()} ${n}. The current chunk will not be buffered.`),null;const u=t[n],f=u.details,h=o>-1?ry(f,r,o):null,d=h?h.fragment:XE(f,r,i);return d?(i&&i!==d&&(d.stats=i.stats),{frag:d,part:h,level:u}):null}bufferFragmentData(e,t,i,n,r){if(this.state!==ce.PARSING)return;const{data1:o,data2:u}=e;let f=o;if(u&&(f=dn(o,u)),!f.length)return;const h=this.initPTS[t.cc],d=h?-h.baseTime/h.timescale:void 0,m={type:e.type,frag:t,part:i,chunkMeta:n,offset:d,parent:t.type,data:f};if(this.hls.trigger(R.BUFFER_APPENDING,m),e.dropped&&e.independent&&!i){if(r)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!je.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const i=t.currentTime,n=je.bufferInfo(t,i,0),r=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,r*.25),u=Math.max(Math.min(e.start-o,n.end-o),i+o);e.start-u>o&&this.flushMainBuffer(u,e.start)}getFwdBufferInfo(e,t){var i;const n=this.getLoadPosition();if(!xe(n))return null;const o=this.lastCurrentTime>n||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,n,t,o)}getFwdBufferInfoAtPos(e,t,i,n){const r=je.bufferInfo(e,t,n);if(r.len===0&&r.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,i);if(o&&(r.nextStart<=o.end||o.gap)){const u=Math.max(Math.min(r.nextStart,o.end)-t,n);return je.bufferInfo(e,t,u)}}return r}getMaxBufferLength(e){const{config:t}=this;let i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const i=this.config,n=Math.max(Math.min(e-t,i.maxBufferLength),t),r=Math.max(e-t*3,i.maxMaxBufferLength/2,n);return r>=n?(i.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0):!1}getAppendedFrag(e,t=_e.MAIN){const i=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){const i=t.fragments,n=i.length;if(!n)return null;const{config:r}=this,o=i[0].start,u=r.lowLatencyMode&&!!t.partList;let f=null;if(t.live){const m=r.initialLiveManifestSize;if(n<m)return this.warn(`Not enough fragments to start playback (have: ${n}, need: ${m})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var h;u&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),f=this.getInitialLiveFragment(t);const p=this.hls.startPosition,v=this.hls.liveSyncPosition,y=f?(p!==-1&&p>=o?p:v)||f.start:e;this.log(`Setting startPosition to ${y} to match start frag at live edge. mainStart: ${p} liveSyncPosition: ${v} frag.start: ${(h=f)==null?void 0:h.start}`),this.startPosition=this.nextLoadPosition=y}}else e<=o&&(f=i[0]);if(!f){const m=this.loadingParts?t.partEnd:t.fragmentEnd;f=this.getFragmentAtPosition(e,m,t)}let d=this.filterReplacedPrimary(f,t);if(!d&&f){const m=f.sn-t.startSN;d=this.filterReplacedPrimary(i[m+1]||null,t)}return this.mapToInitFragWhenRequired(d)}isLoopLoading(e,t){const i=this.fragmentTracker.getState(e);return(i===si.OK||i===si.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,n,r){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&i.nextStart)){const u=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,n,0);if(u!==null&&i.len+u.len>=r){const f=o.sn;return this.loopSn!==f&&(this.log(`buffer full after gaps in "${n}" playlist starting at sn: ${f}`),this.loopSn=f),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(ly(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(ly(this.config)&&e.type!==_e.SUBTITLE){const i=this.hls.interstitialsManager,n=i?.bufferingItem;if(n){const o=n.event;if(o){if(o.appendInPlace||Math.abs(e.start-n.start)>1||n.start===0)return null}else if(e.end<=n.start&&t?.live===!1||e.start>n.end&&n.nextEvent&&(n.nextEvent.appendInPlace||e.start-n.end>1))return null}const r=i?.playerQueue;if(r)for(let o=r.length;o--;){const u=r[o].interstitial;if(u.appendInPlace&&e.start>=u.startTime&&e.end<=u.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,i){let n=-1,r=!1,o=!0;for(let u=0,f=e.length;u<f;u++){const h=e[u];if(o=o&&!h.independent,n>-1&&i<h.start)break;const d=h.loaded;d?n=-1:(r||(h.independent||o)&&h.fragment===t)&&(h.fragment!==t&&this.warn(`Need buffer at ${i} but next unloaded part starts at ${h.start}`),n=u),r=d}return n}loadedEndOfParts(e,t){let i;for(let n=e.length;n--;){if(i=e[n],!i.loaded)return!1;if(t>i.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,i=this.fragPrevious;let n=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),n=EL(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){const r=i.sn+1;if(r>=e.startSN&&r<=e.endSN){const o=t[r-e.startSN];i.cc===o.cc&&(n=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${n.sn}`))}n||(n=kE(e,i.cc,i.end),n&&this.log(`Live playlist, switching playlist, load frag with same CC: ${n.sn}`))}}else{const r=this.hls.liveSyncPosition;r!==null&&(n=this.getFragmentAtPosition(r,this.bitrateTest?e.fragmentEnd:e.edge,e))}return n}getFragmentAtPosition(e,t,i){const{config:n}=this;let{fragPrevious:r}=this,{fragments:o,endSN:u}=i;const{fragmentHint:f}=i,{maxFragLookUpTolerance:h}=n,d=i.partList,m=!!(this.loadingParts&&d!=null&&d.length&&f);m&&!this.bitrateTest&&d[d.length-1].fragment.sn===f.sn&&(o=o.concat(f),u=f.sn);let p;if(e<t){var v;const T=e<this.lastCurrentTime||e>t-h||(v=this.media)!=null&&v.paused||!this.startFragRequested?0:h;p=Jr(r,o,e,T)}else p=o[o.length-1];if(p){const y=p.sn-i.startSN,T=this.fragmentTracker.getState(p);if((T===si.OK||T===si.PARTIAL&&p.gap)&&(r=p),r&&p.sn===r.sn&&(!m||d[0].fragment.sn>p.sn||!i.live)&&p.level===r.level){const b=o[y+1];p.sn<u&&this.fragmentTracker.getState(b)!==si.OK?p=b:p=null}}return p}alignPlaylists(e,t,i){const n=e.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;const r=e.fragmentStart,o=!t,u=e.alignedSliding&&xe(r);if(o||!u&&!r){tD(i,e);const f=e.fragmentStart;return this.log(`Live playlist sliding: ${f.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${n}`),f}return r}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let i=this.startPosition;i<t&&(i=-1);const n=this.timelineOffset;if(i===-1){const r=this.startTimeOffset!==null,o=r?this.startTimeOffset:e.startTimeOffset;o!==null&&xe(o)?(i=t+o,o<0&&(i+=e.edge),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Setting startPosition to ${i} for start time offset ${o} found in ${r?"multivariant":"media"} playlist`),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${i}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+n}this.nextLoadPosition=i+n}getLoadPosition(){var e;const{media:t}=this;let i=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?i=t.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Zt(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==ce.FRAG_LOADING_WAITING_RETRY)&&(this.state=ce.IDLE)}onFragmentOrKeyLoadError(e,t){var i;if(t.chunkMeta&&!t.frag){const b=this.getCurrentContext(t.chunkMeta);b&&(t.frag=b.frag)}const n=t.frag;if(!n||n.type!==e||!this.levels)return;if(this.fragContextChanged(n)){var r;this.warn(`Frag load error must match current frag to retry ${n.url} > ${(r=this.fragCurrent)==null?void 0:r.url}`);return}const o=t.details===te.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(n,!0);const u=t.errorAction;if(!u){this.state=ce.ERROR;return}const{action:f,flags:h,retryCount:d=0,retryConfig:m}=u,p=!!m,v=p&&f===ni.RetryRequest,y=p&&!u.resolved&&h===Oi.MoveAllAlternatesMatchingHost,T=(i=this.hls.latestLevelDetails)==null?void 0:i.live;if(!v&&y&&Zt(n)&&!n.endList&&T&&!UE(t))this.resetFragmentErrors(e),this.treatAsGap(n),u.resolved=!0;else if((v||y)&&d<m.maxNumRetry){var S;const b=Gd((S=t.response)==null?void 0:S.code),C=vg(m,d);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+C,this.state=ce.FRAG_LOADING_WAITING_RETRY,u.resolved=!0,b){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${n.sn} of ${e} ${n.level} errored with ${t.details}, retrying loading ${d+1}/${m.maxNumRetry} in ${C}ms`)}else if(m)if(this.resetFragmentErrors(e),d<m.maxNumRetry)!o&&f!==ni.RemoveAlternatePermanently&&(u.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${d})`);return}else f===ni.SendAlternateToPenaltyBox?this.state=ce.WAITING_LEVEL:this.state=ce.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,i=t===1/0;(!t||e>=t||i&&!Gd(0))&&(i&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=ce.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===ce.PARSING||this.state===ce.PARSED){const t=e.frag,i=e.parent,n=this.getFwdBufferInfo(this.mediaBuffer,i),r=n&&n.len>.5;r&&this.reduceMaxBufferLength(n.len,t?.duration||10);const o=!r;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${i} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===_e.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==ce.STOPPED&&(this.state=ce.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;const n=je.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,n,i),this.state===ce.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==ce.STOPPED&&(this.state=ce.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,n){const r=i.details;if(!r){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((f,h)=>{const d=e.elementaryStreams[h];if(d){const m=d.endPTS-d.startPTS;if(m<=0)return this.warn(`Could not parse fragment ${e.sn} ${h} duration reliably (${m})`),f||!1;const p=n?0:zE(r,e,d.startPTS,d.endPTS,d.startDTS,d.endDTS,this);return this.hls.trigger(R.LEVEL_PTS_UPDATED,{details:r,level:i,drift:p,type:h,frag:e,start:d.startPTS,end:d.endPTS}),!0}return f},!1)){var u;if(i.fragmentError===0&&this.treatAsGap(e,i),((u=this.transmuxer)==null?void 0:u.error)===null){const f=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(f.message),this.hls.trigger(R.ERROR,{type:ke.MEDIA_ERROR,details:te.FRAG_PARSING_ERROR,fatal:!1,error:f,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=ce.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(R.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===_e.MAIN?"level":"track"}fragInfo(e,t=!0,i){var n,r;return`${this.playlistLabel()} ${e.level} (${i?"part":"frag"}:[${((n=t&&!i?e.startPTS:(i||e).start)!=null?n:NaN).toFixed(3)}-${((r=t&&!i?e.endPTS:(i||e).end)!=null?r:NaN).toFixed(3)}]${i&&e.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function ly(l){return!!l.interstitialsController&&l.enableInterstitialPlayback!==!1}class eT{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let i;if(e.length)e.length===1?i=e[0]:i=nD(e,t);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function nD(l,e){const t=new Uint8Array(e);let i=0;for(let n=0;n<l.length;n++){const r=l[n];t.set(r,i),i+=r.length}return t}var rd={exports:{}},uy;function sD(){return uy||(uy=1,(function(l){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function n(f,h,d){this.fn=f,this.context=h,this.once=d||!1}function r(f,h,d,m,p){if(typeof d!="function")throw new TypeError("The listener must be a function");var v=new n(d,m||f,p),y=t?t+h:h;return f._events[y]?f._events[y].fn?f._events[y]=[f._events[y],v]:f._events[y].push(v):(f._events[y]=v,f._eventsCount++),f}function o(f,h){--f._eventsCount===0?f._events=new i:delete f._events[h]}function u(){this._events=new i,this._eventsCount=0}u.prototype.eventNames=function(){var h=[],d,m;if(this._eventsCount===0)return h;for(m in d=this._events)e.call(d,m)&&h.push(t?m.slice(1):m);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(d)):h},u.prototype.listeners=function(h){var d=t?t+h:h,m=this._events[d];if(!m)return[];if(m.fn)return[m.fn];for(var p=0,v=m.length,y=new Array(v);p<v;p++)y[p]=m[p].fn;return y},u.prototype.listenerCount=function(h){var d=t?t+h:h,m=this._events[d];return m?m.fn?1:m.length:0},u.prototype.emit=function(h,d,m,p,v,y){var T=t?t+h:h;if(!this._events[T])return!1;var S=this._events[T],b=arguments.length,C,L;if(S.fn){switch(S.once&&this.removeListener(h,S.fn,void 0,!0),b){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,d),!0;case 3:return S.fn.call(S.context,d,m),!0;case 4:return S.fn.call(S.context,d,m,p),!0;case 5:return S.fn.call(S.context,d,m,p,v),!0;case 6:return S.fn.call(S.context,d,m,p,v,y),!0}for(L=1,C=new Array(b-1);L<b;L++)C[L-1]=arguments[L];S.fn.apply(S.context,C)}else{var D=S.length,_;for(L=0;L<D;L++)switch(S[L].once&&this.removeListener(h,S[L].fn,void 0,!0),b){case 1:S[L].fn.call(S[L].context);break;case 2:S[L].fn.call(S[L].context,d);break;case 3:S[L].fn.call(S[L].context,d,m);break;case 4:S[L].fn.call(S[L].context,d,m,p);break;default:if(!C)for(_=1,C=new Array(b-1);_<b;_++)C[_-1]=arguments[_];S[L].fn.apply(S[L].context,C)}}return!0},u.prototype.on=function(h,d,m){return r(this,h,d,m,!1)},u.prototype.once=function(h,d,m){return r(this,h,d,m,!0)},u.prototype.removeListener=function(h,d,m,p){var v=t?t+h:h;if(!this._events[v])return this;if(!d)return o(this,v),this;var y=this._events[v];if(y.fn)y.fn===d&&(!p||y.once)&&(!m||y.context===m)&&o(this,v);else{for(var T=0,S=[],b=y.length;T<b;T++)(y[T].fn!==d||p&&!y[T].once||m&&y[T].context!==m)&&S.push(y[T]);S.length?this._events[v]=S.length===1?S[0]:S:o(this,v)}return this},u.prototype.removeAllListeners=function(h){var d;return h?(d=t?t+h:h,this._events[d]&&o(this,d)):(this._events=new i,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=t,u.EventEmitter=u,l.exports=u})(rd)),rd.exports}var rD=sD(),xg=FR(rD);const Sl="1.6.13",no={};function aD(){return typeof __HLS_WORKER_BUNDLE__=="function"}function oD(){const l=no[Sl];if(l)return l.clientCount++,l;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),n={worker:new self.Worker(t),objectURL:t,clientCount:1};return no[Sl]=n,n}function lD(l){const e=no[l];if(e)return e.clientCount++,e;const t=new self.URL(l,self.location.href).href,n={worker:new self.Worker(t),scriptURL:t,clientCount:1};return no[l]=n,n}function uD(l){const e=no[l||Sl];if(e&&e.clientCount--===1){const{worker:i,objectURL:n}=e;delete no[l||Sl],n&&self.URL.revokeObjectURL(n),i.terminate()}}function tT(l,e){return e+10<=l.length&&l[e]===51&&l[e+1]===68&&l[e+2]===73&&l[e+3]<255&&l[e+4]<255&&l[e+6]<128&&l[e+7]<128&&l[e+8]<128&&l[e+9]<128}function Cg(l,e){return e+10<=l.length&&l[e]===73&&l[e+1]===68&&l[e+2]===51&&l[e+3]<255&&l[e+4]<255&&l[e+6]<128&&l[e+7]<128&&l[e+8]<128&&l[e+9]<128}function Pc(l,e){let t=0;return t=(l[e]&127)<<21,t|=(l[e+1]&127)<<14,t|=(l[e+2]&127)<<7,t|=l[e+3]&127,t}function bl(l,e){const t=e;let i=0;for(;Cg(l,e);){i+=10;const n=Pc(l,e+6);i+=n,tT(l,e+10)&&(i+=10),e+=i}if(i>0)return l.subarray(t,t+i)}function cD(l,e,t,i){const n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],r=e[t+2],o=r>>2&15;if(o>12){const v=new Error(`invalid ADTS sampling index:${o}`);l.emit(R.ERROR,R.ERROR,{type:ke.MEDIA_ERROR,details:te.FRAG_PARSING_ERROR,fatal:!0,error:v,reason:v.message});return}const u=(r>>6&3)+1,f=e[t+3]>>6&3|(r&1)<<2,h="mp4a.40."+u,d=n[o];let m=o;(u===5||u===29)&&(m-=3);const p=[u<<3|(m&14)>>1,(m&1)<<7|f<<3];return vt.log(`manifest codec:${i}, parsed codec:${h}, channels:${f}, rate:${d} (ADTS object type:${u} sampling index:${o})`),{config:p,samplerate:d,channelCount:f,codec:h,parsedCodec:h,manifestCodec:i}}function iT(l,e){return l[e]===255&&(l[e+1]&246)===240}function nT(l,e){return l[e+1]&1?7:9}function Rg(l,e){return(l[e+3]&3)<<11|l[e+4]<<3|(l[e+5]&224)>>>5}function fD(l,e){return e+5<l.length}function _c(l,e){return e+1<l.length&&iT(l,e)}function hD(l,e){return fD(l,e)&&iT(l,e)&&Rg(l,e)<=l.length-e}function dD(l,e){if(_c(l,e)){const t=nT(l,e);if(e+t>=l.length)return!1;const i=Rg(l,e);if(i<=t)return!1;const n=e+i;return n===l.length||_c(l,n)}return!1}function sT(l,e,t,i,n){if(!l.samplerate){const r=cD(e,t,i,n);if(!r)return;xt(l,r)}}function rT(l){return 1024*9e4/l}function gD(l,e){const t=nT(l,e);if(e+t<=l.length){const i=Rg(l,e)-t;if(i>0)return{headerLength:t,frameLength:i}}}function aT(l,e,t,i,n){const r=rT(l.samplerate),o=i+n*r,u=gD(e,t);let f;if(u){const{frameLength:m,headerLength:p}=u,v=p+m,y=Math.max(0,t+v-e.length);y?(f=new Uint8Array(v-p),f.set(e.subarray(t+p,e.length),0)):f=e.subarray(t+p,t+v);const T={unit:f,pts:o};return y||l.samples.push(T),{sample:T,length:v,missing:y}}const h=e.length-t;return f=new Uint8Array(h),f.set(e.subarray(t,e.length),0),{sample:{unit:f,pts:o},length:h,missing:-1}}function mD(l,e){return Cg(l,e)&&Pc(l,e+6)+10<=l.length-e}function pD(l){return l instanceof ArrayBuffer?l:l.byteOffset==0&&l.byteLength==l.buffer.byteLength?l.buffer:new Uint8Array(l).buffer}function ad(l,e=0,t=1/0){return AD(l,e,t,Uint8Array)}function AD(l,e,t,i){const n=vD(l);let r=1;"BYTES_PER_ELEMENT"in i&&(r=i.BYTES_PER_ELEMENT);const o=yD(l)?l.byteOffset:0,u=(o+l.byteLength)/r,f=(o+e)/r,h=Math.floor(Math.max(0,Math.min(f,u))),d=Math.floor(Math.min(h+Math.max(t,0),u));return new i(n,h,d-h)}function vD(l){return l instanceof ArrayBuffer?l:l.buffer}function yD(l){return l&&l.buffer instanceof ArrayBuffer&&l.byteLength!==void 0&&l.byteOffset!==void 0}function ED(l){const e={key:l.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(l.size<2)return;if(l.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const i=l.data.subarray(1).indexOf(0);if(i===-1)return;const n=Xi(ad(l.data,1,i)),r=l.data[2+i],o=l.data.subarray(3+i).indexOf(0);if(o===-1)return;const u=Xi(ad(l.data,3+i,o));let f;return n==="-->"?f=Xi(ad(l.data,4+i+o)):f=pD(l.data.subarray(4+i+o)),e.mimeType=n,e.pictureType=r,e.description=u,e.data=f,e}function TD(l){if(l.size<2)return;const e=Xi(l.data,!0),t=new Uint8Array(l.data.subarray(e.length+1));return{key:l.type,info:e,data:t.buffer}}function SD(l){if(l.size<2)return;if(l.type==="TXXX"){let t=1;const i=Xi(l.data.subarray(t),!0);t+=i.length+1;const n=Xi(l.data.subarray(t));return{key:l.type,info:i,data:n}}const e=Xi(l.data.subarray(1));return{key:l.type,info:"",data:e}}function bD(l){if(l.type==="WXXX"){if(l.size<2)return;let t=1;const i=Xi(l.data.subarray(t),!0);t+=i.length+1;const n=Xi(l.data.subarray(t));return{key:l.type,info:i,data:n}}const e=Xi(l.data);return{key:l.type,info:"",data:e}}function xD(l){return l.type==="PRIV"?TD(l):l.type[0]==="W"?bD(l):l.type==="APIC"?ED(l):SD(l)}function CD(l){const e=String.fromCharCode(l[0],l[1],l[2],l[3]),t=Pc(l,4),i=10;return{type:e,size:t,data:l.subarray(i,i+t)}}const Qu=10,RD=10;function oT(l){let e=0;const t=[];for(;Cg(l,e);){const i=Pc(l,e+6);l[e+5]>>6&1&&(e+=Qu),e+=Qu;const n=e+i;for(;e+RD<n;){const r=CD(l.subarray(e)),o=xD(r);o&&t.push(o),e+=r.size+Qu}tT(l,e)&&(e+=Qu)}return t}function lT(l){return l&&l.key==="PRIV"&&l.info==="com.apple.streaming.transportStreamTimestamp"}function LD(l){if(l.data.byteLength===8){const e=new Uint8Array(l.data),t=e[3]&1;let i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,t&&(i+=4772185884e-2),Math.round(i)}}function Lg(l){const e=oT(l);for(let t=0;t<e.length;t++){const i=e[t];if(lT(i))return LD(i)}}let Fi=(function(l){return l.audioId3="org.id3",l.dateRange="com.apple.quicktime.HLS",l.emsg="https://aomedia.org/emsg/ID3",l.misbklv="urn:misb:KLV:bin:1910.1",l})({});function Kn(l="",e=9e4){return{type:l,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Dg{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=dn(this.cachedData,e),this.cachedData=null);let i=bl(e,0),n=i?i.length:0,r;const o=this._audioTrack,u=this._id3Track,f=i?Lg(i):void 0,h=e.length;for((this.basePTS===null||this.frameIndex===0&&xe(f))&&(this.basePTS=DD(f,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Fi.audioId3,duration:Number.POSITIVE_INFINITY});n<h;){if(this.canParse(e,n)){const d=this.appendFrame(o,e,n);d?(this.frameIndex++,this.lastPTS=d.sample.pts,n+=d.length,r=n):n=h}else mD(e,n)?(i=bl(e,n),u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Fi.audioId3,duration:Number.POSITIVE_INFINITY}),n+=i.length,r=n):n++;if(n===h&&r!==h){const d=e.slice(r);this.cachedData?this.cachedData=dn(this.cachedData,d):this.cachedData=d}}return{audioTrack:o,videoTrack:Kn(),id3Track:u,textTrack:Kn()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Kn(),id3Track:this._id3Track,textTrack:Kn()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const DD=(l,e,t)=>{if(xe(l))return l*90;const i=t?t.baseTime*9e4/t.timescale:0;return e*9e4+i};let qu=null;const _D=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],ID=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],BD=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],MD=[0,1,1,4];function uT(l,e,t,i,n){if(t+24>e.length)return;const r=cT(e,t);if(r&&t+r.frameLength<=e.length){const o=r.samplesPerFrame*9e4/r.sampleRate,u=i+n*o,f={unit:e.subarray(t,t+r.frameLength),pts:u,dts:u};return l.config=[],l.channelCount=r.channelCount,l.samplerate=r.sampleRate,l.samples.push(f),{sample:f,length:r.frameLength,missing:0}}}function cT(l,e){const t=l[e+1]>>3&3,i=l[e+1]>>1&3,n=l[e+2]>>4&15,r=l[e+2]>>2&3;if(t!==1&&n!==0&&n!==15&&r!==3){const o=l[e+2]>>1&1,u=l[e+3]>>6,f=t===3?3-i:i===3?3:4,h=_D[f*14+n-1]*1e3,m=ID[(t===3?0:t===2?1:2)*3+r],p=u===3?1:2,v=BD[t][i],y=MD[i],T=v*8*y,S=Math.floor(v*h/m+o)*y;if(qu===null){const L=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);qu=L?parseInt(L[1]):0}return!!qu&&qu<=87&&i===2&&h>=224e3&&u===0&&(l[e+3]=l[e+3]|128),{sampleRate:m,channelCount:p,frameLength:S,samplesPerFrame:T}}}function _g(l,e){return l[e]===255&&(l[e+1]&224)===224&&(l[e+1]&6)!==0}function fT(l,e){return e+1<l.length&&_g(l,e)}function OD(l,e){return _g(l,e)&&4<=l.length-e}function hT(l,e){if(e+1<l.length&&_g(l,e)){const i=cT(l,e);let n=4;i!=null&&i.frameLength&&(n=i.frameLength);const r=e+n;return r===l.length||fT(l,r)}return!1}class FD extends Dg{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,n){super.resetInitSegment(e,t,i,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const i=bl(e,0);let n=i?.length||0;if(hT(e,n))return!1;for(let r=e.length;n<r;n++)if(dD(e,n))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return hD(e,t)}appendFrame(e,t,i){sT(e,this.observer,t,i,e.manifestCodec);const n=aT(e,t,i,this.basePTS,this.frameIndex);if(n&&n.missing===0)return n}}const dT=(l,e)=>{let t=0,i=5;e+=i;const n=new Uint32Array(1),r=new Uint32Array(1),o=new Uint8Array(1);for(;i>0;){o[0]=l[e];const u=Math.min(i,8),f=8-u;r[0]=4278190080>>>24+f<<f,n[0]=(o[0]&r[0])>>f,t=t?t<<u|n[0]:n[0],e+=1,i-=u}return t};class kD extends Dg{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,i,n){super.resetInitSegment(e,t,i,n),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,i){const n=gT(e,t,i,this.basePTS,this.frameIndex);if(n!==-1)return{sample:e.samples[e.samples.length-1],length:n,missing:0}}static probe(e){if(!e)return!1;const t=bl(e,0);if(!t)return!1;const i=t.length;return e[i]===11&&e[i+1]===119&&Lg(t)!==void 0&&dT(e,i)<16}}function gT(l,e,t,i,n){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const r=e[t+4]>>6;if(r>=3)return-1;const u=[48e3,44100,32e3][r],f=e[t+4]&63,d=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][f*3+r]*2;if(t+d>e.length)return-1;const m=e[t+6]>>5;let p=0;m===2?p+=2:(m&1&&m!==1&&(p+=2),m&4&&(p+=2));const v=(e[t+6]<<8|e[t+7])>>12-p&1,T=[2,1,2,3,3,4,4,5][m]+v,S=e[t+5]>>3,b=e[t+5]&7,C=new Uint8Array([r<<6|S<<1|b>>2,(b&3)<<6|m<<3|v<<2|f>>4,f<<4&224]),L=1536/u*9e4,D=i+n*L,_=e.subarray(t,t+d);return l.config=C,l.channelCount=T,l.samplerate=u,l.samples.push({unit:_,pts:D}),d}class wD extends Dg{resetInitSegment(e,t,i,n){super.resetInitSegment(e,t,i,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=bl(e,0);let i=t?.length||0;if(t&&e[i]===11&&e[i+1]===119&&Lg(t)!==void 0&&dT(e,i)<=16)return!1;for(let n=e.length;i<n;i++)if(hT(e,i))return vt.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return OD(e,t)}appendFrame(e,t,i){if(this.basePTS!==null)return uT(e,t,i,this.basePTS,this.frameIndex)}}const UD=/\/emsg[-/]ID3/i;class PD{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,n){const r=this.videoTrack=Kn("video",1),o=this.audioTrack=Kn("audio",1),u=this.txtTrack=Kn("text",1);if(this.id3Track=Kn("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const f=bE(e);if(f.video){const{id:h,timescale:d,codec:m,supplemental:p}=f.video;r.id=h,r.timescale=u.timescale=d,r.codec=m,r.supplemental=p}if(f.audio){const{id:h,timescale:d,codec:m}=f.audio;o.id=h,o.timescale=d,o.codec=m}u.id=EE.text,r.sampleDuration=0,r.duration=o.duration=n}resetContiguity(){this.remainderData=null}static probe(e){return PR(e)}demux(e,t){this.timeOffset=t;let i=e;const n=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=dn(this.remainderData,e));const u=YR(i);this.remainderData=u.remainder,n.samples=u.valid||new Uint8Array}else n.samples=i;const o=this.extractID3Track(n,t);return r.samples=Dv(t,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const n=this.extractID3Track(t,this.timeOffset);return i.samples=Dv(e,t),{videoTrack:t,audioTrack:Kn(),id3Track:n,textTrack:Kn()}}extractID3Track(e,t){const i=this.id3Track;if(e.samples.length){const n=et(e.samples,["emsg"]);n&&n.forEach(r=>{const o=jR(r);if(UD.test(o.schemeIdUri)){const u=cy(o,t);let f=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;f<=.001&&(f=Number.POSITIVE_INFINITY);const h=o.payload;i.samples.push({data:h,len:h.byteLength,dts:u,pts:u,type:Fi.emsg,duration:f})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const u=cy(o,t);i.samples.push({data:o.payload,len:o.payload.byteLength,dts:u,pts:u,type:Fi.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function cy(l,e){return xe(l.presentationTime)?l.presentationTime/l.timeScale:e+l.presentationTimeDelta/l.timeScale}class ND{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new yg(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,fr.cbc)}decryptAacSample(e,t,i){const n=e[t].unit;if(n.length<=16)return;const r=n.subarray(16,n.length-n.length%16),o=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(o).then(u=>{const f=new Uint8Array(u);n.set(f,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)}).catch(i)}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length){i();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(t);let n=0;for(let r=32;r<e.length-16;r+=160,n+=16)i.set(e.subarray(r,r+16),n);return i}getAvcDecryptedUnit(e,t){const i=new Uint8Array(t);let n=0;for(let r=32;r<e.length-16;r+=160,n+=16)e.set(i.subarray(n,n+16),r);return e}decryptAvcSample(e,t,i,n,r){const o=RE(r.data),u=this.getAvcEncryptedData(o);this.decryptBuffer(u.buffer).then(f=>{r.data=this.getAvcDecryptedUnit(o,f),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,n)}).catch(n)}decryptAvcSamples(e,t,i,n){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length){n();return}const r=e[t].units;for(;!(i>=r.length);i++){const o=r[i];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,i,n,o),!this.decrypter.isSync()))return}}}}class mT{constructor(){this.VideoSample=null}createVideoSample(e,t,i){return{key:e,frame:!1,pts:t,dts:i,units:[],length:0}}getLastNalUnit(e){var t;let i=this.VideoSample,n;if((!i||i.units.length===0)&&(i=e[e.length-1]),(t=i)!=null&&t.units){const r=i.units;n=r[r.length-1]}return n}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const i=t.samples,n=i.length;if(n){const r=i[n-1];e.pts=r.pts,e.dts=r.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,i){const n=t.byteLength;let r=e.naluState||0;const o=r,u=[];let f=0,h,d,m,p=-1,v=0;for(r===-1&&(p=0,v=this.getNALuType(t,0),r=0,f=1);f<n;){if(h=t[f++],!r){r=h?0:1;continue}if(r===1){r=h?0:2;continue}if(!h)r=3;else if(h===1){if(d=f-r-1,p>=0){const y={data:t.subarray(p,d),type:v};u.push(y)}else{const y=this.getLastNalUnit(e.samples);y&&(o&&f<=4-o&&y.state&&(y.data=y.data.subarray(0,y.data.byteLength-o)),d>0&&(y.data=dn(y.data,t.subarray(0,d)),y.state=0))}f<n?(m=this.getNALuType(t,f),p=f,v=m,r=0):r=-1}else r=0}if(p>=0&&r>=0){const y={data:t.subarray(p,n),type:v,state:r};u.push(y)}if(u.length===0){const y=this.getLastNalUnit(e.samples);y&&(y.data=dn(y.data,t))}return e.naluState=r,u}}class pl{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,i=e.byteLength-t,n=new Uint8Array(4),r=Math.min(4,t);if(r===0)throw new Error("no bytes available");n.set(e.subarray(i,i+r)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=r*8,this.bytesAvailable-=r}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const i=this.word>>>32-t;if(e>32&&vt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class GD extends mT{parsePES(e,t,i,n){const r=this.parseNALu(e,i.data,n);let o=this.VideoSample,u,f=!1;i.data=null,o&&r.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),r.forEach(h=>{var d,m;switch(h.type){case 1:{let T=!1;u=!0;const S=h.data;if(f&&S.length>4){const b=this.readSliceType(S);(b===2||b===4||b===7||b===9)&&(T=!0)}if(T){var p;(p=o)!=null&&p.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.frame=!0,o.key=T;break}case 5:u=!0,(d=o)!=null&&d.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 6:{u=!0,mg(h.data,1,i.pts,t.samples);break}case 7:{var v,y;u=!0,f=!0;const T=h.data,S=this.readSPS(T);if(!e.sps||e.width!==S.width||e.height!==S.height||((v=e.pixelRatio)==null?void 0:v[0])!==S.pixelRatio[0]||((y=e.pixelRatio)==null?void 0:y[1])!==S.pixelRatio[1]){e.width=S.width,e.height=S.height,e.pixelRatio=S.pixelRatio,e.sps=[T];const b=T.subarray(1,4);let C="avc1.";for(let L=0;L<3;L++){let D=b[L].toString(16);D.length<2&&(D="0"+D),C+=D}e.codec=C}break}case 8:u=!0,e.pps=[h.data];break;case 9:u=!0,e.audFound=!0,(m=o)!=null&&m.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:u=!0;break;default:u=!1;break}o&&u&&o.units.push(h)}),n&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new pl(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let i=8,n=8,r;for(let o=0;o<e;o++)n!==0&&(r=t.readEG(),n=(i+r+256)%256),i=n===0?i:n}readSPS(e){const t=new pl(e);let i=0,n=0,r=0,o=0,u,f,h;const d=t.readUByte.bind(t),m=t.readBits.bind(t),p=t.readUEG.bind(t),v=t.readBoolean.bind(t),y=t.skipBits.bind(t),T=t.skipEG.bind(t),S=t.skipUEG.bind(t),b=this.skipScalingList.bind(this);d();const C=d();if(m(5),y(3),d(),S(),C===100||C===110||C===122||C===244||C===44||C===83||C===86||C===118||C===128){const O=p();if(O===3&&y(1),S(),S(),y(1),v())for(f=O!==3?8:12,h=0;h<f;h++)v()&&(h<6?b(16,t):b(64,t))}S();const L=p();if(L===0)p();else if(L===1)for(y(1),T(),T(),u=p(),h=0;h<u;h++)T();S(),y(1);const D=p(),_=p(),w=m(1);w===0&&y(1),y(1),v()&&(i=p(),n=p(),r=p(),o=p());let I=[1,1];if(v()&&v())switch(d()){case 1:I=[1,1];break;case 2:I=[12,11];break;case 3:I=[10,11];break;case 4:I=[16,11];break;case 5:I=[40,33];break;case 6:I=[24,11];break;case 7:I=[20,11];break;case 8:I=[32,11];break;case 9:I=[80,33];break;case 10:I=[18,11];break;case 11:I=[15,11];break;case 12:I=[64,33];break;case 13:I=[160,99];break;case 14:I=[4,3];break;case 15:I=[3,2];break;case 16:I=[2,1];break;case 255:{I=[d()<<8|d(),d()<<8|d()];break}}return{width:Math.ceil((D+1)*16-i*2-n*2),height:(2-w)*(_+1)*16-(w?2:4)*(r+o),pixelRatio:I}}}class HD extends mT{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,i,n){const r=this.parseNALu(e,i.data,n);let o=this.VideoSample,u,f=!1;i.data=null,o&&r.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),r.forEach(h=>{var d,m;switch(h.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),o.frame=!0,u=!0;break;case 16:case 17:case 18:case 21:if(u=!0,f){var p;(p=o)!=null&&p.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:u=!0,(d=o)!=null&&d.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 39:u=!0,mg(h.data,2,i.pts,t.samples);break;case 32:u=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=xt(e.params,this.readVPS(h.data)),this.initVPS=h.data),e.vps=[h.data];break;case 33:if(u=!0,f=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],h.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const v=this.readSPS(h.data);e.width=v.width,e.height=v.height,e.pixelRatio=v.pixelRatio,e.codec=v.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const y in v.params)e.params[y]=v.params[y]}this.pushParameterSet(e.sps,h.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0;break;case 34:if(u=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const v=this.readPPS(h.data);for(const y in v)e.params[y]=v[y]}this.pushParameterSet(e.pps,h.data,e.vps)}break;case 35:u=!0,e.audFound=!0,(m=o)!=null&&m.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:u=!1;break}o&&u&&o.units.push(h)}),n&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,i){(i&&i[0]===this.initVPS||!i&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let i=0;for(let n=0;n<e.byteLength;n++)n>=2&&e[n]===3&&e[n-1]===0&&e[n-2]===0||(t[i]=e[n],i++);return new Uint8Array(t.buffer,0,i)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new pl(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const i=t.readBits(3),n=t.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:n}}readSPS(e){const t=new pl(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const i=t.readBits(3);t.readBoolean();const n=t.readBits(2),r=t.readBoolean(),o=t.readBits(5),u=t.readUByte(),f=t.readUByte(),h=t.readUByte(),d=t.readUByte(),m=t.readUByte(),p=t.readUByte(),v=t.readUByte(),y=t.readUByte(),T=t.readUByte(),S=t.readUByte(),b=t.readUByte(),C=[],L=[];for(let Ae=0;Ae<i;Ae++)C.push(t.readBoolean()),L.push(t.readBoolean());if(i>0)for(let Ae=i;Ae<8;Ae++)t.readBits(2);for(let Ae=0;Ae<i;Ae++)C[Ae]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),L[Ae]&&t.readUByte();t.readUEG();const D=t.readUEG();D==3&&t.skipBits(1);const _=t.readUEG(),w=t.readUEG(),I=t.readBoolean();let O=0,F=0,M=0,H=0;I&&(O+=t.readUEG(),F+=t.readUEG(),M+=t.readUEG(),H+=t.readUEG());const P=t.readUEG(),z=t.readUEG(),Y=t.readUEG(),Z=t.readBoolean();for(let Ae=Z?0:i;Ae<=i;Ae++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Ee=0;Ee<4;Ee++)for(let pe=0;pe<(Ee===3?2:6);pe++)if(!t.readBoolean())t.readUEG();else{const Te=Math.min(64,1<<4+(Ee<<1));Ee>1&&t.readEG();for(let de=0;de<Te;de++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const Q=t.readUEG();let j=0;for(let Ae=0;Ae<Q;Ae++){let Ee=!1;if(Ae!==0&&(Ee=t.readBoolean()),Ee){Ae===Q&&t.readUEG(),t.readBoolean(),t.readUEG();let pe=0;for(let Re=0;Re<=j;Re++){const Te=t.readBoolean();let de=!1;Te||(de=t.readBoolean()),(Te||de)&&pe++}j=pe}else{const pe=t.readUEG(),Re=t.readUEG();j=pe+Re;for(let Te=0;Te<pe;Te++)t.readUEG(),t.readBoolean();for(let Te=0;Te<Re;Te++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Ae=t.readUEG();for(let Ee=0;Ee<Ae;Ee++){for(let pe=0;pe<Y+4;pe++)t.readBits(1);t.readBits(1)}}let U=0,N=1,V=1,q=!0,X=1,re=0;t.readBoolean(),t.readBoolean();let oe=!1;if(t.readBoolean()){if(t.readBoolean()){const He=t.readUByte(),Le=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Se=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];He>0&&He<16?(N=Le[He-1],V=Se[He-1]):He===255&&(N=t.readBits(16),V=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),oe=t.readBoolean(),oe&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(X=t.readBits(32),re=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Se=t.readBoolean(),be=t.readBoolean();let qe=!1;(Se||be)&&(qe=t.readBoolean(),qe&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),qe&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let De=0;De<=i;De++){q=t.readBoolean();const Oe=q||t.readBoolean();let Ne=!1;Oe?t.readEG():Ne=t.readBoolean();const Ye=Ne?1:t.readUEG()+1;if(Se)for(let ct=0;ct<Ye;ct++)t.readUEG(),t.readUEG(),qe&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(be)for(let ct=0;ct<Ye;ct++)t.readUEG(),t.readUEG(),qe&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),U=t.readUEG())}let ve=_,ye=w;if(I){let Ae=1,Ee=1;D===1?Ae=Ee=2:D==2&&(Ae=2),ve=_-Ae*F-Ae*O,ye=w-Ee*H-Ee*M}const fe=n?["A","B","C"][n]:"",me=u<<24|f<<16|h<<8|d;let Pe=0;for(let Ae=0;Ae<32;Ae++)Pe=(Pe|(me>>Ae&1)<<31-Ae)>>>0;let Be=Pe.toString(16);return o===1&&Be==="2"&&(Be="6"),{codecString:`hvc1.${fe}${o}.${Be}.${r?"H":"L"}${b}.B0`,params:{general_tier_flag:r,general_profile_idc:o,general_profile_space:n,general_profile_compatibility_flags:[u,f,h,d],general_constraint_indicator_flags:[m,p,v,y,T,S],general_level_idc:b,bit_depth:P+8,bit_depth_luma_minus8:P,bit_depth_chroma_minus8:z,min_spatial_segmentation_idc:U,chroma_format_idc:D,frame_rate:{fixed:q,fps:re/X}},width:ve,height:ye,pixelRatio:[N,V]}}readPPS(e){const t=new pl(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const n=t.readBoolean(),r=t.readBoolean();let o=1;return r&&n?o=0:r?o=3:n&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const ui=188;class ur{constructor(e,t,i,n){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.logger=n,this.videoParser=null}static probe(e,t){const i=ur.syncOffset(e);return i>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(e){const t=e.length;let i=Math.min(ui*5,t-ui)+1,n=0;for(;n<i;){let r=!1,o=-1,u=0;for(let f=n;f<t;f+=ui)if(e[f]===71&&(t-f===ui||e[f+ui]===71)){if(u++,o===-1&&(o=f,o!==0&&(i=Math.min(o+ui*99,e.length-ui)+1)),r||(r=Yd(e,f)===0),r&&u>1&&(o===0&&u>2||f+ui>i))return o}else{if(u)return-1;break}n++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:EE[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,i,n){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=ur.createTrack("video"),this._videoTrack.duration=n,this._audioTrack=ur.createTrack("audio",n),this._id3Track=ur.createTrack("id3"),this._txtTrack=ur.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,i=!1,n=!1){i||(this.sampleAes=null);let r;const o=this._videoTrack,u=this._audioTrack,f=this._id3Track,h=this._txtTrack;let d=o.pid,m=o.pesData,p=u.pid,v=f.pid,y=u.pesData,T=f.pesData,S=null,b=this.pmtParsed,C=this._pmtId,L=e.length;if(this.remainderData&&(e=dn(this.remainderData,e),L=e.length,this.remainderData=null),L<ui&&!n)return this.remainderData=e,{audioTrack:u,videoTrack:o,id3Track:f,textTrack:h};const D=Math.max(0,ur.syncOffset(e));L-=(L-D)%ui,L<e.byteLength&&!n&&(this.remainderData=new Uint8Array(e.buffer,L,e.buffer.byteLength-L));let _=0;for(let I=D;I<L;I+=ui)if(e[I]===71){const O=!!(e[I+1]&64),F=Yd(e,I),M=(e[I+3]&48)>>4;let H;if(M>1){if(H=I+5+e[I+4],H===I+ui)continue}else H=I+4;switch(F){case d:O&&(m&&(r=Va(m,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,h,r,!1)),m={data:[],size:0}),m&&(m.data.push(e.subarray(H,I+ui)),m.size+=I+ui-H);break;case p:if(O){if(y&&(r=Va(y,this.logger)))switch(u.segmentCodec){case"aac":this.parseAACPES(u,r);break;case"mp3":this.parseMPEGPES(u,r);break;case"ac3":this.parseAC3PES(u,r);break}y={data:[],size:0}}y&&(y.data.push(e.subarray(H,I+ui)),y.size+=I+ui-H);break;case v:O&&(T&&(r=Va(T,this.logger))&&this.parseID3PES(f,r),T={data:[],size:0}),T&&(T.data.push(e.subarray(H,I+ui)),T.size+=I+ui-H);break;case 0:O&&(H+=e[H]+1),C=this._pmtId=KD(e,H);break;case C:{O&&(H+=e[H]+1);const P=VD(e,H,this.typeSupported,i,this.observer,this.logger);d=P.videoPid,d>0&&(o.pid=d,o.segmentCodec=P.segmentVideoCodec),p=P.audioPid,p>0&&(u.pid=p,u.segmentCodec=P.segmentAudioCodec),v=P.id3Pid,v>0&&(f.pid=v),S!==null&&!b&&(this.logger.warn(`MPEG-TS PMT found at ${I} after unknown PID '${S}'. Backtracking to sync byte @${D} to parse all TS packets.`),S=null,I=D-188),b=this.pmtParsed=!0;break}case 17:case 8191:break;default:S=F;break}}else _++;_>0&&zd(this.observer,new Error(`Found ${_} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=m,u.pesData=y,f.pesData=T;const w={audioTrack:u,videoTrack:o,id3Track:f,textTrack:h};return n&&this.extractRemainingSamples(w),w}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:i,id3Track:n,textTrack:r}=e,o=i.pesData,u=t.pesData,f=n.pesData;let h;if(o&&(h=Va(o,this.logger))?(this.readyVideoParser(i.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(i,r,h,!0),i.pesData=null)):i.pesData=o,u&&(h=Va(u,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,h);break;case"mp3":this.parseMPEGPES(t,h);break;case"ac3":this.parseAC3PES(t,h);break}t.pesData=null}else u!=null&&u.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=u;f&&(h=Va(f,this.logger))?(this.parseID3PES(n,h),n.pesData=null):n.pesData=f}demuxSampleAes(e,t,i){const n=this.demux(e,i,!0,!this.config.progressive),r=this.sampleAes=new ND(this.observer,this.config,t);return this.decrypt(n,r)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new GD:e==="hevc"&&(this.videoParser=new HD))}decrypt(e,t){return new Promise(i=>{const{audioTrack:n,videoTrack:r}=e;n.samples&&n.segmentCodec==="aac"?t.decryptAacSamples(n.samples,0,()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,()=>{i(e)}):i(e)}):r.samples&&t.decryptAvcSamples(r.samples,0,0,()=>{i(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let i=0;const n=this.aacOverFlow;let r=t.data;if(n){this.aacOverFlow=null;const m=n.missing,p=n.sample.unit.byteLength;if(m===-1)r=dn(n.sample.unit,r);else{const v=p-m;n.sample.unit.set(r.subarray(0,m),v),e.samples.push(n.sample),i=n.missing}}let o,u;for(o=i,u=r.length;o<u-1&&!_c(r,o);o++);if(o!==i){let m;const p=o<u-1;if(p?m=`AAC PES did not start with ADTS header,offset:${o}`:m="No ADTS header found in AAC PES",zd(this.observer,new Error(m),p,this.logger),!p)return}sT(e,this.observer,r,o,this.audioCodec);let f;if(t.pts!==void 0)f=t.pts;else if(n){const m=rT(e.samplerate);f=n.sample.pts+m}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let h=0,d;for(;o<u;)if(d=aT(e,r,o,f,h),o+=d.length,d.missing){this.aacOverFlow=d;break}else for(h++;o<u-1&&!_c(r,o);o++);}parseMPEGPES(e,t){const i=t.data,n=i.length;let r=0,o=0;const u=t.pts;if(u===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<n;)if(fT(i,o)){const f=uT(e,i,o,u,r);if(f)o+=f.length,r++;else break}else o++}parseAC3PES(e,t){{const i=t.data,n=t.pts;if(n===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const r=i.length;let o=0,u=0,f;for(;u<r&&(f=gT(e,i,u,n,o++))>0;)u+=f}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=xt({},t,{type:this._videoTrack?Fi.emsg:Fi.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function Yd(l,e){return((l[e+1]&31)<<8)+l[e+2]}function KD(l,e){return(l[e+10]&31)<<8|l[e+11]}function VD(l,e,t,i,n,r){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},u=(l[e+1]&15)<<8|l[e+2],f=e+3+u-4,h=(l[e+10]&15)<<8|l[e+11];for(e+=12+h;e<f;){const d=Yd(l,e),m=(l[e+3]&15)<<8|l[e+4];switch(l[e]){case 207:if(!i){od("ADTS AAC",r);break}case 15:o.audioPid===-1&&(o.audioPid=d);break;case 21:o.id3Pid===-1&&(o.id3Pid=d);break;case 219:if(!i){od("H.264",r);break}case 27:o.videoPid===-1&&(o.videoPid=d);break;case 3:case 4:!t.mpeg&&!t.mp3?r.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=d,o.segmentAudioCodec="mp3");break;case 193:if(!i){od("AC-3",r);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=d,o.segmentAudioCodec="ac3"):r.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&m>0){let p=e+5,v=m;for(;v>2;){switch(l[p]){case 106:t.ac3!==!0?r.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=d,o.segmentAudioCodec="ac3");break}const T=l[p+1]+2;p+=T,v-=T}}break;case 194:case 135:return zd(n,new Error("Unsupported EC-3 in M2TS found"),void 0,r),o;case 36:o.videoPid===-1&&(o.videoPid=d,o.segmentVideoCodec="hevc",r.log("HEVC in M2TS found"));break}e+=m+5}return o}function zd(l,e,t,i){i.warn(`parsing error: ${e.message}`),l.emit(R.ERROR,R.ERROR,{type:ke.MEDIA_ERROR,details:te.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function od(l,e){e.log(`${l} with AES-128-CBC encryption found in unencrypted stream`)}function Va(l,e){let t=0,i,n,r,o,u;const f=l.data;if(!l||l.size===0)return null;for(;f[0].length<19&&f.length>1;)f[0]=dn(f[0],f[1]),f.splice(1,1);if(i=f[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(n=(i[4]<<8)+i[5],n&&n>l.size-6)return null;const d=i[7];d&192&&(o=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,d&64?(u=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,o-u>60*9e4&&(e.warn(`${Math.round((o-u)/9e4)}s delta between PTS and DTS, align them`),o=u)):u=o),r=i[8];let m=r+9;if(l.size<=m)return null;l.size-=m;const p=new Uint8Array(l.size);for(let v=0,y=f.length;v<y;v++){i=f[v];let T=i.byteLength;if(m)if(m>T){m-=T;continue}else i=i.subarray(m),T-=m,m=0;p.set(i,t),t+=T}return n&&(n-=r+3),{data:p,pts:o,dts:u,len:n}}return null}class $D{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const ar=Math.pow(2,32)-1;class ee{static init(){ee.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in ee.types)ee.types.hasOwnProperty(e)&&(ee.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);ee.HDLR_TYPES={video:t,audio:i};const n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);ee.STTS=ee.STSC=ee.STCO=r,ee.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),ee.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),ee.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),ee.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),u=new Uint8Array([97,118,99,49]),f=new Uint8Array([0,0,0,1]);ee.FTYP=ee.box(ee.types.ftyp,o,f,o,u),ee.DINF=ee.box(ee.types.dinf,ee.box(ee.types.dref,n))}static box(e,...t){let i=8,n=t.length;const r=n;for(;n--;)i+=t[n].byteLength;const o=new Uint8Array(i);for(o[0]=i>>24&255,o[1]=i>>16&255,o[2]=i>>8&255,o[3]=i&255,o.set(e,4),n=0,i=8;n<r;n++)o.set(t[n],i),i+=t[n].byteLength;return o}static hdlr(e){return ee.box(ee.types.hdlr,ee.HDLR_TYPES[e])}static mdat(e){return ee.box(ee.types.mdat,e)}static mdhd(e,t){t*=e;const i=Math.floor(t/(ar+1)),n=Math.floor(t%(ar+1));return ee.box(ee.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,n>>24,n>>16&255,n>>8&255,n&255,85,196,0,0]))}static mdia(e){return ee.box(ee.types.mdia,ee.mdhd(e.timescale||0,e.duration||0),ee.hdlr(e.type),ee.minf(e))}static mfhd(e){return ee.box(ee.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?ee.box(ee.types.minf,ee.box(ee.types.smhd,ee.SMHD),ee.DINF,ee.stbl(e)):ee.box(ee.types.minf,ee.box(ee.types.vmhd,ee.VMHD),ee.DINF,ee.stbl(e))}static moof(e,t,i){return ee.box(ee.types.moof,ee.mfhd(e),ee.traf(i,t))}static moov(e){let t=e.length;const i=[];for(;t--;)i[t]=ee.trak(e[t]);return ee.box.apply(null,[ee.types.moov,ee.mvhd(e[0].timescale||0,e[0].duration||0)].concat(i).concat(ee.mvex(e)))}static mvex(e){let t=e.length;const i=[];for(;t--;)i[t]=ee.trex(e[t]);return ee.box.apply(null,[ee.types.mvex,...i])}static mvhd(e,t){t*=e;const i=Math.floor(t/(ar+1)),n=Math.floor(t%(ar+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,n>>24,n>>16&255,n>>8&255,n&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return ee.box(ee.types.mvhd,r)}static sdtp(e){const t=e.samples||[],i=new Uint8Array(4+t.length);let n,r;for(n=0;n<t.length;n++)r=t[n].flags,i[n+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return ee.box(ee.types.sdtp,i)}static stbl(e){return ee.box(ee.types.stbl,ee.stsd(e),ee.box(ee.types.stts,ee.STTS),ee.box(ee.types.stsc,ee.STSC),ee.box(ee.types.stsz,ee.STSZ),ee.box(ee.types.stco,ee.STCO))}static avc1(e){let t=[],i=[],n,r,o;for(n=0;n<e.sps.length;n++)r=e.sps[n],o=r.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(r));for(n=0;n<e.pps.length;n++)r=e.pps[n],o=r.byteLength,i.push(o>>>8&255),i.push(o&255),i=i.concat(Array.prototype.slice.call(r));const u=ee.box(ee.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(i))),f=e.width,h=e.height,d=e.pixelRatio[0],m=e.pixelRatio[1];return ee.box(ee.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,h>>8&255,h&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,ee.box(ee.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),ee.box(ee.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,d&255,m>>24,m>>16&255,m>>8&255,m&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return ee.box(ee.types.mp4a,ee.audioStsd(e),ee.box(ee.types.esds,ee.esds(e)))}static mp3(e){return ee.box(ee.types[".mp3"],ee.audioStsd(e))}static ac3(e){return ee.box(ee.types["ac-3"],ee.audioStsd(e),ee.box(ee.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return ee.box(ee.types.stsd,ee.STSD,ee.mp4a(e));if(t==="ac3"&&e.config)return ee.box(ee.types.stsd,ee.STSD,ee.ac3(e));if(t==="mp3"&&e.codec==="mp3")return ee.box(ee.types.stsd,ee.STSD,ee.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return ee.box(ee.types.stsd,ee.STSD,ee.avc1(e));if(t==="hevc"&&e.vps)return ee.box(ee.types.stsd,ee.STSD,ee.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,i=(e.duration||0)*(e.timescale||0),n=e.width||0,r=e.height||0,o=Math.floor(i/(ar+1)),u=Math.floor(i%(ar+1));return ee.box(ee.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,u>>24,u>>16&255,u>>8&255,u&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,n&255,0,0,r>>8&255,r&255,0,0]))}static traf(e,t){const i=ee.sdtp(e),n=e.id,r=Math.floor(t/(ar+1)),o=Math.floor(t%(ar+1));return ee.box(ee.types.traf,ee.box(ee.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255])),ee.box(ee.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,o>>24,o>>16&255,o>>8&255,o&255])),ee.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,ee.box(ee.types.trak,ee.tkhd(e),ee.mdia(e))}static trex(e){const t=e.id;return ee.box(ee.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const i=e.samples||[],n=i.length,r=12+16*n,o=new Uint8Array(r);let u,f,h,d,m,p;for(t+=8+r,o.set([e.type==="video"?1:0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,n&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),u=0;u<n;u++)f=i[u],h=f.duration,d=f.size,m=f.flags,p=f.cts,o.set([h>>>24&255,h>>>16&255,h>>>8&255,h&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255,m.isLeading<<2|m.dependsOn,m.isDependedOn<<6|m.hasRedundancy<<4|m.paddingValue<<1|m.isNonSync,m.degradPrio&61440,m.degradPrio&15,p>>>24&255,p>>>16&255,p>>>8&255,p&255],12+16*u);return ee.box(ee.types.trun,o)}static initSegment(e){ee.types||ee.init();const t=ee.moov(e);return dn(ee.FTYP,t)}static hvc1(e){const t=e.params,i=[e.vps,e.sps,e.pps],n=4,r=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),n-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),i.length]);let o=r.length;for(let y=0;y<i.length;y+=1){o+=3;for(let T=0;T<i[y].length;T+=1)o+=2+i[y][T].length}const u=new Uint8Array(o);u.set(r,0),o=r.length;const f=i.length-1;for(let y=0;y<i.length;y+=1){u.set(new Uint8Array([32+y|(y===f?128:0),0,i[y].length]),o),o+=3;for(let T=0;T<i[y].length;T+=1)u.set(new Uint8Array([i[y][T].length>>8,i[y][T].length&255]),o),o+=2,u.set(i[y][T],o),o+=i[y][T].length}const h=ee.box(ee.types.hvcC,u),d=e.width,m=e.height,p=e.pixelRatio[0],v=e.pixelRatio[1];return ee.box(ee.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,d&255,m>>8&255,m&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,ee.box(ee.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),ee.box(ee.types.pasp,new Uint8Array([p>>24,p>>16&255,p>>8&255,p&255,v>>24,v>>16&255,v>>8&255,v&255])))}}ee.types=void 0;ee.HDLR_TYPES=void 0;ee.STTS=void 0;ee.STSC=void 0;ee.STCO=void 0;ee.STSZ=void 0;ee.VMHD=void 0;ee.SMHD=void 0;ee.STSD=void 0;ee.FTYP=void 0;ee.DINF=void 0;const pT=9e4;function Ig(l,e,t=1,i=!1){const n=l*e*t;return i?Math.round(n):n}function YD(l,e,t=1,i=!1){return Ig(l,e,1/t,i)}function al(l,e=!1){return Ig(l,1e3,1/pT,e)}function zD(l,e=1){return Ig(l,pT,1/e)}function fy(l){const{baseTime:e,timescale:t,trackId:i}=l;return`${e/t} (${e}/${t}) trackId: ${i}`}const jD=10*1e3,JD=1024,XD=1152,QD=1536;let $a=null,ld=null;function hy(l,e,t,i){return{duration:e,size:t,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:l?2:1,isNonSync:l?0:1}}}class hc extends gn{constructor(e,t,i,n){if(super("mp4-remuxer",n),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,$a===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);$a=o?parseInt(o[1]):0}if(ld===null){const r=navigator.userAgent.match(/Safari\/(\d+)/i);ld=r?parseInt(r[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&fy(t)} > ${e&&fy(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const i=e[0].pts,n=e.reduce((r,o)=>{let u=o.pts,f=u-r;return f<-4294967296&&(t=!0,u=Ji(u,i),f=u-r),f>0?r:u},i);return t&&this.debug("PTS rollover detected"),n}remux(e,t,i,n,r,o,u,f){let h,d,m,p,v,y,T=r,S=r;const b=e.pid>-1,C=t.pid>-1,L=t.samples.length,D=e.samples.length>0,_=u&&L>0||L>1;if((!b||D)&&(!C||_)||this.ISGenerated||u){if(this.ISGenerated){var I,O,F,M;const Y=this.videoTrackConfig;(Y&&(t.width!==Y.width||t.height!==Y.height||((I=t.pixelRatio)==null?void 0:I[0])!==((O=Y.pixelRatio)==null?void 0:O[0])||((F=t.pixelRatio)==null?void 0:F[1])!==((M=Y.pixelRatio)==null?void 0:M[1]))||!Y&&_||this.nextAudioTs===null&&D)&&this.resetInitSegment()}this.ISGenerated||(m=this.generateIS(e,t,r,o));const H=this.isVideoContiguous;let P=-1,z;if(_&&(P=qD(t.samples),!H&&this.config.forceKeyFrameOnDiscontinuity))if(y=!0,P>0){this.warn(`Dropped ${P} out of ${L} video samples due to a missing keyframe`);const Y=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(P),t.dropped+=P,S+=(t.samples[0].pts-Y)/t.inputTimeScale,z=S}else P===-1&&(this.warn(`No keyframe found out of ${L} video samples`),y=!1);if(this.ISGenerated){if(D&&_){const Y=this.getVideoStartPts(t.samples),k=(Ji(e.samples[0].pts,Y)-Y)/t.inputTimeScale;T+=Math.max(0,k),S+=Math.max(0,-k)}if(D){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),m=this.generateIS(e,t,r,o)),d=this.remuxAudio(e,T,this.isAudioContiguous,o,C||_||f===_e.AUDIO?S:void 0),_){const Y=d?d.endPTS-d.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),m=this.generateIS(e,t,r,o)),h=this.remuxVideo(t,S,H,Y)}}else _&&(h=this.remuxVideo(t,S,H,0));h&&(h.firstKeyFrame=P,h.independent=P!==-1,h.firstKeyFramePTS=z)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(v=AT(i,r,this._initPTS,this._initDTS)),n.samples.length&&(p=vT(n,r,this._initPTS))),{audio:d,video:h,initSegment:m,independent:y,text:p,id3:v}}computeInitPts(e,t,i,n){const r=Math.round(i*t);let o=Ji(e,r);if(o<r+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(r-o)/t} ${n}`);o<r+t;)o+=8589934592;return o-r}generateIS(e,t,i,n){const r=e.samples,o=t.samples,u=this.typeSupported,f={},h=this._initPTS;let d=!h||n,m="audio/mp4",p,v,y,T=-1;if(d&&(p=v=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":u.mpeg?(m="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}f.audio={id:"audio",container:m,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&u.mpeg?new Uint8Array(0):ee.initSegment([e]),metadata:{channelCount:e.channelCount}},d&&(T=e.id,y=e.inputTimeScale,!h||y!==h.timescale?p=v=this.computeInitPts(r[0].pts,y,i,"audio"):d=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,f.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:ee.initSegment([t]),metadata:{width:t.width,height:t.height}},d)if(T=t.id,y=t.inputTimeScale,!h||y!==h.timescale){const S=this.getVideoStartPts(o),b=Ji(o[0].dts,S),C=this.computeInitPts(b,y,i,"video"),L=this.computeInitPts(S,y,i,"video");v=Math.min(v,C),p=Math.min(p,L)}else d=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(f).length)return this.ISGenerated=!0,d?(h&&this.warn(`Timestamps at playlist time: ${n?"":"~"}${i} ${p/y} != initPTS: ${h.baseTime/h.timescale} (${h.baseTime}/${h.timescale}) trackId: ${h.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${p/y} (${p}/${y}) trackId: ${T}`),this._initPTS={baseTime:p,timescale:y,trackId:T},this._initDTS={baseTime:v,timescale:y,trackId:T}):p=y=void 0,{tracks:f,initPTS:p,timescale:y,trackId:T}}remuxVideo(e,t,i,n){const r=e.inputTimeScale,o=e.samples,u=[],f=o.length,h=this._initPTS,d=h.baseTime*r/h.timescale;let m=this.nextVideoTs,p=8,v=this.videoSampleDuration,y,T,S=Number.POSITIVE_INFINITY,b=Number.NEGATIVE_INFINITY,C=!1;if(!i||m===null){const U=d+t*r,N=o[0].pts-Ji(o[0].dts,o[0].pts);$a&&m!==null&&Math.abs(U-N-(m+d))<15e3?i=!0:m=U-N-d}const L=m+d;for(let U=0;U<f;U++){const N=o[U];N.pts=Ji(N.pts,L),N.dts=Ji(N.dts,L),N.dts<o[U>0?U-1:U].dts&&(C=!0)}C&&o.sort(function(U,N){const V=U.dts-N.dts,q=U.pts-N.pts;return V||q}),y=o[0].dts,T=o[o.length-1].dts;const D=T-y,_=D?Math.round(D/(f-1)):v||e.inputTimeScale/30;if(i){const U=y-L,N=U>_,V=U<-1;if((N||V)&&(N?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${al(U,!0)} ms (${U}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${al(-U,!0)} ms (${U}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!V||L>=o[0].pts||$a)){y=L;const q=o[0].pts-U;if(N)o[0].dts=y,o[0].pts=q;else{let X=!0;for(let re=0;re<o.length&&!(o[re].dts>q&&X);re++){const oe=o[re].pts;if(o[re].dts-=U,o[re].pts-=U,re<o.length-1){const le=o[re+1].pts,ve=o[re].pts,ye=le<=ve,fe=le<=oe;X=ye==fe}}}this.log(`Video: Initial PTS/DTS adjusted: ${al(q,!0)}/${al(y,!0)}, delta: ${al(U,!0)} ms`)}}y=Math.max(0,y);let w=0,I=0,O=y;for(let U=0;U<f;U++){const N=o[U],V=N.units,q=V.length;let X=0;for(let re=0;re<q;re++)X+=V[re].data.length;I+=X,w+=q,N.length=X,N.dts<O?(N.dts=O,O+=_/4|0||1):O=N.dts,S=Math.min(N.pts,S),b=Math.max(N.pts,b)}T=o[f-1].dts;const F=I+4*w+8;let M;try{M=new Uint8Array(F)}catch(U){this.observer.emit(R.ERROR,R.ERROR,{type:ke.MUX_ERROR,details:te.REMUX_ALLOC_ERROR,fatal:!1,error:U,bytes:F,reason:`fail allocating video mdat ${F}`});return}const H=new DataView(M.buffer);H.setUint32(0,F),M.set(ee.types.mdat,4);let P=!1,z=Number.POSITIVE_INFINITY,Y=Number.POSITIVE_INFINITY,Z=Number.NEGATIVE_INFINITY,k=Number.NEGATIVE_INFINITY;for(let U=0;U<f;U++){const N=o[U],V=N.units;let q=0;for(let oe=0,le=V.length;oe<le;oe++){const ve=V[oe],ye=ve.data,fe=ve.data.byteLength;H.setUint32(p,fe),p+=4,M.set(ye,p),p+=fe,q+=4+fe}let X;if(U<f-1)v=o[U+1].dts-N.dts,X=o[U+1].pts-N.pts;else{const oe=this.config,le=U>0?N.dts-o[U-1].dts:_;if(X=U>0?N.pts-o[U-1].pts:_,oe.stretchShortVideoTrack&&this.nextAudioTs!==null){const ve=Math.floor(oe.maxBufferHole*r),ye=(n?S+n*r:this.nextAudioTs+d)-N.pts;ye>ve?(v=ye-le,v<0?v=le:P=!0,this.log(`It is approximately ${ye/90} ms to the next segment; using duration ${v/90} ms for the last video frame.`)):v=le}else v=le}const re=Math.round(N.pts-N.dts);z=Math.min(z,v),Z=Math.max(Z,v),Y=Math.min(Y,X),k=Math.max(k,X),u.push(hy(N.key,v,q,re))}if(u.length){if($a){if($a<70){const U=u[0].flags;U.dependsOn=2,U.isNonSync=0}}else if(ld&&k-Y<Z-z&&_/Z<.025&&u[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let U=y;for(let N=0,V=u.length;N<V;N++){const q=U+u[N].duration,X=U+u[N].cts;if(N<V-1){const re=q+u[N+1].cts;u[N].duration=re-X}else u[N].duration=N?u[N-1].duration:_;u[N].cts=0,U=q}}}v=P||!v?_:v;const K=T+v;this.nextVideoTs=m=K-d,this.videoSampleDuration=v,this.isVideoContiguous=!0;const J={data1:ee.moof(e.sequenceNumber++,y,xt(e,{samples:u})),data2:M,startPTS:(S-d)/r,endPTS:(b+v-d)/r,startDTS:(y-d)/r,endDTS:m/r,type:"video",hasAudio:!1,hasVideo:!0,nb:u.length,dropped:e.dropped};return e.samples=[],e.dropped=0,J}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return XD;case"ac3":return QD;default:return JD}}remuxAudio(e,t,i,n,r){const o=e.inputTimeScale,u=e.samplerate?e.samplerate:o,f=o/u,h=this.getSamplesPerFrame(e),d=h*f,m=this._initPTS,p=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,v=[],y=r!==void 0;let T=e.samples,S=p?0:8,b=this.nextAudioTs||-1;const C=m.baseTime*o/m.timescale,L=C+t*o;if(this.isAudioContiguous=i=i||T.length&&b>0&&(n&&Math.abs(L-(b+C))<9e3||Math.abs(Ji(T[0].pts,L)-(b+C))<20*d),T.forEach(function(k){k.pts=Ji(k.pts,L)}),!i||b<0){const k=T.length;if(T=T.filter(K=>K.pts>=0),k!==T.length&&this.warn(`Removed ${T.length-k} of ${k} samples (initPTS ${C} / ${o})`),!T.length)return;r===0?b=0:n&&!y?b=Math.max(0,L-C):b=T[0].pts-C}if(e.segmentCodec==="aac"){const k=this.config.maxAudioFramesDrift;for(let K=0,Q=b+C;K<T.length;K++){const j=T[K],J=j.pts,U=J-Q,N=Math.abs(1e3*U/o);if(U<=-k*d&&y)K===0&&(this.warn(`Audio frame @ ${(J/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*U/o)} ms.`),this.nextAudioTs=b=J-C,Q=J);else if(U>=k*d&&N<jD&&y){let V=Math.round(U/d);for(Q=J-V*d;Q<0&&V&&d;)V--,Q+=d;K===0&&(this.nextAudioTs=b=Q-C),this.warn(`Injecting ${V} audio frames @ ${((Q-C)/o).toFixed(3)}s due to ${Math.round(1e3*U/o)} ms gap.`);for(let q=0;q<V;q++){let X=$D.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);X||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),X=j.unit.subarray()),T.splice(K,0,{unit:X,pts:Q}),Q+=d,K++}}j.pts=Q,Q+=d}}let D=null,_=null,w,I=0,O=T.length;for(;O--;)I+=T[O].unit.byteLength;for(let k=0,K=T.length;k<K;k++){const Q=T[k],j=Q.unit;let J=Q.pts;if(_!==null){const N=v[k-1];N.duration=Math.round((J-_)/f)}else if(i&&e.segmentCodec==="aac"&&(J=b+C),D=J,I>0){I+=S;try{w=new Uint8Array(I)}catch(N){this.observer.emit(R.ERROR,R.ERROR,{type:ke.MUX_ERROR,details:te.REMUX_ALLOC_ERROR,fatal:!1,error:N,bytes:I,reason:`fail allocating audio mdat ${I}`});return}p||(new DataView(w.buffer).setUint32(0,I),w.set(ee.types.mdat,4))}else return;w.set(j,S);const U=j.byteLength;S+=U,v.push(hy(!0,h,U,0)),_=J}const F=v.length;if(!F)return;const M=v[v.length-1];b=_-C,this.nextAudioTs=b+f*M.duration;const H=p?new Uint8Array(0):ee.moof(e.sequenceNumber++,D/f,xt({},e,{samples:v}));e.samples=[];const P=(D-C)/o,z=b/o,Z={data1:H,data2:w,startPTS:P,endPTS:z,startDTS:P,endDTS:z,type:"audio",hasAudio:!0,hasVideo:!1,nb:F};return this.isAudioContiguous=!0,Z}}function Ji(l,e){let t;if(e===null)return l;for(e<l?t=-8589934592:t=8589934592;Math.abs(l-e)>4294967296;)l+=t;return l}function qD(l){for(let e=0;e<l.length;e++)if(l[e].key)return e;return-1}function AT(l,e,t,i){const n=l.samples.length;if(!n)return;const r=l.inputTimeScale;for(let u=0;u<n;u++){const f=l.samples[u];f.pts=Ji(f.pts-t.baseTime*r/t.timescale,e*r)/r,f.dts=Ji(f.dts-i.baseTime*r/i.timescale,e*r)/r}const o=l.samples;return l.samples=[],{samples:o}}function vT(l,e,t){const i=l.samples.length;if(!i)return;const n=l.inputTimeScale;for(let o=0;o<i;o++){const u=l.samples[o];u.pts=Ji(u.pts-t.baseTime*n/t.timescale,e*n)/n}l.samples.sort((o,u)=>o.pts-u.pts);const r=l.samples;return l.samples=[],{samples:r}}class WD extends gn{constructor(e,t,i,n){super("passthrough-remuxer",n),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,i,n){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(e,n),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:i,videoCodec:n}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:r,video:o}=this.initData=bE(e);if(t)KR(e,t);else{const f=r||o;f!=null&&f.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${f.codec}")!`)}r&&(i=dy(r,Rt.AUDIO,this)),o&&(n=dy(o,Rt.VIDEO,this));const u={};r&&o?u.audiovideo={container:"video/mp4",codec:i+","+n,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:r?u.audio={container:"audio/mp4",codec:i,encrypted:r.encrypted,initSegment:e,id:"audio"}:o?u.video={container:"video/mp4",codec:n,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=u}remux(e,t,i,n,r,o){var u,f;let{initPTS:h,lastEndTime:d}=this;const m={audio:void 0,video:void 0,text:n,id3:i,initSegment:void 0};xe(d)||(d=this.lastEndTime=r||0);const p=t.samples;if(!p.length)return m;const v={initPTS:void 0,timescale:void 0,trackId:void 0};let y=this.initData;if((u=y)!=null&&u.length||(this.generateInitSegment(p),y=this.initData),!((f=y)!=null&&f.length))return this.warn("Failed to generate initSegment."),m;this.emitInitSegment&&(v.tracks=this.initTracks,this.emitInitSegment=!1);const T=$R(p,y,this),S=y.audio?T[y.audio.id]:null,b=y.video?T[y.video.id]:null,C=Wu(b,1/0),L=Wu(S,1/0),D=Wu(b,0,!0),_=Wu(S,0,!0);let w=r,I=0;const O=S&&(!b||!h&&L<C||h&&h.trackId===y.audio.id),F=O?S:b;if(F){const Q=F.timescale,j=F.start-r*Q,J=O?y.audio.id:y.video.id;w=F.start/Q,I=O?_-L:D-C,(o||!h)&&(ZD(h,w,r,I)||Q!==h.timescale)&&(h&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${r} ${j/Q} != initPTS: ${h.baseTime/h.timescale} (${h.baseTime}/${h.timescale}) trackId: ${h.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${w-r} (${j}/${Q}) trackId: ${J}`),h=null,v.initPTS=j,v.timescale=Q,v.trackId=J)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${r}`);h?(v.initPTS=h.baseTime,v.timescale=h.timescale,v.trackId=h.trackId):((!v.timescale||v.trackId===void 0||v.initPTS===void 0)&&(this.warn("Could not set initPTS"),v.initPTS=w,v.timescale=1,v.trackId=-1),this.initPTS=h={baseTime:v.initPTS,timescale:v.timescale,trackId:v.trackId});const M=w-h.baseTime/h.timescale,H=M+I;I>0?this.lastEndTime=H:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const P=!!y.audio,z=!!y.video;let Y="";P&&(Y+="audio"),z&&(Y+="video");const Z=(y.audio?y.audio.encrypted:!1)||(y.video?y.video.encrypted:!1),k={data1:p,startPTS:M,startDTS:M,endPTS:H,endDTS:H,type:Y,hasAudio:P,hasVideo:z,nb:1,dropped:0,encrypted:Z};m.audio=P&&!z?k:void 0,m.video=z?k:void 0;const K=b?.sampleCount;if(K){const Q=b.keyFrameIndex,j=Q!==-1;k.nb=K,k.dropped=Q===0||this.isVideoContiguous?0:j?Q:K,k.independent=j,k.firstKeyFrame=Q,j&&b.keyFrameStart&&(k.firstKeyFramePTS=(b.keyFrameStart-h.baseTime)/h.timescale),this.isVideoContiguous||(m.independent=j),this.isVideoContiguous||(this.isVideoContiguous=j),k.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${Q}/${K} dropped: ${k.dropped} start: ${k.firstKeyFramePTS||"NA"}`)}return m.initSegment=v,m.id3=AT(i,r,h,h),n.samples.length&&(m.text=vT(n,r,h)),m}}function Wu(l,e,t=!1){return l?.start!==void 0?(l.start+(t?l.duration:0))/l.timescale:e}function ZD(l,e,t,i){if(l===null)return!0;const n=Math.max(i,1),r=e-l.baseTime/l.timescale;return Math.abs(r-t)>n}function dy(l,e,t){const i=l.codec;return i&&i.length>4?i:e===Rt.AUDIO?i==="ec-3"||i==="ac-3"||i==="alac"?i:i==="fLaC"||i==="Opus"?Tc(i,!1):(t.warn(`Unhandled audio codec "${i}" in mp4 MAP`),i||"mp4a"):(t.warn(`Unhandled video codec "${i}" in mp4 MAP`),i||"avc1")}let Ls;try{Ls=self.performance.now.bind(self.performance)}catch{Ls=Date.now}const dc=[{demux:PD,remux:WD},{demux:ur,remux:hc},{demux:FD,remux:hc},{demux:wD,remux:hc}];dc.splice(2,0,{demux:kD,remux:hc});class gy{constructor(e,t,i,n,r,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.id=r,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,n){const r=i.transmuxing;r.executeStart=Ls();let o=new Uint8Array(e);const{currentTransmuxState:u,transmuxConfig:f}=this;n&&(this.currentTransmuxState=n);const{contiguous:h,discontinuity:d,trackSwitch:m,accurateTimeOffset:p,timeOffset:v,initSegmentChange:y}=n||u,{audioCodec:T,videoCodec:S,defaultInitPts:b,duration:C,initSegmentData:L}=f,D=e_(o,t);if(D&&qa(D.method)){const O=this.getDecrypter(),F=Tg(D.method);if(O.isSync()){let M=O.softwareDecrypt(o,D.key.buffer,D.iv.buffer,F);if(i.part>-1){const P=O.flush();M=P&&P.buffer}if(!M)return r.executeEnd=Ls(),ud(i);o=new Uint8Array(M)}else return this.asyncResult=!0,this.decryptionPromise=O.webCryptoDecrypt(o,D.key.buffer,D.iv.buffer,F).then(M=>{const H=this.push(M,null,i);return this.decryptionPromise=null,H}),this.decryptionPromise}const _=this.needsProbing(d,m);if(_){const O=this.configureTransmuxer(o);if(O)return this.logger.warn(`[transmuxer] ${O.message}`),this.observer.emit(R.ERROR,R.ERROR,{type:ke.MEDIA_ERROR,details:te.FRAG_PARSING_ERROR,fatal:!1,error:O,reason:O.message}),r.executeEnd=Ls(),ud(i)}(d||m||y||_)&&this.resetInitSegment(L,T,S,C,t),(d||y||_)&&this.resetInitialTimestamp(b),h||this.resetContiguity();const w=this.transmux(o,D,v,p,i);this.asyncResult=xl(w);const I=this.currentTransmuxState;return I.contiguous=!0,I.discontinuity=!1,I.trackSwitch=!1,r.executeEnd=Ls(),w}flush(e){const t=e.transmuxing;t.executeStart=Ls();const{decrypter:i,currentTransmuxState:n,decryptionPromise:r}=this;if(r)return this.asyncResult=!0,r.then(()=>this.flush(e));const o=[],{timeOffset:u}=n;if(i){const m=i.flush();m&&o.push(this.push(m.buffer,null,e))}const{demuxer:f,remuxer:h}=this;if(!f||!h){t.executeEnd=Ls();const m=[ud(e)];return this.asyncResult?Promise.resolve(m):m}const d=f.flush(u);return xl(d)?(this.asyncResult=!0,d.then(m=>(this.flushRemux(o,m,e),o))):(this.flushRemux(o,d,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,i){const{audioTrack:n,videoTrack:r,id3Track:o,textTrack:u}=t,{accurateTimeOffset:f,timeOffset:h}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${i.sn}${i.part>-1?" part: "+i.part:""} of ${this.id===_e.MAIN?"level":"track"} ${i.level}`);const d=this.remuxer.remux(n,r,o,u,h,f,!0,this.id);e.push({remuxResult:d,chunkMeta:i}),i.transmuxing.executeEnd=Ls()}resetInitialTimestamp(e){const{demuxer:t,remuxer:i}=this;!t||!i||(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,n,r){const{demuxer:o,remuxer:u}=this;!o||!u||(o.resetInitSegment(e,t,i,n),u.resetInitSegment(e,t,i,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,n,r){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,i,n,r):o=this.transmuxUnencrypted(e,i,n,r),o}transmuxUnencrypted(e,t,i,n){const{audioTrack:r,videoTrack:o,id3Track:u,textTrack:f}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,o,u,f,t,i,!1,this.id),chunkMeta:n}}transmuxSampleAes(e,t,i,n,r){return this.demuxer.demuxSampleAes(e,t,i).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,i,n,!1,this.id),chunkMeta:r}))}configureTransmuxer(e){const{config:t,observer:i,typeSupported:n}=this;let r;for(let m=0,p=dc.length;m<p;m++){var o;if((o=dc[m].demux)!=null&&o.probe(e,this.logger)){r=dc[m];break}}if(!r)return new Error("Failed to find demuxer by probing fragment data");const u=this.demuxer,f=this.remuxer,h=r.remux,d=r.demux;(!f||!(f instanceof h))&&(this.remuxer=new h(i,t,n,this.logger)),(!u||!(u instanceof d))&&(this.demuxer=new d(i,t,n,this.logger),this.probe=d.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new yg(this.config)),e}}function e_(l,e){let t=null;return l.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const ud=l=>({remuxResult:{},chunkMeta:l});function xl(l){return"then"in l&&l.then instanceof Function}class t_{constructor(e,t,i,n,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=n,this.defaultInitPts=r||null}}class i_{constructor(e,t,i,n,r,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=n,this.timeOffset=r,this.initSegmentChange=o}}let my=0;class yT{constructor(e,t,i,n){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=my++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=f=>{const h=f.data,d=this.hls;if(!(!d||!(h!=null&&h.event)||h.instanceNo!==this.instanceNo))switch(h.event){case"init":{var m;const p=(m=this.workerContext)==null?void 0:m.objectURL;p&&self.URL.revokeObjectURL(p);break}case"transmuxComplete":{this.handleTransmuxComplete(h.data);break}case"flush":{this.onFlush(h.data);break}case"workerLog":{d.logger[h.data.logType]&&d.logger[h.data.logType](h.data.message);break}default:{h.data=h.data||{},h.data.frag=this.frag,h.data.part=this.part,h.data.id=this.id,d.trigger(h.event,h.data);break}}},this.onWorkerError=f=>{if(!this.hls)return;const h=new Error(`${f.message}  (${f.filename}:${f.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(R.ERROR,{type:ke.OTHER_ERROR,details:te.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:h})};const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=i,this.onFlush=n;const o=(f,h)=>{h=h||{},h.frag=this.frag||void 0,f===R.ERROR&&(h=h,h.parent=this.id,h.part=this.part,this.error=h.error),this.hls.trigger(f,h)};this.observer=new xg,this.observer.on(R.FRAG_DECRYPTED,o),this.observer.on(R.ERROR,o);const u=Bv(r.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const f=this.hls.logger;if(r.workerPath||aD()){try{r.workerPath?(f.log(`loading Web Worker ${r.workerPath} for "${t}"`),this.workerContext=lD(r.workerPath)):(f.log(`injecting Web Worker for "${t}"`),this.workerContext=oD());const{worker:d}=this.workerContext;d.addEventListener("message",this.onWorkerMessage),d.addEventListener("error",this.onWorkerError),d.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:u,id:t,config:Lt(r)})}catch(d){f.warn(`Error setting up "${t}" Web Worker, fallback to inline`,d),this.terminateWorker(),this.error=null,this.transmuxer=new gy(this.observer,u,r,"",t,e.logger)}return}}this.transmuxer=new gy(this.observer,u,r,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=my++;const t=this.hls.config,i=Bv(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:i,id:this.id,config:Lt(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),uD(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,i,n,r,o,u,f,h,d){var m,p;h.transmuxing.start=self.performance.now();const{instanceNo:v,transmuxer:y}=this,T=o?o.start:r.start,S=r.decryptdata,b=this.frag,C=!(b&&r.cc===b.cc),L=!(b&&h.level===b.level),D=b?h.sn-b.sn:-1,_=this.part?h.part-this.part.index:-1,w=D===0&&h.id>1&&h.id===b?.stats.chunkCount,I=!L&&(D===1||D===0&&(_===1||w&&_<=0)),O=self.performance.now();(L||D||r.stats.parsing.start===0)&&(r.stats.parsing.start=O),o&&(_||!I)&&(o.stats.parsing.start=O);const F=!(b&&((m=r.initSegment)==null?void 0:m.url)===((p=b.initSegment)==null?void 0:p.url)),M=new i_(C,I,f,L,T,F);if(!I||C||F){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${r.type} sn: ${h.sn}${h.part>-1?" part: "+h.part:""} ${this.id===_e.MAIN?"level":"track"}: ${h.level} id: ${h.id}
        discontinuity: ${C}
        trackSwitch: ${L}
        contiguous: ${I}
        accurateTimeOffset: ${f}
        timeOffset: ${T}
        initSegmentChange: ${F}`);const H=new t_(i,n,t,u,d);this.configureTransmuxer(H)}if(this.frag=r,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:v,cmd:"demux",data:e,decryptdata:S,chunkMeta:h,state:M},e instanceof ArrayBuffer?[e]:[]);else if(y){const H=y.push(e,S,h,M);xl(H)?H.then(P=>{this.handleTransmuxComplete(P)}).catch(P=>{this.transmuxerError(P,h,"transmuxer-interface push error")}):this.handleTransmuxComplete(H)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(i){const n=i.flush(e);xl(n)?n.then(r=>{this.handleFlushResult(r,e)}).catch(r=>{this.transmuxerError(r,e,"transmuxer-interface flush error")}):this.handleFlushResult(n,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(R.ERROR,{type:ke.MEDIA_ERROR,details:te.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):i&&i.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const py=100;class ET extends Uc{constructor(e,t,i){super(e,t,i,"audio-stream-controller",_e.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(R.LEVEL_LOADED,this.onLevelLoaded,this),e.on(R.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(R.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(R.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(R.BUFFER_RESET,this.onBufferReset,this),e.on(R.BUFFER_CREATED,this.onBufferCreated,this),e.on(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(R.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(R.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(R.FRAG_LOADING,this.onFragLoading,this),e.on(R.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(R.LEVEL_LOADED,this.onLevelLoaded,this),e.off(R.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(R.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(R.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(R.BUFFER_RESET,this.onBufferReset,this),e.off(R.BUFFER_CREATED,this.onBufferCreated,this),e.off(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(R.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(R.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(R.FRAG_LOADING,this.onFragLoading,this),e.off(R.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:i,initPTS:n,timescale:r,trackId:o}){if(i===_e.MAIN){const u=t.cc,f=this.fragCurrent;if(this.initPTS[u]={baseTime:n,timescale:r,trackId:o},this.log(`InitPTS for cc: ${u} found from main: ${n/r} (${n}/${r}) trackId: ${o}`),this.mainAnchor=t,this.state===ce.WAITING_INIT_PTS){const h=this.waitingData;(!h&&!this.loadingParts||h&&h.frag.cc!==u)&&this.syncWithAnchor(t,h?.frag)}else!this.hls.hasEnoughToStart&&f&&f.cc!==u?(f.abortRequests(),this.syncWithAnchor(t,f)):this.state===ce.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var i;const n=((i=this.mainFragLoading)==null?void 0:i.frag)||null;if(t&&n?.cc===t.cc)return;const r=(n||e).cc,o=this.getLevelDetails(),u=this.getLoadPosition(),f=kE(o,r,u);f&&(this.log(`Syncing with main frag at ${f.start} cc ${f.cc}`),this.startFragRequested=!1,this.nextLoadPosition=f.start,this.resetLoadingState(),this.state===ce.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=ce.STOPPED;return}const i=this.lastCurrentTime;this.stopLoad(),this.setInterval(py),i>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i,this.state=ce.IDLE):this.state=ce.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case ce.IDLE:this.doTickIdle();break;case ce.WAITING_TRACK:{const{levels:e,trackId:t}=this,i=e?.[t],n=i?.details;if(n&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(n))break;this.state=ce.WAITING_INIT_PTS}break}case ce.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case ce.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:i,cache:n,complete:r}=e,o=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=ce.FRAG_LOADING;const u=n.flush().buffer,f={frag:t,part:i,payload:u,networkDetails:null};this._handleFragmentLoadProgress(f),r&&super._handleFragmentLoadComplete(f)}else o&&o.cc!==e.frag.cc&&this.syncWithAnchor(o,e.frag)}else this.state=ce.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:i,media:n,trackId:r}=this,o=t.config;if(!this.buffering||!n&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(i!=null&&i[r]))return;const u=i[r],f=u.details;if(!f||this.waitForLive(u)||this.waitForCdnTuneIn(f)){this.state=ce.WAITING_TRACK,this.startFragRequested=!1;return}const h=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&h&&(this.bufferFlushed=!1,this.afterBufferFlushed(h,Rt.AUDIO,_e.AUDIO));const d=this.getFwdBufferInfo(h,_e.AUDIO);if(d===null)return;if(!this.switchingTrack&&this._streamEnded(d,f)){t.trigger(R.BUFFER_EOS,{type:"audio"}),this.state=ce.ENDED;return}const m=d.len,p=t.maxBufferLength,v=f.fragments,y=v[0].start,T=this.getLoadPosition(),S=this.flushing?T:d.end;if(this.switchingTrack&&n){const L=T;f.PTSKnown&&L<y&&(d.end>y||d.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=y+.05)}if(m>=p&&!this.switchingTrack&&S<v[v.length-1].start)return;let b=this.getNextFragment(S,f);if(b&&this.isLoopLoading(b,S)&&(b=this.getNextFragmentLoopLoading(b,f,d,_e.MAIN,p)),!b){this.bufferFlushed=!0;return}let C=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&C&&Zt(b)&&!b.endList&&(!f.live||!this.loadingParts&&S<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(C)===si.OK&&(this.mainFragLoading=C=null),C&&Zt(C))){if(b.start>C.end){const D=this.fragmentTracker.getFragAtPos(S,_e.MAIN);D&&D.end>C.end&&(C=D,this.mainFragLoading={frag:D,targetBufferTime:null})}if(b.start>C.end)return}this.loadFragment(b,u,S)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(i=>new io(i))}onAudioTrackSwitching(e,t){const i=!!t.url;this.trackId=t.id;const{fragCurrent:n}=this;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),i?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==ce.STOPPED&&(this.setInterval(py),this.state=ce.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(R.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(e,t){var i;const{levels:n}=this,{details:r,id:o,groupId:u,track:f}=t;if(!n){this.warn(`Audio tracks reset while loading track ${o} "${f.name}" of "${u}"`);return}const h=this.mainDetails;if(!h||r.endCC>h.endCC||h.expired){this.cachedTrackLoadedData=t,this.state!==ce.STOPPED&&(this.state=ce.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${f.name}" of "${u}" loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const d=n[o];let m=0;if(r.live||(i=d.details)!=null&&i.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;if(d.details){var p;m=this.alignPlaylists(r,d.details,(p=this.levelLastLoaded)==null?void 0:p.details)}r.alignedSliding||(ZE(r,h),r.alignedSliding||Dc(r,h),m=r.fragmentStart)}d.details=r,this.levelLastLoaded=d,this.startFragRequested||this.setStartPosition(h,m),this.hls.trigger(R.AUDIO_TRACK_UPDATED,{details:r,id:o,groupId:t.groupId}),this.state===ce.WAITING_TRACK&&!this.waitForCdnTuneIn(r)&&(this.state=ce.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:n,payload:r}=e,{config:o,trackId:u,levels:f}=this;if(!f){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const h=f[u];if(!h){this.warn("Audio track is undefined on fragment load progress");return}const d=h.details;if(!d){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const m=o.defaultAudioCodec||h.audioCodec||"mp4a.40.2";let p=this.transmuxer;p||(p=this.transmuxer=new yT(this.hls,_e.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const v=this.initPTS[i.cc],y=(t=i.initSegment)==null?void 0:t.data;if(v!==void 0){const S=n?n.index:-1,b=S!==-1,C=new wc(i.level,i.sn,i.stats.chunkCount,r.byteLength,S,b);p.push(r,y,m,"",i,n,d.totalduration,!1,C,v)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${d.startSN} ,${d.endSN}],track ${u}`);const{cache:T}=this.waitingData=this.waitingData||{frag:i,part:n,cache:new eT,complete:!1};T.push(new Uint8Array(r)),this.state!==ce.STOPPED&&(this.state=ce.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===_e.MAIN&&Zt(t.frag)&&(this.mainFragLoading=t,this.state===ce.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:i,part:n}=t;if(i.type!==_e.AUDIO){!this.audioOnly&&i.type===_e.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${n?" p: "+n.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Zt(i)){this.fragPrevious=i;const r=this.switchingTrack;r&&(this.bufferedTrack=r,this.switchingTrack=null,this.hls.trigger(R.AUDIO_TRACK_SWITCHED,At({},r)))}this.fragBufferedComplete(i,n),this.media&&this.tick()}onError(e,t){var i;if(t.fatal){this.state=ce.ERROR;return}switch(t.details){case te.FRAG_GAP:case te.FRAG_PARSING_ERROR:case te.FRAG_DECRYPT_ERROR:case te.FRAG_LOAD_ERROR:case te.FRAG_LOAD_TIMEOUT:case te.KEY_LOAD_ERROR:case te.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(_e.AUDIO,t);break;case te.AUDIO_TRACK_LOAD_ERROR:case te.AUDIO_TRACK_LOAD_TIMEOUT:case te.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ce.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===tt.AUDIO_TRACK&&(this.state=ce.IDLE);break;case te.BUFFER_ADD_CODEC_ERROR:case te.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case te.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case te.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Rt.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Rt.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ce.ENDED&&(this.state=ce.IDLE);const i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,t,_e.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const i="audio",{hls:n}=this,{remuxResult:r,chunkMeta:o}=e,u=this.getCurrentContext(o);if(!u){this.resetWhenMissingContext(o);return}const{frag:f,part:h,level:d}=u,{details:m}=d,{audio:p,text:v,id3:y,initSegment:T}=r;if(this.fragContextChanged(f)||!m){this.fragmentTracker.removeFragment(f);return}if(this.state=ce.PARSING,this.switchingTrack&&p&&this.completeAudioSwitch(this.switchingTrack),T!=null&&T.tracks){const S=f.initSegment||f;if(this.unhandledEncryptionError(T,f))return;this._bufferInitSegment(d,T.tracks,S,o),n.trigger(R.FRAG_PARSING_INIT_SEGMENT,{frag:S,id:i,tracks:T.tracks})}if(p){const{startPTS:S,endPTS:b,startDTS:C,endDTS:L}=p;h&&(h.elementaryStreams[Rt.AUDIO]={startPTS:S,endPTS:b,startDTS:C,endDTS:L}),f.setElementaryStreamInfo(Rt.AUDIO,S,b,C,L),this.bufferFragmentData(p,f,h,o)}if(y!=null&&(t=y.samples)!=null&&t.length){const S=xt({id:i,frag:f,details:m},y);n.trigger(R.FRAG_PARSING_METADATA,S)}if(v){const S=xt({id:i,frag:f,details:m},v);n.trigger(R.FRAG_PARSING_USERDATA,S)}}_bufferInitSegment(e,t,i,n){if(this.state!==ce.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const r=t.audio;r.id=_e.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${r.container}, codecs[level/parsed]=[${o}/${r.codec}]`),o&&o.split(",").length===1&&(r.levelCodec=o),this.hls.trigger(R.BUFFER_CODECS,t);const u=r.initSegment;if(u!=null&&u.byteLength){const f={type:"audio",frag:i,part:null,chunkMeta:n,parent:i.type,data:u};this.hls.trigger(R.BUFFER_APPENDING,f)}this.tickImmediate()}loadFragment(e,t,i){const n=this.fragmentTracker.getState(e);if(this.switchingTrack||n===si.NOT_LOADED||n===si.PARTIAL){var r;if(!Zt(e))this._loadInitSegment(e,t);else if((r=t.details)!=null&&r.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=ce.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&Dc(t.details,o)}else super.loadFragment(e,t,i)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:i,assocLang:n,characteristics:r,audioCodec:o,channels:u}=this.bufferedTrack;Yr({name:t,lang:i,assocLang:n,characteristics:r,audioCodec:o,channels:u},e,Kr)||(bc(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(R.AUDIO_TRACK_SWITCHED,At({},e))}}class Nc extends gn{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,i){const n=t?.renditionReports;if(n){let r=-1;for(let o=0;o<n.length;o++){const u=n[o];let f;try{f=new self.URL(u.URI,t.url).href}catch(h){this.warn(`Could not construct new URL for Rendition Report: ${h}`),f=u.URI||""}if(f===e){r=o;break}else f===e.substring(0,f.length)&&(r=o)}if(r!==-1){const o=n[r],u=parseInt(o["LAST-MSN"])||t.lastPartSn;let f=parseInt(o["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const d=Math.min(t.age-t.partTarget,t.targetduration);f>=0&&d>t.partTarget&&(f+=1)}const h=i&&Mv(i);return new Nd(u,f>=0?f:void 0,h)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}return e}playlistLoaded(e,t,i){const{details:n,stats:r}=t,o=self.performance.now(),u=r.loading.first?Math.max(0,o-r.loading.first):0;n.advancedDateTime=Date.now()-u;const f=this.hls.config.timelineOffset;if(f!==n.appliedTimelineOffset){const d=Math.max(f||0,0);n.appliedTimelineOffset=d,n.fragments.forEach(m=>{m.setStart(m.playlistOffset+d)})}if(n.live||i!=null&&i.live){const d="levelInfo"in t?t.levelInfo:t.track;if(n.reloaded(i),i&&n.fragments.length>0){XL(i,n,this);const C=n.playlistParsingError;if(C){this.warn(C);const L=this.hls;if(!L.config.ignorePlaylistParsingErrors){var h;const{networkDetails:D}=t;L.trigger(R.ERROR,{type:ke.NETWORK_ERROR,details:te.LEVEL_PARSING_ERROR,fatal:!1,url:n.url,error:C,reason:C.message,level:t.level||void 0,parent:(h=n.fragments[0])==null?void 0:h.type,networkDetails:D,stats:r});return}n.playlistParsingError=null}}n.requestScheduled===-1&&(n.requestScheduled=r.loading.start);const m=this.hls.mainForwardBufferInfo,p=m?m.end-m.len:0,v=(n.edge-p)*1e3,y=JE(n,v);if(n.requestScheduled+y<o?n.requestScheduled=o:n.requestScheduled+=y,this.log(`live playlist ${e} ${n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:n.updated?"UPDATED":"MISSED"}`),!this.canLoad||!n.live)return;let T,S,b;if(n.canBlockReload&&n.endSN&&n.advanced){const C=this.hls.config.lowLatencyMode,L=n.lastPartSn,D=n.endSN,_=n.lastPartIndex,w=_!==-1,I=L===D;w?I?(S=D+1,b=C?0:_):(S=L,b=C?_+1:n.maxPartIndex):S=D+1;const O=n.age,F=O+n.ageHeader;let M=Math.min(F-n.partTarget,n.targetduration*1.5);if(M>0){if(F>n.targetduration*3)this.log(`Playlist last advanced ${O.toFixed(2)}s ago. Omitting segment and part directives.`),S=void 0,b=void 0;else if(i!=null&&i.tuneInGoal&&F-n.partTarget>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${M} with playlist age: ${n.age}`),M=0;else{const H=Math.floor(M/n.targetduration);if(S+=H,b!==void 0){const P=Math.round(M%n.targetduration/n.partTarget);b+=P}this.log(`CDN Tune-in age: ${n.ageHeader}s last advanced ${O.toFixed(2)}s goal: ${M} skip sn ${H} to part ${b}`)}n.tuneInGoal=M}if(T=this.getDeliveryDirectives(n,t.deliveryDirectives,S,b),C||!I){n.requestScheduled=o,this.loadingPlaylist(d,T);return}}else(n.canBlockReload||n.canSkipUntil)&&(T=this.getDeliveryDirectives(n,t.deliveryDirectives,S,b));T&&S!==void 0&&n.canBlockReload&&(n.requestScheduled=r.loading.first+Math.max(y-u*2,y/2)),this.scheduleLoading(d,T,n)}else this.clearTimer()}scheduleLoading(e,t,i){const n=i||e.details;if(!n){this.loadingPlaylist(e,t);return}const r=self.performance.now(),o=n.requestScheduled;if(r>=o){this.loadingPlaylist(e,t);return}const u=o-r;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(u)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),u)}getDeliveryDirectives(e,t,i,n){let r=Mv(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,n=t.part,r=gl.No),new Nd(i,n,r)}checkRetry(e){const t=e.details,i=xc(e),n=e.errorAction,{action:r,retryCount:o=0,retryConfig:u}=n||{},f=!!n&&!!u&&(r===ni.RetryRequest||!n.resolved&&r===ni.SendAlternateToPenaltyBox);if(f){var h;if(o>=u.maxNumRetry)return!1;if(i&&(h=e.context)!=null&&h.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${u.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const d=vg(u,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),d),this.warn(`Retrying playlist loading ${o+1}/${u.maxNumRetry} after "${t}" in ${d}ms`)}e.levelRetry=!0,n.resolved=!0}return f}}function TT(l,e){if(l.length!==e.length)return!1;for(let t=0;t<l.length;t++)if(!Cl(l[t].attrs,e[t].attrs))return!1;return!0}function Cl(l,e,t){const i=l["STABLE-RENDITION-ID"];return i&&!t?i===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>l[n]!==e[n])}function jd(l,e){return e.label.toLowerCase()===l.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(l.lang||"").toLowerCase())}class ST extends Nc{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.LEVEL_LOADING,this.onLevelLoading,this),e.on(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(R.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(R.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.LEVEL_LOADING,this.onLevelLoading,this),e.off(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(R.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(R.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:i,groupId:n,details:r}=t,o=this.tracksInGroup[i];if(!o||o.groupId!==n){this.warn(`Audio track with id:${i} and group:${n} not found in active group ${o?.groupId}`);return}const u=o.details;o.details=t.details,this.log(`Audio track ${i} "${o.name}" lang:${o.lang} group:${n} loaded [${r.startSN}-${r.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.audioGroups||null,n=this.groupIds;let r=this.currentTrack;if(!i||n?.length!==i?.length||i!=null&&i.some(u=>n?.indexOf(u)===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const u=this.tracks.filter(p=>!i||i.indexOf(p.groupId)!==-1);if(u.length)this.selectDefaultTrack&&!u.some(p=>p.default)&&(this.selectDefaultTrack=!1),u.forEach((p,v)=>{p.id=v});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=u;const f=this.hls.config.audioPreference;if(!r&&f){const p=Vn(f,u,Kr);if(p>-1)r=u[p];else{const v=Vn(f,this.tracks);r=this.tracks[v]}}let h=this.findTrackId(r);h===-1&&r&&(h=this.findTrackId(null));const d={audioTracks:u};this.log(`Updating audio tracks, ${u.length} track(s) found in group(s): ${i?.join(",")}`),this.hls.trigger(R.AUDIO_TRACKS_UPDATED,d);const m=this.trackId;if(h!==-1&&m===-1)this.setAudioTrack(h);else if(u.length&&m===-1){var o;const p=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${u.length}`);this.warn(p.message),this.hls.trigger(R.ERROR,{type:ke.MEDIA_ERROR,details:te.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:p})}}}onError(e,t){t.fatal||!t.context||t.context.type===tt.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){const n=this.currentTrack;if(n&&Yr(e,n,Kr))return n;const r=Vn(e,this.tracksInGroup,Kr);if(r>-1){const o=this.tracksInGroup[r];return this.setAudioTrack(r),o}else if(n){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const u=yL(e,t.levels,i,o,Kr);if(u===-1)return null;t.nextLoadLevel=u}if(e.channels||e.audioCodec){const o=Vn(e,i);if(o>-1)return i[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,n=t[e],r=n.details&&!n.details.live;if(e===this.trackId&&n===i&&r||(this.log(`Switching to audio-track ${e} "${n.name}" lang:${n.lang} group:${n.groupId} channels:${n.channels}`),this.trackId=e,this.currentTrack=n,this.hls.trigger(R.AUDIO_TRACK_SWITCHING,At({},n)),r))return;const o=this.switchParams(n.url,i?.details,n.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const n=t[i];if(!(this.selectDefaultTrack&&!n.default)&&(!e||Yr(e,n,Kr)))return i}if(e){const{name:i,lang:n,assocLang:r,characteristics:o,audioCodec:u,channels:f}=e;for(let h=0;h<t.length;h++){const d=t[h];if(Yr({name:i,lang:n,assocLang:r,characteristics:o,audioCodec:u,channels:f},d,Kr))return h}for(let h=0;h<t.length;h++){const d=t[h];if(Cl(e.attrs,d.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return h}for(let h=0;h<t.length;h++){const d=t[h];if(Cl(e.attrs,d.attrs,["LANGUAGE"]))return h}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&bc(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,n=e.groupId,r=this.getUrlWithDirectives(e.url,t),o=e.details,u=o?.age;this.log(`Loading audio-track ${i} "${e.name}" lang:${e.lang} group:${n}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&o.live?" age "+u.toFixed(1)+(o.type&&" "+o.type||""):""} ${r}`),this.hls.trigger(R.AUDIO_TRACK_LOADING,{url:r,id:i,groupId:n,deliveryDirectives:t||null,track:e})}}class n_{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,i){if(this.queues===null||this.tracks===null)return;const n=this.queues[t];n.push(e),n.length===1&&!i&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const i={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(i,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const i={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(i)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const i=(t=e[0])==null?void 0:t.label;(i==="async-blocker"||i==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const n=t[0];try{n.execute()}catch(r){var i;if(n.onError(r),this.queues===null||this.tracks===null)return;const o=(i=this.tracks[e])==null?void 0:i.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,i;return(t=this.queues)!=null&&t[e]||(i=this.tracks)!=null&&i[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const i=(t=this.tracks)==null?void 0:t[e],n=i?.buffer;return n?`SourceBuffer${n.updating?" updating":""}${i.ended?" ended":""}${i.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(i=>i.label).join(", "))||""}}const Ay=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,bT="HlsJsTrackRemovedError";class s_ extends Error{constructor(e){super(e),this.name=bT}}class xT extends gn{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=i=>{var n;this.hls&&((n=this.mediaSource)==null?void 0:n.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=i=>{const{media:n,mediaSource:r}=this;i&&this.log("Media source opened"),!(!n||!r)&&(r.removeEventListener("sourceopen",this._onMediaSourceOpen),n.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(R.MEDIA_ATTACHED,{media:n,mediaSource:r}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:i,_objectUrl:n}=this;i!==n&&this.error(`Media element src was set while attaching MediaSource (${n} > ${i})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=OR(Bs(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.BUFFER_RESET,this.onBufferReset,this),e.on(R.BUFFER_APPENDING,this.onBufferAppending,this),e.on(R.BUFFER_CODECS,this.onBufferCodecs,this),e.on(R.BUFFER_EOS,this.onBufferEos,this),e.on(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(R.FRAG_PARSED,this.onFragParsed,this),e.on(R.FRAG_CHANGED,this.onFragChanged,this),e.on(R.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.BUFFER_RESET,this.onBufferReset,this),e.off(R.BUFFER_APPENDING,this.onBufferAppending,this),e.off(R.BUFFER_CODECS,this.onBufferCodecs,this),e.off(R.BUFFER_EOS,this.onBufferEos,this),e.off(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(R.FRAG_PARSED,this.onFragParsed,this),e.off(R.FRAG_CHANGED,this.onFragChanged,this),e.off(R.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const i={};if(this.operationQueue){const r=this.isUpdating();r||this.operationQueue.removeBlockers();const o=this.isQueued();(r||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${r?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const n=this.transferData;return!this.sourceBufferCount&&n&&n.mediaSource===t?xt(i,n.tracks):this.sourceBuffers.forEach(r=>{const[o]=r;o&&(i[o]=xt({},this.tracks[o]),this.removeBuffer(o)),r[0]=r[1]=null}),{media:e,mediaSource:t,tracks:i}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var i;let n=2;(t.audio&&!t.video||!t.altAudio)&&(n=1),this.bufferCodecEventsTotal=n,this.log(`${n} bufferCodec event(s) expected.`),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&n&&this.bufferCreated()}onMediaAttaching(e,t){const i=this.media=t.media;this.transferData=this.overrides=void 0;const n=Bs(this.appendSource);if(n){const r=!!t.mediaSource;(r||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new n;if(this.assignMediaSource(o),r)this._objectUrl=i.src,this.attachTransferred();else{const u=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{i.removeAttribute("src");const f=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||f&&o instanceof f,vy(i),r_(i,u),i.load()}catch{i.src=u}else i.src=u}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,i;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(i=e.constructor)==null?void 0:i.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const i=this.tracks,n=t.tracks,r=n?Object.keys(n):null,o=r?r.length:0,u=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(n&&r&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Lt(i,(f,h)=>f==="initSegment"?void 0:h)};
transfer tracks: ${Lt(n,(f,h)=>f==="initSegment"?void 0:h)}}`),!pE(n,i)){t.mediaSource=null,t.tracks=void 0;const f=e.currentTime,h=this.details,d=Math.max(f,h?.fragments[0].start||0);if(d-f>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${f} -> ${d}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(n)}"->"${Object.keys(i)}") start time: ${d} currentTime: ${f}`),this.onMediaDetaching(R.MEDIA_DETACHING,{}),this.onMediaAttaching(R.MEDIA_ATTACHING,t),e.currentTime=d;return}this.transferData=void 0,r.forEach(f=>{const h=f,d=n[h];if(d){const m=d.buffer;if(m){const p=this.fragmentTracker,v=d.id;if(p.hasFragments(v)||p.hasParts(v)){const S=je.getBuffered(m);p.detectEvictedFragments(h,S,v,null,!0)}const y=cd(h),T=[h,m];this.sourceBuffers[y]=T,m.updating&&this.operationQueue&&this.operationQueue.prependBlocker(h),this.trackSourceBuffer(h,d)}}}),u(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),u()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const i=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:n,mediaSource:r,_objectUrl:o}=this;if(r){if(this.log(`media source ${i?"transferring":"detaching"}`),i)this.sourceBuffers.forEach(([u])=>{u&&this.removeBuffer(u)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const u=r.readyState==="open";try{const f=r.sourceBuffers;for(let h=f.length;h--;)u&&f[h].abort(),r.removeSourceBuffer(f[h]);u&&r.endOfStream()}catch(f){this.warn(`onMediaDetaching: ${f.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}n&&(n.removeEventListener("emptied",this._onMediaEmptied),i||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(n.removeAttribute("src"),this.appendSource&&vy(n),n.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(R.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const i=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),i)try{var n;(n=this.mediaSource)!=null&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(r){this.warn(`onBufferReset ${e}`,r)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[cd(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new n_(this.tracks)}onBufferCodecs(e,t){var i;const n=this.tracks,r=Object.keys(t);this.log(`BUFFER_CODECS: "${r}" (current SB count ${this.sourceBufferCount})`);const o="audiovideo"in t&&(n.audio||n.video)||n.audiovideo&&("audio"in t||"video"in t),u=!o&&this.sourceBufferCount&&this.media&&r.some(f=>!n[f]);if(o||u){this.warn(`Unsupported transition between "${Object.keys(n)}" and "${r}" SourceBuffers`);return}r.forEach(f=>{var h,d;const m=t[f],{id:p,codec:v,levelCodec:y,container:T,metadata:S,supplemental:b}=m;let C=n[f];const L=(h=this.transferData)==null||(h=h.tracks)==null?void 0:h[f],D=L!=null&&L.buffer?L:C,_=D?.pendingCodec||D?.codec,w=D?.levelCodec;C||(C=n[f]={buffer:void 0,listeners:[],codec:v,supplemental:b,container:T,levelCodec:y,metadata:S,id:p});const I=cc(_,w),O=I?.replace(Ay,"$1");let F=cc(v,y);const M=(d=F)==null?void 0:d.replace(Ay,"$1");F&&I&&O!==M&&(f.slice(0,5)==="audio"&&(F=Tc(F,this.appendSource)),this.log(`switching codec ${_} to ${F}`),F!==(C.pendingCodec||C.codec)&&(C.pendingCodec=F),C.container=T,this.appendChangeType(f,T,F))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((i=t.audio)==null?void 0:i.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const i=this.tracks[t];return e[t]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},e},{})}appendChangeType(e,t,i){const n=`${t};codecs=${i}`,r={label:`change-type=${n}`,execute:()=>{const o=this.tracks[e];if(o){const u=o.buffer;u!=null&&u.changeType&&(this.log(`changing ${e} sourceBuffer type to ${n}`),u.changeType(n),o.codec=i,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(r,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const i=e.start,n=i+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(i,_e.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var u;const f=this.tracks.video;(this.lastVideoAppendEnd>n||f!=null&&f.buffer&&je.isBuffered(f.buffer,n)||((u=this.fragmentTracker.getAppendedFrag(n,_e.MAIN))==null?void 0:u.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:u=>{this.warn("Error executing block-audio operation",u)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:i}=this,{data:n,type:r,parent:o,frag:u,part:f,chunkMeta:h,offset:d}=t,m=h.buffering[r],{sn:p,cc:v}=u,y=self.performance.now();m.start=y;const T=u.stats.buffering,S=f?f.stats.buffering:null;T.start===0&&(T.start=y),S&&S.start===0&&(S.start=y);const b=i.audio;let C=!1;r==="audio"&&b?.container==="audio/mpeg"&&(C=!this.lastMpegAudioChunk||h.id===1||this.lastMpegAudioChunk.sn!==h.sn,this.lastMpegAudioChunk=h);const L=i.video,D=L?.buffer;if(D&&p!=="initSegment"){const I=f||u,O=this.blockedAudioAppend;if(r==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(L.ending||L.ended)){const M=I.start+I.duration*.05,H=D.buffered,P=this.currentOp("video");!H.length&&!P?this.blockAudio(I):!P&&!je.isBuffered(D,M)&&this.lastVideoAppendEnd<M&&this.blockAudio(I)}else if(r==="video"){const F=I.end;if(O){const M=O.frag.start;(F>M||F<this.lastVideoAppendEnd||je.isBuffered(D,M))&&this.unblockAudio()}this.lastVideoAppendEnd=F}}const _=(f||u).start,w={label:`append-${r}`,execute:()=>{var I;m.executeStart=self.performance.now();const O=(I=this.tracks[r])==null?void 0:I.buffer;O&&(C?this.updateTimestampOffset(O,_,.1,r,p,v):d!==void 0&&xe(d)&&this.updateTimestampOffset(O,d,1e-6,r,p,v)),this.appendExecutor(n,r)},onStart:()=>{},onComplete:()=>{const I=self.performance.now();m.executeEnd=m.end=I,T.first===0&&(T.first=I),S&&S.first===0&&(S.first=I);const O={};this.sourceBuffers.forEach(([F,M])=>{F&&(O[F]=je.getBuffered(M))}),this.appendErrors[r]=0,r==="audio"||r==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(R.BUFFER_APPENDED,{type:r,frag:u,part:f,chunkMeta:h,parent:u.type,timeRanges:O})},onError:I=>{var O;const F={type:ke.MEDIA_ERROR,parent:u.type,details:te.BUFFER_APPEND_ERROR,sourceBufferName:r,frag:u,part:f,chunkMeta:h,error:I,err:I,fatal:!1},M=(O=this.media)==null?void 0:O.error;if(I.code===DOMException.QUOTA_EXCEEDED_ERR||I.name=="QuotaExceededError"||"quota"in I)F.details=te.BUFFER_FULL_ERROR;else if(I.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!M)F.errorAction=Qa(!0);else if(I.name===bT&&this.sourceBufferCount===0)F.errorAction=Qa(!0);else{const H=++this.appendErrors[r];this.warn(`Failed ${H}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${r}" sourceBuffer (${M||"no media error"})`),(H>=this.hls.config.appendErrorMaxRetry||M)&&(F.fatal=!0)}this.hls.trigger(R.ERROR,F)}};this.log(`queuing "${r}" append sn: ${p}${f?" p: "+f.index:""} of ${u.type===_e.MAIN?"level":"track"} ${u.level} cc: ${v}`),this.append(w,r,this.isPending(this.tracks[r]))}getFlushOp(e,t,i){return this.log(`queuing "${e}" remove ${t}-${i}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(R.BUFFER_FLUSHED,{type:e})},onError:n=>{this.warn(`Failed to remove ${t}-${i} from "${e}" SourceBuffer`,n)}}}onBufferFlushing(e,t){const{type:i,startOffset:n,endOffset:r}=t;i?this.append(this.getFlushOp(i,n,r),i):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,n,r),o)})}onFragParsed(e,t){const{frag:i,part:n}=t,r=[],o=n?n.elementaryStreams:i.elementaryStreams;o[Rt.AUDIOVIDEO]?r.push("audiovideo"):(o[Rt.AUDIO]&&r.push("audio"),o[Rt.VIDEO]&&r.push("video"));const u=()=>{const f=self.performance.now();i.stats.buffering.end=f,n&&(n.stats.buffering.end=f);const h=n?n.stats:i.stats;this.hls.trigger(R.FRAG_BUFFERED,{frag:i,part:n,stats:h,id:i.type})};r.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(u,r).catch(f=>{this.warn(`Fragment buffered callback ${f}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var i;this.sourceBuffers.forEach(([o])=>{if(o){const u=this.tracks[o];(!t.type||t.type===o)&&(u.ending=!0,u.ended||(u.ended=!0,this.log(`${o} buffer reached EOS`)))}});const n=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var u;return o&&!((u=this.tracks[o])!=null&&u.ended)})?n?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(R.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(R.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===te.BUFFER_APPEND_ERROR&&t.frag){var i;const n=(i=t.errorAction)==null?void 0:i.nextAutoLevel;xe(n)&&n!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:i}=this;if(!i||t===null||!this.sourceBufferCount)return;const n=e.config,r=i.currentTime,o=t.levelTargetDuration,u=t.live&&n.liveBackBufferLength!==null?n.liveBackBufferLength:n.backBufferLength;if(xe(u)&&u>=0){const h=Math.max(u,o),d=Math.floor(r/o)*o-h;this.flushBackBuffer(r,o,d)}const f=n.frontBufferFlushThreshold;if(xe(f)&&f>0){const h=Math.max(n.maxBufferLength,f),d=Math.max(h,o),m=Math.floor(r/o)*o+d;this.flushFrontBuffer(r,o,m)}}flushBackBuffer(e,t,i){this.sourceBuffers.forEach(([n,r])=>{if(r){const u=je.getBuffered(r);if(u.length>0&&i>u.start(0)){var o;this.hls.trigger(R.BACK_BUFFER_REACHED,{bufferEnd:i});const f=this.tracks[n];if((o=this.details)!=null&&o.live)this.hls.trigger(R.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(f!=null&&f.ended){this.log(`Cannot flush ${n} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(R.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:n})}}})}flushFrontBuffer(e,t,i){this.sourceBuffers.forEach(([n,r])=>{if(r){const o=je.getBuffered(r),u=o.length;if(u<2)return;const f=o.start(u-1),h=o.end(u-1);if(i>f||e>=f&&e<=h)return;this.hls.trigger(R.BUFFER_FLUSHING,{startOffset:f,endOffset:1/0,type:n})}})}getDurationAndRange(){var e;const{details:t,mediaSource:i}=this;if(!t||!this.media||i?.readyState!=="open")return null;const n=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&i.setLiveSeekableRange){const h=Math.max(0,t.fragmentStart),d=Math.max(h,n);return{duration:1/0,start:h,end:d}}return{duration:1/0}}const r=(e=this.overrides)==null?void 0:e.duration;if(r)return xe(r)?{duration:r}:null;const o=this.media.duration,u=xe(i.duration)?i.duration:0;return n>u&&n>o||!xe(o)?{duration:n}:null}updateMediaSource({duration:e,start:t,end:i}){const n=this.mediaSource;!this.media||!n||n.readyState!=="open"||(n.duration!==e&&(xe(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),n.duration=e),t!==void 0&&i!==void 0&&(this.log(`MediaSource duration is set to ${n.duration}. Setting seekable range to ${t}-${i}.`),n.setLiveSeekableRange(t,i)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:i}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Lt(i)}`),this.tracksReady){var n;const r=(n=this.transferData)==null?void 0:n.tracks;r&&Object.keys(r).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,i])=>{if(t){const n=this.tracks[t];e[t]={buffer:i,container:n.container,codec:n.codec,supplemental:n.supplemental,levelCodec:n.levelCodec,id:n.id,metadata:n.metadata}}}),this.hls.trigger(R.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(R.ERROR,{type:ke.MEDIA_ERROR,details:te.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:i}=this;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(const r in e){const o=r,u=e[o];if(this.isPending(u)){const f=this.getTrackCodec(u,o),h=`${u.container};codecs=${f}`;u.codec=f,this.log(`creating sourceBuffer(${h})${this.currentOp(o)?" Queued":""} ${Lt(u)}`);try{const d=i.addSourceBuffer(h),m=cd(o),p=[o,d];t[m]=p,u.buffer=d}catch(d){var n;this.error(`error while trying to add sourceBuffer: ${d.message}`),this.shiftAndExecuteNext(o),(n=this.operationQueue)==null||n.removeBlockers(),delete this.tracks[o],this.hls.trigger(R.ERROR,{type:ke.MEDIA_ERROR,details:te.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:d,sourceBufferName:o,mimeType:h,parent:u.id});return}this.trackSourceBuffer(o,u)}}this.bufferCreated()}getTrackCodec(e,t){const i=e.supplemental;let n=e.codec;i&&(t==="video"||t==="audiovideo")&&El(i,"video")&&(n=eL(n,i));const r=cc(n,e.levelCodec);return r?t.slice(0,5)==="audio"?Tc(r,this.appendSource):r:""}trackSourceBuffer(e,t){const i=t.buffer;if(!i)return;const n=this.getTrackCodec(t,e);this.tracks[e]={buffer:i,codec:n,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(r,o)=>{const u=o.removedRanges;u!=null&&u.length&&this.hls.trigger(R.BUFFER_FLUSHED,{type:r})})}get mediaSrc(){var e,t;const i=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return i?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var i;const n=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${n}`,t),this.hls.trigger(R.ERROR,{type:ke.MEDIA_ERROR,details:te.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:n,fatal:!1});const r=this.currentOp(e);r&&r.onError(n)}updateTimestampOffset(e,t,i,n,r,o){const u=t-e.timestampOffset;Math.abs(u)>=i&&(this.log(`Updating ${n} SourceBuffer timestampOffset to ${t} (sn: ${r} cc: ${o})`),e.timestampOffset=t)}removeExecutor(e,t,i){const{media:n,mediaSource:r}=this,o=this.tracks[e],u=o?.buffer;if(!n||!r||!u){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const f=xe(n.duration)?n.duration:1/0,h=xe(r.duration)?r.duration:1/0,d=Math.max(0,t),m=Math.min(i,f,h);m>d&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${d},${m}] from the ${e} SourceBuffer`),u.remove(d,m)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const i=this.tracks[t],n=i?.buffer;if(!n)throw new s_(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);i.ending=!1,i.ended=!1,n.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:i}=this,n=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(n).then(o=>{i===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var i;const n=(i=this.tracks[t])==null?void 0:i.buffer;!n||n.updating||this.shiftAndExecuteNext(t)})}append(e,t,i){this.operationQueue&&this.operationQueue.append(e,t,i)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,i){const n=this.tracks[e];if(!n)return;const r=n.buffer;if(!r)return;const o=i.bind(this,e);n.listeners.push({event:t,listener:o}),r.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const i=t.buffer;i&&(t.listeners.forEach(n=>{i.removeEventListener(n.event,n.listener)}),t.listeners.length=0)}}function vy(l){const e=l.querySelectorAll("source");[].slice.call(e).forEach(t=>{l.removeChild(t)})}function r_(l,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,l.appendChild(t)}function cd(l){return l==="audio"?1:0}class Gc{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(R.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(R.BUFFER_CODECS,this.onBufferCodecs,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(R.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(R.BUFFER_CODECS,this.onBufferCodecs,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&xe(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${i}: ${e[i].height}p@${e[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=i,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const i=t.filter((n,r)=>this.isLevelAllowed(n)&&r<=e);return this.clientRect=null,Gc.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,!t.width&&!t.height&&(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(i=>e.bitrate===i.bitrate&&e.width===i.width&&e.height===i.height)}static getMaxLevelByMediaSize(e,t,i){if(!(e!=null&&e.length))return-1;const n=(u,f)=>f?u.width!==f.width||u.height!==f.height:!0;let r=e.length-1;const o=Math.max(t,i);for(let u=0;u<e.length;u+=1){const f=e[u];if((f.width>=o||f.height>=o)&&n(f,e[u+1])){r=u;break}}return r}}const a_={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Mi=a_,o_={HLS:"h"},l_=o_;class Yn{constructor(e,t){Array.isArray(e)&&(e=e.map(i=>i instanceof Yn?i:new Yn(i))),this.value=e,this.params=t}}const u_="Dict";function c_(l){return Array.isArray(l)?JSON.stringify(l):l instanceof Map?"Map{}":l instanceof Set?"Set{}":typeof l=="object"?JSON.stringify(l):String(l)}function f_(l,e,t,i){return new Error(`failed to ${l} "${c_(e)}" as ${t}`,{cause:i})}function zn(l,e,t){return f_("serialize",l,e,t)}class CT{constructor(e){this.description=e}}const yy="Bare Item",h_="Boolean";function d_(l){if(typeof l!="boolean")throw zn(l,h_);return l?"?1":"?0"}function g_(l){return btoa(String.fromCharCode(...l))}const m_="Byte Sequence";function p_(l){if(ArrayBuffer.isView(l)===!1)throw zn(l,m_);return`:${g_(l)}:`}const A_="Integer";function v_(l){return l<-999999999999999||999999999999999<l}function RT(l){if(v_(l))throw zn(l,A_);return l.toString()}function y_(l){return`@${RT(l.getTime()/1e3)}`}function LT(l,e){if(l<0)return-LT(-l,e);const t=Math.pow(10,e);if(Math.abs(l*t%1-.5)<Number.EPSILON){const n=Math.floor(l*t);return(n%2===0?n:n+1)/t}else return Math.round(l*t)/t}const E_="Decimal";function T_(l){const e=LT(l,3);if(Math.floor(Math.abs(e)).toString().length>12)throw zn(l,E_);const t=e.toString();return t.includes(".")?t:`${t}.0`}const S_="String",b_=/[\x00-\x1f\x7f]+/;function x_(l){if(b_.test(l))throw zn(l,S_);return`"${l.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function C_(l){return l.description||l.toString().slice(7,-1)}const R_="Token";function Ey(l){const e=C_(l);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw zn(e,R_);return e}function Jd(l){switch(typeof l){case"number":if(!xe(l))throw zn(l,yy);return Number.isInteger(l)?RT(l):T_(l);case"string":return x_(l);case"symbol":return Ey(l);case"boolean":return d_(l);case"object":if(l instanceof Date)return y_(l);if(l instanceof Uint8Array)return p_(l);if(l instanceof CT)return Ey(l);default:throw zn(l,yy)}}const L_="Key";function Xd(l){if(/^[a-z*][a-z0-9\-_.*]*$/.test(l)===!1)throw zn(l,L_);return l}function Bg(l){return l==null?"":Object.entries(l).map(([e,t])=>t===!0?`;${Xd(e)}`:`;${Xd(e)}=${Jd(t)}`).join("")}function DT(l){return l instanceof Yn?`${Jd(l.value)}${Bg(l.params)}`:Jd(l)}function D_(l){return`(${l.value.map(DT).join(" ")})${Bg(l.params)}`}function __(l,e={whitespace:!0}){if(typeof l!="object"||l==null)throw zn(l,u_);const t=l instanceof Map?l.entries():Object.entries(l),i=e?.whitespace?" ":"";return Array.from(t).map(([n,r])=>{r instanceof Yn||(r=new Yn(r));let o=Xd(n);return r.value===!0?o+=Bg(r.params):(o+="=",Array.isArray(r.value)?o+=D_(r):o+=DT(r)),o}).join(`,${i}`)}function _T(l,e){return __(l,e)}const Gn="CMCD-Object",Yt="CMCD-Request",Gr="CMCD-Session",or="CMCD-Status",I_={br:Gn,ab:Gn,d:Gn,ot:Gn,tb:Gn,tpb:Gn,lb:Gn,tab:Gn,lab:Gn,url:Gn,pb:Yt,bl:Yt,tbl:Yt,dl:Yt,ltc:Yt,mtp:Yt,nor:Yt,nrr:Yt,rc:Yt,sn:Yt,sta:Yt,su:Yt,ttfb:Yt,ttfbb:Yt,ttlb:Yt,cmsdd:Yt,cmsds:Yt,smrt:Yt,df:Yt,cs:Yt,ts:Yt,cid:Gr,pr:Gr,sf:Gr,sid:Gr,st:Gr,v:Gr,msd:Gr,bs:or,bsd:or,cdn:or,rtp:or,bg:or,pt:or,ec:or,e:or},B_={REQUEST:Yt};function M_(l){return Object.keys(l).reduce((e,t)=>{var i;return(i=l[t])===null||i===void 0||i.forEach(n=>e[n]=t),e},{})}function O_(l,e){const t={};if(!l)return t;const i=Object.keys(l),n=e?M_(e):{};return i.reduce((r,o)=>{var u;const f=I_[o]||n[o]||B_.REQUEST,h=(u=r[f])!==null&&u!==void 0?u:r[f]={};return h[o]=l[o],r},t)}function F_(l){return["ot","sf","st","e","sta"].includes(l)}function k_(l){return typeof l=="number"?xe(l):l!=null&&l!==""&&l!==!1}const IT="event";function w_(l,e){const t=new URL(l),i=new URL(e);if(t.origin!==i.origin)return l;const n=t.pathname.split("/").slice(1),r=i.pathname.split("/").slice(1,-1);for(;n[0]===r[0];)n.shift(),r.shift();for(;r.length;)r.shift(),n.unshift("..");return n.join("/")+t.search+t.hash}const gc=l=>Math.round(l),Qd=(l,e)=>Array.isArray(l)?l.map(t=>Qd(t,e)):l instanceof Yn&&typeof l.value=="string"?new Yn(Qd(l.value,e),l.params):(e.baseUrl&&(l=w_(l,e.baseUrl)),e.version===1?encodeURIComponent(l):l),Zu=l=>gc(l/100)*100,U_=(l,e)=>{let t=l;return e.version>=2&&(l instanceof Yn&&typeof l.value=="string"?t=new Yn([l]):typeof l=="string"&&(t=[l])),Qd(t,e)},P_={br:gc,d:gc,bl:Zu,dl:Zu,mtp:Zu,nor:U_,rtp:Zu,tb:gc},BT="request",MT="response",Mg=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],N_=["e"],G_=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Hc(l){return G_.test(l)}function H_(l){return Mg.includes(l)||N_.includes(l)||Hc(l)}const OT=["d","dl","nor","ot","rtp","su"];function K_(l){return Mg.includes(l)||OT.includes(l)||Hc(l)}const V_=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function $_(l){return Mg.includes(l)||OT.includes(l)||V_.includes(l)||Hc(l)}const Y_=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function z_(l){return Y_.includes(l)||Hc(l)}const j_={[MT]:$_,[IT]:H_,[BT]:K_};function FT(l,e={}){const t={};if(l==null||typeof l!="object")return t;const i=e.version||l.v||1,n=e.reportingMode||BT,r=i===1?z_:j_[n];let o=Object.keys(l).filter(r);const u=e.filter;typeof u=="function"&&(o=o.filter(u));const f=n===MT||n===IT;f&&!o.includes("ts")&&o.push("ts"),i>1&&!o.includes("v")&&o.push("v");const h=xt({},P_,e.formatters),d={version:i,reportingMode:n,baseUrl:e.baseUrl};return o.sort().forEach(m=>{let p=l[m];const v=h[m];if(typeof v=="function"&&(p=v(p,d)),m==="v"){if(i===1)return;p=i}m=="pr"&&p===1||(f&&m==="ts"&&!xe(p)&&(p=Date.now()),k_(p)&&(F_(m)&&typeof p=="string"&&(p=new CT(p)),t[m]=p))}),t}function J_(l,e={}){const t={};if(!l)return t;const i=FT(l,e),n=O_(i,e?.customHeaderMap);return Object.entries(n).reduce((r,[o,u])=>{const f=_T(u,{whitespace:!1});return f&&(r[o]=f),r},t)}function X_(l,e,t){return xt(l,J_(e,t))}const Q_="CMCD";function q_(l,e={}){return l?_T(FT(l,e),{whitespace:!1}):""}function W_(l,e={}){if(!l)return"";const t=q_(l,e);return encodeURIComponent(t)}function Z_(l,e={}){if(!l)return"";const t=W_(l,e);return`${Q_}=${t}`}const Ty=/CMCD=[^&#]+/;function eI(l,e,t){const i=Z_(e,t);if(!i)return l;if(Ty.test(l))return l.replace(Ty,i);const n=l.includes("?")?"&":"?";return`${l}${n}${i}`}class kT{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=n=>{try{this.apply(n,{ot:Mi.MANIFEST,su:!this.initialized})}catch(r){this.hls.logger.warn("Could not generate manifest CMCD data.",r)}},this.applyFragmentData=n=>{try{const{frag:r,part:o}=n,u=this.hls.levels[r.level],f=this.getObjectType(r),h={d:(o||r).duration*1e3,ot:f};(f===Mi.VIDEO||f===Mi.AUDIO||f==Mi.MUXED)&&(h.br=u.bitrate/1e3,h.tb=this.getTopBandwidth(f)/1e3,h.bl=this.getBufferLength(f));const d=o?this.getNextPart(o):this.getNextFrag(r);d!=null&&d.url&&d.url!==r.url&&(h.nor=d.url),this.apply(n,h)}catch(r){this.hls.logger.warn("Could not generate segment CMCD data.",r)}},this.hls=e;const t=this.config=e.config,{cmcd:i}=t;i!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||e.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHED,this.onMediaDetached,this),e.on(R.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHED,this.onMediaDetached,this),e.off(R.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,n;this.audioBuffer=(i=t.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(n=t.tracks.video)==null?void 0:n.buffer}createData(){var e;return{v:1,sf:l_.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){xt(t,this.createData());const i=t.ot===Mi.INIT||t.ot===Mi.VIDEO||t.ot===Mi.MUXED;this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:n}=this;n&&(t=Object.keys(t).reduce((o,u)=>(n.includes(u)&&(o[u]=t[u]),o),{}));const r={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),X_(e.headers,t,r)):e.url=eI(e.url,t,r)}getNextFrag(e){var t;const i=(t=this.hls.levels[e.level])==null?void 0:t.details;if(i){const n=e.sn-i.startSN;return i.fragments[n+1]}}getNextPart(e){var t;const{index:i,fragment:n}=e,r=(t=this.hls.levels[n.level])==null||(t=t.details)==null?void 0:t.partList;if(r){const{sn:o}=n;for(let u=r.length-1;u>=0;u--){const f=r[u];if(f.index===i&&f.fragment.sn===o)return r[u+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Mi.TIMED_TEXT;if(e.sn==="initSegment")return Mi.INIT;if(t==="audio")return Mi.AUDIO;if(t==="main")return this.hls.audioTracks.length?Mi.VIDEO:Mi.MUXED}getTopBandwidth(e){let t=0,i;const n=this.hls;if(e===Mi.AUDIO)i=n.audioTracks;else{const r=n.maxAutoLevel,o=r>-1?r+1:n.levels.length;i=n.levels.slice(0,o)}return i.forEach(r=>{r.bitrate>t&&(t=r.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,i=e===Mi.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!t?NaN:je.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new i(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,o,u){t(r),this.loader.load(r,o,u)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new i(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,o,u){t(r),this.loader.load(r,o,u)}}}}const tI=3e5;class wT extends gn{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(i=>i!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:i}=t;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:i}=t;if(i?.action===ni.SendAlternateToPenaltyBox&&i.flags===Oi.MoveAllAlternatesMatchingHost){const n=this.levels;let r=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:u,pathwayId:f,type:h}=t.context;u&&n?o=this.getPathwayForGroupId(u,h,o):f&&(o=f)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!r&&n&&(r=this.pathways()),r&&r.length>1&&(this.updatePathwayPriority(r),i.resolved=this.pathwayId!==o),t.details===te.BUFFER_APPEND_ERROR&&!t.fatal?i.resolved=!0:i.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${n&&n.length} priorities: ${Lt(r)} penalized: ${Lt(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const i=this.penalizedPathways,n=performance.now();Object.keys(i).forEach(r=>{n-i[r]>tI&&delete i[r]});for(let r=0;r<e.length;r++){const o=e[r];if(o in i)continue;if(o===this.pathwayId)return;const u=this.hls.nextLoadLevel,f=this.hls.levels[u];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,qE(t),this.hls.trigger(R.LEVELS_UPDATED,{levels:t});const h=this.hls.levels[u];f&&h&&this.levels&&(h.attrs["STABLE-VARIANT-ID"]!==f.attrs["STABLE-VARIANT-ID"]&&h.bitrate!==f.bitrate&&this.log(`Unstable Pathways change from bitrate ${f.bitrate} to ${h.bitrate}`),this.hls.nextLoadLevel=u);break}}}getPathwayForGroupId(e,t,i){const n=this.getLevelsForPathway(i).concat(this.levels||[]);for(let r=0;r<n.length;r++)if(t===tt.AUDIO_TRACK&&n[r].hasAudioGroup(e)||t===tt.SUBTITLE_TRACK&&n[r].hasSubtitleGroup(e))return n[r].pathwayId;return i}clonePathways(e){const t=this.levels;if(!t)return;const i={},n={};e.forEach(r=>{const{ID:o,"BASE-ID":u,"URI-REPLACEMENT":f}=r;if(t.some(d=>d.pathwayId===o))return;const h=this.getLevelsForPathway(u).map(d=>{const m=new Pt(d.attrs);m["PATHWAY-ID"]=o;const p=m.AUDIO&&`${m.AUDIO}_clone_${o}`,v=m.SUBTITLES&&`${m.SUBTITLES}_clone_${o}`;p&&(i[m.AUDIO]=p,m.AUDIO=p),v&&(n[m.SUBTITLES]=v,m.SUBTITLES=v);const y=UT(d.uri,m["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",f),T=new io({attrs:m,audioCodec:d.audioCodec,bitrate:d.bitrate,height:d.height,name:d.name,url:y,videoCodec:d.videoCodec,width:d.width});if(d.audioGroups)for(let S=1;S<d.audioGroups.length;S++)T.addGroupId("audio",`${d.audioGroups[S]}_clone_${o}`);if(d.subtitleGroups)for(let S=1;S<d.subtitleGroups.length;S++)T.addGroupId("text",`${d.subtitleGroups[S]}_clone_${o}`);return T});t.push(...h),Sy(this.audioTracks,i,f,o),Sy(this.subtitleTracks,n,f,o)})}loadSteeringManifest(e){const t=this.hls.config,i=t.loader;this.loader&&this.loader.destroy(),this.loader=new i(t);let n;try{n=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(n.protocol!=="data:"){const d=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;n.searchParams.set("_HLS_pathway",this.pathwayId),n.searchParams.set("_HLS_throughput",""+d)}const r={responseType:"json",url:n.href},o=t.steeringManifestLoadPolicy.default,u=o.errorRetry||o.timeoutRetry||{},f={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:u.maxNumRetry||0,retryDelay:u.retryDelayMs||0,maxRetryDelay:u.maxRetryDelayMs||0},h={onSuccess:(d,m,p,v)=>{this.log(`Loaded steering manifest: "${n}"`);const y=d.data;if(y?.VERSION!==1){this.log(`Steering VERSION ${y.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=y.TTL;const{"RELOAD-URI":T,"PATHWAY-CLONES":S,"PATHWAY-PRIORITY":b}=y;if(T)try{this.uri=new self.URL(T,n).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${T}`);return}this.scheduleRefresh(this.uri||p.url),S&&this.clonePathways(S);const C={steeringManifest:y,url:n.toString()};this.hls.trigger(R.STEERING_MANIFEST_LOADED,C),b&&this.updatePathwayPriority(b)},onError:(d,m,p,v)=>{if(this.log(`Error loading steering manifest: ${d.code} ${d.text} (${m.url})`),this.stopLoad(),d.code===410){this.enabled=!1,this.log(`Steering manifest ${m.url} no longer available`);return}let y=this.timeToLoad*1e3;if(d.code===429){const T=this.loader;if(typeof T?.getResponseHeader=="function"){const S=T.getResponseHeader("Retry-After");S&&(y=parseFloat(S)*1e3)}this.log(`Steering manifest ${m.url} rate limited`);return}this.scheduleRefresh(this.uri||m.url,y)},onTimeout:(d,m,p)=>{this.log(`Timeout loading steering manifest (${m.url})`),this.scheduleRefresh(this.uri||m.url)}};this.log(`Requesting steering manifest: ${n}`),this.loader.load(r,f,h)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;const n=(i=this.hls)==null?void 0:i.media;if(n&&!n.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Sy(l,e,t,i){l&&Object.keys(e).forEach(n=>{const r=l.filter(o=>o.groupId===n).map(o=>{const u=xt({},o);return u.details=void 0,u.attrs=new Pt(u.attrs),u.url=u.attrs.URI=UT(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),u.groupId=u.attrs["GROUP-ID"]=e[n],u.attrs["PATHWAY-ID"]=i,u});l.push(...r)})}function UT(l,e,t,i){const{HOST:n,PARAMS:r,[t]:o}=i;let u;e&&(u=o?.[e],u&&(l=u));const f=new self.URL(l);return n&&!u&&(f.host=n),r&&Object.keys(r).sort().forEach(h=>{h&&f.searchParams.set(h,r[h])}),f.href}class zr extends gn{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=zr.CDMCleanupPromise?[zr.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:i,initData:n}=t,r=`"${t.type}" event: init data type: "${i}"`;if(this.debug(r),n!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=ll(this.config));const u=o.map(id).filter(f=>!!f);this.keyFormatPromise=this.getKeyFormatPromise(u)}this.keyFormatPromise.then(o=>{const u=fc(o);if(i!=="sinf"||u!==Nt.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${i}" for selected key-system ${u}`);return}let f;try{const v=ii(new Uint8Array(n)),y=Sg(JSON.parse(v).sinf),T=CE(y);if(!T)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");f=new Uint8Array(T.subarray(8,24))}catch(v){this.warn(`${r} Failed to parse sinf: ${v}`);return}const h=xi(f),{keyIdToKeySessionPromise:d,mediaKeySessions:m}=this;let p=d[h];for(let v=0;v<m.length;v++){const y=m[v],T=y.decryptdata;if(!T.keyId)continue;const S=xi(T.keyId);if(Rc(f,T.keyId)||T.uri.replace(/-/g,"").indexOf(h)!==-1){if(p=d[S],!p)continue;if(T.pssh)break;delete d[S],T.pssh=new Uint8Array(n),T.keyId=f,p=d[h]=p.then(()=>this.generateRequestWithPreferredKeySession(y,i,n,"encrypted-event-key-match")),p.catch(b=>this.handleError(b));break}}p||this.handleError(new Error(`Key ID ${h} not encountered in playlist. Key-system sessions ${m.length}.`))}).catch(o=>this.handleError(o))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(R.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(R.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(R.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(R.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(R.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(R.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(R.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(R.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:i}=this.config,n=t?.[e];if(n)return n.licenseUrl;if(e===Nt.WIDEVINE&&i)return i}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,i=t?.[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,i=(o,u,f)=>!!o&&f.indexOf(o)===u,n=t.map(o=>o.audioCodec).filter(i),r=t.map(o=>o.videoCodec).filter(i);return n.length+r.length===0&&r.push("avc1.42e01e"),new Promise((o,u)=>{const f=h=>{const d=h.shift();this.getMediaKeysPromise(d,n,r).then(m=>o({keySystem:d,mediaKeys:m})).catch(m=>{h.length?f(h):m instanceof ji?u(m):u(new ji({type:ke.KEY_SYSTEM_ERROR,details:te.KEY_SYSTEM_NO_ACCESS,error:m,fatal:!0},m.message))})};f(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let n=`Configured requestMediaKeySystemAccess is not a function ${i}`;return bg===null&&self.location.protocol==="http:"&&(n=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(n))}return i(e,t)}getMediaKeysPromise(e,t,i){var n;const r=GL(e,t,i,this.config.drmSystemOptions||{});let o=this.keySystemAccessPromises[e],u=(n=o)==null?void 0:n.keySystemAccess;if(!u){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Lt(r)}`),u=this.requestMediaKeySystemAccess(e,r);const f=o=this.keySystemAccessPromises[e]={keySystemAccess:u};return u.catch(h=>{this.log(`Failed to obtain access to key-system "${e}": ${h}`)}),u.then(h=>{this.log(`Access for key-system "${h.keySystem}" obtained`);const d=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const m=f.mediaKeys=h.createMediaKeys().then(p=>(this.log(`Media-keys created for "${e}"`),f.hasMediaKeys=!0,d.then(v=>v?this.setMediaKeysServerCertificate(p,e,v):p)));return m.catch(p=>{this.error(`Failed to create media-keys for "${e}"}: ${p}`)}),m})}return u.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:i}){this.log(`Creating key-system session "${t}" keyId: ${xi(e.keyId||[])} keyUri: ${e.uri}`);const n=i.createSession(),r={decryptdata:e,keySystem:t,mediaKeys:i,mediaKeysSession:n,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const i=this.createMediaKeySessionContext(e),n=ec(t),r="cenc";this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(i,r,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyId ${xi(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),i.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>id(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:i})=>this.attemptSetMediaKeys(t,i))}selectKeySystem(e){return new Promise((t,i)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:n})=>{const r=id(n);r?t(r):i(new Error(`Unable to find format for key-system "${n}"`))}).catch(i)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=ll(this.config),i=e.map(fc).filter(n=>!!n&&t.indexOf(n)!==-1);return this.selectKeySystem(i)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let i=0;i<t.length;i++){const n=iI(e,t[i]);if(n)return n}}loadKey(e){const t=e.keyInfo.decryptdata,i=ec(t),n=this.bannedKeyIds[i];if(n||this.getKeyStatus(t)==="internal-error"){const u=by(n||"internal-error",t);return this.handleError(u,e.frag),Promise.reject(u)}const r=`(keyId: ${i} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${r}`);const o=this.keyIdToKeySessionPromise[i];if(!o){const u=this.getKeySystemForKeyPromise(t).then(({keySystem:f,mediaKeys:h})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${r}`),this.attemptSetMediaKeys(f,h).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:f,mediaKeys:h,decryptdata:t}))))).then(f=>{const h="cenc",d=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(f,h,d,"playlist-key")});return u.catch(f=>this.handleError(f,e.frag)),this.keyIdToKeySessionPromise[i]=u,u}return o.catch(u=>{if(u instanceof ji){const f=At({},u.data);this.getKeyStatus(t)==="internal-error"&&(f.decryptdata=t);const h=new ji(f,u.message);this.handleError(h,e.frag)}}),o}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof ji){t&&(e.data.frag=t);const i=e.data.decryptdata;this.error(`${e.message}${i?` (${xi(i.keyId||[])})`:""}`),this.hls.trigger(R.ERROR,e.data)}else this.error(e.message),this.hls.trigger(R.ERROR,{type:ke.KEY_SYSTEM_ERROR,details:te.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=ec(e),i=this.keyIdToKeySessionPromise[t];if(!i){const n=fc(e.keyFormat),r=n?[n]:ll(this.config);return this.attemptKeySystemAccess(r)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=ll(this.config)),e.length===0)throw new ji({type:ke.KEY_SYSTEM_ERROR,details:te.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Lt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const n=Promise.all(i).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(n),n.then(()=>{this.log(`Media-keys set for "${e}"`),i.push(n),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(r=>i.indexOf(r)===-1)})}generateRequestWithPreferredKeySession(e,t,i,n){var r;const o=(r=this.config.drmSystems)==null||(r=r[e.keySystem])==null?void 0:r.generateRequest;if(o)try{const y=o.call(this.hls,t,i,e);if(!y)throw new Error("Invalid response from configured generateRequest filter");t=y.initDataType,i=y.initData?y.initData:null,e.decryptdata.pssh=i?new Uint8Array(i):null}catch(y){if(this.warn(y.message),this.hls&&this.hls.config.debug)throw y}if(i===null)return this.log(`Skipping key-session request for "${n}" (no initData)`),Promise.resolve(e);const u=ec(e.decryptdata),f=e.decryptdata.uri;this.log(`Generating key-session request for "${n}" keyId: ${u} URI: ${f} (init data type: ${t} length: ${i.byteLength})`);const h=new xg,d=e._onmessage=y=>{const T=e.mediaKeysSession;if(!T){h.emit("error",new Error("invalid state"));return}const{messageType:S,message:b}=y;this.log(`"${S}" message event for session "${T.sessionId}" message size: ${b.byteLength}`),S==="license-request"||S==="license-renewal"?this.renewLicense(e,b).catch(C=>{h.eventNames().length?h.emit("error",C):this.handleError(C)}):S==="license-release"?e.keySystem===Nt.FAIRPLAY&&this.updateKeySession(e,Kd("acknowledged")).then(()=>this.removeSession(e)).catch(C=>this.handleError(C)):this.warn(`unhandled media key message type "${S}"`)},m=(y,T)=>{T.keyStatus=y;let S;y.startsWith("usable")?h.emit("resolved"):y==="internal-error"||y==="output-restricted"||y==="output-downscaled"?S=by(y,T.decryptdata):y==="expired"?S=new Error(`key expired (keyId: ${u})`):y==="released"?S=new Error("key released"):y==="status-pending"||this.warn(`unhandled key status change "${y}" (keyId: ${u})`),S&&(h.eventNames().length?h.emit("error",S):this.handleError(S))},p=e._onkeystatuseschange=y=>{if(!e.mediaKeysSession){h.emit("error",new Error("invalid state"));return}const S=this.getKeyStatuses(e);if(!Object.keys(S).some(D=>S[D]!=="status-pending"))return;if(S[u]==="expired"){this.log(`Expired key ${Lt(S)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let C=S[u];if(C)m(C,e);else{var L;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(L=e.keyStatusTimeouts)[u]||(L[u]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const _=this.getKeyStatus(e.decryptdata);if(_&&_!=="status-pending")return this.log(`No status for keyId ${u} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${_} from other session.`),m(_,e);this.log(`key status for ${u} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),C="internal-error",m(C,e)},1e3)),this.log(`No status for keyId ${u} (${Lt(S)}).`)}};Ci(e.mediaKeysSession,"message",d),Ci(e.mediaKeysSession,"keystatuseschange",p);const v=new Promise((y,T)=>{h.on("error",T),h.on("resolved",y)});return e.mediaKeysSession.generateRequest(t,i).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${u} URI: ${f}`)}).catch(y=>{throw new ji({type:ke.KEY_SYSTEM_ERROR,details:te.KEY_SYSTEM_NO_SESSION,error:y,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${y}`)}).then(()=>v).catch(y=>(h.removeAllListeners(),this.removeSession(e).then(()=>{throw y}))).then(()=>(h.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((i,n)=>{if(typeof n=="string"&&typeof i=="object"){const u=n;n=i,i=u}const r="buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n);e.keySystem===Nt.PLAYREADY&&r.length===16&&KE(r);const o=xi(r);i==="internal-error"&&(this.bannedKeyIds[o]=i),this.log(`key status change "${i}" for keyStatuses keyId: ${o} key-session "${e.mediaKeysSession.sessionId}"`),t[o]=i}),t}fetchServerCertificate(e){const t=this.config,i=t.loader,n=new i(t),r=this.getServerCertificateUrl(e);return r?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,u)=>{const f={responseType:"arraybuffer",url:r},h=t.certLoadPolicy.default,d={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(p,v,y,T)=>{o(p.data)},onError:(p,v,y,T)=>{u(new ji({type:ke.KEY_SYSTEM_ERROR,details:te.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:y,response:At({url:f.url,data:void 0},p)},`"${e}" certificate request failed (${r}). Status: ${p.code} (${p.text})`))},onTimeout:(p,v,y)=>{u(new ji({type:ke.KEY_SYSTEM_ERROR,details:te.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:y,response:{url:f.url,data:void 0}},`"${e}" certificate request timed out (${r})`))},onAbort:(p,v,y)=>{u(new Error("aborted"))}};n.load(f,d,m)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise((n,r)=>{e.setServerCertificate(i).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${i.byteLength}) on "${t}"`),n(e)}).catch(o=>{r(new ji({type:ke.KEY_SYSTEM_ERROR,details:te.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(i=>this.updateKeySession(e,new Uint8Array(i)).catch(n=>{throw new ji({type:ke.KEY_SYSTEM_ERROR,details:te.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:n,fatal:!1},n.message)}))}unpackPlayReadyKeyMessage(e,t){const i=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const n=new DOMParser().parseFromString(i,"application/xml"),r=n.querySelectorAll("HttpHeader");if(r.length>0){let d;for(let m=0,p=r.length;m<p;m++){var o,u;d=r[m];const v=(o=d.querySelector("name"))==null?void 0:o.textContent,y=(u=d.querySelector("value"))==null?void 0:u.textContent;v&&y&&e.setRequestHeader(v,y)}}const f=n.querySelector("Challenge"),h=f?.textContent;if(!h)throw new Error("Cannot find <Challenge> in key message");return Kd(atob(h))}setupLicenseXHR(e,t,i,n){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,i,n)}).catch(o=>{if(!i.decryptdata)throw o;return e.open("POST",t,!0),r.call(this.hls,e,t,i,n)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||n})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:n}))}requestLicense(e,t){const i=this.config.keyLoadPolicy.default;return new Promise((n,r)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const u=new XMLHttpRequest;u.responseType="arraybuffer",u.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(u.readyState===4)if(u.status===200){this._requestLicenseFailureCount=0;let f=u.response;this.log(`License received ${f instanceof ArrayBuffer?f.byteLength:f}`);const h=this.config.licenseResponseCallback;if(h)try{f=h.call(this.hls,u,o,e)}catch(d){this.error(d)}n(f)}else{const f=i.errorRetry,h=f?f.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>h||u.status>=400&&u.status<500)r(new ji({type:ke.KEY_SYSTEM_ERROR,details:te.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:u,response:{url:o,data:void 0,code:u.status,text:u.statusText}},`License Request XHR failed (${o}). Status: ${u.status} (${u.statusText})`));else{const d=h-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${d} attempts left`),this.requestLicense(e,t).then(n,r)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=u,this.setupLicenseXHR(u,o,e,t).then(({xhr:f,licenseChallenge:h})=>{e.keySystem==Nt.PLAYREADY&&(h=this.unpackPlayReadyKeyMessage(f,h)),f.send(h)}).catch(r)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const i=t.media;this.media=i,Ci(i,"encrypted",this.onMediaEncrypted),Ci(i,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(ki(e,"encrypted",this.onMediaEncrypted),ki(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const t=this.media,i=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,cr.clearKeyUriToKeyIdMap();const n=i.length;zr.CDMCleanupPromise=Promise.all(i.map(r=>this.removeSession(r)).concat((t==null||(e=t.setMediaKeys(null))==null?void 0:e.catch(r=>{this.log(`Could not clear media keys: ${r}`),this.hls&&this.hls.trigger(R.ERROR,{type:ke.OTHER_ERROR,details:te.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${r}`)})}))||Promise.resolve())).catch(r=>{this.log(`Could not close sessions and clear media keys: ${r}`),this.hls&&this.hls.trigger(R.ERROR,{type:ke.OTHER_ERROR,details:te.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${r}`)})}).then(()=>{n&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null,this.bannedKeyIds={}}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=t.reduce((n,r)=>(n.indexOf(r.keyFormat)===-1&&n.push(r.keyFormat),n),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:i,decryptdata:n}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${xi(n?.keyId||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);r>-1&&this.mediaKeySessions.splice(r,1);const{keyStatusTimeouts:o}=e;o&&Object.keys(o).forEach(h=>self.clearTimeout(o[h]));const{drmSystemOptions:u}=this.config;return(KL(u)?new Promise((h,d)=>{self.setTimeout(()=>d(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(h).catch(d)}):Promise.resolve()).catch(h=>{this.log(`Could not remove session: ${h}`),this.hls&&this.hls.trigger(R.ERROR,{type:ke.OTHER_ERROR,details:te.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${h}`)})}).then(()=>t.close()).catch(h=>{this.log(`Could not close session: ${h}`),this.hls&&this.hls.trigger(R.ERROR,{type:ke.OTHER_ERROR,details:te.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${h}`)})})}return Promise.resolve()}}zr.CDMCleanupPromise=void 0;function ec(l){if(!l)throw new Error("Could not read keyId of undefined decryptdata");if(l.keyId===null)throw new Error("keyId is null");return xi(l.keyId)}function iI(l,e){if(l.keyId&&e.mediaKeysSession.keyStatuses.has(l.keyId))return e.mediaKeysSession.keyStatuses.get(l.keyId);if(l.matches(e.decryptdata))return e.keyStatus}class ji extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function by(l,e){const t=l==="output-restricted",i=t?te.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:te.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new ji({type:ke.KEY_SYSTEM_ERROR,details:i,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${l}"`)}class PT{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(R.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(R.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(R.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(R.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const i=this.hls.config;if(i.capLevelOnFPSDrop){const n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,i){const n=performance.now();if(t){if(this.lastTime){const r=n-this.lastTime,o=i-this.lastDroppedFrames,u=t-this.lastDecodedFrames,f=1e3*o/r,h=this.hls;if(h.trigger(R.FPS_DROP,{currentDropped:o,currentDecoded:u,totalDroppedFrames:i}),f>0&&o>h.config.fpsDroppedMonitoringThreshold*u){let d=h.currentLevel;h.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(h.autoLevelCapping===-1||h.autoLevelCapping>=d)&&(d=d-1,h.trigger(R.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:h.currentLevel}),h.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function NT(l,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=l,e.dispatchEvent(t)}function GT(l,e){const t=l.mode;if(t==="disabled"&&(l.mode="hidden"),l.cues&&!l.cues.getCueById(e.id))try{if(l.addCue(e),!l.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(i){vt.debug(`[texttrack-utils]: ${i}`);try{const n=new self.TextTrackCue(e.startTime,e.endTime,e.text);n.id=e.id,l.addCue(n)}catch(n){vt.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${n}`)}}t==="disabled"&&(l.mode=t)}function ja(l,e){const t=l.mode;if(t==="disabled"&&(l.mode="hidden"),l.cues)for(let i=l.cues.length;i--;)e&&l.cues[i].removeEventListener("enter",e),l.removeCue(l.cues[i]);t==="disabled"&&(l.mode=t)}function qd(l,e,t,i){const n=l.mode;if(n==="disabled"&&(l.mode="hidden"),l.cues&&l.cues.length>0){const r=sI(l.cues,e,t);for(let o=0;o<r.length;o++)(!i||i(r[o]))&&l.removeCue(r[o])}n==="disabled"&&(l.mode=n)}function nI(l,e){if(e<=l[0].startTime)return 0;const t=l.length-1;if(e>l[t].endTime)return-1;let i=0,n=t,r;for(;i<=n;)if(r=Math.floor((n+i)/2),e<l[r].startTime)n=r-1;else if(e>l[r].startTime&&i<t)i=r+1;else return r;return l[i].startTime-e<e-l[n].startTime?i:n}function sI(l,e,t){const i=[],n=nI(l,e);if(n>-1)for(let r=n,o=l.length;r<o;r++){const u=l[r];if(u.startTime>=e&&u.endTime<=t)i.push(u);else if(u.startTime>t)return i}return i}function mc(l){const e=[];for(let t=0;t<l.length;t++){const i=l[t];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&e.push(l[t])}return e}class HT extends Nc{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const i=mc(this.media.textTracks);for(let r=0;r<i.length;r++)if(i[r].mode==="hidden")t=i[r];else if(i[r].mode==="showing"){t=i[r];break}const n=this.findTrackForTextTrack(t);this.subtitleTrack!==n&&this.setSubtitleTrack(n)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.LEVEL_LOADING,this.onLevelLoading,this),e.on(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(R.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(R.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.LEVEL_LOADING,this.onLevelLoading,this),e.off(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(R.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(R.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const i=this.media;if(!i)return;const n=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,n)return;mc(i.textTracks).forEach(o=>{ja(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:i,groupId:n,details:r}=t,o=this.tracksInGroup[i];if(!o||o.groupId!==n){this.warn(`Subtitle track with id:${i} and group:${n} not found in active group ${o?.groupId}`);return}const u=o.details;o.details=t.details,this.log(`Subtitle track ${i} "${o.name}" lang:${o.lang} group:${n} loaded [${r.startSN}-${r.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.subtitleGroups||null,n=this.groupIds;let r=this.currentTrack;if(!i||n?.length!==i?.length||i!=null&&i.some(o=>n?.indexOf(o)===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(d=>!i||i.indexOf(d.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(d=>d.default)&&(this.selectDefaultTrack=!1),o.forEach((d,m)=>{d.id=m});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const u=this.hls.config.subtitlePreference;if(!r&&u){this.selectDefaultTrack=!1;const d=Vn(u,o);if(d>-1)r=o[d];else{const m=Vn(u,this.tracks);r=this.tracks[m]}}let f=this.findTrackId(r);f===-1&&r&&(f=this.findTrackId(null));const h={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${i?.join(",")}" group-id`),this.hls.trigger(R.SUBTITLE_TRACKS_UPDATED,h),f!==-1&&this.trackId===-1&&this.setSubtitleTrack(f)}}findTrackId(e){const t=this.tracksInGroup,i=this.selectDefaultTrack;for(let n=0;n<t.length;n++){const r=t[n];if(!(i&&!r.default||!i&&!e)&&(!e||Yr(r,e)))return n}if(e){for(let n=0;n<t.length;n++){const r=t[n];if(Cl(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<t.length;n++){const r=t[n];if(Cl(e.attrs,r.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const n=t[i];if(jd(n,e))return i}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===tt.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const i=this.currentTrack;if(i&&Yr(e,i))return i;const n=Vn(e,this.tracksInGroup);if(n>-1){const r=this.tracksInGroup[n];return this.setSubtitleTrack(n),r}else{if(i)return null;{const r=Vn(e,t);if(r>-1)return t[r]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,n=e.groupId,r=this.getUrlWithDirectives(e.url,t),o=e.details,u=o?.age;this.log(`Loading subtitle ${i} "${e.name}" lang:${e.lang} group:${n}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&o.live?" age "+u.toFixed(1)+(o.type&&" "+o.type||""):""} ${r}`),this.hls.trigger(R.SUBTITLE_TRACK_LOADING,{url:r,id:i,groupId:n,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=mc(e.textTracks),i=this.currentTrack;let n;if(i&&(n=t.filter(r=>jd(i,r))[0],n||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(t).forEach(r=>{r.mode!=="disabled"&&r!==n&&(r.mode="disabled")}),n){const r=this.subtitleDisplay?"showing":"hidden";n.mode!==r&&(n.mode=r)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!xe(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,n=t[e]||null;if(this.trackId=e,this.currentTrack=n,this.toggleTrackModes(),!n){this.hls.trigger(R.SUBTITLE_TRACK_SWITCH,{id:e});return}const r=!!n.details&&!n.details.live;if(e===this.trackId&&n===i&&r)return;this.log(`Switching to subtitle-track ${e}`+(n?` "${n.name}" lang:${n.lang} group:${n.groupId}`:""));const{id:o,groupId:u="",name:f,type:h,url:d}=n;this.hls.trigger(R.SUBTITLE_TRACK_SWITCH,{id:o,groupId:u,name:f,type:h,url:d});const m=this.switchParams(n.url,i?.details,n.details);this.loadPlaylist(m)}}function rI(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const r=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(n=="x"?r:r&3|8).toString(16)})}}}function Al(l){let e=5381,t=l.length;for(;t;)e=e*33^l.charCodeAt(--t);return(e>>>0).toString()}const Wa=.025;let Ic=(function(l){return l[l.Point=0]="Point",l[l.Range=1]="Range",l})({});function aI(l,e,t){return`${l.identifier}-${t+1}-${Al(e)}`}class oI{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const i=this.playoutLimit;return e<=0||isNaN(i)?!1:i===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>i}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return fd(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,i=fd(t,e);return t-i<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=xe(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return fd(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Wa))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Ic.Range:Ic.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return lI(this)}}function fd(l,e){return l-e.start<e.duration/2&&!(Math.abs(l-(e.start+e.duration))<Wa)?e.start:e.start+e.duration}function KT(l,e,t){const i=new self.URL(l,t);return i.protocol!=="data:"&&i.searchParams.set("_HLS_primary_id",e),i}function hd(l,e){for(;(t=l.assetList[++e])!=null&&t.error;)var t;return e}function lI(l){return`["${l.identifier}" ${l.cue.pre?"<pre>":l.cue.post?"<post>":""}${l.timelineStart.toFixed(2)}-${l.resumeTime.toFixed(2)}]`}function Ya(l){const e=l.timelineStart,t=l.duration||0;return`["${l.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class uI{constructor(e,t,i,n){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(R.PLAYOUT_LIMIT_REACHED,{})};const r=this.hls=new e(t);this.interstitial=i,this.assetItem=n;const o=()=>{this.hasDetails=!0};r.once(R.LEVEL_LOADED,o),r.once(R.AUDIO_TRACK_LOADED,o),r.once(R.SUBTITLE_TRACK_LOADED,o),r.on(R.MEDIA_ATTACHING,(u,{media:f})=>{this.removeMediaListeners(),this.mediaAttached=f,this.interstitial.playoutLimit&&(f.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&r.on(R.BUFFER_APPENDED,()=>{const d=this.bufferedEnd;this.reachedPlayout(d)&&(this._bufferedEosTime=d,r.trigger(R.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=KT(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const i=Math.min(this._bufferedEosTime||1/0,this.duration),n=this.timelineOffset,r=je.bufferInfo(e,n,0);return this.getAssetTime(r.end)>=i-.02}reachedPlayout(e){const i=this.interstitial.playoutLimit;return this.startOffset+e>=i}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=je.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const i=t-this.startOffset;if(i>0&&i<e)return i}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const i=e-t;if(Math.abs(i)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,i=this.duration;return Math.min(Math.max(0,e-t),i)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=i=>delete i.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,i){var n;(n=this.hls)==null||n.on(e,t)}once(e,t,i){var n;(n=this.hls)==null||n.once(e,t)}off(e,t,i){var n;(n=this.hls)==null||n.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Ya(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const xy=.033;class cI extends gn{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((i,n)=>e<=n.startOffset&&t>n.startOffset?(delete n.error,i+1):i,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);const n=this.items;if(n)for(n[i]||(t===void 0&&(t=e.start),i=this.findItemIndexAtTime(t));i>=0&&(r=n[i])!=null&&r.event;){var r;i--}return i}findItemIndexAtTime(e,t){const i=this.items;if(i)for(let n=0;n<i.length;n++){let r=i[n];if(t&&t!=="primary"&&(r=r[t]),e===r.start||e>r.start&&e<r.end)return n}return-1}findJumpRestrictedIndex(e,t){const i=this.items;if(i)for(let n=e;n<=t&&i[n];n++){const r=i[n].event;if(r!=null&&r.restrictions.jump&&!r.appendInPlace)return n}return-1}findEventIndex(e){const t=this.items;if(t)for(let n=t.length;n--;){var i;if(((i=t[n].event)==null?void 0:i.identifier)===e)return n}return-1}findAssetIndex(e,t){const i=e.assetList,n=i.length;if(n>1)for(let r=0;r<n;r++){const o=i[r];if(!o.error){const u=o.timelineStart;if(t===u||t>u&&(t<u+(o.duration||0)||r===n-1))return r}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const i=t.assetList,n=i[i.length-1];if(n)return n.identifier}return null}parseInterstitialDateRanges(e,t){const i=e.main.details,{dateRanges:n}=i,r=this.events,o=this.parseDateRanges(n,{url:i.url},t),u=Object.keys(n),f=r?r.filter(h=>!u.includes(h.identifier)):[];o.length&&o.sort((h,d)=>{const m=h.cue.pre,p=h.cue.post,v=d.cue.pre,y=d.cue.post;if(m&&!v)return-1;if(v&&!m||p&&!y)return 1;if(y&&!p)return-1;if(!m&&!v&&!p&&!y){const T=h.startTime,S=d.startTime;if(T!==S)return T-S}return h.dateRange.tagOrder-d.dateRange.tagOrder}),this.events=o,f.forEach(h=>{this.removeEvent(h)}),this.updateSchedule(e,f)}updateSchedule(e,t=[],i=!1){const n=this.events||[];if(n.length||t.length||this.length<2){const r=this.items,o=this.parseSchedule(n,e);(i||t.length||r?.length!==o.length||o.some((f,h)=>Math.abs(f.playout.start-r[h].playout.start)>.005||Math.abs(f.playout.end-r[h].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(t,r))}}parseDateRanges(e,t,i){const n=[],r=Object.keys(e);for(let o=0;o<r.length;o++){const u=r[o],f=e[u];if(f.isInterstitial){let h=this.eventMap[u];h?h.setDateRange(f):(h=new oI(f,t),this.eventMap[u]=h,i===!1&&(h.appendInPlace=i)),n.push(h)}}return n}parseSchedule(e,t){const i=[],n=t.main.details,r=n.live?1/0:n.edge;let o=0;if(e=e.filter(f=>!f.error&&!(f.cue.once&&f.hasPlayed)),e.length){this.resolveOffsets(e,t);let f=0,h=0;if(e.forEach((d,m)=>{const p=d.cue.pre,v=d.cue.post,y=e[m-1]||null,T=d.appendInPlace,S=v?r:d.startOffset,b=d.duration,C=d.timelineOccupancy===Ic.Range?b:0,L=d.resumptionOffset,D=y?.startTime===S,_=S+d.cumulativeDuration;let w=T?_+b:S+L;if(p||!v&&S<=0){const O=h;h+=C,d.timelineStart=_;const F=o;o+=b,i.push({event:d,start:_,end:w,playout:{start:F,end:o},integrated:{start:O,end:h}})}else if(S<=r){if(!D){const M=S-f;if(M>xy){const H=f,P=h;h+=M;const z=o;o+=M;const Y={previousEvent:e[m-1]||null,nextEvent:d,start:H,end:H+M,playout:{start:z,end:o},integrated:{start:P,end:h}};i.push(Y)}else M>0&&y&&(y.cumulativeDuration+=M,i[i.length-1].end=S)}v&&(w=_),d.timelineStart=_;const O=h;h+=C;const F=o;o+=b,i.push({event:d,start:_,end:w,playout:{start:F,end:o},integrated:{start:O,end:h}})}else return;const I=d.resumeTime;v||I>r?f=r:f=I}),f<r){var u;const d=f,m=h,p=r-f;h+=p;const v=o;o+=p,i.push({previousEvent:((u=i[i.length-1])==null?void 0:u.event)||null,nextEvent:null,start:f,end:d+p,playout:{start:v,end:o},integrated:{start:m,end:h}})}this.setDurations(r,o,h)}else i.push({previousEvent:null,nextEvent:null,start:0,end:r,playout:{start:0,end:r},integrated:{start:0,end:r}}),this.setDurations(r,r,r);return i}setDurations(e,t,i){this.durations={primary:e,playout:t,integrated:i}}resolveOffsets(e,t){const i=t.main.details,n=i.live?1/0:i.edge;let r=0,o=-1;e.forEach((u,f)=>{const h=u.cue.pre,d=u.cue.post,m=h?0:d?n:u.startTime;this.updateAssetDurations(u),o===m?u.cumulativeDuration=r:(r=0,o=m),!d&&u.snapOptions.in&&(u.resumeAnchor=Jr(null,i.fragments,u.startOffset+u.resumptionOffset,0,0)||void 0),u.appendInPlace&&!u.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(u,t)||(u.appendInPlace=!1)),!u.appendInPlace&&f+1<e.length&&e[f+1].startTime-e[f].resumeTime<xy&&(e[f+1].appendInPlace=!1,e[f+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${u}`));const v=xe(u.resumeOffset)?u.resumeOffset:u.duration;r+=v})}primaryCanResumeInPlaceAt(e,t){const i=e.resumeTime,n=e.startTime+e.resumptionOffset;return Math.abs(i-n)>Wa?(this.log(`"${e.identifier}" resumption ${i} not aligned with estimated timeline end ${n}`),!1):!Object.keys(t).some(o=>{const u=t[o].details,f=u.edge;if(i>=f)return this.log(`"${e.identifier}" resumption ${i} past ${o} playlist end ${f}`),!1;const h=Jr(null,u.fragments,i);if(!h)return this.log(`"${e.identifier}" resumption ${i} does not align with any fragments in ${o} playlist (${u.fragStart}-${u.fragmentEnd})`),!0;const d=o==="audio"?.175:0;return Math.abs(h.start-i)<Wa+d||Math.abs(h.end-i)<Wa+d?!1:(this.log(`"${e.identifier}" resumption ${i} not aligned with ${o} fragment bounds (${h.start}-${h.end} sn: ${h.sn} cc: ${h.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let i=0,n=!1,r=!1;for(let o=0;o<e.assetList.length;o++){const u=e.assetList[o],f=t+i;u.startOffset=i,u.timelineStart=f,n||(n=u.duration===null),r||(r=!!u.error);const h=u.error?0:u.duration||0;i+=h}n&&!r?e.duration=Math.max(i,e.duration):e.duration=i}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function bn(l){return`[${l.event?'"'+l.event.identifier+'"':"primary"}: ${l.start.toFixed(2)}-${l.end.toFixed(2)}]`}class fI{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const i=e.assetListUrl;let n;try{n=KT(i,this.hls.sessionId,e.baseUrl)}catch(p){const v=this.assignAssetListError(e,te.ASSET_LIST_LOAD_ERROR,p,i);this.hls.trigger(R.ERROR,v);return}t&&n.protocol!=="data:"&&n.searchParams.set("_HLS_start_offset",""+t);const r=this.hls.config,o=r.loader,u=new o(r),f={responseType:"json",url:n.href},h=r.interstitialAssetListLoadPolicy.default,d={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(p,v,y,T)=>{const S=p.data,b=S?.ASSETS;if(!Array.isArray(b)){const C=this.assignAssetListError(e,te.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),y.url,v,T);this.hls.trigger(R.ERROR,C);return}e.assetListResponse=S,this.hls.trigger(R.ASSET_LIST_LOADED,{event:e,assetListResponse:S,networkDetails:T})},onError:(p,v,y,T)=>{const S=this.assignAssetListError(e,te.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${p.code} ${p.text} (${v.url})`),v.url,T,y);this.hls.trigger(R.ERROR,S)},onTimeout:(p,v,y)=>{const T=this.assignAssetListError(e,te.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${v.url})`),v.url,p,y);this.hls.trigger(R.ERROR,T)}};return u.load(f,d,m),this.hls.trigger(R.ASSET_LIST_LOADING,{event:e}),u}assignAssetListError(e,t,i,n,r,o){return e.error=i,{type:ke.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:n,error:i,networkDetails:o,stats:r}}}function Cy(l){l?.play().catch(()=>{})}function tc(l,e){return`[${l}] Advancing timeline position to ${e}`}class hI extends gn{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled||!this.schedule)return;const n=i-this.timelinePos;if(Math.abs(n)<1/7056e5)return;const o=n<=-.01;this.timelinePos=i,this.bufferedPos=i;const u=this.playingItem;if(!u){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(i,i-n)&&this.updateSchedule(!0),this.checkBuffer(),o&&i<u.start||i>=u.end){var f;const v=this.findItemIndex(u);let y=this.schedule.findItemIndexAtTime(i);if(y===-1&&(y=v+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${i} (resolving from ${v} to ${y})`)),!this.isInterstitial(u)&&(f=this.media)!=null&&f.paused&&(this.shouldPlay=!1),!o&&y>v){const T=this.schedule.findJumpRestrictedIndex(v+1,y);if(T>v){this.setSchedulePosition(T);return}}this.setSchedulePosition(y);return}const h=this.playingAsset;if(!h){if(this.playingLastItem&&this.isInterstitial(u)){const v=u.event.assetList[0];v&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,v))}return}const d=h.timelineStart,m=h.duration||0;if(o&&i<d||i>=d+m){var p;(p=u.event)!=null&&p.appendInPlace&&(this.clearInterstitial(u.event,u),this.flushFrontBuffer(i)),this.setScheduleToAssetAtTime(i,h)}},this.onTimeupdate=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;if(i>this.timelinePos)this.timelinePos=i,i>this.bufferedPos&&this.checkBuffer();else return;const n=this.playingItem;if(!n||this.playingLastItem)return;if(i>=n.end){this.timelinePos=n.end;const u=this.findItemIndex(n);this.setSchedulePosition(u+1)}const r=this.playingAsset;if(!r)return;const o=r.timelineStart+(r.duration||0);i>=o&&this.setScheduleToAssetAtTime(i,r)},this.onScheduleUpdate=(i,n)=>{const r=this.schedule;if(!r)return;const o=this.playingItem,u=r.events||[],f=r.items||[],h=r.durations,d=i.map(T=>T.identifier),m=!!(u.length||d.length);(m||n)&&this.log(`INTERSTITIALS_UPDATED (${u.length}): ${u}
Schedule: ${f.map(T=>bn(T))} pos: ${this.timelinePos}`),d.length&&this.log(`Removed events ${d}`);let p=null,v=null;o&&(p=this.updateItem(o,this.timelinePos),this.itemsMatch(o,p)?this.playingItem=p:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const y=this.bufferingItem;if(y&&(v=this.updateItem(y,this.bufferedPos),this.itemsMatch(y,v)?this.bufferingItem=v:y.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(y.event,null))),i.forEach(T=>{T.assetList.forEach(S=>{this.clearAssetPlayer(S.identifier,null)})}),this.playerQueue.forEach(T=>{if(T.interstitial.appendInPlace){const S=T.assetItem.timelineStart,b=T.timelineOffset-S;if(b)try{T.timelineOffset=S}catch(C){Math.abs(b)>Wa&&this.warn(`${C} ("${T.assetId}" ${T.timelineOffset}->${S})`)}}}),m||n){if(this.hls.trigger(R.INTERSTITIALS_UPDATED,{events:u.slice(0),schedule:f.slice(0),durations:h,removedIds:d}),this.isInterstitial(o)&&d.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(p,o),y&&v!==p&&this.trimInPlace(v,y),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new fI(e),this.schedule=new cI(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(R.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(R.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(R.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(R.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(R.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(R.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(R.BUFFER_APPENDED,this.onBufferAppended,this),e.on(R.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(R.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(R.MEDIA_ENDED,this.onMediaEnded,this),e.on(R.ERROR,this.onError,this),e.on(R.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(R.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(R.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(R.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(R.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(R.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(R.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(R.BUFFER_CODECS,this.onBufferCodecs,this),e.off(R.BUFFER_APPENDED,this.onBufferAppended,this),e.off(R.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(R.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(R.MEDIA_ENDED,this.onMediaEnded,this),e.off(R.ERROR,this.onError,this),e.off(R.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){ki(e,"play",this.onPlay),ki(e,"pause",this.onPause),ki(e,"seeking",this.onSeeking),ki(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const i=this.media=t.media;Ci(i,"seeking",this.onSeeking),Ci(i,"timeupdate",this.onTimeupdate),Ci(i,"play",this.onPlay),Ci(i,"pause",this.onPause)}onMediaAttached(e,t){const i=this.effectivePlayingItem,n=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!n){this.clearScheduleState();const r=this.findItemIndex(i);this.setSchedulePosition(r)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const i=!!t.transferMedia,n=this.media;if(this.media=null,!i&&(n&&this.removeMediaListeners(n),this.detachedData)){const r=this.getBufferingPlayer();r&&(this.log(`Removing schedule state for detachedData and ${r}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,r.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,i=m=>m&&e.getAssetPlayer(m.identifier),n=(m,p,v,y,T)=>{if(m){let S=m[p].start;const b=m.event;if(b){if(p==="playout"||b.timelineOccupancy!==Ic.Point){const C=i(v);C?.interstitial===b&&(S+=C.assetItem.startOffset+C[T])}}else{const C=y==="bufferedPos"?o():e[y];S+=C-m.start}return S}return 0},r=(m,p)=>{var v;if(m!==0&&p!=="primary"&&(v=e.schedule)!=null&&v.length){var y;const T=e.schedule.findItemIndexAtTime(m),S=(y=e.schedule.items)==null?void 0:y[T];if(S){const b=S[p].start-S.start;return m+b}}return m},o=()=>{const m=e.bufferedPos;return m===Number.MAX_VALUE?u("primary"):Math.max(m,0)},u=m=>{var p,v;return(p=e.primaryDetails)!=null&&p.live?e.primaryDetails.edge:((v=e.schedule)==null?void 0:v.durations[m])||0},f=(m,p)=>{var v,y;const T=e.effectivePlayingItem;if(T!=null&&(v=T.event)!=null&&v.restrictions.skip||!e.schedule)return;e.log(`seek to ${m} "${p}"`);const S=e.effectivePlayingItem,b=e.schedule.findItemIndexAtTime(m,p),C=(y=e.schedule.items)==null?void 0:y[b],L=e.getBufferingPlayer(),D=L?.interstitial,_=D?.appendInPlace,w=S&&e.itemsMatch(S,C);if(S&&(_||w)){const I=i(e.playingAsset),O=I?.media||e.primaryMedia;if(O){const F=p==="primary"?O.currentTime:n(S,p,e.playingAsset,"timelinePos","currentTime"),M=m-F,H=(_?F:O.currentTime)+M;if(H>=0&&(!I||_||H<=I.duration)){O.currentTime=H;return}}}if(C){let I=m;if(p!=="primary"){const F=C[p].start,M=m-F;I=C.start+M}const O=!e.isInterstitial(C);if((!e.isInterstitial(S)||S.event.appendInPlace)&&(O||C.event.appendInPlace)){const F=e.media||(_?L?.media:null);F&&(F.currentTime=I)}else if(S){const F=e.findItemIndex(S);if(b>F){const H=e.schedule.findJumpRestrictedIndex(F+1,b);if(H>F){e.setSchedulePosition(H);return}}let M=0;if(O)e.timelinePos=I,e.checkBuffer();else{const H=C.event.assetList,P=m-(C[p]||C).start;for(let z=H.length;z--;){const Y=H[z];if(Y.duration&&P>=Y.startOffset&&P<Y.startOffset+Y.duration){M=z;break}}}e.setSchedulePosition(b,M)}}},h=()=>{const m=e.effectivePlayingItem;if(e.isInterstitial(m))return m;const p=t();return e.isInterstitial(p)?p:null},d={get bufferedEnd(){const m=t(),p=e.bufferingItem;if(p&&p===m){var v;return n(p,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-p.playout.start||((v=e.bufferingAsset)==null?void 0:v.startOffset)||0}return 0},get currentTime(){const m=h(),p=e.effectivePlayingItem;return p&&p===m?n(p,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-p.playout.start:0},set currentTime(m){const p=h(),v=e.effectivePlayingItem;v&&v===p&&f(m+v.playout.start,"playout")},get duration(){const m=h();return m?m.playout.end-m.playout.start:0},get assetPlayers(){var m;const p=(m=h())==null?void 0:m.event.assetList;return p?p.map(v=>e.getAssetPlayer(v.identifier)):[]},get playingIndex(){var m;const p=(m=h())==null?void 0:m.event;return p&&e.effectivePlayingAsset?p.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return h()}};return this.manager={get events(){var m;return((m=e.schedule)==null||(m=m.events)==null?void 0:m.slice(0))||[]},get schedule(){var m;return((m=e.schedule)==null||(m=m.items)==null?void 0:m.slice(0))||[]},get interstitialPlayer(){return h()?d:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const m=t();return e.findItemIndex(m)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const m=e.effectivePlayingItem;return e.findItemIndex(m)},primary:{get bufferedEnd(){return o()},get currentTime(){const m=e.timelinePos;return m>0?m:0},set currentTime(m){f(m,"primary")},get duration(){return u("primary")},get seekableStart(){var m;return((m=e.primaryDetails)==null?void 0:m.fragmentStart)||0}},integrated:{get bufferedEnd(){return n(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return n(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(m){f(m,"integrated")},get duration(){return u("integrated")},get seekableStart(){var m;return r(((m=e.primaryDetails)==null?void 0:m.fragmentStart)||0,"integrated")}},skip:()=>{const m=e.effectivePlayingItem,p=m?.event;if(p&&!p.restrictions.skip){const v=e.findItemIndex(m);if(p.appendInPlace){const y=m.playout.start+m.event.duration;f(y+.001,"playout")}else e.advanceAfterAssetEnded(p,v,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,i=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!i?!1:this.findItemIndex(t)===i.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const i=this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&!i.event.appendInPlace)return;let n=this.media;!n&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(n=this.primaryMedia);const r=(t=n)==null?void 0:t.currentTime;if(!(r===void 0||!xe(r)))return r}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,t)}transferMediaFromPlayer(e,t){const i=e.interstitial.appendInPlace,n=e.media;if(i&&n===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&n){this.detachedData={media:n};return}const r=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Lt(r)}`),this.detachedData=r}else t&&n&&(this.shouldPlay||(this.shouldPlay=!n.paused))}transferMediaTo(e,t){var i,n;if(e.media===t)return;let r=null;const o=this.hls,u=e!==o,f=u&&e.interstitial.appendInPlace,h=(i=this.detachedData)==null?void 0:i.mediaSource;let d;if(o.media)f&&(r=o.transferMedia(),this.detachedData=r),d="Primary";else if(h){const y=this.getBufferingPlayer();y?(r=y.transferMedia(),d=`${y}`):d="detached MediaSource"}else d="detached media";if(!r){if(h)r=this.detachedData,this.log(`using detachedData: MediaSource ${Lt(r)}`);else if(!this.detachedData||o.media===t){const y=this.playerQueue;y.length>1&&y.forEach(T=>{if(u&&T.interstitial.appendInPlace!==f){const S=T.interstitial;this.clearInterstitial(T.interstitial,null),S.appendInPlace=!1,S.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${S}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const m=r&&"mediaSource"in r&&((n=r.mediaSource)==null?void 0:n.readyState)!=="closed",p=m&&r?r:t;this.log(`${m?"transfering MediaSource":"attaching media"} to ${u?e:"Primary"} from ${d} (media.currentTime: ${t.currentTime})`);const v=this.schedule;if(p===r&&v){const y=u&&e.assetId===v.assetIdAtEnd;p.overrides={duration:v.duration,endOfStream:!u||y,cueRemoval:!u}}e.attachMedia(p)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const i=this.timelinePos,n=this.effectivePlayingItem;if(i===-1){const r=this.hls.startPosition;if(this.log(tc("checkStart",r)),this.timelinePos=r,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(r>=0||!this.primaryLive){const o=this.timelinePos=r>0?r:0,u=e.findItemIndexAtTime(o);this.setSchedulePosition(u)}}else if(n&&!this.playingItem){const r=e.findItemIndex(n);this.setSchedulePosition(r)}}advanceAssetBuffering(e,t){const i=e.event,n=i.findAssetIndex(t),r=hd(i,n);if(!i.isAssetPastPlayoutLimit(r))this.bufferedToEvent(e,r);else if(this.schedule){var o;const u=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(e)+1];u&&this.bufferedToItem(u)}}advanceAfterAssetEnded(e,t,i){const n=hd(e,i);if(e.isAssetPastPlayoutLimit(n)){if(this.schedule){const r=this.schedule.items;if(r){const o=t+1,u=r.length;if(o>=u){this.setSchedulePosition(-1);return}const f=e.resumeTime;this.timelinePos<f&&(this.log(tc("advanceAfterAssetEnded",f)),this.timelinePos=f,e.appendInPlace&&this.advanceInPlace(f),this.checkBuffer(this.bufferedPos<f)),this.setSchedulePosition(o)}}}else{if(e.appendInPlace){const r=e.assetList[n];r&&this.advanceInPlace(r.timelineStart)}this.setSchedulePosition(t,n)}}setScheduleToAssetAtTime(e,t){const i=this.schedule;if(!i)return;const n=t.parentIdentifier,r=i.getEvent(n);if(r){const o=i.findEventIndex(n),u=i.findAssetIndex(r,e);this.advanceAfterAssetEnded(r,o,u-1)}}setSchedulePosition(e,t){var i;const n=(i=this.schedule)==null?void 0:i.items;if(!n||this.playbackDisabled)return;const r=e>=0?n[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${r&&bn(r)}) pos: ${this.timelinePos}`);const o=this.waitingItem||this.playingItem,u=this.playingLastItem;if(this.isInterstitial(o)){const d=o.event,m=this.playingAsset,p=m?.identifier,v=p?this.getAssetPlayer(p):null;if(v&&p&&(!this.eventItemsMatch(o,r)||t!==void 0&&p!==d.assetList[t].identifier)){var f;const y=d.findAssetIndex(m);if(this.log(`INTERSTITIAL_ASSET_ENDED ${y+1}/${d.assetList.length} ${Ya(m)}`),this.endedAsset=m,this.playingAsset=null,this.hls.trigger(R.INTERSTITIAL_ASSET_ENDED,{asset:m,assetListIndex:y,event:d,schedule:n.slice(0),scheduleIndex:e,player:v}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(d,this.findItemIndex(this.playingItem),y);return}this.retreiveMediaSource(p,r),v.media&&!((f=this.detachedData)!=null&&f.mediaSource)&&v.detachMedia()}if(!this.eventItemsMatch(o,r)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${d} ${bn(o)}`),d.hasPlayed=!0,this.hls.trigger(R.INTERSTITIAL_ENDED,{event:d,schedule:n.slice(0),scheduleIndex:e}),d.cue.once)){var h;this.updateSchedule();const y=(h=this.schedule)==null?void 0:h.items;if(r&&y){const T=this.findItemIndex(r);this.advanceSchedule(T,y,t,o,u)}return}}this.advanceSchedule(e,n,t,o,u)}advanceSchedule(e,t,i,n,r){const o=this.schedule;if(!o)return;const u=t[e]||null,f=this.primaryMedia,h=this.playerQueue;if(h.length&&h.forEach(d=>{const m=d.interstitial,p=o.findEventIndex(m.identifier);(p<e||p>e+1)&&this.clearInterstitial(m,u)}),this.isInterstitial(u)){this.timelinePos=Math.min(Math.max(this.timelinePos,u.start),u.end);const d=u.event;if(i===void 0){i=o.findAssetIndex(d,this.timelinePos);const y=hd(d,i-1);if(d.isAssetPastPlayoutLimit(y)||d.appendInPlace&&this.timelinePos===u.end){this.advanceAfterAssetEnded(d,e,i);return}i=y}const m=this.waitingItem;this.assetsBuffered(u,f)||this.setBufferingItem(u);let p=this.preloadAssets(d,i);if(this.eventItemsMatch(u,m||n)||(this.waitingItem=u,this.log(`INTERSTITIAL_STARTED ${bn(u)} ${d.appendInPlace?"append in place":""}`),this.hls.trigger(R.INTERSTITIAL_STARTED,{event:d,schedule:t.slice(0),scheduleIndex:e})),!d.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${d}`);return}if(d.assetListLoader&&(d.assetListLoader.destroy(),d.assetListLoader=void 0),!f){this.log(`Waiting for attachMedia to start Interstitial ${d}`);return}this.waitingItem=this.endedItem=null,this.playingItem=u;const v=d.assetList[i];if(!v){this.advanceAfterAssetEnded(d,e,i||0);return}if(p||(p=this.getAssetPlayer(v.identifier)),p===null||p.destroyed){const y=d.assetList.length;this.warn(`asset ${i+1}/${y} player destroyed ${d}`),p=this.createAssetPlayer(d,v,i),p.loadSource()}if(!this.eventItemsMatch(u,this.bufferingItem)&&d.appendInPlace&&this.isAssetBuffered(v))return;this.startAssetPlayer(p,i,t,e,f),this.shouldPlay&&Cy(p.media)}else u?(this.resumePrimary(u,e,n),this.shouldPlay&&Cy(this.hls.media)):r&&this.isInterstitial(n)&&(this.endedItem=null,this.playingItem=n,n.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,i){var n,r;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${bn(e)}`),!((n=this.detachedData)!=null&&n.mediaSource)){let u=this.timelinePos;(u<e.start||u>=e.end)&&(u=this.getPrimaryResumption(e,t),this.log(tc("resumePrimary",u)),this.timelinePos=u),this.attachPrimary(u,e)}if(!i)return;const o=(r=this.schedule)==null?void 0:r.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${bn(e)}`),this.hls.trigger(R.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const i=e.start;if(this.primaryLive){const n=this.primaryDetails;if(t===0)return this.hls.startPosition;if(n&&(i<n.fragmentStart||i>n.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:je.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,i){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const n=this.primaryMedia;if(!n)return;const r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,n),i&&this.startLoadingPrimaryAt(e,i)),i||(this.log(tc("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}startLoadingPrimaryAt(e,t){var i;const n=this.hls;!n.loadingEnabled||!n.media||Math.abs((((i=n.mainForwardBufferInfo)==null?void 0:i.start)||n.media.currentTime)-e)>.5?n.startLoad(e,t):n.bufferingEnabled||n.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(R.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(R.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const i=this.hls.levels[t.level];if(!i.details)return;const n=At(At({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=n,this.schedule.parseInterstitialDateRanges(n,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const i=this.hls.audioTracks[t.id],n=this.mediaSelection;if(!n){this.altSelection=At(At({},this.altSelection),{},{audio:i});return}const r=At(At({},n),{},{audio:i});this.mediaSelection=r}onSubtitleTrackUpdated(e,t){const i=this.hls.subtitleTracks[t.id],n=this.mediaSelection;if(!n){this.altSelection=At(At({},this.altSelection),{},{subtitles:i});return}const r=At(At({},n),{},{subtitles:i});this.mediaSelection=r}onAudioTrackSwitching(e,t){const i=Fv(t);this.playerQueue.forEach(({hls:n})=>n&&(n.setAudioOption(t)||n.setAudioOption(i)))}onSubtitleTrackSwitch(e,t){const i=Fv(t);this.playerQueue.forEach(({hls:n})=>n&&(n.setSubtitleOption(t)||t.id!==-1&&n.setSubtitleOption(i)))}onBufferCodecs(e,t){const i=t.tracks;i&&(this.requiredTracks=i)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){const n=this.timelinePos;this.bufferedPos=n,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let n=0;n<t.length;n++){const r=t[n];if(r.cue.post){var i;const o=this.schedule.findEventIndex(r.identifier),u=(i=this.schedule.items)==null?void 0:i[o];this.isInterstitial(u)&&this.eventItemsMatch(u,this.bufferingItem)&&this.bufferedToItem(u,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const i=this.findItemIndex(t);this.setSchedulePosition(i+1)}else this.shouldPlay=!1}updateItem(e,t){var i;const n=(i=this.schedule)==null?void 0:i.items;if(e&&n){const r=this.findItemIndex(e,t);return n[r]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((r,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(r.identifier,null)});const i=e.end+.25,n=je.bufferInfo(this.primaryMedia,i,0);(n.end>i||(n.nextStart||0)>i)&&(this.log(`trim buffered interstitial ${bn(e)} (was ${bn(t)})`),this.attachPrimary(i,null,!0),this.flushFrontBuffer(i))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var i;return!!t&&(e===t||e.event.identifier===((i=t.event)==null?void 0:i.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const i=this.mediaSelection;i&&((t=this.schedule)==null||t.updateSchedule(i,[],e))}checkBuffer(e){var t;const i=(t=this.schedule)==null?void 0:t.items;if(!i)return;const n=je.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=n.len<1),this.updateBufferedPos(n.end,i,e)}updateBufferedPos(e,t,i){const n=this.schedule,r=this.bufferingItem;if(this.bufferedPos>e||!n)return;if(t.length===1&&this.itemsMatch(t[0],r)){this.bufferedPos=e;return}const o=this.playingItem,u=this.findItemIndex(o);let f=n.findItemIndexAtTime(e);if(this.bufferedPos<e){var h;const d=this.findItemIndex(r),m=Math.min(d+1,t.length-1),p=t[m];if((f===-1&&r&&e>=r.end||(h=p.event)!=null&&h.appendInPlace&&e+.01>=p.start)&&(f=m),this.isInterstitial(r)){const v=r.event;if(m-u>1&&v.appendInPlace===!1||v.assetList.length===0&&v.assetListLoader)return}if(this.bufferedPos=e,f>d&&f>u)this.bufferedToItem(p);else{const v=this.primaryDetails;this.primaryLive&&v&&e>v.edge-v.targetduration&&p.start<v.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(p)&&this.preloadAssets(p.event,0)}}else i&&o&&!this.itemsMatch(o,r)&&(f===u?this.bufferedToItem(o):f===u+1&&this.bufferedToItem(t[f]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(n=>{const r=this.getAssetPlayer(n.identifier);return!(r!=null&&r.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,i=this.schedule;if(!this.itemsMatch(e,t)&&i){const{items:n,events:r}=i;if(!n||!r)return t;const o=this.isInterstitial(e),u=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const f=u?u.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${bn(e)}`+(t?` (${f.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const h=i.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((d,m)=>{const p=this.getAssetPlayer(d.identifier);p&&(m===h&&p.loadSource(),p.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(h=>h.pauseBuffering());this.hls.trigger(R.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:r.slice(0),schedule:n.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(i!==null){this.bufferingAsset=null;const n=this.detachedData;n?n.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),i=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(i)}bufferedToEvent(e,t){const i=e.event,n=i.assetList.length===0&&!i.assetListLoader,r=i.cue.once;if(n||!r){const o=this.preloadAssets(i,t);if(o!=null&&o.interstitial.appendInPlace){const u=this.primaryMedia;u&&this.bufferAssetPlayer(o,u)}}}preloadAssets(e,t){const i=e.assetUrl,n=e.assetList.length,r=n===0&&!e.assetListLoader,o=e.cue.once;if(r){const f=e.timelineStart;if(e.appendInPlace){var u;const p=this.playingItem;!this.isInterstitial(p)&&(p==null||(u=p.nextEvent)==null?void 0:u.identifier)===e.identifier&&this.flushFrontBuffer(f+.25)}let h,d=0;if(!this.playingItem&&this.primaryLive&&(d=this.hls.startPosition,d===-1&&(d=this.hls.liveSyncPosition||0)),d&&!(e.cue.pre||e.cue.post)){const p=d-f;p>0&&(h=Math.round(p*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${i?1:n} ${e}${h?` live-start: ${d} start-offset: ${h}`:""}`),i)return this.createAsset(e,0,0,f,e.duration,i);const m=this.assetListLoader.loadAssetList(e,h);m&&(e.assetListLoader=m)}else if(!o&&n){for(let h=t;h<n;h++){const d=e.assetList[h],m=this.getAssetPlayerQueueIndex(d.identifier);(m===-1||this.playerQueue[m].destroyed)&&!d.error&&this.createAssetPlayer(e,d,h)}const f=e.assetList[t];if(f){const h=this.getAssetPlayer(f.identifier);return h&&h.loadSource(),h}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(n=>{this.hls.trigger(R.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:n})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let i=0;i<t.length;i++)if(e===t[i].assetId)return i;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let i=0;i<e.length;i++)if(e[i].media===t)return e[i]}return null}createAsset(e,t,i,n,r,o){const u={parentIdentifier:e.identifier,identifier:aI(e,o,t),duration:r,startOffset:i,timelineStart:n,uri:o};return this.createAssetPlayer(e,u,t)}createAssetPlayer(e,t,i){const n=this.hls,r=n.userConfig;let o=r.videoPreference;const u=n.loadLevelObj||n.levels[n.currentLevel];(o||u)&&(o=xt({},o),u.videoCodec&&(o.videoCodec=u.videoCodec),u.videoRange&&(o.allowedVideoRanges=[u.videoRange]));const f=n.audioTracks[n.audioTrack],h=n.subtitleTracks[n.subtitleTrack];let d=0;if(this.primaryLive||e.appendInPlace){const D=this.timelinePos-t.timelineStart;if(D>1){const _=t.duration;_&&D<_&&(d=D)}}const m=t.identifier,p=At(At({},r),{},{maxMaxBufferLength:Math.min(180,n.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:n.sessionId,assetPlayerId:m,abrEwmaDefaultEstimate:n.bandwidthEstimate,interstitialsController:void 0,startPosition:d,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:f||r.audioPreference,subtitlePreference:h||r.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(p.timelineOffset=t.timelineStart));const v=p.cmcd;v!=null&&v.sessionId&&v.contentId&&(p.cmcd=xt({},v,{contentId:Al(t.uri)})),this.getAssetPlayer(m)&&this.warn(`Duplicate date range identifier ${e} and asset ${m}`);const y=new uI(this.HlsPlayerClass,p,e,t);this.playerQueue.push(y),e.assetList[i]=t;let T=!0;const S=D=>{if(D.live){var _;const O=new Error(`Interstitials MUST be VOD assets ${e}`),F={fatal:!0,type:ke.OTHER_ERROR,details:te.INTERSTITIAL_ASSET_ITEM_ERROR,error:O},M=((_=this.schedule)==null?void 0:_.findEventIndex(e.identifier))||-1;this.handleAssetItemError(F,e,M,i,O.message);return}const w=D.edge-D.fragmentStart,I=t.duration;(T||I===null||w>I)&&(T=!1,this.log(`Interstitial asset "${m}" duration change ${I} > ${w}`),t.duration=w,this.updateSchedule())};y.on(R.LEVEL_UPDATED,(D,{details:_})=>S(_)),y.on(R.LEVEL_PTS_UPDATED,(D,{details:_})=>S(_)),y.on(R.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const b=(D,_)=>{const w=this.getAssetPlayer(m);if(w&&_.tracks){w.off(R.BUFFER_CODECS,b),w.tracks=_.tracks;const I=this.primaryMedia;this.bufferingAsset===w.assetItem&&I&&!w.media&&this.bufferAssetPlayer(w,I)}};y.on(R.BUFFER_CODECS,b);const C=()=>{var D;const _=this.getAssetPlayer(m);if(this.log(`buffered to end of asset ${_}`),!_||!this.schedule)return;const w=this.schedule.findEventIndex(e.identifier),I=(D=this.schedule.items)==null?void 0:D[w];this.isInterstitial(I)&&this.advanceAssetBuffering(I,t)};y.on(R.BUFFERED_TO_END,C);const L=D=>()=>{if(!this.getAssetPlayer(m)||!this.schedule)return;this.shouldPlay=!0;const w=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,w,D)};return y.once(R.MEDIA_ENDED,L(i)),y.once(R.PLAYOUT_LIMIT_REACHED,L(1/0)),y.on(R.ERROR,(D,_)=>{if(!this.schedule)return;const w=this.getAssetPlayer(m);if(_.details===te.BUFFER_STALLED_ERROR){if(w!=null&&w.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(_,e,this.schedule.findEventIndex(e.identifier),i,`Asset player error ${_.error} ${e}`)}),y.on(R.DESTROYING,()=>{if(!this.getAssetPlayer(m)||!this.schedule)return;const _=new Error(`Asset player destroyed unexpectedly ${m}`),w={fatal:!0,type:ke.OTHER_ERROR,details:te.INTERSTITIAL_ASSET_ITEM_ERROR,error:_};this.handleAssetItemError(w,e,this.schedule.findEventIndex(e.identifier),i,_.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Ya(t)}`),this.hls.trigger(R.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:i,event:e,player:y}),y}clearInterstitial(e,t){e.assetList.forEach(i=>{this.clearAssetPlayer(i.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const i=this.playerQueue[t];this.transferMediaFromPlayer(i,null),i.resetDetails()}}clearAssetPlayer(e,t){const i=this.getAssetPlayerQueueIndex(e);if(i!==-1){const n=this.playerQueue[i];this.log(`clear ${n} toSegment: ${t&&bn(t)}`),this.transferMediaFromPlayer(n,t),this.playerQueue.splice(i,1),n.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,i,n,r){const{interstitial:o,assetItem:u,assetId:f}=e,h=o.assetList.length,d=this.playingAsset;this.endedAsset=null,this.playingAsset=u,(!d||d.identifier!==f)&&(d&&(this.clearAssetPlayer(d.identifier,i[n]),delete d.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${h} ${Ya(u)}`),this.hls.trigger(R.INTERSTITIAL_ASSET_STARTED,{asset:u,assetListIndex:t,event:o,schedule:i.slice(0),scheduleIndex:n,player:e})),this.bufferAssetPlayer(e,r)}bufferAssetPlayer(e,t){var i,n;if(!this.schedule)return;const{interstitial:r,assetItem:o}=e,u=this.schedule.findEventIndex(r.identifier),f=(i=this.schedule.items)==null?void 0:i[u];if(!f)return;e.loadSource(),this.setBufferingItem(f),this.bufferingAsset=o;const h=this.getBufferingPlayer();if(h===e)return;const d=r.appendInPlace;if(d&&h?.interstitial.appendInPlace===!1)return;const m=h?.tracks||((n=this.detachedData)==null?void 0:n.tracks)||this.requiredTracks;if(d&&o!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(m&&!pE(m,e.tracks)){const p=new Error(`Asset ${Ya(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(m)}')`),v={fatal:!0,type:ke.OTHER_ERROR,details:te.INTERSTITIAL_ASSET_ITEM_ERROR,error:p},y=r.findAssetIndex(o);this.handleAssetItemError(v,r,u,y,p.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,i=this.primaryMedia;if(!t||!i)return;const n=i.currentTime,r=t.findAssetIndex(e,n),o=e.assetList[r];if(o){const u=this.getAssetPlayer(o.identifier);if(u){const f=u.currentTime||n-o.timelineStart,h=u.duration-f;if(this.warn(`Stalled at ${f} of ${f+h} in ${u} ${e} (media.currentTime: ${n})`),f&&(h/i.playbackRate<.5||u.bufferedInPlaceToEnd(i))&&u.hls){const d=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,d,r)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,i,n,r){if(e.details===te.BUFFER_STALLED_ERROR)return;const o=t.assetList[n]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&Ya(o)} ${e.error}`),!this.schedule)return;const u=o?.identifier||"",f=this.getAssetPlayerQueueIndex(u),h=this.playerQueue[f]||null,d=this.schedule.items,m=xt({},e,{fatal:!1,errorAction:Qa(!0),asset:o,assetListIndex:n,event:t,schedule:d,scheduleIndex:i,player:h});if(this.hls.trigger(R.INTERSTITIAL_ASSET_ERROR,m),!e.fatal)return;const p=this.playingAsset,v=this.bufferingAsset,y=new Error(r);if(o&&(this.clearAssetPlayer(u,null),o.error=y),!t.assetList.some(T=>!T.error))t.error=y;else for(let T=n;T<t.assetList.length;T++)this.resetAssetPlayer(t.assetList[T].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):p&&p.identifier===u?this.advanceAfterAssetEnded(t,i,n):v&&v.identifier===u&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,v)}primaryFallback(e){const t=e.timelineStart,i=this.effectivePlayingItem;if(i){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${bn(i)} error: ${e.error}`);let n=this.timelinePos;n===-1&&(n=this.hls.startPosition);const r=this.updateItem(i,n);if(this.itemsMatch(i,r)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t)),!this.schedule)return;const o=this.schedule.findItemIndexAtTime(n);this.setSchedulePosition(o)}else this.checkStart()}onAssetListLoaded(e,t){var i,n;const r=t.event,o=r.identifier,u=t.assetListResponse.ASSETS;if(!((i=this.schedule)!=null&&i.hasEvent(o)))return;const f=r.timelineStart,h=r.duration;let d=0;u.forEach((T,S)=>{const b=parseFloat(T.DURATION);this.createAsset(r,S,d,f+d,b,T.URI),d+=b}),r.duration=d,this.log(`Loaded asset-list with duration: ${d} (was: ${h}) ${r}`);const m=this.waitingItem,p=m?.event.identifier===o;this.updateSchedule();const v=(n=this.bufferingItem)==null?void 0:n.event;if(p){var y;const T=this.schedule.findEventIndex(o),S=(y=this.schedule.items)==null?void 0:y[T];if(S){if(!this.playingItem&&this.timelinePos>S.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==T){r.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${r}`),this.updateSchedule(!0),this.primaryFallback(r);return}this.setBufferingItem(S)}this.setSchedulePosition(T)}else if(v?.identifier===o){const T=r.assetList[0];if(T){const S=this.getAssetPlayer(T.identifier);if(v.appendInPlace){const b=this.primaryMedia;S&&b&&this.bufferAssetPlayer(S,b)}else S&&S.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case te.ASSET_LIST_PARSING_ERROR:case te.ASSET_LIST_LOAD_ERROR:case te.ASSET_LIST_LOAD_TIMEOUT:{const i=t.interstitial;i&&(this.updateSchedule(!0),this.primaryFallback(i));break}case te.BUFFER_STALLED_ERROR:{const i=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&i.event.appendInPlace){this.handleInPlaceStall(i.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const Ry=500;class VT extends Uc{constructor(e,t,i){super(e,t,i,"subtitle-stream-controller",_e.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(R.LEVEL_LOADED,this.onLevelLoaded,this),e.on(R.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(R.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(R.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(R.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(R.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(R.LEVEL_LOADED,this.onLevelLoaded,this),e.off(R.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(R.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(R.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(R.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(R.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=ce.IDLE,this.setInterval(Ry),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:i,success:n}=t;if(this.fragContextChanged(i)||(Zt(i)&&(this.fragPrevious=i),this.state=ce.IDLE),!n)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let o;const u=i.start;for(let h=0;h<r.length;h++)if(u>=r[h].start&&u<=r[h].end){o=r[h];break}const f=i.start+i.duration;o?o.end=f:(o={start:u,end:f},r.push(o)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:i,endOffset:n}=t;if(i===0&&n!==Number.POSITIVE_INFINITY){const r=n-1;if(r<=0)return;t.endOffsetSubtitles=Math.max(0,r),this.tracksBuffered.forEach(o=>{for(let u=0;u<o.length;){if(o[u].end<=r){o.shift();continue}else if(o[u].start<r)o[u].start=r;else break;u++}}),this.fragmentTracker.removeFragmentsInRange(i,r,_e.SUBTITLE)}}onError(e,t){const i=t.frag;i?.type===_e.SUBTITLE&&(t.details===te.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ce.STOPPED&&(this.state=ce.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&TT(this.levels,t)){this.levels=t.map(i=>new io(i));return}this.tracksBuffered=[],this.levels=t.map(i=>{const n=new io(i);return this.tracksBuffered[n.id]=[],n}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,_e.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var i;if(this.currentTrackId=t.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}const n=this.levels[this.currentTrackId];n!=null&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.state!==ce.STOPPED&&this.setInterval(Ry)}onSubtitleTrackLoaded(e,t){var i;const{currentTrackId:n,levels:r}=this,{details:o,id:u}=t;if(!r){this.warn(`Subtitle tracks were reset while loading level ${u}`);return}const f=r[u];if(u>=r.length||!f)return;this.log(`Subtitle track ${u} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let h=0;if(o.live||(i=f.details)!=null&&i.live){if(o.deltaUpdateFailed)return;const m=this.mainDetails;if(!m){this.startFragRequested=!1;return}const p=m.fragments[0];if(!f.details)o.hasProgramDateTime&&m.hasProgramDateTime?(Dc(o,m),h=o.fragmentStart):p&&(h=p.start,$d(o,h));else{var d;h=this.alignPlaylists(o,f.details,(d=this.levelLastLoaded)==null?void 0:d.details),h===0&&p&&(h=p.start,$d(o,h))}m&&!this.startFragRequested&&this.setStartPosition(m,h)}f.details=o,this.levelLastLoaded=f,u===n&&(this.hls.trigger(R.SUBTITLE_TRACK_UPDATED,{details:o,id:u,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===ce.IDLE&&(Jr(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),f.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:i}=e,n=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&n!=null&&n.key&&n.iv&&qa(n.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(i),n.key.buffer,n.iv.buffer,Tg(n.method)).catch(u=>{throw r.trigger(R.ERROR,{type:ke.MEDIA_ERROR,details:te.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:t}),u}).then(u=>{const f=performance.now();r.trigger(R.FRAG_DECRYPTED,{frag:t,payload:u,stats:{tstart:o,tdecrypt:f}})}).catch(u=>{this.warn(`${u.name}: ${u.message}`),this.state=ce.IDLE})}}doTick(){if(!this.media){this.state=ce.IDLE;return}if(this.state===ce.IDLE){const{currentTrackId:e,levels:t}=this,i=t?.[e];if(!i||!t.length||!i.details||this.waitForLive(i))return;const{config:n}=this,r=this.getLoadPosition(),o=je.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,n.maxBufferHole),{end:u,len:f}=o,h=i.details,d=this.hls.maxBufferLength+h.levelTargetDuration;if(f>d)return;const m=h.fragments,p=m.length,v=h.edge;let y=null;const T=this.fragPrevious;if(u<v){const C=n.maxFragLookUpTolerance,L=u>v-C?0:C;y=Jr(T,m,Math.max(m[0].start,u),L),!y&&T&&T.start<m[0].start&&(y=m[0])}else y=m[p-1];if(y=this.filterReplacedPrimary(y,i.details),!y)return;const S=y.sn-h.startSN,b=m[S-1];if(b&&b.cc===y.cc&&this.fragmentTracker.getState(b)===si.NOT_LOADED&&(y=b),this.fragmentTracker.getState(y)===si.NOT_LOADED){const C=this.mapToInitFragWhenRequired(y);C&&this.loadFragment(C,i,u)}}}loadFragment(e,t,i){Zt(e)?super.loadFragment(e,t,i):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new dI(this.tracksBuffered[this.currentTrackId]||[])}}class dI{constructor(e){this.buffered=void 0;const t=(i,n,r)=>{if(n=n>>>0,n>r-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${n}) is greater than the maximum bound (${r})`);return e[n][i]};this.buffered={get length(){return e.length},end(i){return t("end",i,e.length)},start(i){return t("start",i,e.length)}}}}const gI={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},$T=l=>String.fromCharCode(gI[l]||l),xn=15,xs=100,mI={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},pI={17:2,18:4,21:6,22:8,23:10,19:13,20:15},AI={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},vI={25:2,26:4,29:6,30:8,31:10,27:13,28:15},yI=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class EI{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const i=typeof t=="function"?t():t;vt.log(`${this.time} [${e}] ${i}`)}}}const Hr=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class YT{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){const n=t[i];e.hasOwnProperty(n)&&(this[n]=e[n])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class TI{constructor(){this.uchar=" ",this.penState=new YT}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class SI{constructor(e){this.chars=[],this.pos=0,this.currPenState=new YT,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<xs;t++)this.chars.push(new TI);this.logger=e}equals(e){for(let t=0;t<xs;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<xs;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<xs;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>xs&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=xs)}moveCursor(e){const t=this.pos+e;if(e>1)for(let i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=$T(e);if(this.pos>=xs){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<xs;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let i=0;i<xs;i++){const n=this.chars[i].uchar;n!==" "&&(t=!1),e.push(n)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class dd{constructor(e){this.rows=[],this.currRow=xn-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<xn;t++)this.rows.push(new SI(e));this.logger=e}reset(){for(let e=0;e<xn;e++)this.rows[e].clear();this.currRow=xn-1}equals(e){let t=!0;for(let i=0;i<xn;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<xn;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<xn;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Lt(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let u=0;u<xn;u++)this.rows[u].clear();const r=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const u=o.rows[r].cueStartTime,f=this.logger.time;if(u!==null&&f!==null&&u<f)for(let h=0;h<this.nrRollUpRows;h++)this.rows[t-this.nrRollUpRows+h+1].copy(o.rows[r+h])}}this.currRow=t;const i=this.rows[this.currRow];if(e.indent!==null){const r=e.indent,o=Math.max(r-1,0);i.setCursor(e.indent),e.color=i.chars[o].penState.foreground}const n={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(n)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Lt(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let i="",n=-1;for(let r=0;r<xn;r++){const o=this.rows[r].getTextString();o&&(n=r+1,e?t.push("Row "+n+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?i="["+t.join(" | ")+"]":i=t.join(`
`)),i}getTextAndFormat(){return this.rows}}class Ly{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new dd(i),this.nonDisplayedMemory=new dd(i),this.lastOutputScreen=new dd(i),this.currRollUpRow=this.displayedMemory.rows[xn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[xn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const i=Math.floor(e/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=n[i]}this.logger.log(2,"MIDROW: "+Lt(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Dy{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=xI(),this.logger=void 0;const n=this.logger=new EI;this.channels=[null,new Ly(e,t,n),new Ly(e+1,i,n)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let i=0;i<t.length;i+=2){const n=t[i]&127,r=t[i+1]&127;let o=!1,u=null;if(n===0&&r===0)continue;this.logger.log(3,()=>"["+Hr([t[i],t[i+1]])+"] -> ("+Hr([n,r])+")");const f=this.cmdHistory;if(n>=16&&n<=31){if(bI(n,r,f)){ic(null,null,f),this.logger.log(3,()=>"Repeated command ("+Hr([n,r])+") is dropped");continue}ic(n,r,this.cmdHistory),o=this.parseCmd(n,r),o||(o=this.parseMidrow(n,r)),o||(o=this.parsePAC(n,r)),o||(o=this.parseBackgroundAttributes(n,r))}else ic(null,null,f);if(!o&&(u=this.parseChars(n,r),u)){const d=this.currentChannel;d&&d>0?this.channels[d].insertChars(u):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!u&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Hr([n,r])+" orig: "+Hr([t[i],t[i+1]]))}}parseCmd(e,t){const i=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=33&&t<=35;if(!(i||n))return!1;const r=e===20||e===21||e===23?1:2,o=this.channels[r];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=r,!0}parseMidrow(e,t){let i=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const n=this.channels[i];return n?(n.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Hr([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let i;const n=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,r=(e===16||e===24)&&t>=64&&t<=95;if(!(n||r))return!1;const o=e<=23?1:2;t>=64&&t<=95?i=o===1?mI[e]:AI[e]:i=o===1?pI[e]:vI[e];const u=this.channels[o];return u?(u.setPAC(this.interpretPAC(i,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let i;const n={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?i=t-96:i=t-64,n.underline=(i&1)===1,i<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(n.italics=!0,n.color="white"):n.indent=Math.floor((i-16)/2)*4,n}parseChars(e,t){let i,n=null,r=null;if(e>=25?(i=2,r=e-8):(i=1,r=e),r>=17&&r<=19){let o;r===17?o=t+80:r===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+$T(o)+"' in channel "+i),n=[o]}else e>=32&&e<=127&&(n=t===0?[e]:[e,t]);return n&&this.logger.log(3,()=>"Char codes =  "+Hr(n).join(",")),n}parseBackgroundAttributes(e,t){const i=(e===16||e===24)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=45&&t<=47;if(!(i||n))return!1;let r;const o={};e===16||e===24?(r=Math.floor((t-32)/2),o.background=yI[r],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const u=e<=23?1:2;return this.channels[u].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}ic(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const i=this.channels[t];i&&i.cueSplitAtTime(e)}}}function ic(l,e,t){t.a=l,t.b=e}function bI(l,e,t){return t.a===l&&t.b===e}function xI(){return{a:null,b:null}}var Og=(function(){if(Lc!=null&&Lc.VTTCue)return self.VTTCue;const l=["","lr","rl"],e=["start","middle","end","left","right"];function t(u,f){if(typeof f!="string"||!Array.isArray(u))return!1;const h=f.toLowerCase();return~u.indexOf(h)?h:!1}function i(u){return t(l,u)}function n(u){return t(e,u)}function r(u,...f){let h=1;for(;h<arguments.length;h++){const d=arguments[h];for(const m in d)u[m]=d[m]}return u}function o(u,f,h){const d=this,m={enumerable:!0};d.hasBeenReset=!1;let p="",v=!1,y=u,T=f,S=h,b=null,C="",L=!0,D="auto",_="start",w=50,I="middle",O=50,F="middle";Object.defineProperty(d,"id",r({},m,{get:function(){return p},set:function(M){p=""+M}})),Object.defineProperty(d,"pauseOnExit",r({},m,{get:function(){return v},set:function(M){v=!!M}})),Object.defineProperty(d,"startTime",r({},m,{get:function(){return y},set:function(M){if(typeof M!="number")throw new TypeError("Start time must be set to a number.");y=M,this.hasBeenReset=!0}})),Object.defineProperty(d,"endTime",r({},m,{get:function(){return T},set:function(M){if(typeof M!="number")throw new TypeError("End time must be set to a number.");T=M,this.hasBeenReset=!0}})),Object.defineProperty(d,"text",r({},m,{get:function(){return S},set:function(M){S=""+M,this.hasBeenReset=!0}})),Object.defineProperty(d,"region",r({},m,{get:function(){return b},set:function(M){b=M,this.hasBeenReset=!0}})),Object.defineProperty(d,"vertical",r({},m,{get:function(){return C},set:function(M){const H=i(M);if(H===!1)throw new SyntaxError("An invalid or illegal string was specified.");C=H,this.hasBeenReset=!0}})),Object.defineProperty(d,"snapToLines",r({},m,{get:function(){return L},set:function(M){L=!!M,this.hasBeenReset=!0}})),Object.defineProperty(d,"line",r({},m,{get:function(){return D},set:function(M){if(typeof M!="number"&&M!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");D=M,this.hasBeenReset=!0}})),Object.defineProperty(d,"lineAlign",r({},m,{get:function(){return _},set:function(M){const H=n(M);if(!H)throw new SyntaxError("An invalid or illegal string was specified.");_=H,this.hasBeenReset=!0}})),Object.defineProperty(d,"position",r({},m,{get:function(){return w},set:function(M){if(M<0||M>100)throw new Error("Position must be between 0 and 100.");w=M,this.hasBeenReset=!0}})),Object.defineProperty(d,"positionAlign",r({},m,{get:function(){return I},set:function(M){const H=n(M);if(!H)throw new SyntaxError("An invalid or illegal string was specified.");I=H,this.hasBeenReset=!0}})),Object.defineProperty(d,"size",r({},m,{get:function(){return O},set:function(M){if(M<0||M>100)throw new Error("Size must be between 0 and 100.");O=M,this.hasBeenReset=!0}})),Object.defineProperty(d,"align",r({},m,{get:function(){return F},set:function(M){const H=n(M);if(!H)throw new SyntaxError("An invalid or illegal string was specified.");F=H,this.hasBeenReset=!0}})),d.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o})();class CI{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function zT(l){function e(i,n,r,o){return(i|0)*3600+(n|0)*60+(r|0)+parseFloat(o||0)}const t=l.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class RI{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let n=0;n<i.length;++n)if(t===i[n]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function jT(l,e,t,i){const n=i?l.split(i):[l];for(const r in n){if(typeof n[r]!="string")continue;const o=n[r].split(t);if(o.length!==2)continue;const u=o[0],f=o[1];e(u,f)}}const Wd=new Og(0,0,""),nc=Wd.align==="middle"?"middle":"center";function LI(l,e,t){const i=l;function n(){const u=zT(l);if(u===null)throw new Error("Malformed timestamp: "+i);return l=l.replace(/^[^\sa-zA-Z-]+/,""),u}function r(u,f){const h=new RI;jT(u,function(p,v){let y;switch(p){case"region":for(let T=t.length-1;T>=0;T--)if(t[T].id===v){h.set(p,t[T].region);break}break;case"vertical":h.alt(p,v,["rl","lr"]);break;case"line":y=v.split(","),h.integer(p,y[0]),h.percent(p,y[0])&&h.set("snapToLines",!1),h.alt(p,y[0],["auto"]),y.length===2&&h.alt("lineAlign",y[1],["start",nc,"end"]);break;case"position":y=v.split(","),h.percent(p,y[0]),y.length===2&&h.alt("positionAlign",y[1],["start",nc,"end","line-left","line-right","auto"]);break;case"size":h.percent(p,v);break;case"align":h.alt(p,v,["start",nc,"end","left","right"]);break}},/:/,/\s/),f.region=h.get("region",null),f.vertical=h.get("vertical","");let d=h.get("line","auto");d==="auto"&&Wd.line===-1&&(d=-1),f.line=d,f.lineAlign=h.get("lineAlign","start"),f.snapToLines=h.get("snapToLines",!0),f.size=h.get("size",100),f.align=h.get("align",nc);let m=h.get("position","auto");m==="auto"&&Wd.position===50&&(m=f.align==="start"||f.align==="left"?0:f.align==="end"||f.align==="right"?100:50),f.position=m}function o(){l=l.replace(/^\s+/,"")}if(o(),e.startTime=n(),o(),l.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);l=l.slice(3),o(),e.endTime=n(),o(),r(l,e)}function JT(l){return l.replace(/<br(?: \/)?>/gi,`
`)}class DI{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new CI,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function i(){let r=t.buffer,o=0;for(r=JT(r);o<r.length&&r[o]!=="\r"&&r[o]!==`
`;)++o;const u=r.slice(0,o);return r[o]==="\r"&&++o,r[o]===`
`&&++o,t.buffer=r.slice(o),u}function n(r){jT(r,function(o,u){},/:/)}try{let r="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;r=i();const u=r.match(/^()?WEBVTT([ \t].*)?$/);if(!(u!=null&&u[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:r=i(),t.state){case"HEADER":/:/.test(r)?n(r):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;if(t.cue=new Og(0,0,""),t.state="CUE",r.indexOf("-->")===-1){t.cue.id=r;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{LI(r,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const u=r.indexOf("-->")!==-1;if(!r||u&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=r}continue;case"BADCUE":r||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const _I=/\r\n|\n\r|\n|\r/g,gd=function(e,t,i=0){return e.slice(i,i+t.length)===t},II=function(e){let t=parseInt(e.slice(-3));const i=parseInt(e.slice(-6,-4)),n=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!xe(t)||!xe(i)||!xe(n)||!xe(r))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=60*1e3*n,t+=3600*1e3*r,t};function Fg(l,e,t){return Al(l.toString())+Al(e.toString())+Al(t)}const BI=function(e,t,i){let n=e[t],r=e[n.prevCC];if(!r||!r.new&&n.new){e.ccOffset=e.presentationOffset=n.start,n.new=!1;return}for(;(o=r)!=null&&o.new;){var o;e.ccOffset+=n.start-r.start,n.new=!1,n=r,r=e[n.prevCC]}e.presentationOffset=i};function MI(l,e,t,i,n,r,o){const u=new DI,f=Xi(new Uint8Array(l)).trim().replace(_I,`
`).split(`
`),h=[],d=e?zD(e.baseTime,e.timescale):0;let m="00:00.000",p=0,v=0,y,T=!0;u.oncue=function(S){const b=t[i];let C=t.ccOffset;const L=(p-d)/9e4;if(b!=null&&b.new&&(v!==void 0?C=t.ccOffset=b.start:BI(t,i,L)),L){if(!e){y=new Error("Missing initPTS for VTT MPEGTS");return}C=L-t.presentationOffset}const D=S.endTime-S.startTime,_=Ji((S.startTime+C-v)*9e4,n*9e4)/9e4;S.startTime=Math.max(_,0),S.endTime=Math.max(_+D,0);const w=S.text.trim();S.text=decodeURIComponent(encodeURIComponent(w)),S.id||(S.id=Fg(S.startTime,S.endTime,w)),S.endTime>0&&h.push(S)},u.onparsingerror=function(S){y=S},u.onflush=function(){if(y){o(y);return}r(h)},f.forEach(S=>{if(T)if(gd(S,"X-TIMESTAMP-MAP=")){T=!1,S.slice(16).split(",").forEach(b=>{gd(b,"LOCAL:")?m=b.slice(6):gd(b,"MPEGTS:")&&(p=parseInt(b.slice(7)))});try{v=II(m)/1e3}catch(b){y=b}return}else S===""&&(T=!1);u.parse(S+`
`)}),u.flush()}const md="stpp.ttml.im1t",XT=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,QT=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,OI={left:"start",center:"center",right:"end",start:"start",end:"end"};function _y(l,e,t,i){const n=et(new Uint8Array(l),["mdat"]);if(n.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const r=n.map(u=>Xi(u)),o=YD(e.baseTime,1,e.timescale);try{r.forEach(u=>t(FI(u,o)))}catch(u){i(u)}}function FI(l,e){const n=new DOMParser().parseFromString(l,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(r).reduce((m,p)=>(m[p]=n.getAttribute(`ttp:${p}`)||r[p],m),{}),u=n.getAttribute("xml:space")!=="preserve",f=Iy(pd(n,"styling","style")),h=Iy(pd(n,"layout","region")),d=pd(n,"body","[begin]");return[].map.call(d,m=>{const p=qT(m,u);if(!p||!m.hasAttribute("begin"))return null;const v=vd(m.getAttribute("begin"),o),y=vd(m.getAttribute("dur"),o);let T=vd(m.getAttribute("end"),o);if(v===null)throw By(m);if(T===null){if(y===null)throw By(m);T=v+y}const S=new Og(v-e,T-e,p);S.id=Fg(S.startTime,S.endTime,S.text);const b=h[m.getAttribute("region")],C=f[m.getAttribute("style")],L=kI(b,C,f),{textAlign:D}=L;if(D){const _=OI[D];_&&(S.lineAlign=_),S.align=D}return xt(S,L),S}).filter(m=>m!==null)}function pd(l,e,t){const i=l.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(t)):[]}function Iy(l){return l.reduce((e,t)=>{const i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function qT(l,e){return[].slice.call(l.childNodes).reduce((t,i,n)=>{var r;return i.nodeName==="br"&&n?t+`
`:(r=i.childNodes)!=null&&r.length?qT(i,e):e?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent},"")}function kI(l,e,t){const i="http://www.w3.org/ns/ttml#styling";let n=null;const r=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=l!=null&&l.hasAttribute("style")?l.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(n=t[o]),r.reduce((u,f)=>{const h=Ad(e,i,f)||Ad(l,i,f)||Ad(n,i,f);return h&&(u[f]=h),u},{})}function Ad(l,e,t){return l&&l.hasAttributeNS(e,t)?l.getAttributeNS(e,t):null}function By(l){return new Error(`Could not parse ttml timestamp ${l}`)}function vd(l,e){if(!l)return null;let t=zT(l);return t===null&&(XT.test(l)?t=wI(l,e):QT.test(l)&&(t=UI(l,e))),t}function wI(l,e){const t=XT.exec(l),i=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+i/e.frameRate}function UI(l,e){const t=QT.exec(l),i=Number(t[1]);switch(t[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}class sc{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class WT{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Oy(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(R.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(R.FRAG_LOADING,this.onFragLoading,this),e.on(R.FRAG_LOADED,this.onFragLoaded,this),e.on(R.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(R.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(R.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(R.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(R.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(R.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(R.FRAG_LOADING,this.onFragLoading,this),e.off(R.FRAG_LOADED,this.onFragLoaded,this),e.off(R.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(R.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(R.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(R.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(R.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new sc(this,"textTrack1"),t=new sc(this,"textTrack2"),i=new sc(this,"textTrack3"),n=new sc(this,"textTrack4");this.cea608Parser1=new Dy(1,e,t),this.cea608Parser2=new Dy(3,i,n)}addCues(e,t,i,n,r){let o=!1;for(let u=r.length;u--;){const f=r[u],h=PI(f[0],f[1],t,i);if(h>=0&&(f[0]=Math.min(f[0],t),f[1]=Math.max(f[1],i),o=!0,h/(i-t)>.5))return}if(o||r.push([t,i]),this.config.renderTextTracksNatively){const u=this.captionsTracks[e];this.Cues.newCue(u,t,i,n)}else{const u=this.Cues.newCue(null,t,i,n);this.hls.trigger(R.CUES_PARSED,{type:"captions",cues:u,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:n,timescale:r,trackId:o}){const{unparsedVttFrags:u}=this;i===_e.MAIN&&(this.initPTS[t.cc]={baseTime:n,timescale:r,trackId:o}),u.length&&(this.unparsedVttFrags=[],u.forEach(f=>{this.initPTS[f.frag.cc]?this.onFragLoaded(R.FRAG_LOADED,f):this.hls.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:f.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:i}=this;if(i)for(let n=0;n<i.textTracks.length;n++){const r=i.textTracks[n];if(My(r,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:i,media:n}=this,{label:r,languageCode:o}=t[e],u=this.getExistingTrack(r,o);if(u)i[e]=u,ja(i[e]),NT(i[e],n);else{const f=this.createTextTrack("captions",r,o);f&&(f[e]=!0,i[e]=f)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const i=t.label,n={_id:e,label:i,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(R.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}createTextTrack(e,t,i){const n=this.media;if(n)return n.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const i=!!t.transferMedia;if(this.media=null,i)return;const{captionsTracks:n}=this;Object.keys(n).forEach(r=>{ja(n[r]),delete n[r]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Oy(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let i=0;i<t.length;i++)ja(t[i])}onSubtitleTracksUpdated(e,t){const i=t.subtitleTracks||[],n=i.some(r=>r.textCodec===md);if(this.config.enableWebVTT||n&&this.config.enableIMSC1){if(TT(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const o=this.media,u=o?mc(o.textTracks):null;if(this.tracks.forEach((f,h)=>{let d;if(u){let m=null;for(let p=0;p<u.length;p++)if(u[p]&&My(u[p],f)){m=u[p],u[p]=null;break}m&&(d=m)}if(d)ja(d);else{const m=ZT(f);d=this.createTextTrack(m,f.name,f.lang),d&&(d.mode="disabled")}d&&this.textTracks.push(d)}),u!=null&&u.length){const f=u.filter(h=>h!==null).map(h=>h.label);f.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${f.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(u=>({label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}));this.hls.trigger(R.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(i=>{const n=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!n)return;const r=`textTrack${n[1]}`,o=this.captionsProperties[r];o&&(o.label=i.name,i.lang&&(o.languageCode=i.lang),o.media=i)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===_e.MAIN){var i,n;const{cea608Parser1:r,cea608Parser2:o,lastSn:u}=this,{cc:f,sn:h}=t.frag,d=(i=(n=t.part)==null?void 0:n.index)!=null?i:-1;r&&o&&(h!==u+1||h===u&&d!==this.lastPartIndex+1||f!==this.lastCc)&&(r.reset(),o.reset()),this.lastCc=f,this.lastSn=h,this.lastPartIndex=d}}onFragLoaded(e,t){const{frag:i,payload:n}=t;if(i.type===_e.SUBTITLE)if(n.byteLength){const r=i.decryptdata,o="stats"in t;if(r==null||!r.encrypted||o){const u=this.tracks[i.level],f=this.vttCCs;f[i.cc]||(f[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),u&&u.textCodec===md?this._parseIMSC1(i,n):this._parseVTTs(t)}}else this.hls.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const i=this.hls;_y(t,this.initPTS[e.cc],n=>{this._appendCues(n,e.level),i.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},n=>{i.logger.log(`Failed to parse IMSC1: ${n}`),i.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:n})})}_parseVTTs(e){var t;const{frag:i,payload:n}=e,{initPTS:r,unparsedVttFrags:o}=this,u=r.length-1;if(!r[i.cc]&&u===-1){o.push(e);return}const f=this.hls,h=(t=i.initSegment)!=null&&t.data?dn(i.initSegment.data,new Uint8Array(n)).buffer:n;MI(h,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,d=>{this._appendCues(d,i.level),f.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},d=>{const m=d.message==="Missing initPTS for VTT MPEGTS";m?o.push(e):this._fallbackToIMSC1(i,n),f.logger.log(`Failed to parse VTT cue: ${d}`),!(m&&u>i.cc)&&f.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:d})})}_fallbackToIMSC1(e,t){const i=this.tracks[e.level];i.textCodec||_y(t,this.initPTS[e.cc],()=>{i.textCodec=md,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){const i=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[t];if(!n||n.mode==="disabled")return;e.forEach(r=>GT(n,r))}else{const n=this.tracks[t];if(!n)return;const r=n.default?"default":"subtitles"+t;i.trigger(R.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,t){const{frag:i}=t;i.type===_e.SUBTITLE&&this.onFragLoaded(R.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:i,samples:n}=t;if(!(i.type===_e.MAIN&&this.closedCaptionsForLevel(i)==="NONE"))for(let r=0;r<n.length;r++){const o=n[r].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const u=this.extractCea608Data(o);this.cea608Parser1.addData(n[r].pts,u[0]),this.cea608Parser2.addData(n[r].pts,u[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:n,type:r}){const{media:o}=this;if(!(!o||o.currentTime<i)){if(!r||r==="video"){const{captionsTracks:u}=this;Object.keys(u).forEach(f=>qd(u[f],t,i))}if(this.config.renderTextTracksNatively&&t===0&&n!==void 0){const{textTracks:u}=this;Object.keys(u).forEach(f=>qd(u[f],t,n))}}}extractCea608Data(e){const t=[[],[]],i=e[0]&31;let n=2;for(let r=0;r<i;r++){const o=e[n++],u=127&e[n++],f=127&e[n++];if(u===0&&f===0)continue;if((4&o)!==0){const d=3&o;(d===0||d===1)&&(t[d].push(u),t[d].push(f))}}return t}}function ZT(l){return l.characteristics&&/transcribes-spoken-dialog/gi.test(l.characteristics)&&/describes-music-and-sound/gi.test(l.characteristics)?"captions":"subtitles"}function My(l,e){return!!l&&l.kind===ZT(e)&&jd(e,l)}function PI(l,e,t,i){return Math.min(e,i)-Math.max(l,t)}function Oy(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const NI=/\s/,eS={newCue(l,e,t,i){const n=[];let r,o,u,f,h;const d=self.VTTCue||self.TextTrackCue;for(let p=0;p<i.rows.length;p++)if(r=i.rows[p],u=!0,f=0,h="",!r.isEmpty()){var m;for(let T=0;T<r.chars.length;T++)NI.test(r.chars[T].uchar)&&u?f++:(h+=r.chars[T].uchar,u=!1);r.cueStartTime=e,e===t&&(t+=1e-4),f>=16?f--:f++;const v=JT(h.trim()),y=Fg(e,t,v);l!=null&&(m=l.cues)!=null&&m.getCueById(y)||(o=new d(e,t,v),o.id=y,o.line=p+1,o.align="left",o.position=10+Math.min(80,Math.floor(f*8/32)*10),n.push(o))}return l&&n.length&&(n.sort((p,v)=>p.line==="auto"||v.line==="auto"?0:p.line>8&&v.line>8?v.line-p.line:p.line-v.line),n.forEach(p=>GT(l,p))),n}};function tS(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const GI=/(\d+)-(\d+)\/(\d+)/;class Zd{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||$I,this.controller=new self.AbortController,this.stats=new Fc}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){const n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();const r=HI(e,this.controller.signal),o=e.responseType==="arraybuffer",u=o?"byteLength":"length",{maxTimeToFirstByteMs:f,maxLoadTimeMs:h}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),t.timeout=f&&xe(f)?f:h,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},t.timeout),(xl(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(m=>{var p;this.response=this.loader=m;const v=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=h,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},h-(v-n.loading.start)),!m.ok){const{status:T,statusText:S}=m;throw new YI(S||"fetch, bad network response",T,m)}n.loading.first=v,n.total=VI(m.headers)||n.total;const y=(p=this.callbacks)==null?void 0:p.onProgress;return y&&xe(t.highWaterMark)?this.loadProgressively(m,n,e,t.highWaterMark,y):o?m.arrayBuffer():e.responseType==="json"?m.json():m.text()}).then(m=>{var p,v;const y=this.response;if(!y)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);const T=m[u];T&&(n.loaded=n.total=T);const S={url:y.url,data:m,code:y.status},b=(p=this.callbacks)==null?void 0:p.onProgress;b&&!xe(t.highWaterMark)&&b(n,e,m,y),(v=this.callbacks)==null||v.onSuccess(S,n,e,y)}).catch(m=>{var p;if(self.clearTimeout(this.requestTimeout),n.aborted)return;const v=m&&m.code||0,y=m?m.message:null;(p=this.callbacks)==null||p.onError({code:v,text:y},e,m?m.details:null,n)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,n=0,r){const o=new eT,u=e.body.getReader(),f=()=>u.read().then(h=>{if(h.done)return o.dataLength&&r(t,i,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const d=h.value,m=d.length;return t.loaded+=m,m<n||o.dataLength?(o.push(d),o.dataLength>=n&&r(t,i,o.flush().buffer,e)):r(t,i,d.buffer,e),f()}).catch(()=>Promise.reject());return f()}}function HI(l,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(xt({},l.headers))};return l.rangeEnd&&t.headers.set("Range","bytes="+l.rangeStart+"-"+String(l.rangeEnd-1)),t}function KI(l){const e=GI.exec(l);if(e)return parseInt(e[2])-parseInt(e[1])+1}function VI(l){const e=l.get("Content-Range");if(e){const i=KI(e);if(xe(i))return i}const t=l.get("Content-Length");if(t)return parseInt(t)}function $I(l,e){return new self.Request(l.url,e)}class YI extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}const zI=/^age:\s*[\d.]+\s*$/im;class kg{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Fc,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const i=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0,n.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then(()=>{if(!(this.loader!==i||this.stats.aborted))return r(i,t.url)}).catch(o=>{if(!(this.loader!==i||this.stats.aborted))return i.open("GET",t.url,!0),r(i,t.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(o=>{var u;(u=this.callbacks)==null||u.onError({code:i.status,text:o.message},t,i,n)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);const n=t.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:o}=i.loadPolicy;if(n)for(const u in n)e.setRequestHeader(u,n[u]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=r&&xe(r)?r:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:i}=this;if(!e||!t)return;const n=t.readyState,r=this.config;if(!i.aborted&&n>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),n===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const h=t.status,d=t.responseType==="text"?t.responseText:null;if(h>=200&&h<300){const y=d??t.response;if(y!=null){var o,u;i.loading.end=Math.max(self.performance.now(),i.loading.first);const T=t.responseType==="arraybuffer"?y.byteLength:y.length;i.loaded=i.total=T,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first);const S=(o=this.callbacks)==null?void 0:o.onProgress;S&&S(i,e,y,t);const b={url:t.responseURL,data:y,code:h};(u=this.callbacks)==null||u.onSuccess(b,i,e,t);return}}const m=r.loadPolicy.errorRetry,p=i.retry,v={url:e.url,data:void 0,code:h};if(Cc(m,p,!1,v))this.retry(m);else{var f;vt.error(`${h} while loading ${e.url}`),(f=this.callbacks)==null||f.onError({code:h,text:t.statusText},e,t,i)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Cc(e,t,!0))this.retry(e);else{var i;vt.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);const n=this.callbacks;n&&(this.abortInternal(),n.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:i}=this;this.retryDelay=vg(e,i.retry),i.retry++,vt.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&zI.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const jI={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},JI=At(At({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:kg,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:OE,bufferController:xT,capLevelController:Gc,errorController:PE,fpsController:PT,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:bg,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:jI},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},XI()),{},{subtitleStreamController:VT,subtitleTrackController:HT,timelineController:WT,audioStreamController:ET,audioTrackController:ST,emeController:zr,cmcdController:kT,contentSteeringController:wT,interstitialsController:hI});function XI(){return{cueHandler:eS,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function QI(l,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=eg(l),n=["manifest","level","frag"],r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return n.forEach(o=>{const u=`${o==="level"?"playlist":o}LoadPolicy`,f=e[u]===void 0,h=[];r.forEach(d=>{const m=`${o}Loading${d}`,p=e[m];if(p!==void 0&&f){h.push(m);const v=i[u].default;switch(e[u]={default:v},d){case"TimeOut":v.maxLoadTimeMs=p,v.maxTimeToFirstByteMs=p;break;case"MaxRetry":v.errorRetry.maxNumRetry=p,v.timeoutRetry.maxNumRetry=p;break;case"RetryDelay":v.errorRetry.retryDelayMs=p,v.timeoutRetry.retryDelayMs=p;break;case"MaxRetryTimeout":v.errorRetry.maxRetryDelayMs=p,v.timeoutRetry.maxRetryDelayMs=p;break}}}),h.length&&t.warn(`hls.js config: "${h.join('", "')}" setting(s) are deprecated, use "${u}": ${Lt(e[u])}`)}),At(At({},i),e)}function eg(l){return l&&typeof l=="object"?Array.isArray(l)?l.map(eg):Object.keys(l).reduce((e,t)=>(e[t]=eg(l[t]),e),{}):l}function qI(l,e){const t=l.loader;t!==Zd&&t!==kg?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),l.progressive=!1):tS()&&(l.loader=Zd,l.progressive=!0,l.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const pc=2,WI=.1,ZI=.05,eB=100;class tB extends NE{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var i;(i=this.media)!=null&&i.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var i;this.ended=((i=this.media)==null?void 0:i.currentTime)||1,this.hls.trigger(R.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(eB),this.mediaSource=t.mediaSource;const i=this.media=t.media;Ci(i,"playing",this.onMediaPlaying),Ci(i,"waiting",this.onMediaWaiting),Ci(i,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:i}=this;i&&(ki(i,"playing",this.onMediaPlaying),ki(i,"waiting",this.onMediaWaiting),ki(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var i,n;const r=(i=this.hls)==null?void 0:i.config;if(!r)return;const o=this.media;if(!o)return;const{seeking:u}=o,f=this.seeking&&!u,h=!this.seeking&&u,d=o.paused&&!u||o.ended||o.playbackRate===0;if(this.seeking=u,e!==t){t&&(this.ended=0),this.moved=!0,u||(this.nudgeRetry=0,r.nudgeOnVideoHole&&!d&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(h||f){f&&this.stallResolved(e);return}if(d){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(R.MEDIA_ENDED,{stalled:!1}));return}if(!je.getBuffered(o).length){this.nudgeRetry=0;return}const m=je.bufferInfo(o,e,0),p=m.nextStart||0,v=this.fragmentTracker;if(u&&v&&this.hls){const w=Fy(this.hls.inFlightFragments,e),I=m.len>pc,O=!p||w||p-e>pc&&!v.getPartialFragment(e);if(I||O)return;this.moved=!1}const y=(n=this.hls)==null?void 0:n.latestLevelDetails;if(!this.moved&&this.stalled!==null&&v){if(!(m.len>0)&&!p)return;const I=Math.max(p,m.start||0)-e,F=!!(y!=null&&y.live)?y.targetduration*2:pc,M=rc(e,v);if(I>0&&(I<=F||M)){o.paused||this._trySkipBufferHole(M);return}}const T=r.detectStallWithCurrentTimeMs,S=self.performance.now(),b=this.waiting;let C=this.stalled;if(C===null)if(b>0&&S-b<T)C=this.stalled=b;else{this.stalled=S;return}const L=S-C;if(!u&&(L>=T||b)&&this.hls){var D;if(((D=this.mediaSource)==null?void 0:D.readyState)==="ended"&&!(y!=null&&y.live)&&Math.abs(e-(y?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(R.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(m),!this.media||!this.hls)return}const _=je.bufferInfo(o,e,r.maxBufferHole);this._tryFixBufferStall(_,L,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const i=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(i)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(R.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var i;const n=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&n&&n.length>1&&e>n.end(0)){const r=je.bufferedInfo(je.timeRangesToArray(this.buffered.audio),e,0);if(r.len>1&&t>=r.start){const o=je.timeRangesToArray(n),u=je.bufferedInfo(o,t,0).bufferedIndex;if(u>-1&&u<o.length-1){const f=je.bufferedInfo(o,e,0).bufferedIndex,h=o[u].end,d=o[u+1].start;if((f===-1||f>u)&&d-h<1&&e-h<2){const m=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${h} -> ${d} buffered index: ${f}`);this.warn(m.message),this.media.currentTime+=1e-6;let p=rc(e,this.fragmentTracker);p&&"fragment"in p?p=p.fragment:p||(p=void 0);const v=je.bufferInfo(this.media,e,0);this.hls.trigger(R.ERROR,{type:ke.MEDIA_ERROR,details:te.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:m,reason:m.message,frag:p,buffer:v.len,bufferInfo:v})}}}}}_tryFixBufferStall(e,t,i){var n,r;const{fragmentTracker:o,media:u}=this,f=(n=this.hls)==null?void 0:n.config;if(!u||!o||!f)return;const h=(r=this.hls)==null?void 0:r.latestLevelDetails,d=rc(i,o);if((d||h!=null&&h.live&&i<h.fragmentStart)&&(this._trySkipBufferHole(d)||!this.media))return;const m=e.buffered,p=this.adjacentTraversal(e,i);(m&&m.length>1&&e.len>f.maxBufferHole||e.nextStart&&(e.nextStart-i<f.maxBufferHole||p))&&(t>f.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const i=this.fragmentTracker,n=e.nextStart;if(i&&n){const r=i.getFragAtPos(t,_e.MAIN),o=i.getFragAtPos(n,_e.MAIN);if(r&&o)return o.sn-r.sn<2}return!1}_reportStall(e){const{hls:t,media:i,stallReported:n,stalled:r}=this;if(!n&&r!==null&&i&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${Lt(e)})`);this.warn(o.message),t.trigger(R.ERROR,{type:ke.MEDIA_ERROR,details:te.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:r}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:i,media:n}=this,r=(t=this.hls)==null?void 0:t.config;if(!n||!i||!r)return 0;const o=n.currentTime,u=je.bufferInfo(n,o,0),f=o<u.start?u.start:u.nextStart;if(f&&this.hls){const d=u.len<=r.maxBufferHole,m=u.len>0&&u.len<1&&n.readyState<3,p=f-o;if(p>0&&(d||m)){if(p>r.maxBufferHole){let y=!1;if(o===0){const T=i.getAppendedFrag(0,_e.MAIN);T&&f<T.end&&(y=!0)}if(!y&&e){var h;if(!((h=this.hls.loadLevelObj)!=null&&h.details)||Fy(this.hls.inFlightFragments,f))return 0;let S=!1,b=e.end;for(;b<f;){const C=rc(b,i);if(C)b+=C.duration;else{S=!0;break}}if(S)return 0}}const v=Math.max(f+ZI,o+WI);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${v}`),this.moved=!0,n.currentTime=v,!(e!=null&&e.gap)){const y=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${v}`),T={type:ke.MEDIA_ERROR,details:te.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:y,reason:y.message,buffer:u.len,bufferInfo:u};e&&("fragment"in e?T.part=e:T.frag=e),this.hls.trigger(R.ERROR,T)}return v}}return 0}_tryNudgeBuffer(e){const{hls:t,media:i,nudgeRetry:n}=this,r=t?.config;if(!i||!r)return 0;const o=i.currentTime;if(this.nudgeRetry++,n<r.nudgeMaxRetry){const u=o+(n+1)*r.nudgeOffset,f=new Error(`Nudging 'currentTime' from ${o} to ${u}`);this.warn(f.message),i.currentTime=u,t.trigger(R.ERROR,{type:ke.MEDIA_ERROR,details:te.BUFFER_NUDGE_ON_STALL,error:f,fatal:!1,buffer:e.len,bufferInfo:e})}else{const u=new Error(`Playhead still not moving while enough data buffered @${o} after ${r.nudgeMaxRetry} nudges`);this.error(u.message),t.trigger(R.ERROR,{type:ke.MEDIA_ERROR,details:te.BUFFER_STALLED_ERROR,error:u,fatal:!0,buffer:e.len,bufferInfo:e})}}}function Fy(l,e){const t=ky(l.main);if(t&&t.start<=e)return t;const i=ky(l.audio);return i&&i.start<=e?i:null}function ky(l){if(!l)return null;switch(l.state){case ce.IDLE:case ce.STOPPED:case ce.ENDED:case ce.ERROR:return null}return l.frag}function rc(l,e){return e.getAppendedFrag(l,_e.MAIN)||e.getPartialFragment(l)}const iB=.25;function tg(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function yd(l,e,t,i,n){let r=new l(e,t,"");try{r.value=i,n&&(r.type=n)}catch{r=new l(e,t,Lt(n?At({type:n},i):i))}return r}const ac=(()=>{const l=tg();try{l&&new l(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class nB{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(R.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(R.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(R.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var i;this.media=t.media,((i=t.overrides)==null?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&ja(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const i=e[t];if(i.kind==="metadata"&&i.label==="id3")return NT(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:i,enableID3MetadataCues:n}=this.hls.config;if(!i&&!n)return;const{samples:r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=tg();if(o)for(let u=0;u<r.length;u++){const f=r[u].type;if(f===Fi.emsg&&!i||!n)continue;const h=oT(r[u].data),d=r[u].pts;let m=d+r[u].duration;m>ac&&(m=ac),m-d<=0&&(m=d+iB);for(let v=0;v<h.length;v++){const y=h[v];if(!lT(y)){this.updateId3CueEnds(d,f);const T=yd(o,d,m,y,f);T&&this.id3Track.addCue(T)}}}}updateId3CueEnds(e,t){var i;const n=(i=this.id3Track)==null?void 0:i.cues;if(n)for(let r=n.length;r--;){const o=n[r];o.type===t&&o.startTime<e&&o.endTime===ac&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:n}){const{id3Track:r,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:u,enableID3MetadataCues:f}}=o;if(r&&(u||f)){let h;n==="audio"?h=d=>d.type===Fi.audioId3&&f:n==="video"?h=d=>d.type===Fi.emsg&&u:h=d=>d.type===Fi.audioId3&&f||d.type===Fi.emsg&&u,qd(r,t,i,h)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:i,timelineOffset:n,enableDateRangeMetadataCues:r,interstitialsController:o}=this.hls.config;if(!r)return;const u=tg();if(i&&n&&!o){const{fragmentStart:T,fragmentEnd:S}=e;let b=this.assetCue;b?(b.startTime=T,b.endTime=S):u&&(b=this.assetCue=yd(u,T,S,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),b&&(b.id=i,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(b),b.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:f}=this,{dateRanges:h}=e,d=Object.keys(h);let m=this.dateRangeCuesAppended;if(f&&t){var p;if((p=f.cues)!=null&&p.length){const T=Object.keys(m).filter(S=>!d.includes(S));for(let S=T.length;S--;){var v;const b=T[S],C=(v=m[b])==null?void 0:v.cues;delete m[b],C&&Object.keys(C).forEach(L=>{const D=C[L];if(D){D.removeEventListener("enter",this.onEventCueEnter);try{f.removeCue(D)}catch{}}})}}else m=this.dateRangeCuesAppended={}}const y=e.fragments[e.fragments.length-1];if(!(d.length===0||!xe(y?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let T=0;T<d.length;T++){const S=d[T],b=h[S],C=b.startTime,L=m[S],D=L?.cues||{};let _=L?.durationKnown||!1,w=ac;const{duration:I,endDate:O}=b;if(O&&I!==null)w=C+I,_=!0;else if(b.endOnNext&&!_){const M=d.reduce((H,P)=>{if(P!==b.id){const z=h[P];if(z.class===b.class&&z.startDate>b.startDate&&(!H||b.startDate<H.startDate))return z}return H},null);M&&(w=M.startTime,_=!0)}const F=Object.keys(b.attr);for(let M=0;M<F.length;M++){const H=F[M];if(!wL(H))continue;const P=D[H];if(P)_&&!(L!=null&&L.durationKnown)?P.endTime=w:Math.abs(P.startTime-C)>.01&&(P.startTime=C,P.endTime=w);else if(u){let z=b.attr[H];UL(H)&&(z=AE(z));const Z=yd(u,C,w,{key:H,data:z},Fi.dateRange);Z&&(Z.id=S,this.id3Track.addCue(Z),D[H]=Z,o&&(H==="X-ASSET-LIST"||H==="X-ASSET-URL")&&Z.addEventListener("enter",this.onEventCueEnter))}}m[S]={cues:D,dateRange:b,durationKnown:_}}}}}class sB{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,i=this.levelDetails;if(!t||!i)return;this.currentTime=t.currentTime;const n=this.computeLatency();if(n===null)return;this._latency=n;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:o}=this.config;if(!r||o===1||!i.live)return;const u=this.targetLatency;if(u===null)return;const f=n-u,h=Math.min(this.maxLatency,u+i.targetduration);if(f<h&&f>.05&&this.forwardBufferLength>1){const m=Math.min(2,Math.max(1,o)),p=Math.round(2/(1+Math.exp(-.75*f-this.edgeStalled))*20)/20,v=Math.min(m,Math.max(1,p));this.changeMediaPlaybackRate(t,v)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:i,targetduration:n}=e,{liveSyncDuration:r,liveSyncDurationCount:o,lowLatencyMode:u}=this.config,f=this.hls.userConfig;let h=u&&i||t;(this._targetLatencyUpdated||f.liveSyncDuration||f.liveSyncDurationCount||h===0)&&(h=r!==void 0?r:o*n);const d=n;return h+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,d)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const i=this.levelDetails;if(i===null)return null;const n=i.edge,r=e-t-this.edgeStalled,o=n-i.totalduration,u=n-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(o,r),u)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(R.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(R.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var i;t.details===te.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(i=this.levelDetails)!=null&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var i,n;e.playbackRate!==t&&((i=this.hls)==null||i.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(n=this.targetLatency)==null?void 0:n.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class rB extends Nc{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(R.LEVEL_LOADED,this.onLevelLoaded,this),e.on(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(R.FRAG_BUFFERED,this.onFragBuffered,this),e.on(R.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(R.LEVEL_LOADED,this.onLevelLoaded,this),e.off(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(R.FRAG_BUFFERED,this.onFragBuffered,this),e.off(R.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const i=this.hls.config.preferManagedMediaSource,n=[],r={},o={};let u=!1,f=!1,h=!1;t.levels.forEach(d=>{const m=d.attrs;let{audioCodec:p,videoCodec:v}=d;p&&(d.audioCodec=p=Tc(p,i)||void 0),v&&(v=d.videoCodec=tL(v));const{width:y,height:T,unknownCodecs:S}=d,b=S?.length||0;if(u||(u=!!(y&&T)),f||(f=!!v),h||(h=!!p),b||p&&!this.isAudioSupported(p)||v&&!this.isVideoSupported(v)){this.log(`Some or all CODECS not supported "${m.CODECS}"`);return}const{CODECS:C,"FRAME-RATE":L,"HDCP-LEVEL":D,"PATHWAY-ID":_,RESOLUTION:w,"VIDEO-RANGE":I}=m,F=`${`${_||"."}-`}${d.bitrate}-${w}-${L}-${C}-${I}-${D}`;if(r[F])if(r[F].uri!==d.url&&!d.attrs["PATHWAY-ID"]){const M=o[F]+=1;d.attrs["PATHWAY-ID"]=new Array(M+1).join(".");const H=this.createLevel(d);r[F]=H,n.push(H)}else r[F].addGroupId("audio",m.AUDIO),r[F].addGroupId("text",m.SUBTITLES);else{const M=this.createLevel(d);r[F]=M,o[F]=1,n.push(M)}}),this.filterAndSortMediaOptions(n,t,u,f,h)}createLevel(e){const t=new io(e),i=e.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){const n=new Error(`SUPPLEMENTAL-CODECS not supported "${i.videoCodec}"`);this.log(n.message),t.supportedResult=_E(n,[])}return t}isAudioSupported(e){return El(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return El(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,i,n,r){var o;let u=[],f=[],h=e;const d=((o=t.stats)==null?void 0:o.parsing)||{};if((i||n)&&r&&(h=h.filter(({videoCodec:C,videoRange:L,width:D,height:_})=>(!!C||!!(D&&_))&&fL(L))),h.length===0){Promise.resolve().then(()=>{if(this.hls){let C="no level with compatible codecs found in manifest",L=C;t.levels.length&&(L=`one or more CODECS in variant not supported: ${Lt(t.levels.map(_=>_.attrs.CODECS).filter((_,w,I)=>I.indexOf(_)===w))}`,this.warn(L),C+=` (${L})`);const D=new Error(C);this.hls.trigger(R.ERROR,{type:ke.MEDIA_ERROR,details:te.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:D,reason:L})}}),d.end=performance.now();return}t.audioTracks&&(u=t.audioTracks.filter(C=>!C.audioCodec||this.isAudioSupported(C.audioCodec)),wy(u)),t.subtitles&&(f=t.subtitles,wy(f));const m=h.slice(0);h.sort((C,L)=>{if(C.attrs["HDCP-LEVEL"]!==L.attrs["HDCP-LEVEL"])return(C.attrs["HDCP-LEVEL"]||"")>(L.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&C.height!==L.height)return C.height-L.height;if(C.frameRate!==L.frameRate)return C.frameRate-L.frameRate;if(C.videoRange!==L.videoRange)return Sc.indexOf(C.videoRange)-Sc.indexOf(L.videoRange);if(C.videoCodec!==L.videoCodec){const D=_v(C.videoCodec),_=_v(L.videoCodec);if(D!==_)return _-D}if(C.uri===L.uri&&C.codecSet!==L.codecSet){const D=Ec(C.codecSet),_=Ec(L.codecSet);if(D!==_)return _-D}return C.averageBitrate!==L.averageBitrate?C.averageBitrate-L.averageBitrate:0});let p=m[0];if(this.steering&&(h=this.steering.filterParsedLevels(h),h.length!==m.length)){for(let C=0;C<m.length;C++)if(m[C].pathwayId===h[0].pathwayId){p=m[C];break}}this._levels=h;for(let C=0;C<h.length;C++)if(h[C]===p){var v;this._firstLevel=C;const L=p.bitrate,D=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${h.length} level(s) found, first bitrate: ${L}`),((v=this.hls.userConfig)==null?void 0:v.abrEwmaDefaultEstimate)===void 0){const _=Math.min(L,this.hls.config.abrEwmaDefaultEstimateMax);_>D&&D===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=_)}break}const y=r&&!n,T=this.hls.config,S=!!(T.audioStreamController&&T.audioTrackController),b={levels:h,audioTracks:u,subtitleTracks:f,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:n,altAudio:S&&!y&&u.some(C=>!!C.url)};d.end=performance.now(),this.hls.trigger(R.MANIFEST_PARSED,b)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const d=new Error("invalid level idx"),m=e<0;if(this.hls.trigger(R.ERROR,{type:ke.OTHER_ERROR,details:te.LEVEL_SWITCH_ERROR,level:e,fatal:m,error:d,reason:d.message}),m)return;e=Math.min(e,t.length-1)}const i=this.currentLevelIndex,n=this.currentLevel,r=n?n.attrs["PATHWAY-ID"]:void 0,o=t[e],u=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,i===e&&n&&r===u)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${u?" with Pathway "+u:""} from level ${i}${r?" with Pathway "+r:""}`);const f={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(R.LEVEL_SWITCHING,f);const h=o.details;if(!h||h.live){const d=this.switchParams(o.uri,n?.details,h);this.loadPlaylist(d)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),i=e.filter(n=>t.indexOf(n)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=i}}onError(e,t){t.fatal||!t.context||t.context.type===tt.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===_e.MAIN){const i=t.elementaryStreams;if(!Object.keys(i).some(r=>!!i[r]))return;const n=this._levels[t.level];n!=null&&n.loadError&&(this.log(`Resetting level error count of ${n.loadError} on frag buffered`),n.loadError=0)}}onLevelLoaded(e,t){var i;const{level:n,details:r}=t,o=t.levelInfo;if(!o){var u;this.warn(`Invalid level index ${n}`),(u=t.deliveryDirectives)!=null&&u.skip&&(r.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let f=o.details;f===t.details&&f.advanced&&(f=void 0),this.playlistLoaded(n,t,f)}else(i=t.deliveryDirectives)!=null&&i.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=this.getUrlWithDirectives(e.uri,t),n=this.currentLevelIndex,r=e.attrs["PATHWAY-ID"],o=e.details,u=o?.age;this.log(`Loading level index ${n}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${r?" Pathway "+r:""}${u&&o.live?" age "+u.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(R.LEVEL_LOADING,{url:i,level:n,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const i=this._levels.filter((r,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(r),r===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,r.details&&r.details.fragments.forEach(u=>u.level=-1)),!1));qE(i),this._levels=i,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const n=i.length-1;this._firstLevel=Math.min(this._firstLevel,n),this._startLevel&&(this._startLevel=Math.min(this._startLevel,n)),this.hls.trigger(R.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(R.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}function wy(l){const e={};l.forEach(t=>{const i=t.groupId||"";t.id=e[i]=e[i]||0,e[i]++})}function iS(){return self.SourceBuffer||self.WebKitSourceBuffer}function wg(){if(!Bs())return!1;const e=iS();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function nS(){if(!wg())return!1;const l=Bs();return typeof l?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>l.isTypeSupported(Tl(e,"video")))||["mp4a.40.2","fLaC"].some(e=>l.isTypeSupported(Tl(e,"audio"))))}function aB(){var l;const e=iS();return typeof(e==null||(l=e.prototype)==null?void 0:l.changeType)=="function"}const oB=100;class lB extends Uc{constructor(e,t,i){super(e,t,i,"stream-controller",_e.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const n=this.media,r=n?n.currentTime:null;if(r===null||!xe(r)||(this.log(`Media seeked to ${r.toFixed(3)}`),!this.getBufferedFrag(r)))return;const o=this.getFwdBufferInfoAtPos(n,r,_e.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${r} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.LEVEL_LOADING,this.onLevelLoading,this),e.on(R.LEVEL_LOADED,this.onLevelLoaded,this),e.on(R.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(R.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(R.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(R.BUFFER_CREATED,this.onBufferCreated,this),e.on(R.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(R.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.LEVEL_LOADED,this.onLevelLoaded,this),e.off(R.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(R.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(R.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(R.BUFFER_CREATED,this.onBufferCreated,this),e.off(R.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(R.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:i,hls:n}=this;if(this.stopLoad(),this.setInterval(oB),this.level=-1,!this.startFragRequested){let r=n.startLevel;r===-1&&(n.config.testBandwidth&&this.levels.length>1?(r=0,this.bitrateTest=!0):r=n.firstAutoLevel),n.nextLoadLevel=r,this.level=n.loadLevel,this._hasEnoughToStart=!!t}i>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i),this.state=ce.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=ce.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ce.WAITING_LEVEL:{const{levels:e,level:t}=this,i=e?.[t],n=i?.details;if(n&&(!n.live||this.levelLastLoaded===i&&!this.waitForLive(i))){if(this.waitForCdnTuneIn(n))break;this.state=ce.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ce.IDLE;break}break}case ce.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===ce.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:i,media:n}=this;if(t===null||!n&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const r=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(i!=null&&i[r]))return;const o=i[r],u=this.getMainFwdBufferInfo();if(u===null)return;const f=this.getLevelDetails();if(f&&this._streamEnded(u,f)){const T={};this.altAudio===2&&(T.type="video"),this.hls.trigger(R.BUFFER_EOS,T),this.state=ce.ENDED;return}if(!this.buffering)return;e.loadLevel!==r&&e.manualLevel===-1&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=e.nextLoadLevel=r;const h=o.details;if(!h||this.state===ce.WAITING_LEVEL||this.waitForLive(o)){this.level=r,this.state=ce.WAITING_LEVEL,this.startFragRequested=!1;return}const d=u.len,m=this.getMaxBufferLength(o.maxBitrate);if(d>=m)return;this.backtrackFragment&&this.backtrackFragment.start>u.end&&(this.backtrackFragment=null);const p=this.backtrackFragment?this.backtrackFragment.start:u.end;let v=this.getNextFragment(p,h);if(this.couldBacktrack&&!this.fragPrevious&&v&&Zt(v)&&this.fragmentTracker.getState(v)!==si.OK){var y;const S=((y=this.backtrackFragment)!=null?y:v).sn-h.startSN,b=h.fragments[S-1];b&&v.cc===b.cc&&(v=b,this.fragmentTracker.removeFragment(b))}else this.backtrackFragment&&u.len&&(this.backtrackFragment=null);if(v&&this.isLoopLoading(v,p)){if(!v.gap){const S=this.audioOnly&&!this.altAudio?Rt.AUDIO:Rt.VIDEO,b=(S===Rt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;b&&this.afterBufferFlushed(b,S,_e.MAIN)}v=this.getNextFragmentLoopLoading(v,h,u,_e.MAIN,m)}v&&(v.initSegment&&!v.initSegment.data&&!this.bitrateTest&&(v=v.initSegment),this.loadFragment(v,o,p))}loadFragment(e,t,i){const n=this.fragmentTracker.getState(e);n===si.NOT_LOADED||n===si.PARTIAL?Zt(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,i):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,_e.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let i;const n=this.getAppendedFrag(t.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);const r=this.getLevelDetails();if(r!=null&&r.live){const u=this.getMainFwdBufferInfo();if(!u||u.len<r.targetduration*2)return}if(!t.paused&&e){const u=this.hls.nextLoadLevel,f=e[u],h=this.fragLastKbps;h&&this.fragCurrent?i=this.fragCurrent.duration*f.maxBitrate/(1e3*h)+1:i=0}else i=0;const o=this.getBufferedFrag(t.currentTime+i);if(o){const u=this.followingBufferedFrag(o);if(u){this.abortCurrentFrag();const f=u.maxStartPTS?u.maxStartPTS:u.start,h=u.duration,d=Math.max(o.end,f+Math.min(Math.max(h-this.config.maxFragLookUpTolerance,h*(this.couldBacktrack?.5:.125)),h*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(d,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ce.KEY_LOADING:case ce.FRAG_LOADING:case ce.FRAG_LOADING_WAITING_RETRY:case ce.PARSING:case ce.PARSED:this.state=ce.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const i=t.media;Ci(i,"playing",this.onMediaPlaying),Ci(i,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:i}=this;i&&(ki(i,"playing",this.onMediaPlaying),ki(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(R.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let i=!1,n=!1;for(let r=0;r<t.levels.length;r++){const o=t.levels[r].audioCodec;o&&(i=i||o.indexOf("mp4a.40.2")!==-1,n=n||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=i&&n&&!aB(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:i}=this;if(!i||this.state!==ce.IDLE)return;const n=t.levelInfo;(!n.details||n.details.live&&(this.levelLastLoaded!==n||n.details.expired)||this.waitForCdnTuneIn(n.details))&&(this.state=ce.WAITING_LEVEL)}onLevelLoaded(e,t){var i;const{levels:n,startFragRequested:r}=this,o=t.level,u=t.details,f=u.totalduration;if(!n){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${u.startSN},${u.endSN}]${u.lastPartSn?`[part-${u.lastPartSn}-${u.lastPartIndex}]`:""}, cc [${u.startCC}, ${u.endCC}] duration:${f}`);const h=t.levelInfo,d=this.fragCurrent;d&&(this.state===ce.FRAG_LOADING||this.state===ce.FRAG_LOADING_WAITING_RETRY)&&d.level!==t.level&&d.loader&&this.abortCurrentFrag();let m=0;if(u.live||(i=h.details)!=null&&i.live){var p;if(this.checkLiveUpdate(u),u.deltaUpdateFailed)return;m=this.alignPlaylists(u,h.details,(p=this.levelLastLoaded)==null?void 0:p.details)}if(h.details=u,this.levelLastLoaded=h,r||this.setStartPosition(u,m),this.hls.trigger(R.LEVEL_UPDATED,{details:u,level:o}),this.state===ce.WAITING_LEVEL){if(this.waitForCdnTuneIn(u))return;this.state=ce.IDLE}r&&u.live&&this.synchronizeToLiveEdge(u),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:i}=this;if(!i)return;const n=this.hls.liveSyncPosition,r=this.getLoadPosition(),o=e.fragmentStart,u=e.edge,f=r>=o-t.maxFragLookUpTolerance&&r<=u;if(n!==null&&i.duration>n&&(r<n||!f)){const d=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!f&&i.readyState<4||r<u-d)&&(this._hasEnoughToStart||(this.nextLoadPosition=n),i.readyState))if(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${u}, reset currentTime to : ${n.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var h;const m=je.bufferInfo(i,n,0);if(!((h=m.buffered)!=null&&h.length)){i.currentTime=n;return}if(m.start<=r){i.currentTime=n;return}const{nextStart:v}=je.bufferedInfo(m.buffered,r,0);v&&(i.currentTime=v)}else i.currentTime=n}}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:n,payload:r}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const u=o[i.level];if(!u){this.warn(`Level ${i.level} not found on progress`);return}const f=u.details;if(!f){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const h=u.videoCodec,d=f.PTSKnown||!f.live,m=(t=i.initSegment)==null?void 0:t.data,p=this._getAudioCodec(u),v=this.transmuxer=this.transmuxer||new yT(this.hls,_e.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),y=n?n.index:-1,T=y!==-1,S=new wc(i.level,i.sn,i.stats.chunkCount,r.byteLength,y,T),b=this.initPTS[i.cc];v.push(r,m,p,h,i,n,f.totalduration,d,S,b)}onAudioTrackSwitching(e,t){const i=this.hls,n=this.altAudio===2;if(bc(t.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(n){this.fragmentTracker.removeAllFragments(),i.once(R.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(R.AUDIO_TRACK_SWITCHED,t)}),i.trigger(R.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}i.trigger(R.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const i=bc(t.url,this.hls);if(i){const n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=i?2:0,this.tick()}onBufferCreated(e,t){const i=t.tracks;let n,r,o=!1;for(const u in i){const f=i[u];if(f.id==="main"){if(r=u,n=f,u==="video"){const h=i[u];h&&(this.videoBuffer=h.buffer)}}else o=!0}o&&n?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:i,part:n}=t,r=i.type===_e.MAIN;if(r){if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${n?" p: "+n.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ce.PARSED&&(this.state=ce.IDLE);return}const u=n?n.stats:i.stats;this.fragLastKbps=Math.round(8*u.total/(u.buffering.end-u.loading.first)),Zt(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,n)}const o=this.media;o&&(!this._hasEnoughToStart&&je.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var i;if(t.fatal){this.state=ce.ERROR;return}switch(t.details){case te.FRAG_GAP:case te.FRAG_PARSING_ERROR:case te.FRAG_DECRYPT_ERROR:case te.FRAG_LOAD_ERROR:case te.FRAG_LOAD_TIMEOUT:case te.KEY_LOAD_ERROR:case te.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(_e.MAIN,t);break;case te.LEVEL_LOAD_ERROR:case te.LEVEL_LOAD_TIMEOUT:case te.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ce.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===tt.LEVEL&&(this.state=ce.IDLE);break;case te.BUFFER_ADD_CODEC_ERROR:case te.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case te.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case te.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=ce.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Rt.AUDIO||!this.altAudio){const i=(t===Rt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,t,_e.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${t}`);return}const n=this.timelineOffset;n&&i&&(i+=n);const r=this.getLevelDetails(),o=je.getBuffered(e),u=o.length?o.start(0):0,f=u-i,h=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||f>0&&(f<h||this.loadingParts&&f<2*(r?.partTarget||0)))&&(this.log(`adjusting start position by ${f} to match buffer start`),i+=f,this.startPosition=i),t<i&&(this.log(`seek to target start position ${i} from current time ${t} buffer start ${u}`),e.currentTime=i)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(i=>{const{hls:n}=this,r=i?.frag;if(!r||this.fragContextChanged(r))return;t.fragmentError=0,this.state=ce.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=r.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),n.trigger(R.FRAG_LOADED,i),r.bitrateTest=!1}).catch(i=>{this.state===ce.STOPPED||this.state===ce.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:i}=this,{remuxResult:n,chunkMeta:r}=e,o=this.getCurrentContext(r);if(!o){this.resetWhenMissingContext(r);return}const{frag:u,part:f,level:h}=o,{video:d,text:m,id3:p,initSegment:v}=n,{details:y}=h,T=this.altAudio?void 0:n.audio;if(this.fragContextChanged(u)){this.fragmentTracker.removeFragment(u);return}if(this.state=ce.PARSING,v){const S=v.tracks;if(S){const D=u.initSegment||u;if(this.unhandledEncryptionError(v,u))return;this._bufferInitSegment(h,S,D,r),i.trigger(R.FRAG_PARSING_INIT_SEGMENT,{frag:D,id:t,tracks:S})}const b=v.initPTS,C=v.timescale,L=this.initPTS[u.cc];if(xe(b)&&(!L||L.baseTime!==b||L.timescale!==C)){const D=v.trackId;this.initPTS[u.cc]={baseTime:b,timescale:C,trackId:D},i.trigger(R.INIT_PTS_FOUND,{frag:u,id:t,initPTS:b,timescale:C,trackId:D})}}if(d&&y){T&&d.type==="audiovideo"&&this.logMuxedErr(u);const S=y.fragments[u.sn-1-y.startSN],b=u.sn===y.startSN,C=!S||u.cc>S.cc;if(n.independent!==!1){const{startPTS:L,endPTS:D,startDTS:_,endDTS:w}=d;if(f)f.elementaryStreams[d.type]={startPTS:L,endPTS:D,startDTS:_,endDTS:w};else if(d.firstKeyFrame&&d.independent&&r.id===1&&!C&&(this.couldBacktrack=!0),d.dropped&&d.independent){const I=this.getMainFwdBufferInfo(),O=(I?I.end:this.getLoadPosition())+this.config.maxBufferHole,F=d.firstKeyFramePTS?d.firstKeyFramePTS:L;if(!b&&O<F-this.config.maxBufferHole&&!C){this.backtrack(u);return}else C&&(u.gap=!0);u.setElementaryStreamInfo(d.type,u.start,D,u.start,w,!0)}else b&&L-(y.appliedTimelineOffset||0)>pc&&(u.gap=!0);u.setElementaryStreamInfo(d.type,L,D,_,w),this.backtrackFragment&&(this.backtrackFragment=u),this.bufferFragmentData(d,u,f,r,b||C)}else if(b||C)u.gap=!0;else{this.backtrack(u);return}}if(T){const{startPTS:S,endPTS:b,startDTS:C,endDTS:L}=T;f&&(f.elementaryStreams[Rt.AUDIO]={startPTS:S,endPTS:b,startDTS:C,endDTS:L}),u.setElementaryStreamInfo(Rt.AUDIO,S,b,C,L),this.bufferFragmentData(T,u,f,r)}if(y&&p!=null&&p.samples.length){const S={id:t,frag:u,details:y,samples:p.samples};i.trigger(R.FRAG_PARSING_METADATA,S)}if(y&&m){const S={id:t,frag:u,details:y,samples:m.samples};i.trigger(R.FRAG_PARSING_USERDATA,S)}}logMuxedErr(e){this.warn(`${Zt(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,i,n){if(this.state!==ce.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(i));const{audio:r,video:o,audiovideo:u}=t;if(r){const h=e.audioCodec;let d=cc(r.codec,h);d==="mp4a"&&(d="mp4a.40.5");const m=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){d&&(d.indexOf("mp4a.40.5")!==-1?d="mp4a.40.2":d="mp4a.40.5");const p=r.metadata;p&&"channelCount"in p&&(p.channelCount||1)!==1&&m.indexOf("firefox")===-1&&(d="mp4a.40.5")}d&&d.indexOf("mp4a.40.5")!==-1&&m.indexOf("android")!==-1&&r.container!=="audio/mpeg"&&(d="mp4a.40.2",this.log(`Android: force audio codec to ${d}`)),h&&h!==d&&this.log(`Swapping manifest audio codec "${h}" for "${d}"`),r.levelCodec=d,r.id=_e.MAIN,this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${d||""}/${h||""}/${r.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=_e.MAIN;const h=o.codec;if(h?.length===4)switch(h){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${h}]${o.codec!==h?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}u&&(this.log(`Init audiovideo buffer, container:${u.container}, codecs[level/parsed]=[${e.codecs}/${u.codec}]`),delete t.video,delete t.audio);const f=Object.keys(t);if(f.length){if(this.hls.trigger(R.BUFFER_CODECS,t),!this.hls)return;f.forEach(h=>{const m=t[h].initSegment;m!=null&&m.byteLength&&this.hls.trigger(R.BUFFER_APPENDING,{type:h,data:m,frag:i,part:null,chunkMeta:n,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,_e.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,i=e?.[t];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ce.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const i=e.currentTime;if(je.isBuffered(e,i)?t=this.getAppendedFrag(i):je.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;const n=this.fragPlaying,r=t.level;(!n||t.sn!==n.sn||n.level!==r)&&(this.fragPlaying=t,this.hls.trigger(R.FRAG_CHANGED,{frag:t}),(!n||n.level!==r)&&this.hls.trigger(R.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return xe(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(xe(t)){const i=this.getLevelDetails(),n=this.currentFrag||(i?Jr(null,i.fragments,t):null);if(n){const r=n.programDateTime;if(r!==null){const o=r+(t-n.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class uB extends gn{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const i in this.keyIdToKeyInfo){const n=this.keyIdToKeyInfo[i].loader;if(n){var t;if(e&&e!==((t=n.context)==null?void 0:t.frag.type))return;n.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=te.KEY_LOAD_ERROR,i,n,r){return new Rs({type:ke.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:i,networkDetails:n})}loadClear(e,t,i){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let n=0,r=t.length;n<r;n++){const o=t[n];if(e.cc<=o.cc&&(!Zt(e)||!Zt(o)||e.sn<o.sn)||!i&&n==r-1)return this.emeController.selectKeySystemFormat(o).then(u=>{if(!this.emeController)return;o.setKeyFormat(u);const f=fc(u);if(f)return this.emeController.getKeySystemAccess([f])})}if(this.config.requireKeySystemAccessOnStart){const n=ll(this.config);if(n.length)return this.emeController.getKeySystemAccess(n)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,n;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const h=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,te.KEY_LOAD_ERROR,h))}const o=r.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,te.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));const u=Ed(r);let f=this.keyIdToKeyInfo[u];if((i=f)!=null&&i.decryptdata.key)return r.key=f.decryptdata.key,Promise.resolve({frag:e,keyInfo:f});if(this.emeController&&(n=f)!=null&&n.keyLoadPromise)switch(this.emeController.getKeyStatus(f.decryptdata)){case"usable":case"usable-in-future":return f.keyLoadPromise.then(d=>{const{keyInfo:m}=d;return r.key=m.decryptdata.key,{frag:e,keyInfo:m}})}switch(this.log(`${this.keyIdToKeyInfo[u]?"Rel":"L"}oading${r.keyId?" keyId: "+xi(r.keyId):""} URI: ${r.uri} from ${e.type} ${e.level}`),f=this.keyIdToKeyInfo[u]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return r.keyFormat==="identity"?this.loadKeyHTTP(f,e):this.loadKeyEME(f,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(f,e);default:return Promise.reject(this.createKeyLoadError(e,te.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(e,t){const i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var n;if(!e.decryptdata.keyId&&(n=t.initSegment)!=null&&n.data){const o=VR(t.initSegment.data);if(o.length){const u=o[0];u.some(f=>f!==0)&&(this.log(`Using keyId found in init segment ${xi(u)}`),e.decryptdata.keyId=u,cr.setKeyIdForUri(e.decryptdata.uri,u))}}const r=this.emeController.loadKey(i);return(e.keyLoadPromise=r.then(o=>(e.mediaKeySessionContext=o,i))).catch(o=>{throw e.keyLoadPromise=null,"data"in o&&(o.data.frag=t),o})}return Promise.resolve(i)}loadKeyHTTP(e,t){const i=this.config,n=i.loader,r=new n(i);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise((o,u)=>{const f={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},h=i.keyLoadPolicy.default,d={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(p,v,y,T)=>{const{frag:S,keyInfo:b}=y,C=Ed(b.decryptdata);if(!S.decryptdata||b!==this.keyIdToKeyInfo[C])return u(this.createKeyLoadError(S,te.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),T));b.decryptdata.key=S.decryptdata.key=new Uint8Array(p.data),S.keyLoader=null,b.loader=null,o({frag:S,keyInfo:b})},onError:(p,v,y,T)=>{this.resetLoader(v),u(this.createKeyLoadError(t,te.KEY_LOAD_ERROR,new Error(`HTTP Error ${p.code} loading key ${p.text}`),y,At({url:f.url,data:void 0},p)))},onTimeout:(p,v,y)=>{this.resetLoader(v),u(this.createKeyLoadError(t,te.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),y))},onAbort:(p,v,y)=>{this.resetLoader(v),u(this.createKeyLoadError(t,te.INTERNAL_ABORTED,new Error("key loading aborted"),y))}};r.load(f,d,m)})}resetLoader(e){const{frag:t,keyInfo:i,url:n}=e,r=i.loader;t.keyLoader===r&&(t.keyLoader=null,i.loader=null);const o=Ed(i.decryptdata)||n;delete this.keyIdToKeyInfo[o],r&&r.destroy()}}function Ed(l){if(l.keyFormat!==ci.FAIRPLAY){const e=l.keyId;if(e)return xi(e)}return l.uri}function Uy(l){const{type:e}=l;switch(e){case tt.AUDIO_TRACK:return _e.AUDIO;case tt.SUBTITLE_TRACK:return _e.SUBTITLE;default:return _e.MAIN}}function Td(l,e){let t=l.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class cB{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.LEVEL_LOADING,this.onLevelLoading,this),e.on(R.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(R.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(R.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.LEVEL_LOADING,this.onLevelLoading,this),e.off(R.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(R.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(R.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,i=t.pLoader,n=t.loader,r=i||n,o=new r(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:tt.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:i,level:n,pathwayId:r,url:o,deliveryDirectives:u,levelInfo:f}=t;this.load({id:i,level:n,pathwayId:r,responseType:"text",type:tt.LEVEL,url:o,deliveryDirectives:u,levelOrTrack:f})}onAudioTrackLoading(e,t){const{id:i,groupId:n,url:r,deliveryDirectives:o,track:u}=t;this.load({id:i,groupId:n,level:null,responseType:"text",type:tt.AUDIO_TRACK,url:r,deliveryDirectives:o,levelOrTrack:u})}onSubtitleTrackLoading(e,t){const{id:i,groupId:n,url:r,deliveryDirectives:o,track:u}=t;this.load({id:i,groupId:n,level:null,responseType:"text",type:tt.SUBTITLE_TRACK,url:r,deliveryDirectives:o,levelOrTrack:u})}onLevelsUpdated(e,t){const i=this.loaders[tt.LEVEL];if(i){const n=i.context;n&&!t.levels.some(r=>r===n.levelOrTrack)&&(i.abort(),delete this.loaders[tt.LEVEL])}}load(e){var t;const i=this.hls.config;let n=this.getInternalLoader(e);if(n){const h=this.hls.logger,d=n.context;if(d&&d.levelOrTrack===e.levelOrTrack&&(d.url===e.url||d.deliveryDirectives&&!e.deliveryDirectives)){d.url===e.url?h.log(`[playlist-loader]: ignore ${e.url} ongoing request`):h.log(`[playlist-loader]: ignore ${e.url} in favor of ${d.url}`);return}h.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),n.abort()}let r;if(e.type===tt.MANIFEST?r=i.manifestLoadPolicy.default:r=xt({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),n=this.createInternalLoader(e),xe((t=e.deliveryDirectives)==null?void 0:t.part)){let h;if(e.type===tt.LEVEL&&e.level!==null?h=this.hls.levels[e.level].details:e.type===tt.AUDIO_TRACK&&e.id!==null?h=this.hls.audioTracks[e.id].details:e.type===tt.SUBTITLE_TRACK&&e.id!==null&&(h=this.hls.subtitleTracks[e.id].details),h){const d=h.partTarget,m=h.targetduration;if(d&&m){const p=Math.max(d*3,m*.8)*1e3;r=xt({},r,{maxTimeToFirstByteMs:Math.min(p,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(p,r.maxTimeToFirstByteMs)})}}}const o=r.errorRetry||r.timeoutRetry||{},u={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},f={onSuccess:(h,d,m,p)=>{const v=this.getInternalLoader(m);this.resetInternalLoader(m.type);const y=h.data;d.parsing.start=performance.now(),Cn.isMediaPlaylist(y)||m.type!==tt.MANIFEST?this.handleTrackOrLevelPlaylist(h,d,m,p||null,v):this.handleMasterPlaylist(h,d,m,p)},onError:(h,d,m,p)=>{this.handleNetworkError(d,m,!1,h,p)},onTimeout:(h,d,m)=>{this.handleNetworkError(d,m,!0,void 0,h)}};n.load(e,u,f)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:i}=this.hls;(e||i)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,i,n){const r=this.hls,o=e.data,u=Td(e,i),f=Cn.parseMasterPlaylist(o,u);if(f.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,i,f.playlistParsingError,n,t);return}const{contentSteering:h,levels:d,sessionData:m,sessionKeys:p,startTimeOffset:v,variableList:y}=f;this.variableList=y,d.forEach(C=>{const{unknownCodecs:L}=C;if(L){const{preferManagedMediaSource:D}=this.hls.config;let{audioCodec:_,videoCodec:w}=C;for(let I=L.length;I--;){const O=L[I];El(O,"audio",D)?(C.audioCodec=_=_?`${_},${O}`:O,to.audio[_.substring(0,4)]=2,L.splice(I,1)):El(O,"video",D)&&(C.videoCodec=w=w?`${w},${O}`:O,to.video[w.substring(0,4)]=2,L.splice(I,1))}}});const{AUDIO:T=[],SUBTITLES:S,"CLOSED-CAPTIONS":b}=Cn.parseMasterPlaylistMedia(o,u,f);T.length&&!T.some(L=>!L.url)&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),T.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Pt({}),bitrate:0,url:""})),r.trigger(R.MANIFEST_LOADED,{levels:d,audioTracks:T,subtitles:S,captions:b,contentSteering:h,url:u,stats:t,networkDetails:n,sessionData:m,sessionKeys:p,startTimeOffset:v,variableList:y})}handleTrackOrLevelPlaylist(e,t,i,n,r){const o=this.hls,{id:u,level:f,type:h}=i,d=Td(e,i),m=xe(f)?f:xe(u)?u:0,p=Uy(i),v=Cn.parseLevelPlaylist(e.data,d,m,p,0,this.variableList);if(h===tt.MANIFEST){const y={attrs:new Pt({}),bitrate:0,details:v,name:"",url:d};v.requestScheduled=t.loading.start+JE(v,0),o.trigger(R.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:d,stats:t,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=v,this.handlePlaylistLoaded(v,e,t,i,n,r)}handleManifestParsingError(e,t,i,n,r){this.hls.trigger(R.ERROR,{type:ke.NETWORK_ERROR,details:te.MANIFEST_PARSING_ERROR,fatal:t.type===tt.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:n,stats:r})}handleNetworkError(e,t,i=!1,n,r){let o=`A network ${i?"timeout":"error"+(n?" (status "+n.code+")":"")} occurred while loading ${e.type}`;e.type===tt.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===tt.AUDIO_TRACK||e.type===tt.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const u=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let f=te.UNKNOWN,h=!1;const d=this.getInternalLoader(e);switch(e.type){case tt.MANIFEST:f=i?te.MANIFEST_LOAD_TIMEOUT:te.MANIFEST_LOAD_ERROR,h=!0;break;case tt.LEVEL:f=i?te.LEVEL_LOAD_TIMEOUT:te.LEVEL_LOAD_ERROR,h=!1;break;case tt.AUDIO_TRACK:f=i?te.AUDIO_TRACK_LOAD_TIMEOUT:te.AUDIO_TRACK_LOAD_ERROR,h=!1;break;case tt.SUBTITLE_TRACK:f=i?te.SUBTITLE_TRACK_LOAD_TIMEOUT:te.SUBTITLE_LOAD_ERROR,h=!1;break}d&&this.resetInternalLoader(e.type);const m={type:ke.NETWORK_ERROR,details:f,fatal:h,url:e.url,loader:d,context:e,error:u,networkDetails:t,stats:r};if(n){const p=t?.url||e.url;m.response=At({url:p,data:void 0},n)}this.hls.trigger(R.ERROR,m)}handlePlaylistLoaded(e,t,i,n,r,o){const u=this.hls,{type:f,level:h,levelOrTrack:d,id:m,groupId:p,deliveryDirectives:v}=n,y=Td(t,n),T=Uy(n);let S=typeof n.level=="number"&&T===_e.MAIN?h:void 0;const b=e.playlistParsingError;if(b){if(this.hls.logger.warn(`${b} ${e.url}`),!u.config.ignorePlaylistParsingErrors){u.trigger(R.ERROR,{type:ke.NETWORK_ERROR,details:te.LEVEL_PARSING_ERROR,fatal:!1,url:y,error:b,reason:b.message,response:t,context:n,level:S,parent:T,networkDetails:r,stats:i});return}e.playlistParsingError=null}if(!e.fragments.length){const C=e.playlistParsingError=new Error("No Segments found in Playlist");u.trigger(R.ERROR,{type:ke.NETWORK_ERROR,details:te.LEVEL_EMPTY_ERROR,fatal:!1,url:y,error:C,reason:C.message,response:t,context:n,level:S,parent:T,networkDetails:r,stats:i});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),f){case tt.MANIFEST:case tt.LEVEL:if(S){if(!d)S=0;else if(d!==u.levels[S]){const C=u.levels.indexOf(d);C>-1&&(S=C)}}u.trigger(R.LEVEL_LOADED,{details:e,levelInfo:d||u.levels[0],level:S||0,id:m||0,stats:i,networkDetails:r,deliveryDirectives:v,withoutMultiVariant:f===tt.MANIFEST});break;case tt.AUDIO_TRACK:u.trigger(R.AUDIO_TRACK_LOADED,{details:e,track:d,id:m||0,groupId:p||"",stats:i,networkDetails:r,deliveryDirectives:v});break;case tt.SUBTITLE_TRACK:u.trigger(R.SUBTITLE_TRACK_LOADED,{details:e,track:d,id:m||0,groupId:p||"",stats:i,networkDetails:r,deliveryDirectives:v});break}}}class Ds{static get version(){return Sl}static isMSESupported(){return wg()}static isSupported(){return nS()}static getMediaSource(){return Bs()}static get Events(){return R}static get MetadataSchema(){return Fi}static get ErrorTypes(){return ke}static get ErrorDetails(){return te}static get DefaultConfig(){return Ds.defaultConfig?Ds.defaultConfig:JI}static set DefaultConfig(e){Ds.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new xg,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=MR(e.debug||!1,"Hls instance",e.assetPlayerId),i=this.config=QI(Ds.DefaultConfig,e,t);this.userConfig=e,i.progressive&&qI(i,t);const{abrController:n,bufferController:r,capLevelController:o,errorController:u,fpsController:f}=i,h=new u(this),d=this.abrController=new n(this),m=new xL(this),p=i.interstitialsController,v=p?this.interstitialsController=new p(this,Ds):null,y=this.bufferController=new r(this,m),T=this.capLevelController=new o(this),S=new f(this),b=new cB(this),C=i.contentSteeringController,L=C?new C(this):null,D=this.levelController=new rB(this,L),_=new nB(this),w=new uB(this.config,this.logger),I=this.streamController=new lB(this,m,w),O=this.gapController=new tB(this,m);T.setStreamController(I),S.setStreamController(I);const F=[b,D,I];v&&F.splice(1,0,v),L&&F.splice(1,0,L),this.networkControllers=F;const M=[d,y,O,T,S,_,m];this.audioTrackController=this.createController(i.audioTrackController,F);const H=i.audioStreamController;H&&F.push(this.audioStreamController=new H(this,m,w)),this.subtitleTrackController=this.createController(i.subtitleTrackController,F);const P=i.subtitleStreamController;P&&F.push(this.subtititleStreamController=new P(this,m,w)),this.createController(i.timelineController,M),w.emeController=this.emeController=this.createController(i.emeController,M),this.cmcdController=this.createController(i.cmcdController,M),this.latencyController=this.createController(sB,M),this.coreComponents=M,F.push(h);const z=h.onErrorOut;typeof z=="function"&&this.on(R.ERROR,z,h),this.on(R.MANIFEST_LOADED,b.onManifestLoaded,b)}createController(e,t){if(e){const i=new e(this);return t&&t.push(i),i}return null}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,n){this._emitter.off(e,t,i,n)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(i){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;const n=e===R.ERROR;this.trigger(R.ERROR,{type:ke.OTHER_ERROR,details:te.INTERNAL_EXCEPTION,fatal:n,event:e,error:i}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(R.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const r=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(R.ERROR,{type:ke.OTHER_ERROR,details:te.ATTACH_MEDIA_ERROR,fatal:!0,error:r});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,i=t?e.media:e,n=t?e:{media:i};this._media=i,this.trigger(R.MEDIA_ATTACHING,n)}detachMedia(){this.logger.log("detachMedia"),this.trigger(R.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(R.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,i=this._url,n=this._url=dg.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${n}`),t&&i&&(i!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(R.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let i=0;i<this.networkControllers.length&&(this.networkControllers[i].startLoad(e,t),!(!this.started||!this.networkControllers));i++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[_e.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[_e.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[_e.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=rI()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){cL(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const i=e.length;for(let n=0;n<i;n++)if(e[n].maxBitrate>=t)return n;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:i}=this;let n;if(t===-1&&e!=null&&e.length?n=e.length-1:n=t,i)for(let r=n;r--;){const o=e[r].attrs["HDCP-LEVEL"];if(o&&o<=i)return r}return n}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const i=ME(t);return IE(e,i,navigator.mediaCapabilities)}}Ds.defaultConfig=void 0;const fB=Object.freeze(Object.defineProperty({__proto__:null,AbrController:OE,AttrList:Pt,AudioStreamController:ET,AudioTrackController:ST,BasePlaylistController:Nc,BaseSegment:gg,BaseStreamController:Uc,BufferController:xT,CMCDController:kT,CapLevelController:Gc,ChunkMetadata:wc,ContentSteeringController:wT,Cues:eS,DateRange:Eg,EMEController:zr,ErrorActionFlags:Oi,ErrorController:PE,ErrorDetails:te,ErrorTypes:ke,Events:R,FPSController:PT,FetchLoader:Zd,Fragment:uc,Hls:Ds,HlsSkip:gl,HlsUrlParameters:Nd,KeySystemFormats:ci,KeySystems:Nt,Level:io,LevelDetails:HE,LevelKey:cr,LoadStats:Fc,M3U8Parser:Cn,MetadataSchema:Fi,NetworkErrorAction:ni,Part:vE,PlaylistLevelType:_e,SubtitleStreamController:VT,SubtitleTrackController:HT,TimelineController:WT,XhrLoader:kg,default:Ds,fetchSupported:tS,getMediaSource:Bs,isMSESupported:wg,isSupported:nS,requestMediaKeySystemAccess:bg},Symbol.toStringTag,{value:"Module"})),hB=((l,e)=>typeof window<"u"&&typeof((l=window.document)==null?void 0:l.createElement)=="function"&&typeof((e=window.navigator)==null?void 0:e.userAgent)=="string")();let Sd=null;async function dB(...l){var e;(e=Sd)!==null&&e!==void 0||(Sd=await bR(()=>Promise.resolve().then(()=>fB),void 0,import.meta.url));const t=Sd.default;return t.isSupported()?new t(...l):null}function BB(l,{unsuspend:e="loadedmetadata",start:t=!0,hls:i={},crossOrigin:n="anonymous",muted:r=!0,loop:o=!0,playsInline:u=!0,onVideoFrame:f,...h}={}){const d=_s(y=>y.gl),m=Ie.useRef(null),p=Py(()=>new Promise(async y=>{let T,S;typeof l=="string"?T=l:S=l;const b=Object.assign(document.createElement("video"),{src:T,srcObject:S,crossOrigin:n,loop:o,muted:r,playsInline:u,...h});if(T&&hB&&T.endsWith(".m3u8")){const L=m.current=await dB(i);L&&(L.on(R.MEDIA_ATTACHED,()=>void L.loadSource(T)),L.attachMedia(b))}const C=new Kb(b);C.colorSpace=d.outputColorSpace,b.addEventListener(e,()=>y(C))}),[l]),v=p.source.data;return gB(v,f),Ie.useEffect(()=>(t&&p.image.play(),()=>{m.current&&(m.current.destroy(),m.current=null)}),[p,t]),p}const gB=(l,e)=>{Ie.useEffect(()=>{if(!e||!l.requestVideoFrameCallback)return;let t;const i=(...n)=>{e(...n),t=l.requestVideoFrameCallback(i)};return l.requestVideoFrameCallback(i),()=>l.cancelVideoFrameCallback(t)},[l,e])},MB=Ie.forwardRef(({children:l,enabled:e=!0,speed:t=1,rotationIntensity:i=1,floatIntensity:n=1,floatingRange:r=[-.1,.1],autoInvalidate:o=!1,...u},f)=>{const h=Ie.useRef(null);Ie.useImperativeHandle(f,()=>h.current,[]);const d=Ie.useRef(Math.random()*1e4);return Bc(m=>{var p,v;if(!e||t===0)return;o&&m.invalidate();const y=d.current+m.clock.elapsedTime;h.current.rotation.x=Math.cos(y/4*t)/8*i,h.current.rotation.y=Math.sin(y/4*t)/8*i,h.current.rotation.z=Math.sin(y/4*t)/20*i;let T=Math.sin(y/4*t)/10;T=ag.mapLinear(T,-.1,.1,(p=r?.[0])!==null&&p!==void 0?p:-.1,(v=r?.[1])!==null&&v!==void 0?v:.1),h.current.position.y=T*n,h.current.updateMatrix()}),Ie.createElement("group",u,Ie.createElement("group",{ref:h,matrixAutoUpdate:!1},l))});export{MB as F,SB as H,DB as P,yB as R,xB as S,RB as T,bR as _,BB as a,hg as b,EB as c,TB as d,yR as e,LB as s,bB as u};
